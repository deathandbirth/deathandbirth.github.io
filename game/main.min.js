(function(){"use strict";function e(){At=new Vue({el:"#game-container",data:{isEnglish:!1,flag:qt,ver:s,verData:0,msgFixed:"",rogue:null,help:up,inventoryList:Fr.list,investigationList:or.list,colorList:Dt,msgListTemp:Na.listTemp,msgList:Na.list,msgTotal:"",barEnemy:null,barName:""}})}const t=(e,t,i)=>{let a=[];for(;e<=t;)a.push(i?1<<e++:e++);return a},i=(e,i)=>t(e,i),a=(e,i)=>t(e,i,!0),s=.1,l=0===window.location.href.split("/").pop().indexOf("debug"),r=45,n=25,o=2,h=r*o,d=n*o,m=4,c=5,p=c*m,u=Math.floor((d-(m-1))/m),g=Math.floor((h-(c-1))/c),b=4,f=4,y=2,k=4,v=k*y,w=Math.floor((r/2-2-k)/(k/2)),x=Math.floor((n/2-2-y)/(y/2)),S=8,R=10,B=4,L=6,M=20,q=10*M,E=q/M,I=4,$=2e3,A=10,D=12,z=13,C=99,P=100,T=20,N=20,O=10,F=1e4,V=9,G=4,H=6,W=100,j=2,U=10,Y=100,_=10,Z=5,J=15,K=J**2,X=400,Q=225,ee=n**2,te=5,ie=1e3,ae=100,se="a",le=-1,re=-1,ne=-1,oe=20,he=10,de=10,me=.2,ce=1e3,pe=0,ue=3e3,ge=.1,be=5,fe=50,ye=20,ke=3,ve=100,we="Arial, sans serif",[xe,Se,Re,Be,Le,Me,qe]=i(2,8),[Ee,Ie,$e,Ae]=i(1,4),[De,ze,Ce,Pe]=i(0,3),[Te,Ne,Oe]=i(0,2),[Fe,Ve,Ge,He,We]=i(0,4),[je,Ue,Ye,_e,Ze,Je,Ke,Xe]=a(1,8),[Qe,et,tt]=a(1,3),[it,at,st,lt,rt,nt,ot,ht,dt]=i(0,8),[mt,ct,pt,ut,gt,bt,ft,yt,kt]=i(1,9),vt=["a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"],wt=[{x:-1,y:0,id:it},{x:0,y:1,id:at},{x:0,y:-1,id:st},{x:1,y:0,id:lt},{x:-1,y:-1,id:rt},{x:-1,y:1,id:nt},{x:1,y:-1,id:ot},{x:1,y:1,id:ht}],xt={a:"main",b:"off",c:"neck",d:"R-ring",e:"L-ring",f:"light",g:"body",h:"back",i:"waist",j:"head",k:"hands",l:"feet"},St=["melee","missile","staff","shield","armor","cloak","belt","helm","gloves","boots","light","ring","amulet"],Rt={ring:.1,amulet:.2,book:1,potion:.2,scroll:.1,recipe:.1,wand:.5,gem:.1,orb:.1,coin:.1,food:.3,material:.2},Bt={book:100,food:50,potion:25,scroll:25,recipe:25,wand:300,melee:100,missile:100,staff:100,shield:50,armor:100,cloak:50,belt:50,helm:50,gloves:50,boots:50,ring:100,amulet:150,light:50,gem:400,orb:350,oil:30,ammo:1,material:200},Lt={book:70,food:50,potion:0,scroll:0,recipe:50,wand:50,melee:0,missile:20,staff:20,shield:50,armor:50,cloak:50,belt:50,helm:50,gloves:50,boots:50,light:50,ring:70,amulet:70,oil:50,ammo:50,coin:70,gem:80,orb:80},Mt={stash:{x:22,y:18},start:{x:22,y:12},hell:{x:40,y:12}},qt={died:!0,wait:!1,regular:!1,arrow:!1,scroll:!1,openDoor:!1,closeDoor:!1,retry:!1,title:!1,inventory:!1,drop:!1,destroy:!1,equip:!1,unequip:!1,equipmentList:!1,eat:!1,quaff:!1,read:!1,synthesize:!1,grab:!1,zap:!1,aim:!1,investigate:!1,message:!1,identify:!1,repair:!1,help:!1,create:!1,dash:!1,pack:!1,number:!1,clearInv:!1,examine:!1,skill:!1,sortSkill:!1,assign:!1,gain:!1,minimap:!1,shop:!1,gamble:!1,stash:!1,wormhole:!1,disint:!1,fuel:!1,option:!1,option2:!1,quit:!1,cure:!1,blacksmith:!1,floor:!1,throw:!1,character:!1,failed:!1},Et=new Map([[Qe,30],[et,80],[tt,10]]),It=new Map([[ze,{fire:10,water:10,air:10,earth:10,poison:10}],[Ce,{fire:20,water:20,air:20,earth:20,poison:20}],[Pe,{fire:30,water:30,air:30,earth:30,poison:30,hpRate:ye,mpRate:ke,mpReg:100}]]);let $t,At;const Dt={clear:"transparent",shadow:"#848484",shadow2:"#333333",black:"black",darkolivegreen:"darkolivegreen",firebrick:"firebrick",turquoise:"turquoise",red:"red",yellow:"yellow",white:"white",skyblue:"#0099FF",aqua:"aqua",blue:"blue",purple:"purple",green:"green",brown:"brown",gray:"gray",pink:"pink",silver:"silver",gold:"gold",indigo:"indigo",orange:"orange",violet:"violet",crimson:"crimson",lime:"lime",lightgreen:"lightgreen",coral:"coral",yellowgreen:"yellowgreen",olive:"olive",azure:"azure",blueviolet:"blueviolet",darkviolet:"darkviolet",darkred:"darkred",lightblue:"lightblue",deeppink:"deeppink",lightgrey:"lightgrey",darkgrey:"darkgray",darkgreen:"darkgreen",orangered:"orangered",lavender:"lavender",lightyellow:"lightyellow",cyan:"cyan",navy:"navy",palegreen:"palegreen",scarlet:"#d3381c",royalblue:"#4169e1",aquamarine:"aquamarine",sandybrown:"sandybrown",lightseagreen:"lightseagreen",limegreen:"limegreen",deepskyblue:"deepskyblue",darkorange:"darkorange",linen:"#faf0e6",flax:"#d6c6af",beige:"#eedcb3",beigegray:"#b4ada9",goldenyellow:"#f6ae54",fox:"#c38743",teal:"#008080",bronze:"#7A592F",brass:"#b5a642",steel:"#6C676E",tin:"#9ea1a3",copper:"#b87333",iron:"#cbcdcd",platinum:"#e5e4e2",titanium:"#B6AFA9",zinc:"#bac4c8",cadmium:"#fff600",chrome:"#e3dedb",aluminium:"#848789",carbon:"#252626",magnesium:"#E9EEEB",cobalt:"#0068b7",nickel:"#b5b6b5",mahogany:"#6b3f31",rosewood:"#65000b",ebony:"#242E35",ash:"#efe5d1",walnut:"#443028",cypress:"#bcad8c",oak:"#806517",beech:"#c5c993",teak:"#AE8F60",fire:"red",water:"aquamarine",air:"turquoise",earth:"brown",poison:"green",light:"white",cold:"blue",lightning:"yellow",gravity:"#848484",infection:"darkolivegreen",sand:"sandybrown",blizzard:"violet",acid:"olive",magma:"firebrick",radiation:"darkorange",atom:"#333333",physical:"gray",buff:"#0099FF"},zt=[{name:{a:"Blue",b:"青色"},color:Dt.blue},{name:{a:"Red",b:"赤色"},color:Dt.red},{name:{a:"Green",b:"緑色"},color:Dt.green},{name:{a:"Gray",b:"灰色"},color:Dt.gray},{name:{a:"Brown",b:"茶色"},color:Dt.brown},{name:{a:"Pink",b:"桃色"},color:Dt.pink},{name:{a:"White",b:"白色"},color:Dt.white},{name:{a:"Purple",b:"紫色"},color:Dt.purple},{name:{a:"Yellow",b:"黄色"},color:Dt.yellow},{name:{a:"Orange",b:"橙色"},color:Dt.orange},{name:{a:"Silver",b:"銀色"},color:Dt.silver},{name:{a:"Gold",b:"金色"},color:Dt.gold},{name:{a:"Violet",b:"すみれ色"},color:Dt.violet},{name:{a:"Sky blue",b:"空色"},color:Dt.skyblue},{name:{a:"Aqua",b:"水色"},color:Dt.aqua},{name:{a:"Indigo",b:"藍色"},color:Dt.indigo},{name:{a:"Crimson",b:"紅色"},color:Dt.crimson},{name:{a:"Lime",b:"ライム色"},color:Dt.lime},{name:{a:"Lightgreen",b:"淡緑色"},color:Dt.lightgreen},{name:{a:"Coral",b:"珊瑚色"},color:Dt.coral},{name:{a:"Yellowgreen",b:"黃緑色"},color:Dt.yellowgreen},{name:{a:"Deeppink",b:"深桃色"},color:Dt.deeppink},{name:{a:"Olive",b:"オリーブ色"},color:Dt.olive},{name:{a:"Azure",b:"紺碧色"},color:Dt.azure},{name:{a:"Blueviolet",b:"青紫色"},color:Dt.blueviolet},{name:{a:"Darkviolet",b:"暗紫色"},color:Dt.darkviolet},{name:{a:"Darkred",b:"暗赤色"},color:Dt.darkred},{name:{a:"Lightblue",b:"淡青色"},color:Dt.lightblue},{name:{a:"Lightgrey",b:"薄灰色"},color:Dt.lightgrey},{name:{a:"Darkgray",b:"濃灰色"},color:Dt.darkgrey},{name:{a:"Darkgreen",b:"暗緑色"},color:Dt.darkgreen},{name:{a:"Orangered",b:"橙赤色"},color:Dt.orangered},{name:{a:"Lavender",b:"藤色"},color:Dt.lavender},{name:{a:"Cyan",b:"青緑色"},color:Dt.cyan},{name:{a:"Lightyellow",b:"淡黄色"},color:Dt.lightyellow},{name:{a:"Navy",b:"紺色"},color:Dt.navy},{name:{a:"Palegreen",b:"薄緑色"},color:Dt.palegreen},{name:{a:"Scarlet",b:"緋色"},color:Dt.scarlet},{name:{a:"Royalblue",b:"藤紫色"},color:Dt.royalblue},{name:{a:"Aquamarine",b:"淡青緑色"},color:Dt.aquamarine},{name:{a:"Sandybrown",b:"砂茶色"},color:Dt.sandybrown},{name:{a:"Lightseagreen",b:"淡海緑色"},color:Dt.lightseagreen},{name:{a:"Limegreen",b:"ライムグリーン色"},color:Dt.limegreen},{name:{a:"Deepskyblue",b:"深空色"},color:Dt.deepskyblue},{name:{a:"Darkorange",b:"暗橙色"},color:Dt.darkorange}],Ct={init(){this.canvases={},this.ctxes={};let e=[],t=["ground","object","shadow","cursor"];for(let i of t){let t=document.createElement("canvas");t.id="canvas-"+i,e.push(t)}e.push(At.$refs.canvasMain);for(let t of e){let e=t.id.replace("canvas-","");this.canvases[e]=t,this.ctxes[e]=t.getContext("2d")}let i=18;this.fs=i,this.setSize();for(let e in this.ctxes){let t=this.ctxes[e];"shadow"===e?(t.globalAlpha=.5,t.fillStyle=Dt.black):"ground"!==e&&"object"!==e&&"cursor"!==e||(t.textBaseline="middle",t.shadowOffsetX=1,t.shadowOffsetY=1,t.fillStyle=Dt.white,t.font=i+"px "+we,t.textAlign="center","cursor"===e&&(t.strokeStyle=Dt.yellow))}},setSize(e){for(let t in this.canvases){if(e&&"main"!==t)continue;let i,a,s=this.canvases[t];if("ground"===t||"object"===t||"shadow"===t||"cursor"===t)this.widthBuf=i=h*this.fs,this.heightBuf=a=d*this.fs;else if("main"===t){let e=At.$refs.canvasContainer.getBoundingClientRect();this.width=i=e.width,this.height=a=e.height}s.setAttribute("width",i),s.setAttribute("height",a)}},text({ctx:e,msg:t,x:i=0,y:a=0,xPx:s=0,yPx:l=0,stroke:r,fs:n=this.fs}){i+=.5,a+=.5;let o=[t,i*n+s,a*n+l];r&&(e.strokeStyle=r,e.strokeText(...o)),e.fillText(...o)},rect({ctx:e,x:t=0,y:i=0,width:a=0,height:s=0,xPx:l=0,yPx:r=0,widthPx:n=0,heightPx:o=0,stroke:h,clear:d,fs:m=this.fs}){let c=[t*m+l,i*m+r,a*m+n,s*m+o];h?e.strokeRect(...c):d?e.clearRect(...c):e.fillRect(...c)},image({ctx:e,img:t,sx:i=0,sxPx:a=0,sy:s=0,syPx:l=0,sWidthPx:r=0,sHeightPx:n=0,dxPx:o=0,dyPx:h=0,dWidthPx:d=0,dHeightPx:m=0}){let c=this.fs;e.drawImage(t,i*c+a,s*c+l,r,n,o,h,d,m)},clearOne(e){let t=e.canvas;this.rect({ctx:e,widthPx:t.width,heightPx:t.height,clear:!0})},clearAll(){Na.clearFixed();for(let e in this.ctxes)this.clearOne(this.ctxes[e])}};{let e;window.addEventListener("resize",function(){e&&clearTimeout(e),e=setTimeout(function(){if(Ct.setSize(!0),!$t)return;let e,t,i,a;qt.examine?(e=Rr.cX=Rr.x,t=Rr.cY=Rr.y,i=!0):qt.minimap?a=!0:[e,t]=[$t.x,$t.y],vr.draw(e,t,i,a)},200)})}const Pt={list:{a:{a:"Language",b:"言語",key:"language"},b:{a:"Shadow",b:"影",key:"shadow"},c:{a:"Mute",b:"消音",key:"mute"},d:{a:"BGM",b:"BGM",key:"BGM"},e:{a:"SE",b:"効果音",key:"SE"},f:{a:"Autosave",b:"自動記録",key:"autosave"},g:{a:"Auto-destroy",b:"自動破壊",key:"auto-destroy"},h:{a:"Auto-charge",b:"自動充填",key:"auto-charge"},i:{a:"Auto-identify",b:"自動識別",key:"auto-identify"},j:{a:"Rogue Style Movement",b:"ローグ型移動",key:"rogueStyleMove"}},shadow:{defaults:!0},mute:{defaults:!1},autosave:{defaults:!0},"auto-destroy":{defaults:!1},"auto-charge":{defaults:!0},"auto-identify":{defaults:!0},BGM:{defaults:"k",select:{}},SE:{defaults:"k",select:{}},rogueStyleMove:{defaults:!0},language:{defaults:"b",select:{a:{a:"English",b:"英語"},b:{a:"Japanese",b:"日本語"}}},main(e){let t=qt.option2?this[this.name].select:this.list,i=Kt(e);if(i&&(i=i.toLowerCase(),t[i])){if(qt.option2||(this.name=this.list[i].key),"language"===this.name||"BGM"===this.name||"SE"===this.name){if(!qt.option2)return void this.choose(i);if(i===this[this.name].user)return;if("language"===this.name)this[this.name].user=i,At.isEnglish=this.isEnglish();else if("BGM"===this.name||"SE"===this.name){this[this.name].user=i;let e=vt.indexOf(i.toLowerCase())/10;"BGM"===this.name?(pr.volBGM=e,pr.music[pr.curTrack].volume=e):pr.volSE=e}qt.option2=!1}else"shadow"===this.name?(this[this.name].user=!this[this.name].user,vr.redraw()):"mute"===this.name?pr.mute():"autosave"!==this.name&&"auto-identify"!==this.name&&"auto-destroy"!==this.name&&"auto-charge"!==this.name&&"rogueStyleMove"!==this.name||(this[this.name].user=!this[this.name].user);Fr.clear(),Fr.show({list:this.list,dr:lt}),Na.draw(Na.get(pa),!0)}},choose(e){Fr.clear(),Fr.show({list:this.list,dr:lt,a:e}),qt.option2=!0,Fr.show({list:this[this.name].select,dr:it}),Na.draw(Na.get(pa),!0)},isEnglish(){return this.language.user===se},getLanguage(){return this.language.user}};for(let e in Pt.list){let t=Pt.list[e].key;if(Pt[t].user=Pt[t].defaults,"BGM"===t||"SE"===t)for(let e=0;e<=10;e++)Pt[t].select[vt[e]]={a:e,b:e}}Object.defineProperty(Array.prototype,"swap",{value(e,t){[this[e],this[t]]=[this[t],this[e]]}}),Object.defineProperty(Array.prototype,"shuffle",{value(){let e=this.length;for(;e-- >1;){let t=Yt(e);this.swap(e,t)}}});const Tt=(e,t)=>{for(let i in t){let a=t[i];e[i]="object"==typeof a&&a?JSON.parse(JSON.stringify(a)):a}},Nt=(e,t,i)=>{e||(e=0);let a="";for(let e=0;e<t;e++)a+=i?"0":"*";return(a+e).slice(-t)},Ot=()=>!Jt(5*($t.cdl-1)),Ft=()=>Jt(10+$t.searching),Vt=e=>(e-1)**4+10*(e-1),Gt=()=>{Wt.init();for(let e in ep)if("potion"===e||"wand"===e||"scroll"===e||"recipe"===e||"orb"===e)for(let t of ep[e].values())t.identified=!1,"orb"!==e&&Wt[e](t)},Ht=()=>{for(let e in qt)qt[e]="regular"===e},Wt={init(){this.countP=this.countW=0,zt.shuffle(),Hh.shuffle()},potion(e){e.color=zt[this.countP].color;let t=zt[this.countP++].name;e.name.a=t.a,e.name.b=t.b},wand(e){e.color=Hh[this.countW].color;let t=Hh[this.countW++].name;e.name.a=t.a,e.name.b=t.b},recipe(e){this.word(e)},scroll(e){this.word(e)},word(e){let t="",i=vt.length;for(let e=0;e<3;e++){for(let e=0;e<3;e++)t+=vt[Yt(i-1)];2!==e&&(t+=" ")}e.name.a=e.name.b=`'${t}'`}},jt={getBase(e,t){let i=e*t/100,a=Math.ceil(e-i),s=Math.floor(e+i);return a+"-"+s},getNums(e,t=0,i=0,a){let s="",l="",r=0;do{s+=e.charAt(r++)}while(isFinite(e.charAt(r)));for(;""!==e.charAt(++r);)l+=e.charAt(r);return s=Number(s)+t,l=Number(l)+i,!a&&s>=l&&(l=s+1),[s,l]},getAvg(){let[e,t]=this.getNums(...arguments);return Math.ceil((e+t)/2)},roll(){let[e,t]=this.getNums(...arguments);return _t(e,t)},dice(e){let[t,i]=this.getNums(e,0,0,!0),a=0;if(1===i)a=t;else for(let e=0;e<t;e++)a+=_t(1,i);return a}},Ut=(e,t,i,a)=>{let s=0,l=0;return i!==e&&(s=i<e?-.5:.5),a!==t&&(l=a<t?-.5:.5),(e+s-i)**2+(t+l-a)**2},Yt=e=>Math.floor(Math.random()*(e+1)),_t=(e,t)=>Math.floor(Math.random()*(t-e+1))+e,Zt=()=>Math.random()>=.5,Jt=e=>e/100>Math.random(),Kt=e=>/^[a-z]$/i.test(e)?e:null,Xt=e=>/^[0-9]$/.test(e)?e:null,Qt=e=>{let t=Kt(e);return t||(t=Xt(e)),t},ei=e=>e.charAt(0).toUpperCase()+e.slice(1),ti=e=>{let t;switch(e){case"h":case"H":case"ArrowLeft":case"Left":t=it;break;case"j":case"J":case"ArrowDown":case"Down":t=at;break;case"k":case"K":case"ArrowUp":case"Up":t=st;break;case"l":case"L":case"ArrowRight":case"Right":t=lt;break;case"y":case"Y":case"Home":t=rt;break;case"b":case"B":case"End":t=nt;break;case"u":case"U":case"PageUp":t=ot;break;case"n":case"N":case"PageDown":t=ht;break;default:return null}return wt[t]},ii=(e,t,i,a)=>e>i&&t===a?wt[it]:e===i&&t<a?wt[at]:e===i&&t>a?wt[st]:e<i&&t===a?wt[lt]:e>i&&t>a?wt[rt]:e>i&&t<a?wt[nt]:e<i&&t>a?wt[ot]:e<i&&t<a?wt[ht]:null,ai=(e,t)=>{let i;switch(e.id){case it:i=t?nt:rt;break;case nt:i=t?at:it;break;case at:i=t?ht:nt;break;case ht:i=t?lt:at;break;case lt:i=t?ot:ht;break;case ot:i=t?st:lt;break;case st:i=t?rt:ot;break;case rt:i=t?it:st;break;default:return null}return wt[i]},si=(e,t)=>{let i=vt.indexOf(t),a=Object.keys(e).length-1-i;for(let t=0;t<a;t++)e[vt[i]]=e[vt[++i]];delete e[vt[i]]},li=(e,t,i,a,s)=>{if(i&&1===a){let t=/^[aeiou]/i.test(e)?"an ":"a ";e=t+e}if(t||a>1){let t;/[bcdfghjklmnpqrstvwxz]y$/.test(e)?(e=e.slice(0,-1),t="ies"):t=/[sxo]$|sh$|ch$/.test(e)?"es":"s",e+=t}return s&&(e=ei(e)),e},ri=class{constructor(e=0,t=0){this.x=e,this.y=t}},ni=class{constructor(e){Tt(this,e),this.x=0,this.y=0}init(e,t,i){e!==Ee&&(this.getPositionRandomly(e===Ae,e===$e),[t,i]=[this.x,this.y]),this.abort||this.putDown(t,i)}getPositionRandomly(e,t,i){let a,s,l,r=0;if(e){let e,t;Tr.rns.length;Tr.rns.shuffle();let i=0;do{t=Tr.rns[i++],void 0===t&&(Tr.rns.shuffle(),i=0,t=Tr.rns[i++]),e=Tr.list[t],a=_t(e.x+1,e.x+e.width-2),s=_t(e.y+1,e.y+e.height-2),l=vr.coords[a][s]}while((l.wall||l.door||l.fighter||l.item.a||l.trap||l.enter||l.stairs)&&++r<1e3)}else{let[e,i]=[vr.coords.length,vr.coords[0].length];do{a=Yt(e-2)+1,s=Yt(i-2)+1,l=vr.coords[a][s]}while((l.wall||l.door||l.fighter||l.item.a||l.trap||l.enter||l.stairs||t&&Ut(a,s,$t.x,$t.y)<=K)&&++r<1e3)}r<100?[this.x,this.y]=[a,s]:i||this.id===re||this.dissapear()}spiralSearch(e,t,i,a=0){let[s,l]=[e,t],r=vr.coords.length,n=vr.coords[0].length,o=0,h="item"===i&&a<O?a:O;if(!this.spiralSearchCheck(s,l,e,t,i,a)){do{for(l--;l<t;)if(s++,l++,s<r-1&&l>0&&this.spiralSearchCheck(s,l,e,t,i,a))return;for(;s>e;)if(s--,l++,s<r-1&&l<n-1&&this.spiralSearchCheck(s,l,e,t,i,a))return;for(;l>t;)if(s--,l--,s>0&&l<n-1&&this.spiralSearchCheck(s,l,e,t,i,a))return;for(;s<e;)if(s++,l--,s>0&&l>0&&this.spiralSearchCheck(s,l,e,t,i,a))return}while(o++<=h);"item"===i&&++a<M?this.spiralSearch(e,t,i,a):this.id!==re&&this.dissapear()}}spiralSearchCheck(e,t,i,a,s,l){let r=vr.coords[e][t];if(!r.isObstacle()&&!r.enter&&("fighter"===s&&!r.fighter||"item"===s&&!r.trap&&!r.door&&!r.item[vt[l]]||"trap"===s&&!r.item.a&&!r.door&&!r.trap&&!r.stairs||"staircase"===s&&!r.door&&!r.trap&&!r.stairs||"portal"===s)&&gr(i,a,e,t))return[this.x,this.y]=[e,t],!0}dissapear(){this.abort=!0;let e=this.getName();Na.draw(Pt.isEnglish()?`${e} dissapeared`:`${e}は消え去った`)}getName(){return this.name[Pt.getLanguage()]}},oi={stash:{name:{a:"Stash",b:"物置箱"},symbol:"&",color:Dt.brown,page:1,stash:!0},book:{name:{a:"Book Shop",b:"魔法書店"},symbol:"?",color:Dt.gray,shop:!0,type:{book:10}},general:{name:{a:"General Shop",b:"雑貨屋"},symbol:":",color:Dt.brown,shop:!0,type:{food:2,light:6,oil:2}},potion:{name:{a:"Potion Shop",b:"薬屋"},symbol:"!",color:Dt.blue,shop:!0,type:{potion:15}},scroll:{name:{a:"Scroll Shop",b:"巻物店"},symbol:"?",color:Dt.white,shop:!0,type:{scroll:15}},wand:{name:{a:"Wand Shop",b:"魔法棒店"},symbol:"-",color:Dt.white,shop:!0,type:{wand:10}},weapon:{name:{a:"Weapon Shop",b:"武器屋"},symbol:"|",color:Dt.white,shop:!0,equipment:!0,type:{melee:8,missile:3,staff:2,ammo:6}},armor:{name:{a:"Armor Shop",b:"防具屋"},symbol:"[",color:Dt.gray,shop:!0,equipment:!0,type:{shield:2,armor:3,cloak:2,belt:2,helm:2,gloves:2,boots:2}},gamble:{name:{a:"Gamble Shop",b:"ギャンブル店"},symbol:"$",color:Dt.yellow,gamble:!0,shop:!0},cure:{name:{a:"Cure Shop",b:"治療店"},symbol:"+",color:Dt.lime,cure:!0,list:{a:{a:"recover completely",b:"全快する",cost:400},b:{a:"restore health and mana",b:"体力と魔力を回復する",cost:100},c:{a:"restore stats",b:"能力値を元に戻す",cost:100},d:{a:"restore condition",b:"状態異常を元に戻す",cost:100},e:{a:"have a meal",b:"食事をとる",cost:100}}},blacksmith:{name:{a:"Blacksmith Shop",b:"鍛冶屋"},symbol:"/",color:Dt.gray,blacksmith:!0}},hi=class extends ni{constructor(e){super(oi[e]),this.shop?this.list={}:this.stash&&(this.list=vr.stashList)}putDown(e,t){let i=vr.coords[e][t];i.deleteWall(),i.enter=this}createShopItem(){let e=0;if(this.gamble)for(let t=0;t<10;t++)this.list[vt[e++]]=cp.item({position:Ie});else for(let t in this.type){let i=this.type[t],a=0,s=0,l=tp.get(t);l.shuffle();do{let i,r;do{r=l[a++],i=ep[t].get(r)}while(i&&!i.shop);if(!i){a=0,l.shuffle();continue}let n=i.equipable?1:_t(10,99);if(this.list[vt[e]]=cp.item({type:t,tabId:r,quantity:n,position:Ie}),Fr.sort(vt[e++],this.list),e===M)return;s++}while(s<i)}}},[di,mi,ci,pi,ui,gi,bi,fi,yi,ki,vi,wi,xi,Si,Ri,Bi,Li,Mi,qi,Ei,Ii,$i,Ai,Di,zi,Ci,Pi,Ti,Ni,Oi,Fi,Vi,Gi,Hi,Wi,ji,Ui,Yi,_i,Zi,Ji,Ki,Xi,Qi,ea,ta,ia,aa,sa,la,ra,na,oa,ha,da,ma,ca,pa,ua,ga,ba,fa,ya,ka,va,wa,xa,Sa,Ra,Ba,La,Ma,qa,Ea,Ia,$a,Aa,Da,za,Ca,Pa]=i(1,100),Ta=new Map([[ci,{a:"Input Number - [0-9] [Backspace] to remove [Enter] to decide [a] for all: ",b:"数値を入力 - [0-9] [Backspace] 削除 [Enter] 決定 [a] すべて: "}],[pi,{a:" [,] for stuff",b:" [,] 持物"}],[ui,{a:" [.] for floor",b:" [.] 床"}],[Bi,{a:" [x] to examine",b:" [x] 探査"}],[ma,{a:" [e] for equipment [i] for inventory",b:" [e] 装備 [i] 持物"}],[Aa,{a:" [direction] + [Shift/Ctrl] to scroll [c] to close",b:" [方向] + [Shift/Ctrl] ページ移動 [c] 閉じる"}],[mi,{a:"You can't destroy it",b:"それを壊す事は出来ない"}],[bi,{a:"You can't read any scrolls",b:"巻物を読む事が出来ない"}],[fi,{a:"You can't read any books",b:"本を読む事が出来ない"}],[yi,{a:"You can't teleport there",b:"そこへテレポートする事は出来ない"}],[Mi,{a:"You can't examine",b:"探査出来ない"}],[Ai,{a:"You can't carry anymore",b:"もう持つことが出来ない"}],[Oi,{a:"You can't add them anymore",b:"これ以上詰め込めない"}],[Hi,{a:"You can't sell anymore",b:"これ以上売却出来ない"}],[Qi,{a:"You can't gain any skills",b:"スキルを習得出来ない"}],[ea,{a:"You can't gain any stats",b:"能力値を習得出来ない"}],[na,{a:"You can't cast any skills",b:"スキルを行使出来ない"}],[xi,{a:"You have nothing to fire with",b:"遠隔武器を持っていない"}],[Si,{a:"You have no ammunition to fire",b:"弾薬を持っていない"}],[$a,{a:"You don't know any recipes",b:"レシピを習得していない"}],[Ti,{a:"You don't equip any light sources",b:"光源を身に付けていない"}],[Wi,{a:"You don't have enough money",b:"金額が足りない"}],[ra,{a:"You don't have any skills to cast",b:"行使するスキルを覚えていない"}],[oa,{a:"You don't have any books to cast",b:"行使するための魔法書を持っていない"}],[ha,{a:"You don't have enough mana to cast",b:"行使するためのマナが足りない"}],[da,{a:"You have nothing to combat with",b:"近接武器を持っていない"}],[xa,{a:"You have nothing to take off or unwield",b:"何も身に着けていない"}],[La,{a:"Interrupted",b:"中断した"}],[va,{a:"You are starved",b:"飢餓状態に陥った"}],[ka,{a:"Your light has gone out",b:"灯火が消え去った"}],[ya,{a:"You're floating in the air",b:"空中に浮かんだ"}],[fa,{a:"You recovered completely",b:"全快した"}],[ba,{a:"You died",b:"死亡した"}],[ga,{a:"You are still stuck",b:"まだ動けない"}],[Ci,{a:"You are using both hands already",b:"既に両手を使っている"}],[qi,{a:"Nothing happened",b:"何も起こらなかった"}],[Ea,{a:"You have no clue",b:"詳細が掴めない"}],[Ca,{a:"It's too heavy to lift",b:"重くて持ち上げられない"}],[di,{a:"Destroy Item: [a-Z] [1-9] to choose",b:"アイテムを壊す: [a-Z] [1-9] 選択"}],[gi,{a:"Read Scroll: [a-Z] [1-9] to choose",b:"巻物を読む: [a-Z] [1-9] 選択"}],[ki,{a:"Identify Item: [a-Z] [1-9] to choose",b:"アイテムを識別する: [a-Z] [1-9] 選択"}],[vi,{a:"Disintegrate Enemy: [a-Z] to choose the symbol",b:"敵を分解する: [a-Z] シンボルを選択"}],[wi,{a:"Repair Equipment: [a-Z] [1-9] to choose",b:"装備品を修復する: [a-Z] [1-9] 選択"}],[Ri,{a:"Zap Wand: [a-Z] [1-9] to choose",b:"魔法棒を振る: [a-Z] [1-9] 選択"}],[Li,{a:"Zap Wand: [direction] [t] to decide",b:"魔法棒を振る: [方向] [t] 決定"}],[Ei,{a:"Quaff Potion: [a-Z] [1-9] to choose",b:"薬を飲む: [a-Z] [1-9] 選択"}],[Ii,{a:"Eat: [a-Z] [1-9] to choose",b:"食事する: [a-Z] [1-9] 選択"}],[$i,{a:"Drop Item: [a-Z] [1-9] to choose",b:"アイテムを置く: [a-Z] [1-9] 選択"}],[Di,{a:"Grab Item: [a-Z] to choose",b:"アイテムを拾う: [a-Z] 選択"}],[zi,{a:"Equip: [a-Z] [1-9] to choose",b:"装備する: [a-Z] [1-9] 選択"}],[Pi,{a:"Fuel: [a-Z] [1-9] to choose",b:"燃料を補給する: [a-Z] [1-9] 選択"}],[Ni,{a:"Investigate Item: [a-Z] [1-9] to choose",b:"アイテムを調査する: [a-Z] [1-9] 選択"}],[Fi,{a:"Alchemy: [a-z] [1-9] to choose [A-Z] to remove [Enter] to synthesize [Ctrl + r] to show recipes",b:"錬金術: [a-z] [1-9] 選択 [A-Z] 除外 [Enter] 合成 [Ctrl + r] レシピを表示"}],[Ia,{a:"[c] to close",b:"[c] 閉じる"}],[Vi,{a:"Pack Item: [a-z] to pack [1-9] to unpack",b:"アイテムを詰める: [a-z] 荷詰め  [1-9] 荷解き"}],[Gi,{a:"Pack Item: [1-9] to pack into",b:"アイテムを詰める: [1-9] 荷詰め箇所"}],[ji,{a:": [A-Z] to buy [a-z] to sell [alt + a-Z] details",b:": [A-Z] 購入 [a-z] 売却 [alt + a-Z] 詳細"}],[Ui,{a:"Stash: [a-z] to store [A-Z] to take out [<] to previous [>] to next page [alt + a-Z] details",b:"物置箱: [a-z] 保管 [A-Z] 持参 [<] 前項 [>] 次項 [alt + a-Z] 詳細"}],[Yi,{a:"Examine: [t] for target [r] for release [c] for char [m] for skill [x] for item details",b:"探査: [t] ターゲット [r] 解除 [c] キャラ [m] スキル [x] アイテム詳細"}],[_i,{a:"Blacksmith: [a-Z] to repair, [Enter] to repair all equipment",b:"鍛冶屋: [a-Z] 修理, [Enter] 装備全修理"}],[Zi,{a:"Cure Shop: [a-z] to choose",b:"治療店: [a-z] 選択"}],[Ji,{a:"Map: [a] for all [s] for yourself [e] for enemy [i] for item [t] fot trap [p] for portal [<],[>] for staircase [c] to close",b:"マップ: [a] すべて [s] 自身 [e] 敵 [i] アイテム [t] 罠 [p] ポータル [<],[>] 階段 [c] 閉じる"}],[Ki,{a:"Sort Skill: [a-z] to replace",b:"スキルの整理: [a-z] 交換元"}],[Xi,{a:"Sort Skill: [a-z] to replace with",b:"スキルの整理: [a-z] 交換先"}],[ta,{a:"Gain Stat/Skill: [a-Z] to choose",b:"ステータス/スキルを取得する: [a-Z] 選択"}],[ca,{a:"Gain Skill: [a-z] to choose [A-Z] details",b:"スキルを取得する: [a-z] 選択 [A-Z] 詳細"}],[ia,{a:"Assign Skill: [a-z] to choose [M], [F1-F12] to remove",b:"スキルを割り当てる: [a-z] 選択 [M], [F1-F12] 除外"}],[aa,{a:"Assign Skill: [M], [F1-F12] to choose",b:"スキルを割り当てる: [M], [F1-F12] 選択"}],[sa,{a:"Use Skill: [a-z] to choose [A-Z] details [Ctrl+s] to sort",b:"スキルを使う: [a-z] 選択 [A-Z] 詳細 [Ctrl+s] 整理"}],[la,{a:"Use Skill: [direction] [t] to decide",b:"スキルを使う: [方向] [t] 決定"}],[pa,{a:"Option: [a-z] to choose",b:"オプション: [a-z] 選択"}],[ua,{a:"Previous Massage: [D] to delete",b:"メッセージ履歴: [D] 消去"}],[Da,{a:"Help - Command:",b:"ヘルプ - コマンド:"}],[za,{a:"Character Description:",b:"キャラ詳細:"}],[wa,{a:"Open/Close Door: [direction] to decide",b:"ドアの開閉: [方向] 決定"}],[Sa,{a:"Take off Equipment: [A-Z] to choose",b:"装備を外す: [A-Z] 選択"}],[Ra,{a:"Fire: [direction] to decide",b:"発射する: [方向] 決定"}],[Ba,{a:"Are you sure you want to quit? [Y/N]",b:"本当にゲームを放棄しますか? [Y/N]"}],[Ma,{a:"Trow Item: [a-z] [1-9] to choose",b:"アイテムを投げる: [a-z] [1-9] 選択"}],[qa,{a:"Trow Item: [direction] [t] to decide",b:"アイテムを投げる: [方向] [t] 決定"}],[Pa,{a:"Retry: [Enter] to decide",b:"リトライ: [Enter] 決定"}]]),Na={listTemp:[],list:[],scroll(e,t){if("D"===e)return At.msgList.splice(0),void(At.msgTotal=`[0/${ie}] `+(Pt.isEnglish()?"Message List":"メッセージ一覧"));if(t){Na.draw(Na.get(ua)+Na.get(Aa),!0),this.eleP=At.$refs.messagePrevContainer.$refs.messagePrevList,this.eleC=this.eleP.firstElementChild;let e=this.list.length;At.msgTotal=`[${e}/${ie}] `+(Pt.isEnglish()?"Message List":"メッセージ一覧")}gp.scroll(this.eleP,this.eleC,e,t)},clear(){},clearFixed(){At.msgFixed=""},counter:0,countDelete:0,draw(e,t){if(t)At.msgFixed=e;else{if(this.counter++,this.list[0]&&this.list[0].text===e){let e=this.list[0];e.count++,this.listTemp.length?this.countDelete++:this.listTemp.unshift(e)}else{let t={text:e,count:1};this.listTemp.unshift(t),this.listTemp.length>te&&(this.listTemp.pop(),this.countDelete++),this.list.unshift(t),this.list.length>ie&&this.list.pop()}setTimeout(()=>{let e=this.listTemp;e.length&&!this.countDelete?e.pop():this.countDelete&&this.countDelete--},ue*this.counter--)}},get:e=>Ta.get(e)[Pt.getLanguage()]},Oa={bodyParts:{main:"メイン",off:"オフ",neck:"首","R-ring":"右指輪","L-ring":"左指輪",light:"光源",body:"体",back:"背中",waist:"腰",head:"頭",hands:"手",feet:"足"},item:{book:"書",food:"食料",potion:"薬",scroll:"巻物",wand:"魔法棒",melee:"近接武器",missile:"遠隔武器",staff:"杖",shield:"盾",armor:"鎧",cloak:"外衣",belt:"ベルト",helm:"兜",gloves:"手袋",boots:"靴",light:"光源",oil:"油",amulet:"首飾り",ring:"指輪",ammo:"弾薬",gem:"ジュエル",orb:"オーブ",coin:"コイン",misc:"雑多品",water:"水",recipe:"レシピ","Charge Book":"充填書",corpse:"死体",material:"素材"},element:{fire:"火",water:"水",air:"風",earth:"土",poison:"毒",light:"光",cold:"氷",lightning:"電",gravity:"重力",infection:"感染",blizzard:"吹雪",sand:"砂",acid:"酸",magma:"溶岩",radiation:"放射線",atom:"原子",physical:"物理"}},Fa=150,[Va,Ga,Ha,Wa,ja,Ua,Ya,_a,Za,Ja,Ka,Xa,Qa,es,ts,is,as,ss,ls,rs,ns,os,hs,ds,ms,cs,ps,us,gs,bs,fs,ys,ks,vs,ws,xs,Ss,Rs,Bs,Ls,Ms,qs,Es,Is,$s,As,Ds,zs,Cs,Ps,Ts,Ns,Os,Fs,Vs,Gs,Hs,Ws,js,Us,Ys,_s,Zs,Js,Ks,Xs,Qs,el,tl,il,al,sl,ll,rl,nl,ol,hl,dl,ml,cl,pl,ul,gl,bl,fl,yl,kl,vl,wl,xl,Sl,Rl,Bl,Ll,Ml,ql,El,Il,$l,Al,Dl,zl,Cl,Pl,Tl,Nl,Ol,Fl,Vl,Gl,Hl,Wl,jl,Ul,Yl,_l,Zl,Jl,Kl,Xl,Ql,er,tr,ir,ar,sr,lr]=i(1,Fa),rr=new Map([[Va,{reqLvl:1,base:"15-25",rate:20,synerzy:10,mp:5,element:"fire",kind:"attack",type:"spell",name:{a:"Fire Bolt",b:"火炎のボルト"},desc:{a:"",b:"敵1体に、{value}の火ダメージを与える。"}}],[Ga,{reqLvl:10,base:"50-60",rate:20,synerzy:10,mp:10,element:"fire",kind:"attack",type:"spell",name:{a:"Fire Ball",b:"火炎のボール"},radius:1,desc:{a:"",b:"半径{radius}の範囲内の敵に、{value}の火ダメージを与える。"}}],[Ha,{reqLvl:30,base:"150-160",rate:20,synerzy:10,mp:30,element:"fire",kind:"attack",type:"spell",name:{a:"Flame of Dido",b:"ディドの焔"},reqSynerzy:20,desc:{a:"",b:"敵1体に、{value}の火ダメージを与える。"}}],[Wa,{reqLvl:11,base:0,rate:0,synerzy:!1,mp:10,element:"fire",kind:"self",type:"spell",name:{a:"Remove Curse",b:"解呪"},reqSynerzy:5,desc:{a:"",b:"装備品の呪いを解く。"}}],[ts,{reqLvl:15,base:0,rate:0,synerzy:!1,mp:10,element:"fire",kind:"self",type:"spell",name:{a:"Restore Strength",b:"筋力復活"},reqSynerzy:10,desc:{a:"",b:"筋力を回復する。"}}],[ja,{reqLvl:5,base:10,rate:5,synerzy:1,mp:10,element:"fire",kind:"self",type:"spell",name:{a:"Resist Fire",b:"耐火"},perc:!0,durBase:"10-20",durRate:10,desc:{a:"",b:"{dur}ターンの間、火の耐性を{value}上昇させる。"}}],[Ua,{reqLvl:3,base:10,rate:2,synerzy:1,mp:5,element:"light",kind:"self",type:"spell",name:{a:"Light",b:"光"},radiusRate:!0,desc:{a:"",b:"半径{radiusRate}の範囲内を照らす。"}}],[Ya,{reqLvl:13,base:0,rate:0,synerzy:!1,mp:10,element:"light",kind:"self",type:"spell",name:{a:"See Invisible",b:"透視"},reqSynerzy:5,durBase:"10-20",durRate:10,desc:{a:"",b:"{dur}ターンの間、透明な敵に対する可視効果を得る。"}}],[_a,{reqLvl:0,base:0,rate:0,synerzy:!1,mp:1,element:"light",kind:"self",type:"spell",name:{a:"Invisibility",b:"透明"},durBase:"10-20",durRate:1,desc:{a:"",b:"{dur}ターンの間、透明状態にする。"}}],[Za,{reqLvl:0,base:0,rate:0,synerzy:!1,mp:1,element:"light",kind:"self",type:"spell",name:{a:"Magic Circle of Protection",b:"守護魔法円"},desc:{a:"",b:"足元に敵の侵入を阻む魔法円を描く。"}}],[Ja,{reqLvl:13,base:"40-60",rate:10,synerzy:5,mp:10,element:"water",kind:"self",type:"spell",name:{a:"Heal",b:"回復"},reqSynerzy:10,desc:{a:"",b:"体力を{value}回復し、毒・混乱・盲目を治す。"}}],[Ka,{reqLvl:28,base:"240-260",rate:10,synerzy:5,mp:30,element:"water",kind:"self",type:"spell",name:{a:"Extra Heal",b:"特大回復"},reqSynerzy:20,desc:{a:"",b:"体力を{value}回復し、毒・混乱・盲目・感染・幻覚を治す。"}}],[sr,{reqLvl:0,base:30,rate:5,synerzy:0,mp:0,element:"water",kind:"self",type:"spell",perc:!0,limit:100,name:{a:"Rejuvenation",b:"活性"},desc:{a:"",b:"体力と魔力を{value}回復する。"}}],[ss,{reqLvl:15,base:0,rate:0,synerzy:!1,mp:10,element:"water",kind:"self",type:"spell",name:{a:"Restore Intelligence",b:"知力復活"},reqSynerzy:10,desc:{a:"",b:"知力を回復する。"}}],[ls,{reqLvl:25,base:0,rate:0,synerzy:!1,mp:25,element:"water",kind:"self",type:"spell",name:{a:"Restore All",b:"全復活"},reqSynerzy:15,desc:{a:"",b:"能力値を回復する。"}}],[rs,{reqLvl:27,base:0,rate:0,synerzy:!1,mp:25,element:"water",kind:"self",type:"spell",name:{a:"Cure All",b:"全治療"},reqSynerzy:15,desc:{a:"",b:"全状態異常を治癒する。"}}],[ns,{reqLvl:5,base:10,rate:5,synerzy:1,mp:10,element:"water",kind:"self",type:"spell",name:{a:"Resist Water",b:"耐水"},perc:!0,durBase:"10-20",durRate:10,desc:{a:"",b:"{dur}ターンの間、水の耐性を{value}上昇させる。"}}],[os,{reqLvl:23,base:5,rate:3,synerzy:1,mp:20,element:"water",kind:"self",type:"spell",name:{a:"Resist All",b:"全耐性"},perc:!0,reqSynerzy:10,durBase:"10-20",durRate:10,desc:{a:"",b:"{dur}ターンの間、すべての耐性を{value}上昇させる。"}}],[Xa,{reqLvl:0,base:"10-20",rate:10,synerzy:0,mp:1,element:"water",kind:"self",type:"spell",name:{a:"Mana",b:"魔力回復"},desc:{a:"",b:"魔力を{value}回復する。"}}],[ar,{reqLvl:0,base:"70-80",rate:10,synerzy:0,mp:0,element:"water",kind:"self",type:"spell",name:{a:"Extra Mana",b:"魔力特大回復"},desc:{a:"",b:"魔力を{value}回復する。"}}],[Qa,{reqLvl:0,base:20,rate:10,synerzy:!1,mp:10,element:"water",kind:"self",type:"spell",name:{a:"Life Regeneration",b:"再生"},perc:!0,durBase:"10-20",durRate:10,desc:{a:"",b:"{dur}ターンの間、体力再生の効果を{value}得る。"}}],[es,{reqLvl:0,base:20,rate:10,synerzy:!1,mp:10,element:"water",kind:"self",type:"spell",name:{a:"Mana Regeneration",b:"魔力再生"},perc:!0,durBase:"10-20",durRate:10,desc:{a:"",b:"{dur}ターンの間、魔力再生の効果を{value}得る。"}}],[hs,{reqLvl:0,base:0,rate:0,synerzy:!1,mp:1,element:"water",kind:"self",type:"spell",name:{a:"Raise Level",b:"レベル上昇"},desc:{a:"",b:"レベルを1上昇させる。"}}],[ds,{reqLvl:0,base:0,rate:0,synerzy:!1,mp:0,element:"water",kind:"self",type:"spell",name:{a:"Respec",b:"リスペック"},desc:{a:"",b:"すべての能力値を初期状態にし、スキルを忘却し、相当のポイントを再び得る。"}}],[ms,{reqLvl:1,base:"5-25",rate:20,synerzy:10,mp:5,element:"cold",kind:"attack",type:"spell",name:{a:"Ice Bolt",b:"冷気のボルト"},desc:{a:"",b:"敵1体に、{value}の氷ダメージを与える。"}}],[cs,{reqLvl:30,base:"80-120",rate:20,synerzy:10,mp:40,element:"cold",kind:"attack",type:"spell",name:{a:"Cocytus",b:"コキュートス"},radius:10,range:0,reqSynerzy:20,desc:{a:"",b:"半径{radius}の範囲内の敵に、{value}の氷ダメージを与える。"}}],[Zl,{reqLvl:0,base:0,rate:0,synerzy:!1,mp:1,element:"cold",kind:"self",type:"spell",name:{a:"Cold",b:"冷気"},desc:{a:"",b:"敵1体を凍結させる。"}}],[Fl,{reqLvl:10,base:"1-40",rate:20,synerzy:10,mp:10,element:"air",kind:"attack",type:"spell",name:{a:"Whirlwind",b:"旋風"},radius:2,penetrate:!0,desc:{a:"",b:"半径{radius}の範囲内の敵を貫通し、{value}の風ダメージを与える。"}}],[us,{reqLvl:22,base:"1-50",rate:10,synerzy:5,mp:20,element:"air",kind:"attack",type:"spell",name:{a:"Tornado",b:"竜巻"},radius:2,penetrate:!0,each:!0,reqSynerzy:10,range:10,desc:{a:"",b:"1マス毎に、半径{radius}の範囲内の敵を貫通し、{value}の風ダメージを与える。"}}],[Vl,{reqLvl:30,base:0,rate:0,synerzy:!1,mp:30,element:"air",kind:"self",type:"spell",name:{a:"Ecco",b:"エコー"},reqSynerzy:20,durBase:"10-20",durRate:5,desc:{a:"",b:"{dur}ターンの間、スキルを2回連続で放つ。"}}],[gs,{reqLvl:13,base:20,rate:3,synerzy:1,mp:10,element:"air",kind:"self",type:"spell",name:{a:"Speed",b:"速度"},reqSynerzy:10,durBase:"10-20",durRate:5,perc:!0,desc:{a:"",b:"{dur}ターンの間、速度を{value}上昇させる。"}}],[is,{reqLvl:15,base:0,rate:0,synerzy:!1,mp:10,element:"air",kind:"self",type:"spell",name:{a:"Restore Dexterity",b:"器用さ復活"},reqSynerzy:10,desc:{a:"",b:"器用さを回復する。"}}],[fs,{reqLvl:5,base:10,rate:5,synerzy:1,mp:10,element:"air",kind:"self",type:"spell",name:{a:"Resist Air",b:"耐風"},perc:!0,durBase:"10-20",durRate:10,desc:{a:"",b:"{dur}ターンの間、風の耐性を{value}上昇させる。"}}],[bs,{reqLvl:0,base:10,rate:2,synerzy:!1,mp:1,element:"air",kind:"self",type:"spell",name:{a:"Scream",b:"悲鳴"},radiusRate:!0,desc:{a:"",b:"半径{radiusRate}の範囲内の敵を目覚めさせる。"}}],[ys,{reqLvl:1,base:"1-25",rate:20,synerzy:10,mp:5,element:"lightning",kind:"attack",type:"spell",name:{
a:"Lightning",b:"稲妻"},penetrate:!0,desc:{a:"",b:"直線上の敵を貫通し、{value}の稲妻ダメージを与える。"}}],[ks,{reqLvl:27,base:0,rate:0,synerzy:!1,mp:25,element:"earth",kind:"self",type:"spell",name:{a:"Enlightenment",b:"啓蒙"},reqSynerzy:20,desc:{a:"",b:"マップ全域を照らし、地形・アイテム及び隠された罠や階段を検出する。"}}],[Rs,{reqLvl:17,base:0,rate:0,synerzy:!1,mp:10,element:"earth",kind:"self",type:"spell",name:{a:"Identify",b:"識別"},reqSynerzy:10,desc:{a:"",b:"アイテムを鑑定する。"}}],[Bs,{reqLvl:1,base:10,rate:2,synerzy:1,mp:5,element:"earth",kind:"self",type:"spell",name:{a:"Monster Detection",b:"モンスター感知"},radiusRate:!0,desc:{a:"",b:"半径{radiusRate}の範囲内の敵を、検出する。"}}],[Ls,{reqLvl:4,base:10,rate:2,synerzy:1,mp:5,element:"earth",kind:"self",type:"spell",name:{a:"Item Detection",b:"アイテム感知"},radiusRate:!0,desc:{a:"",b:"半径{radiusRate}の範囲内のアイテムを、検出する。"}}],[Ms,{reqLvl:7,base:10,rate:2,synerzy:1,mp:10,element:"earth",kind:"self",type:"spell",name:{a:"Magic Mapping",b:"魔法の地図"},radiusRate:!0,desc:{a:"",b:"半径{radiusRate}の範囲内の地形を、検出する。"}}],[qs,{reqLvl:22,base:30,rate:1,synerzy:1,mp:20,element:"earth",kind:"self",type:"spell",name:{a:"Satisfy Hunger",b:"空腹充足"},perc:!0,limit:100,reqSynerzy:10,desc:{a:"",b:"空腹を{value}満たす。"}}],[Es,{reqLvl:12,base:"50-150",rate:10,synerzy:5,mp:10,element:"earth",kind:"aim",type:"spell",name:{a:"Stone to Mud",b:"岩石溶解"},wall:!0,reqSynerzy:10,desc:{a:"",b:"壁を取り壊し、石の敵に{value}の土ダメージを与える。"}}],[Ds,{reqLvl:10,base:0,rate:0,synerzy:!1,mp:10,element:"earth",kind:"self",type:"spell",name:{a:"Restore Durability",b:"耐久度復活"},reqSynerzy:10,desc:{a:"",b:"装備品の耐久度を回復する。"}}],[lr,{reqLvl:13,base:10,rate:5,synerzy:1,mp:10,element:"earth",kind:"self",type:"spell",name:{a:"Resist Physical",b:"耐物"},perc:!0,durBase:"10-20",durRate:10,reqSynerzy:10,desc:{a:"",b:"{dur}ターンの間、物理の耐性を{value}上昇させる。"}}],[Ql,{reqLvl:25,base:30,rate:3,synerzy:1,mp:25,element:"earth",kind:"self",type:"spell",name:{a:"Earthquake",b:"地震"},perc:!0,limit:100,radius:J,reqSynerzy:15,desc:{a:"",b:"半径{radius}の範囲内に、{value}の規模で地震を起こす。"}}],[Kl,{reqLvl:29,base:0,rate:0,synerzy:!1,mp:25,element:"earth",kind:"self",type:"spell",name:{a:"Repair All",b:"全修復"},reqSynerzy:20,desc:{a:"",b:"すべての装備品の耐久度を回復する。"}}],[Xl,{reqLvl:21,base:30,rate:3,synerzy:1,mp:20,element:"earth",kind:"self",type:"spell",name:{a:"Enchant Self",b:"自己強化"},perc:!0,reqSynerzy:15,durBase:"50-100",durRate:15,desc:{a:"",b:"{dur}ターンの間、物理ダメージ・命中値・守備力・攻撃速度をそれぞれ{value}上昇させる。"}}],[as,{reqLvl:15,base:0,rate:0,synerzy:!1,mp:10,element:"earth",kind:"self",type:"spell",name:{a:"Restore Constitution",b:"耐久力復活"},reqSynerzy:10,desc:{a:"",b:"耐久力を回復する。"}}],[zs,{reqLvl:5,base:10,rate:5,synerzy:1,mp:10,element:"earth",kind:"self",type:"spell",name:{a:"Resist Earth",b:"耐土"},perc:!0,durBase:"10-20",durRate:10,desc:{a:"",b:"{dur}ターンの間、土の耐性を{value}上昇させる。"}}],[vs,{reqLvl:0,base:0,rate:5,synerzy:!1,mp:1,element:"earth",kind:"self",type:"spell",name:{a:"Magic Finding",b:"魔法具探求"},perc:!0,durBase:"10-20",durRate:10,desc:{a:"",b:"{dur}ターンの間、魔法具探求の効果を{value}得る。"}}],[ws,{reqLvl:0,base:0,rate:10,synerzy:!1,mp:1,element:"earth",kind:"self",type:"spell",name:{a:"Gold Finding",b:"財宝探求"},perc:!0,durBase:"10-20",durRate:10,desc:{a:"",b:"{dur}ターンの間、財宝探求の効果を{value}得る。"}}],[xs,{reqLvl:0,base:0,rate:10,synerzy:!1,mp:1,element:"earth",kind:"self",type:"spell",name:{a:"Experience",b:"経験"},perc:!0,durBase:"10-20",durRate:10,desc:{a:"",b:"{dur}ターンの間、経験値上昇の効果を{value}得る。"}}],[Ss,{reqLvl:0,base:0,rate:1,synerzy:!1,mp:1,element:"earth",kind:"self",type:"spell",name:{a:"Skill",b:"スキル"},durBase:"10-20",durRate:100,desc:{a:"",b:"{dur}ターンの間、経験値上昇の効果を{value}得る。"}}],[Is,{reqLvl:0,base:0,rate:0,synerzy:!1,mp:1,element:"earth",kind:"self",type:"spell",name:{a:"Create Monster",b:"モンスター生成"},desc:{a:"",b:"モンスターを複数生成する。"}}],[Gl,{reqLvl:0,base:0,rate:0,synerzy:!1,mp:1,element:"earth",kind:"self",type:"spell",name:{a:"Create Magic Monster",b:"マジックモンスター生成"},desc:{a:"",b:"マジックモンスターを複数生成する。"}}],[$s,{reqLvl:0,base:0,rate:0,synerzy:!1,mp:1,element:"earth",kind:"self",type:"spell",name:{a:"Create Giant",b:"巨人生成"},desc:{a:"",b:"巨人を複数生成する。"}}],[As,{reqLvl:0,base:0,rate:0,synerzy:!1,mp:1,element:"earth",kind:"self",type:"spell",name:{a:"Create Trap",b:"トラップ生成"},desc:{a:"",b:"罠を複数生成する。"}}],[Ns,{reqLvl:24,base:-10,rate:-3,synerzy:!1,mp:20,element:"gravity",kind:"aim",type:"spell",name:{a:"Gravitational Field",b:"重力場"},radius:10,range:0,reqSynerzy:10,durBase:"10-20",durRate:5,perc:!0,desc:{a:"",b:"半径{radius}の範囲内の敵を、{dur}ターンの間、速度を{value}低下させる。"}}],[Ps,{reqLvl:30,base:10,rate:2,synerzy:1,mp:30,element:"gravity",kind:"self",type:"spell",name:{a:"Wormhole",b:"ワームホール"},radiusRate:!0,reqSynerzy:20,desc:{a:"",b:"半径{radiusRate}の範囲内の任意の場所に移動する。"}}],[Ts,{reqLvl:0,base:-20,rate:-3,synerzy:!1,mp:1,element:"gravity",kind:"self",type:"spell",name:{a:"Slow",b:"鈍足"},durBase:"10-20",durRate:5,perc:!0,desc:{a:"",b:"{dur}ターンの間、速度を{value}低下させる。"}}],[Hl,{reqLvl:1,base:"5-15",rate:20,synerzy:10,mp:5,element:"poison",kind:"attack",type:"spell",name:{a:"Poison Bolt",b:"毒のボルト"},desc:{a:"",b:"敵1体に、{value}の毒ダメージを与える。"}}],[jl,{reqLvl:10,base:"20-40",rate:20,synerzy:10,mp:10,element:"poison",kind:"attack",type:"spell",name:{a:"Poison Mist",b:"毒の霧"},radius:2,desc:{a:"",b:"半径{radius}の範囲内の敵に、{value}の毒ダメージを与える。"}}],[Vs,{reqLvl:7,base:20,rate:5,synerzy:3,mp:10,element:"poison",kind:"self",type:"spell",name:{a:"Touch of Confusion",b:"混乱の手"},perc:!0,limit:100,durBase:"10-20",durRate:1,desc:{a:"",b:"{dur}ターンの間、物理攻撃に混乱の効果を{value}付与する。"}}],[Wl,{reqLvl:15,base:0,rate:10,synerzy:5,mp:10,element:"poison",kind:"self",type:"spell",name:{a:"Venom Hands",b:"猛毒の手"},perc:!0,reqSynerzy:5,durBase:"50-100",durRate:10,desc:{a:"",b:"{dur}ターンの間、物理攻撃に毒ダメージを{value}付与する。"}}],[_s,{reqLvl:14,base:0,rate:0,synerzy:!1,mp:10,element:"poison",kind:"aim",type:"spell",name:{a:"Sleeping Gas",b:"睡眠ガス"},radius:1,reqSynerzy:5,durBase:"10-20",durRate:1,desc:{a:"",b:"半径{radius}の範囲内の敵を、{dur}ターンの間、昏睡状態にする。"}}],[Zs,{reqLvl:15,base:0,rate:0,synerzy:!1,mp:10,element:"poison",kind:"aim",type:"spell",name:{a:"Hold Monster",b:"モンスター束縛"},radius:5,range:0,reqSynerzy:10,durBase:"3-6",durRate:0,desc:{a:"",b:"半径{radius}の範囲内の敵を、{dur}ターンの間、麻痺状態にする。"}}],[Jl,{reqLvl:21,base:0,rate:0,synerzy:!1,mp:20,element:"poison",kind:"self",type:"spell",name:{a:"Restore Experience",b:"経験値復活"},reqSynerzy:10,desc:{a:"",b:"失った経験値を回復する。"}}],[Ks,{reqLvl:20,base:-20,rate:-3,synerzy:-1,mp:20,element:"poison",kind:"aim",type:"spell",name:{a:"Lower Resist",b:"耐性低下"},radius:1,perc:!0,reqSynerzy:10,durBase:"10-20",durRate:10,desc:{a:"",b:"{dur}ターンの間、全耐性を{value}低下させる。"}}],[il,{reqLvl:5,base:10,rate:5,synerzy:1,mp:10,element:"poison",kind:"self",type:"spell",name:{a:"Resist Poison",b:"耐毒"},perc:!0,durBase:"10-20",durRate:10,desc:{a:"",b:"{dur}ターンの間、毒の耐性を{value}上昇させる。"}}],[Js,{reqLvl:22,base:0,rate:0,synerzy:!1,mp:20,element:"poison",kind:"aim",type:"spell",name:{a:"Hallucinating Mist",b:"幻覚の霧"},radius:1,reqSynerzy:10,durBase:"10-20",durRate:2,desc:{a:"",b:"半径{radius}の範囲内の敵を、{dur}ターンの間、幻覚状態にする。"}}],[Fs,{reqLvl:0,base:0,rate:0,synerzy:!1,mp:1,element:"poison",kind:"self",type:"spell",name:{a:"Confusion",b:"混乱"},durBase:"10-20",durRate:1,desc:{a:"",b:"{dur}ターンの間、混乱状態にする。"}}],[Os,{reqLvl:0,base:0,rate:5,synerzy:3,mp:1,element:"poison",kind:"self",type:"spell",name:{a:"Poison",b:"毒"},durBase:"10-20",durRate:1,desc:{a:"",b:"{dur}ターンの間、毒状態にする。"}}],[Gs,{reqLvl:0,base:0,rate:0,synerzy:!1,mp:1,element:"poison",kind:"self",type:"spell",name:{a:"Paralysis",b:"麻痺"},durBase:"3-6",durRate:0,desc:{a:"",b:"{dur}ターンの間、麻痺状態にする。"}}],[Hs,{reqLvl:0,base:0,rate:0,synerzy:!1,mp:1,element:"poison",kind:"self",type:"spell",name:{a:"Sleep",b:"睡眠"},durBase:"10-20",durRate:1,desc:{a:"",b:"{dur}ターンの間、昏睡状態にする。"}}],[Ws,{reqLvl:0,base:0,rate:0,synerzy:!1,mp:1,element:"poison",kind:"self",type:"spell",name:{a:"Blindness",b:"盲目"},durBase:"10-20",durRate:1,desc:{a:"",b:"{dur}ターンの間、盲目状態にする。"}}],[js,{reqLvl:0,base:0,rate:0,synerzy:!1,mp:1,element:"poison",kind:"self",type:"spell",name:{a:"Hallucination",b:"幻覚"},durBase:"10-20",durRate:2,desc:{a:"",b:"{dur}ターンの間、幻覚状態にする。"}}],[Us,{reqLvl:0,base:0,rate:0,synerzy:!1,mp:1,element:"poison",kind:"self",type:"spell",name:{a:"Polymorph",b:"変容"},desc:{a:"",b:"敵1体を、変容させる。"}}],[Ys,{reqLvl:0,base:0,rate:0,synerzy:!1,mp:1,element:"poison",kind:"self",type:"spell",name:{a:"Cancellation",b:"封印"},durBase:"10-20",durRate:1,desc:{a:"",b:"{dur}ターンの間、封印状態にする。"}}],[Xs,{reqLvl:0,base:0,rate:0,synerzy:!1,mp:1,element:"poison",kind:"self",type:"spell",name:{a:"Weakness",b:"薄弱"},desc:{a:"",b:"筋力を1低下させる。"}}],[Qs,{reqLvl:0,base:0,rate:0,synerzy:!1,mp:1,element:"poison",kind:"self",type:"spell",name:{a:"Clumsiness",b:"不器用"},desc:{a:"",b:"器用さを1低下させる。"}}],[el,{reqLvl:0,base:0,rate:0,synerzy:!1,mp:1,element:"poison",kind:"self",type:"spell",name:{a:"Sickliness",b:"病弱"},desc:{a:"",b:"耐久力を1低下させる。"}}],[tl,{reqLvl:0,base:0,rate:0,synerzy:!1,mp:1,element:"poison",kind:"self",type:"spell",name:{a:"Stupidity",b:"愚鈍"},desc:{a:"",b:"知力を1低下させる。"}}],[al,{reqLvl:0,base:0,rate:0,synerzy:!1,mp:1,lement:"infection",kind:"self",type:"spell",name:{a:"Infection",b:"感染"},durBase:"10-20",durRate:2,desc:{a:"",b:"{dur}ターンの間、感染状態にする。"}}],[sl,{reqLvl:30,base:"50-100",rate:20,synerzy:10,mp:30,element:"infection",kind:"attack",type:"spell",name:{a:"Pestilence",b:"黒死病"},radius:10,range:0,reqSynerzy:20,effect:{id:Os,prob:100},desc:{a:"",b:"半径{radius}の範囲内の敵に、{value}の感染ダメージを与え、追加効果で、毒状態にする。"}}],[ll,{reqLvl:28,base:"20-150",rate:20,synerzy:10,mp:25,element:"sand",kind:"attack",type:"spell",name:{a:"Sandstorm",b:"砂嵐"},radius:2,reqSynerzy:10,desc:{a:"",b:"半径{radius}の範囲内の敵に、{value}の砂ダメージを与える。"}}],[rl,{reqLvl:20,base:"20-120",rate:20,synerzy:10,mp:20,element:"blizzard",kind:"attack",type:"spell",name:{a:"Blizzard",b:"吹雪"},radius:2,reqSynerzy:10,desc:{a:"",b:"半径{radius}の範囲内の敵に、{value}の吹雪ダメージを与える。"}}],[nl,{reqLvl:11,base:"30-60",rate:20,synerzy:10,mp:10,element:"acid",kind:"attack",type:"spell",name:{a:"Acid Ball",b:"酸のボール"},radius:1,reqSynerzy:5,desc:{a:"",b:"半径{radius}の範囲内の敵に、{value}の酸ダメージを与える。"}}],[ol,{reqLvl:20,base:"70-80",rate:20,synerzy:10,mp:20,element:"magma",kind:"attack",type:"spell",name:{a:"Lava Flow",b:"溶岩流"},penetrate:!0,reqSynerzy:10,desc:{a:"",b:"直線上の敵を貫通し、{value}の溶岩ダメージを与える。"}}],[Yl,{reqLvl:25,base:"50-60",rate:20,synerzy:10,mp:25,element:"radiation",kind:"attack",type:"spell",name:{a:"Chain Decay",b:"連鎖崩壊"},penetrate:!0,radius:1,reqSynerzy:10,desc:{a:"",b:"半径{radius}の範囲内の敵を貫通し、{value}の放射線ダメージを与える。"}}],[_l,{reqLvl:0,base:0,rate:0,synerzy:!1,mp:1,element:"radiation",kind:"self",type:"spell",name:{a:"Radiation",b:"放射線"},desc:{a:"",b:"敵1体のいずれかの能力値を1低下させる。"}}],[hl,{reqLvl:5,base:0,rate:0,synerzy:!1,mp:5,element:"atom",kind:"self",type:"spell",name:{a:"Short Teleportation",b:"ショート・テレポート"},desc:{a:"",b:"近距離のランダムなテレポートを行う。"}}],[dl,{reqLvl:10,base:0,rate:0,synerzy:!1,mp:10,element:"atom",kind:"self",type:"spell",name:{a:"Teleportation",b:"テレポート"},desc:{a:"",b:"遠距離のランダムなテレポートを行う。"}}],[cl,{reqLvl:15,base:10,rate:2,synerzy:!1,mp:10,element:"atom",kind:"aim",type:"spell",name:{a:"Teleport Away",b:"テレポート・アウェイ"},radiusRate:!0,penetrate:!0,desc:{a:"",b:"直線上の敵を貫通し、半径{radiusRate}の範囲外へテレポートさせる。"}}],[pl,{reqLvl:30,base:10,rate:2,synerzy:!1,mp:30,element:"atom",kind:"self",type:"spell",name:{a:"Disintegration",b:"分解"},radiusRate:!0,desc:{a:"",b:"半径{radiusRate}の範囲内の敵を、分解する。"}}],[Cs,{reqLvl:25,base:0,rate:0,synerzy:!1,mp:20,element:"atom",kind:"self",type:"spell",name:{a:"Town Portal",b:"タウン・ポータル"},desc:{a:"",b:"街またはダンジョンに帰還するポータルを生成する。"}}],[ml,{reqLvl:0,base:0,rate:0,synerzy:!1,mp:1,element:"atom",kind:"aim",type:"spell",name:{a:"Teleport To",b:"引き寄せ"},desc:{a:"",b:"敵1体を隣接へテレポートさせる。"}}],[xl,{reqLvl:1,base:30,rate:3,synerzy:!1,mp:5,element:"fire",kind:"self",type:"spell",name:{a:"Encouragement",b:"鼓舞"},perc:!0,durBase:"10-20",durRate:10,desc:{a:"",b:"{dur}ターンの間、物理ダメージと命中率を{value}上昇させる。"}}],[Sl,{reqLvl:1,base:30,rate:3,synerzy:!1,mp:5,element:"air",kind:"self",type:"spell",name:{a:"Blessing",b:"加護"},perc:!0,durBase:"10-20",durRate:10,desc:{a:"",b:"{dur}ターンの間、守備力を{value}上昇させる。"}}],[ul,{reqLvl:5,base:-50,rate:5,synerzy:3,mp:10,element:"physical",kind:"attack",type:"melee",name:{a:"Fist of Confusion",b:"混乱の拳"},perc:!0,range:1,effect:{id:Fs,prob:100},desc:{a:"",b:"隣接する敵1体に、{value}の物理ダメージを与え、追加効果で、混乱状態にする。"}}],[gl,{reqLvl:10,base:0,rate:10,synerzy:5,mp:10,element:"physical",kind:"attack",type:"melee",name:{a:"Raid",b:"急襲"},perc:!0,move:!0,parabora:!0,desc:{a:"",b:"敵1体に飛びかかり、{value}の物理ダメージを与える。"}}],[Ol,{reqLvl:25,base:0,rate:10,synerzy:5,mp:20,element:"earth",kind:"attack",type:"melee",name:{a:"Collapse",b:"崩落"},perc:!0,move:!0,radius:5,reqSynerzy:10,parabora:!0,desc:{a:"",b:"任意の場所へ飛びかかり、半径{radius}の範囲内の敵に、{value}の土ダメージを与える。"}}],[Tl,{reqLvl:15,base:0,rate:10,synerzy:5,mp:10,element:"physical",kind:"attack",type:"melee",name:{a:"Rush",b:"突進"},perc:!0,move:!0,penetrate:!0,range:5,reqSynerzy:5,desc:{a:"",b:"直線上の敵を駆け抜け、{value}の物理ダメージを与える。"}}],[Nl,{reqLvl:30,base:0,rate:5,synerzy:3,mp:20,element:"physical",kind:"attack",type:"melee",name:{a:"Spiral",b:"螺旋"},perc:!0,move:!0,penetrate:!0,range:5,each:!0,radius:1,reqSynerzy:20,desc:{a:"",b:"1マス毎に、直線上及び隣接する敵を駆け抜け、{value}の物理ダメージを与える。"}}],[bl,{reqLvl:1,base:0,rate:10,synerzy:5,mp:5,element:"physical",kind:"attack",type:"missile",name:{a:"Piercing Arrow",b:"貫通の矢"},perc:!0,penetrate:!0,desc:{a:"",b:"直線上の敵を貫通する矢を放ち、{value}の物理ダメージを与える。"}}],[yl,{reqLvl:5,base:-50,rate:5,synerzy:3,mp:5,element:"physical",kind:"attack",type:"missile",name:{a:"Paralyzing Arrow",b:"麻痺の矢"},perc:!0,parabora:!0,effect:{id:Gs,prob:100},desc:{a:"",b:"放物線を描く矢を放ち、敵1体に、{value}の物理ダメージを与え、追加効果で、麻痺状態にする。"}}],[fl,{reqLvl:10,base:0,rate:10,synerzy:5,mp:10,element:"fire",kind:"attack",type:"missile",name:{a:"Exploding Arrow",b:"爆発の矢"},perc:!0,radius:1,parabora:!0,desc:{a:"",b:"放物線を描く矢を放ち、半径{radius}の範囲内の敵に、{value}の火ダメージを与える。"}}],[kl,{reqLvl:15,base:0,rate:10,synerzy:5,mp:10,element:"cold",kind:"attack",type:"missile",name:{a:"Freezing Arrow",b:"凍結の矢"},perc:!0,effect:{id:tr,prob:100},parabora:!0,desc:{a:"",b:"放物線を描く矢を放ち、敵1体に、{value}の氷ダメージを与え、凍結させる。"}}],[vl,{reqLvl:20,base:0,rate:10,synerzy:5,mp:15,element:"light",kind:"attack",type:"missile",name:{a:"Photon Arrow",b:"光子の矢"},perc:!0,penetrate:!0,effect:{id:ir,prob:100,self:!0},reqSynerzy:10,desc:{a:"",b:"放物線を描く矢を放ち、素早い動作で、敵1体に、{value}の光ダメージを与える。"}}],[wl,{reqLvl:30,base:100,rate:20,synerzy:10,mp:20,element:"fire",kind:"attack",type:"missile",name:{a:"Apollo's Arrow",b:"アポロンの矢"},perc:!0,radius:5,reqSynerzy:20,parabora:!0,effect:{id:al,prob:20},desc:{a:"",b:"放物線を描く矢を放ち、半径{radius}の範囲内の敵に、{value}の火ダメージを与え、追加効果で、感染状態にする。"}}],[Rl,{reqLvl:0,base:0,rate:3,synerzy:1,mp:5,element:"fire",kind:"breath",type:"spell",name:{a:"Fire Breath",b:"火炎のブレス"}}],[Bl,{reqLvl:0,base:0,rate:3,synerzy:1,mp:5,element:"water",kind:"breath",type:"spell",name:{a:"Aqua Breath",b:"水のブレス"}}],[Ll,{reqLvl:0,base:0,rate:3,synerzy:1,mp:5,element:"air",kind:"breath",type:"spell",name:{a:"Wind Breath",b:"風のブレス"}}],[Ml,{reqLvl:0,base:0,rate:3,synerzy:1,mp:5,element:"poison",kind:"breath",type:"spell",name:{a:"Poison Breath",b:"毒のブレス"}}],[ql,{reqLvl:0,base:0,rate:3,synerzy:1,mp:5,element:"light",kind:"breath",type:"spell",name:{a:"Light Breath",b:"閃光のブレス"}}],[El,{reqLvl:0,base:0,rate:3,synerzy:1,mp:5,element:"cold",kind:"breath",type:"spell",name:{a:"Cold Breath",b:"冷気のブレス"}}],[Il,{reqLvl:0,base:0,rate:3,synerzy:1,mp:5,element:"lightning",kind:"breath",type:"spell",name:{a:"Lightning Breath",b:"稲妻のブレス"}}],[$l,{reqLvl:0,base:0,rate:3,synerzy:1,mp:5,element:"gravity",kind:"breath",type:"spell",name:{a:"Gravity Breath",b:"重力のブレス"}}],[Al,{reqLvl:0,base:0,rate:3,synerzy:1,mp:5,element:"infection",kind:"breath",type:"spell",name:{a:"Infection Breath",b:"感染のブレス"}}],[Dl,{reqLvl:0,base:0,rate:3,synerzy:1,mp:5,element:"blizzard",kind:"breath",type:"spell",name:{a:"Blizzard Breath",b:"吹雪のブレス"}}],[zl,{reqLvl:0,base:0,rate:3,synerzy:1,mp:5,element:"sand",kind:"breath",type:"spell",name:{a:"Dust Breath",b:"砂塵のブレス"}}],[Cl,{reqLvl:0,base:0,rate:3,synerzy:1,mp:5,element:"acid",kind:"breath",type:"spell",name:{a:"Acid Breath",b:"酸のブレス"}}],[Pl,{reqLvl:0,base:0,rate:3,synerzy:1,mp:5,element:"magma",kind:"breath",type:"spell",name:{a:"Magma Breath",b:"溶岩のブレス"}}],[Ul,{reqLvl:0,base:0,rate:3,synerzy:1,mp:5,element:"radiation",kind:"breath",type:"spell",name:{a:"Radioactive Breath",b:"放射能のブレス"}}]]);if(Fa<rr.size)throw new Error("Incorrect skill numbers");for(let[e,t]of rr.entries())t.id=e,t.color=Dt[t.element];const nr=new Map([["race",{name:{a:"Race",b:"種族"},char:!0}],["lvl",{name:{a:"Level",b:"レベル"},char:!0,max:"lvlMax"}],["exp",{name:{a:"Exp",b:"経験値"},char:!0,max:"expMax"}],["expNext",{name:{a:"Exp Next",b:"次経験値"},char:!0}],["expGain",{name:{a:"Exp Gain",b:"取得経験値"},char:!0}],["totalWeight",{name:{a:"Total Weight",b:"総重量"},char:!0,weight:!0,max:"weightLimit"}],["weight",{name:{a:"Weight",b:"重量"},item:!0,weight:!0}],["reqStr",{name:{a:"Strength Requirement",b:"必要筋力"},item:!0}],["charges",{name:{a:"Charges",b:"充填数"},item:!0}],["atkType",{name:{a:"Attack Type",b:"攻撃種類"}}],["dmgValue",{name:{a:"Damage",b:"ダメージ"},item:!0}],["dmgAvg",{name:{a:"Averate Damage",b:"平均ダメージ"},char:!0,equipList:!0}],["dmgSValue",{name:{a:"Slash Damage",b:"斬ダメージ"},char:!0}],["dmgTValue",{name:{a:"Thrust Damage",b:"突ダメージ"},char:!0}],["dmgBValue",{name:{a:"Blunt Damage",b:"打ダメージ"},char:!0}],["timesMelee",{name:{a:"Melee Attack Times",b:"近接攻撃回数"},char:!0}],["timesMissile",{name:{a:"Missile Attack Times",b:"遠隔攻撃回数"},char:!0}],["rateValue",{name:{a:"Hit Rating",b:"命中値"},char:!0,equipList:!0}],["acAvgValue",{name:{a:"Average Defence",b:"平均守備力"},item:!0}],["acSValue",{name:{a:"Slash Defence",b:"斬守備力 "},item:!0}],["acTValue",{name:{a:"Thrust Defence",b:"突守備力 "},item:!0}],["acBValue",{name:{a:"Blunt Defence",b:"打守備力 "},item:!0}],["acAvgValueTotal",{name:{a:"Average Defence",b:"平均守備力"},char:!0,equipList:!0}],["acSValueTotal",{name:{a:"Slash Defence",b:"斬守備力"},char:!0}],["acTValueTotal",{name:{a:"Thrust Defence",b:"突守備力"},char:!0}],["acBValueTotal",{name:{a:"Blunt Defence",b:"打守備力"},char:!0}],["spdMeleeRate",{name:{a:"Melee Attack Speed",b:"近接攻撃速度"},perc:!0,char:!0,equipList:!0}],["spdMissileRate",{name:{a:"Missile Attack Speed",b:"遠隔攻撃速度"},perc:!0,char:!0,equipList:!0}],["spdSpellRate",{name:{a:"Spell Cast Speed",b:"魔法詠唱速度"},perc:!0,char:!0,equipList:!0}],["spdMoveRate",{name:{a:"Move Speed",b:"移動速度"},perc:!0,char:!0,equipList:!0}],["right",null],["statPoints",{name:{a:"Stat Points",b:"ステータスポイント"},char:!0,equipList:!0}],["skillPoints",{name:{a:"Skill Points",b:"スキルポイント"},char:!0,equipList:!0}],["fuelLvl",{name:{a:"Fuel Level",b:"燃料残量"},item:!0,perc:!0}],["durab",{name:{a:"Durability",b:"耐久度"},item:!0,max:"durabMax"}],["iasBase",{name:{a:"Base Attack Speed",b:"基礎攻撃速度"},perc:!0,plus:!0,item:!0}],["fcrBase",{name:{a:"Base Cast Speed",b:"基礎詠唱速度"},perc:!0,plus:!0,item:!0}],["frwBase",{name:{a:"Base Move Speed",b:"基礎移動速度"},perc:!0,plus:!0,item:!0}],["material",{name:{a:"Material",b:"素材"},item:!0}],["embeddedNum",{name:{a:"Embedded Number",b:"埋め込み数"},item:!0,max:"embeddedMax"}],["mod",null],["hp",{name:{a:"Life",b:"体力"},plus:!0,max:"hpMax"}],["mp",{name:{a:"Mana",b:"魔力"},plus:!0,max:"mpMax"}],["str",{name:{a:"Strength",b:"筋力"},plus:!0,max:"strMax"}],["dex",{name:{a:"Dexterity",b:"器用さ"},plus:!0,max:"dexMax"}],["con",{name:{a:"Constitution",b:"耐久力"},plus:!0,max:"conMax"}],["int",{name:{a:"Intelligence",b:"知力"},plus:!0,max:"intMax"}],["spd",{name:{a:"Speed",b:"速度"},plus:!0,perc:!0,max:"spdMax"}],["resistAll",{name:{a:"Resist All",b:"全耐性"},plus:!0,perc:!0,item:!0}],["fire",{name:{a:"Fire Resist",b:"耐火"},plus:!0,perc:!0,max:"fireMax",equipList:!0}],["water",{name:{a:"Water Resist",b:"耐水"},plus:!0,perc:!0,max:"waterMax",equipList:!0}],["air",{name:{a:"Air Resist",b:"耐風"},plus:!0,perc:!0,max:"airMax",equipList:!0}],["earth",{name:{a:"Earth Resist",b:"耐土"},plus:!0,perc:!0,max:"earthMax",equipList:!0}],["poison",{name:{a:"Poison Resist",b:"耐毒"},plus:!0,perc:!0,max:"poisonMax",equipList:!0}],["physical",{name:{a:"Physical Resist",b:"耐物"},plus:!0,perc:!0,max:"physicalMax"}],["end",null],["skillFire",{name:{a:"Fire Skill",b:"火スキル"},plus:!0}],["skillWater",{name:{a:"Water Skill",b:"水スキル"},plus:!0}],["skillAir",{name:{a:"Air Skill",b:"風スキル"},plus:!0}],["skillEarth",{name:{a:"Earth Skill",b:"土スキル"},plus:!0}],["skillPoison",{name:{a:"Poison Skill",b:"毒スキル"},plus:!0}],["skillAll",{name:{a:"All Skill ",b:"全スキル"},plus:!0}],["synerzyMelee",{name:{a:"Melee Synerzy",b:"近接シナジー"},char:!0,plus:!0,margin:!0}],["synerzyMissile",{name:{a:"Missile Synerzy",b:"遠隔シナジー"},char:!0,plus:!0}],["synerzyFire",{name:{a:"Fire Spell Synerzy",b:"火魔法シナジー"},char:!0,plus:!0}],["synerzyWater",{name:{a:"Water Spell Synerzy",b:"水魔法シナジー"},char:!0,plus:!0}],["synerzyAir",{name:{a:"Air Spell Synerzy",b:"風魔法シナジー"},char:!0,plus:!0}],["synerzyEarth",{name:{a:"Earth Spell Synerzy",b:"土魔法シナジー"},char:!0,plus:!0}],["synerzyPoison",{name:{a:"Poison Spell Synerzy",b:"毒魔法シナジー"},char:!0,plus:!0}],["ias",{name:{a:"Increase Attack Speed",b:"攻撃速度上昇"},plus:!0,perc:!0}],["fcr",{name:{a:"Faster Cast Rate",b:"詠唱速度上昇"},plus:!0,perc:!0}],["frw",{name:{a:"Faster Run Walk",b:"早足"},plus:!0,perc:!0}],["digest",{name:{a:"Slow Digestion",b:"遅消化"},plus:!0,perc:!0}],["stealth",{name:{a:"Stealth",b:"隠密"},plus:!0,perc:!0}],["searching",{name:{a:"Searching",b:"捜索"},plus:!0,perc:!0}],["hpReg",{name:{a:"Life Regeneration",b:"再生"},plus:!0,perc:!0}],["mpReg",{name:{a:"Mana Regeneration",b:"魔力再生"},plus:!0,perc:!0}],["mf",{name:{a:"Magic Finding",b:"魔法具探求"},plus:!0,perc:!0}],["gf",{name:{a:"Gold Finding",b:"財宝探求"},plus:!0,perc:!0}],["expBonus",{name:{a:"Experience Bonus",b:"経験値加算値"},plus:!0,perc:!0}],["lighten",{name:{a:"Lighten",b:"照明"},plus:!0}],["fuelBonus",{name:{a:"Fuel Bonus",b:"燃料加算値"},item:!0,plus:!0,perc:!0}],["numBoxes",{name:{a:"Slot numbers",b:"スロット数"},plus:!0}],["dmgMinBonus",{name:{a:"Minimum Damage Bonus",b:"最小ダメージ加算値"},plus:!0}],["dmgMaxBonus",{name:{a:"Maximum Damage Bonus",b:"最大ダメージ加算値"},plus:!0}],["dmgBonus",{name:{a:"Damage Bonus",b:"ダメージ加算値"},plus:!0,perc:!0}],["rateBonus",{name:{a:"Hit Rating Bonus",b:"命中率加算値"},plus:!0,perc:!0}],["acBonus",{name:{a:"Defence Bonus",b:"守備力加算値"},plus:!0,perc:!0}],["durabBonus",{name:{a:"Durability Bonus",b:"耐久度加算値"},item:!0,plus:!0}],["embeddedBonus",{name:{a:"Embedded Bonus",b:"埋め込み加算値"},item:!0,plus:!0}],["digging",{name:{a:"Digging",b:"採掘"},plus:!0,perc:!0}],["dmgHuman",{name:{a:"Damage to Human",b:"対人間ダメージ"},plus:!0,perc:!0}],["dmgDemon",{name:{a:"Damage to Demon",b:"対悪魔ダメージ"},plus:!0,perc:!0}],["dmgAnimal",{name:{a:"Damage to Animal",b:"対動物ダメージ"},plus:!0,perc:!0}],["dmgDragon",{name:{a:"Damage to Dragon",b:"対竜ダメージ"},plus:!0,perc:!0}],["dmgUndead",{name:{a:"Damage to Undead",b:"対不死ダメージ"},plus:!0,perc:!0}],["dmgGiant",{name:{a:"Damage to Giant",b:"対巨人ダメージ"},plus:!0,perc:!0}],["dmgSpirit",{name:{a:"Damage to Spirit",b:"対精霊ダメージ"},plus:!0,perc:!0}],["dmgGod",{name:{a:"Damage to God",b:"対神ダメージ"},plus:!0,perc:!0}],["dmgFire",{name:{a:"Fire Damage",b:"火ダメージ"},plus:!0,perc:!0}],["dmgLightning",{name:{a:"Lightning Damage",b:"電撃ダメージ"},plus:!0,perc:!0}],["dmgPoison",{name:{a:"Poison Damage",b:"毒ダメージ"},plus:!0,perc:!0}],["dmgAcid",{name:{a:"Acid Damage",b:"酸ダメージ"},plus:!0,perc:!0}],["stealLife",{name:{a:"Life Steal",b:"生命力吸収"},plus:!0,perc:!0}],["stealMana",{name:{a:"Mana Steal",b:"魔力吸収"},plus:!0,perc:!0}],["atkCon",{name:{a:"Confusion Attack",b:"混乱攻撃"},plus:!0,perc:!0}],["atkPara",{name:{a:"Paralysis Attack",b:"麻痺攻撃"},plus:!0,perc:!0}],["atkSlow",{name:{a:"Slow Attack",b:"減速攻撃"},plus:!0,perc:!0}],["atkInf",{name:{a:"Infection Attack",b:"感染攻撃"},plus:!0,perc:!0}],["atkBlind",{name:{a:"Blindness Attack",b:"盲目攻撃"},plus:!0,perc:!0}],["atkRadi",{name:{a:"Radioactive Attack",b:"放射能攻撃"},plus:!0,perc:!0}],["atkCold",{name:{a:"Freezing Attack",b:"凍結攻撃"},plus:!0,perc:!0}],["atkDrain",{name:{a:"Drain Attack",b:"吸収攻撃"},plus:!0,perc:!0}],["atkStealGold",{name:{a:"Gold Steal",b:"金貨強奪"},plus:!0,perc:!0}],["atkStealItem",{name:{a:"Item Steal",b:"アイテム強奪"},plus:!0,perc:!0}],["strSus",{name:{a:"Sustain Strength",b:"筋力維持"},bool:!0}],["dexSus",{name:{a:"Sustain Dexterity",b:"器用さ維持"},bool:!0}],["conSus",{name:{a:"Sustain Constitution",b:"耐久力維持"},bool:!0}],["intSus",{name:{a:"Sustain Intelligence",b:"知力維持"},bool:!0}],["levi",{name:{a:"Levitation",b:"浮遊"},bool:!0}],["indestructible",{name:{a:"Indestructible",b:"破壊不能"},bool:!0}],["teleported",{name:{a:"Random Teleportation",b:"ランダム・テレポート"},bool:!0}],["aggravating",{name:{a:"Aggravate Monster",b:"反感"},bool:!0}]]),or={main(e,t,i){let a=this.list[i?"fighter":"item"];a.show=!0,i||Vue.nextTick(function(){let e=At.$refs.investigationItem.$el;e.style.left=t===lt?"50%":"0"});let s,l={};e.shadow&&(l.shadow=e.shadow),e.stroke&&(l.stroke=e.stroke),l.symbolColor=e.color,l.symbol=e.symbol,s=e.cursed?Dt.red:e.equipable&&!e.durab?Dt.gray:Dt.white,l.nameColor=s,l.name=i?e.getName(!1,!0):e.getName(!1,1);let r="";e.desc?r=e.desc[Pt.getLanguage()]:e.nameSkill&&(r=$t.getSkillInfo(rr.get(e.nameSkill),e.skillLvl,!0)),a.desc=r,a.obj=l;let n,o=[],h=[];for(let[t,s]of nr.entries())if(s){if(!(!i&&(s.char||n&&!e[t])||i&&s.item||void 0===e[t])&&(this.loop(e,h,i,t,s,e[t],n),"embeddedNum"===t&&e[t]))for(let t=0,i=e.embeddedList.length;t<i;t++){let i={},a=e.embeddedList[t];i.symbol=a.symbol,i.symbolColor=a.color,i.name=a.getName(),a.shadow&&(i.shadow=a.shadow),a.cursed&&(i.nameColor=Dt.red),o.push(i)}}else if("mod"===t&&!i&&(a.basePropList=h,h=[],n=!0,e.modParts))break;if(i)return void(a.basePropList=h);a.embeddedList=o,a.modPropList=h;let d={};if(e.modParts)for(let t in e.modParts){h=[];let i=e.modParts[t];if("orb"===e.type)for(let t in i){let a=nr.get(t);this.loop(e,h,!1,t,a,i[t],!0)}else{let t;for(let[a,s]of nr.entries())t&&s&&!s.char&&i[a]?this.loop(e,h,!1,a,s,i[a],!0):"mod"===a&&(t=!0)}let a=Pt.isEnglish()?t:Oa.item[t];d[a]=h}if(a.modPartsList=d,a.skills=[],"book"===e.type&&e.list){let[t,i,s]=Pt.isEnglish()?["Element","RLv","RSy"]:["属性","必レ","必シ"],l={element:t,reqLv:i,reqSy:s};a.skills.push(l);let r=e.list;for(let e in r){let t={},i=r[e],s=rr.get(i),l=s.element;t.shadow=Dt[l],t.element=Pt.isEnglish()?ei(l):Oa.element[l],t.name=s.name[Pt.getLanguage()],t.mp=s.mp,t.reqLv=s.reqLvl,t.reqSy=s.reqSynerzy,a.skills.push(t)}}},loop(e,t,i,a,s,l,r){let n={};if(n.text=s.name[Pt.getLanguage()],s.plus&&!i&&l>0&&(l="+"+l),s.perc&&(l+="%"),s.weight&&(l+="kg"),"atkType"===a?l=this.getAtkTypeName(e.atkType):"race"===a?l=this.getRaceName(e.race):i?(e.findBuffStat(a)||e.modList&&(e.modList[a]||e.modList.resistAll&&("fire"===a||"water"===a||"air"===a||"earth"===a||"poison"===a)))&&(n.shadow=Dt.buff):r&&(n.shadow=Dt.buff),s.max&&void 0!==e[s.max]){let t=e[s.max];s.perc&&(t+="%"),s.weight&&(t+="kg"),l+=` (${t})`}s.bool&&(l=l?!i&&r?"":Pt.isEnglish()?"yes":"有り":Pt.isEnglish()?"no":"無し"),"material"===a&&(l=Gh.get(l).name[Pt.getLanguage()]),n.value=l,t.push(n)},skill(e,t){let i=this.list.skill;i.show=!0;let a={};a.shadow=t.color,a.name=t.name[Pt.getLanguage()],i.obj=a;let s=0,l=e.searchSkill(t.id);l&&(s=e.skill[l].lvl);let r=e.getSkillBoost(t);i.desc=e.getSkillInfo(t,s+r);let n=[],o={};o.text=Pt.isEnglish()?"Element":"属性",o.value=Pt.isEnglish()?ei(t.element):Oa.element[t.element],o.shadow=t.color,n.push(o);let[h,d,m,c,p]=Pt.isEnglish()?["Base","per Level","per Synerzy","Duration Base","Max Limit"]:["基礎値","レベル毎","シナジー毎","期間基礎値","上限"],u=t.perc?"%":"";if(t.rate){let e=t.base;isFinite(e)&&u&&e>0?e="+"+e:t.radiusRate&&(e=(Pt.isEnglish()?"radius ":"半径")+e),o={},o.text=h,o.value=e+u,n.push(o),isFinite(t.base)||(u="%");let i=t.rate>0?"+":"";o={},o.text=d,o.value=i+t.rate+u,n.push(o)}if(t.synerzy){let e=t.synerzy>0?"+":"";o={},o.text=m,o.value=e+t.synerzy+u,n.push(o)}if(t.limit){let e=t.perc?"%":"",i="+";o={},o.text=p,o.value=i+t.limit+e,n.push(o)}if(t.durBase&&(o={},o.text=c,o.value=t.durBase,n.push(o)),t.durRate){let e=t.durRate>0?"+":"";o={},o.text=d,o.value=e+t.durRate,n.push(o)}i.basePropList=n},clear(){for(let e in this.list)this.list[e].show=!1},scroll(e,t){if(t)this.eleP=At.$refs.investigationFighter.$refs.fighterPropList,this.eleC=this.eleP.firstElementChild,Na.draw(Na.get(za)+Na.get(Aa),!0);else if(qt.examine&&"c"===e)return qt.character=!1,Fr.clear(),void $t.examineMsg();gp.scroll(this.eleP,this.eleC,e,t)},getAtkTypeName(e){let t="",i=Pt.isEnglish();return e&Qe&&(t+=i?"Slash・":"斬・"),e&et&&(t+=i?"Thrust・":"突・"),e&tt&&(t+=i?"Blunt・":"打・"),t?t.replace(/・$/,""):"-"},getRaceName(e){let t="",i=Pt.isEnglish();return e&je&&(t+=i?"Human・":"人間・"),e&Ue&&(t+=i?"Animal・":"動物・"),e&Ye&&(t+=i?"Demon・":"悪魔・"),e&_e&&(t+=i?"Undead・":"不死・"),e&Ze&&(t+=i?"Dragon・":"竜・"),e&Je&&(t+=i?"Giant・":"巨人・"),e&Ke&&(t+=i?"Spirit・":"精霊・"),e&Xe&&(t+=i?"God・":"神・"),t?t.replace(/・$/,""):"-"},list:{}};or.list.item={obj:{},desc:"",basePropList:[],embeddedList:[],modPropList:[],modPartsList:{},show:!1},or.list.skill={obj:{},desc:"",basePropList:[],show:!1},or.list.fighter={obj:{},desc:"",basePropList:[],show:!1};const hr=class{constructor(){this.convertCe(!0),this.saveItemTab(),this.coords=vr.coords,this.option=Pt,this.messageList=Na.list,$t.cdl&&(this.stashList=vr.stashList),this.track=pr.curTrack,this.date=new Date,this.ver=s}loadInit(){Ct.clearAll(),this.loadOption(),Wt.init(),this.loadItemTab(),this.loadCoords(),Na.list=this.messageList,At.msgList=Na.list,this.ver<.003&&($t.litMapIds=this.litMapIds,$t.inferno=this.difficulty.inferno),$t.cdl&&(this.loadItem(this.stashList),vr.stashList=this.stashList),this.convertCe(),At.rogue=$t,At.isEnglish=Pt.isEnglish(),Ht(),$t.litMapIds={},$t.lightenOrDarken("Lighten"),vr.redraw(),this.loadAudio(),cp.setList()}saveItemTab(){this.itemTab={};for(let e in ep)if("potion"===e||"wand"===e||"scroll"===e||"recipe"===e||"orb"===e){this.itemTab[e]=[];for(let[t,i]of ep[e].entries()){let a={};a.identified=i.identified,a.name={},a.name.a=i.name.a,a.name.b=i.name.b,"potion"!==e&&"wand"!==e||(a.color=i.color),this.itemTab[e][t]=a}}}loadItemTab(){for(let e in ep)if(!("potion"!==e&&"wand"!==e&&"scroll"!==e&&"recipe"!==e&&"orb"!==e||this.ver<.007&&"orb"===e))if(this.ver<.009&&"recipe"===e)for(let t of ep[e].values())t.identified=!1,Wt[e](t);else for(let[t,i]of ep[e].entries()){let a=this.itemTab[e][t];a?(i.identified=a.identified,i.name.a=a.name.a,i.name.b=a.name.b,"potion"!==e&&"wand"!==e||(i.color=a.color)):(i.identified=!1,Wt[e](i))}}loadCoords(){vr.coords=this.coords,vr.init(!1,!0);for(let e of vr.coords)for(let t of e)t.__proto__=qr.prototype,t.fighter&&this.loadFighter(t.fighter),t.item.a&&this.loadItem(t.item,!0),t.enter&&this.loadEntrance(t.enter),t.trap&&(t.trap.__proto__=$r.prototype,vr.trapList[t.x+","+t.y]=t.trap),t.stairs&&(t.stairs.__proto__=Dr.prototype,vr.staircaseList[t.x+","+t.y]=t.stairs)}loadFighter(e){if(e.id===re){if(e.__proto__=dp.prototype,$t=e,this.ver<.009){$t.recipes={};for(let e of ep.recipe.keys())$t.recipes[e]=!0}}else e.__proto__=mp.prototype,vr.enemyList[e.id]=e;vr.queue.push(e),this.loadItem(e.boxes),this.loadItem(e.equipment),this.loadItem(e.side),this.loadItem(e.pack),this.ver<.007&&(e.calcHP(),e.calcMP())}loadItem(e,t){for(let i in e){let a=e[i];a&&(a.__proto__=sp.prototype,t&&(vr.itemList[a.id]=a),a.embeddedList&&a.embeddedList.length&&this.loadItem(a.embeddedList),this.ver<.006&&"gem"===a.type&&(a.material=void 0),this.ver<.008&&"material"===a.type&&(a.tabId=Gr.indexOf(a.material)))}}loadEntrance(e){(e.shop||e.stash)&&this.loadItem(e.list),e.stash&&(vr.stashList=e.list),e.portal?(vr.portal=e,e.__proto__=Er.prototype):e.__proto__=hi.prototype}loadOption(){for(let e in Pt.list){let t=Pt.list[e].key;this.option[t]||(this.option[t]={},this.option[t].user=Pt[t].default),Pt[t].user=this.option[t].user}}convertCe(e){$t.ce&&($t.ce=e?$t.ce.id:vr.enemyList[$t.ce]);for(let t in vr.enemyList){let i=vr.enemyList[t];i.ce&&(i.ce=e?i.ce.id:i.ce===re?$t:vr.enemyList[i.ce])}}loadAudio(){pr.stop(pr.curTrack),pr.curTrack=this.track;let e=this.option.BGM.user;pr.volBGM=Pt.BGM.select[e].a/10,e=this.option.SE.user,pr.volSE=Pt.SE.select[e].a/10,pr.playMusic(pr.curTrack)}},dr={name:"Player",getName(){return`dnb_v0.1xx_${this.name}`},save(e){if(e&&pr.curTrack&&pr.music[pr.curTrack].pause(),qt.died||qt.retry||qt.title||this.error)return;qt.synthesize&&$t.returnCubeItem(),Rr.clearAll(),
Na.draw(Pt.isEnglish()?"Saved":"記録した");let t=new hr;localStorage.setItem(this.getName(),JSON.stringify(t))},load(){let e=JSON.parse(localStorage.getItem(this.getName()));if(null!==e){e.__proto__=hr.prototype;try{e.loadInit(),Na.draw(Pt.isEnglish()?"Loaded":"記録を読み込んだ")}catch(t){console.log(t);let i=e.ver;At.verData=i,qt.regular=!1,qt.failed=!0}}else pp.start()},delete(){localStorage.removeItem(this.getName())},exit(){this.save(),pp.quit("Y",!0)},dontSave(){this.error=!0,Na.draw(Pt.isEnglish()?"Error occurred":"エラーが発生した")}};window.addEventListener("beforeunload",dr.save.bind(dr,!0),!1),window.addEventListener("error",dr.dontSave.bind(dr),!1);const[mr,cr]=i(1,2),pr={volBGM:1,volSE:1,music:{title:new Audio("music/title.ogg"),town:new Audio("music/town.ogg"),town2:new Audio("music/town2.ogg"),dungeon:new Audio("music/dungeon.ogg"),dungeon2:new Audio("music/dungeon2.ogg"),dungeon3:new Audio("music/dungeon3.ogg"),dungeon4:new Audio("music/dungeon4.ogg"),boss:new Audio("music/boss.ogg"),gameover:new Audio("music/gameover.ogg")},sound:{level:new Audio("sound/level.wav"),opendoor:new Audio("sound/opendoor.wav"),shutdoor:new Audio("sound/shutdoor.wav"),teleport:new Audio("sound/teleport.wav"),curse:new Audio("sound/curse.wav"),amulet:new Audio("sound/amulet.wav"),ring:new Audio("sound/ring.wav"),gem:new Audio("sound/gem.wav"),grab:new Audio("sound/grab.wav"),tplevel:new Audio("sound/tplevel.wav"),dig:new Audio("sound/dig.wav"),coin:new Audio("sound/coin.wav"),hitwall:new Audio("sound/hitwall.wav"),uncurse:new Audio("sound/uncurse.wav"),swing:new Audio("sound/swing.wav"),kill:new Audio("sound/kill.wav"),paralyze:new Audio("sound/paralyze.wav"),blind:new Audio("sound/blind.wav"),probe:new Audio("sound/probe.wav"),summon:new Audio("sound/summon.wav"),hungry:new Audio("sound/hungry.wav"),probe2:new Audio("sound/probe2.wav"),fire:new Audio("sound/fire.wav"),air:new Audio("sound/wind.wav"),acid:new Audio("sound/acid.wav"),speed:new Audio("sound/speed.wav"),slow:new Audio("sound/slow.wav"),staircase:new Audio("sound/staircase.wav"),broken:new Audio("sound/broken.wav"),quaff:new Audio("sound/quaff.wav"),throw:new Audio("sound/throw.wav"),lightning:new Audio("sound/lightning.wav"),disintegrate:new Audio("sound/annihilate.wav"),encourage:new Audio("sound/enchant.wav"),hallucinate:new Audio("sound/hallucinate.wav"),eat:new Audio("sound/eat.wav"),shoot:new Audio("sound/shoot.wav")},init(){for(let e in this.music)this.music[e].currentTime=0},fadeIn(e){e.fade===mr&&(e.volume<this.volBGM?(e.volume=Math.round(10*(e.volume+.1))/10,setTimeout(this.fadeIn.bind(this,e),100)):e.fade=null)},fadeOut(e,t){e.fade===cr&&(e.volume>0?(e.volume=Math.round(10*(e.volume-.1))/10,setTimeout(this.fadeOut.bind(this,e,t),100)):(t||e.pause(),e.fade=null))},playSafely(e){setTimeout(()=>{this.curTrack===e.title&&e.paused&&e.play()},0)},playMusic(e){if(!this.music[e])return;let t=this.music[e];this.curTrack=e,t.volume=0,t.fade=mr,this.fadeIn(t),Pt.mute.user||this.playSafely(t)},playSound(e,t){if(!this.sound[e])return;let i=this.sound[e];if(t){if(t>X)return;let e=Math.round(this.volSE*(1-t/X)*10)/10;i.volume=e}else i.volume=this.volSE;i.currentTime=0,Pt.mute.user||i.play()},stop(e){if(!e)return;let t=this.music[e];t.fade=cr,this.fadeOut(t)},mute(){Pt.mute.user=!Pt.mute.user;let e=this.music[this.curTrack];Pt.mute.user?e.pause():this.playSafely(e)},getDungeonTrack:(e,t)=>e<10?"dungeon":e<20?"dungeon2":e<30?"dungeon3":t?"boss":"dungeon4"};for(let e in pr.music){let t=pr.music[e];t.title=e,t.addEventListener("timeupdate",function(){this.fade!==cr&&this.currentTime>=this.duration-.5&&(this.fade=cr,pr.fadeOut(this,!0))},!1),t.addEventListener("ended",function(){pr.curTrack===e&&(this.fade=mr,pr.fadeIn(this),pr.playSafely(this))},!1)}const ur={main({x0:e,y0:t,type:i,radius:a,symbol:s,perc:l}){this.count=0,this.type=i,this.symbol=s,this.perc=l;let r=vr.coords.length,n=vr.coords[0].length,o=a**2;for(let i=0;i<=a;i++){let s=-a;for(;Ut(s,i,0,0)>o;)s++;for(let a=s;a<=-s;a++)if(!(a+e<0)){if(a+e>=r)break;t+i<n&&this.do(a+e,i+t),i&&t-i>=0&&this.do(a+e,-i+t)}}this.count&&(this.type===Bs?Na.draw(Pt.isEnglish()?`Detected ${this.count} enemies`:`${this.count}体の敵を検出した`):this.type===Ls?Na.draw(Pt.isEnglish()?`Detected ${this.count} items`:`${this.count}個のアイテムを検出した`):this.type===pl&&(Na.draw(Pt.isEnglish()?`Disintegrated ${this.count} enemies`:`${this.count}体の敵を塵にした`),pr.playSound("disintegrate")))},do(e,t){let i=vr.coords[e][t];switch(this.type){case Ms:if(i.found)return;i.found=!0,i.drawGround();break;case Ls:if(!i.item.a)return;for(let e in i.item){let t=i.item[e];t.detected||(t.detected=!0,this.count++)}break;case Bs:if(!i.fighter||i.fighter.id===re||i.fighter.detected)return;i.fighter.detected=!0,this.count++;break;case bs:if(!i.fighter||!i.fighter.sleeping)return;i.fighter.wakeUp();break;case pl:if(!i.fighter||i.fighter.id===re||i.fighter.symbol!==this.symbol)return;i.fighter.mod===Pe||Jt(i.fighter.lvl)?i.fighter.sleeping&&i.fighter.wakeUp():($t.ce&&$t.ce.id===i.fighter.id&&$t.removeCe(),i.fighter.died(),this.count++);break;case Ql:if(!Jt(this.perc)||i.indestructible||i.enter&&!i.enter.portal||i.fighter&&i.fighter.id===re)return;let e;if(i.found=!1,i.lighten=!1,i.wall=ve*Zt(),i.floor=!i.wall,i.hidden=!1,i.door=!1,i.trap=null,i.enter&&i.enter.portal&&(i.enter=vr.portal=null),i.item){let t={},a=0;for(let s in i.item){let l=i.item[s];if(l.indestructible||Jt(l.earth))t[vt[a++]]=l,e=!0;else{if(l.mod===Pe&&!l.identified){let e=l.type+","+l.tabId+","+l.uniqueId;this.cui[e]&&delete this.cui[e]}delete vr.itemList[l.id]}}i.item=t}i.fighter&&(i.fighter.boss||i.fighter.indestructible||Jt(i.fighter.earth)?(i.fighter.sleeping&&i.fighter.wakeUp(),e=!0):(i.fighter.mod===Pe&&delete $t.cue[i.fighter.name[se]],i.fighter.died())),i.wall=ve*(!e&&Zt()),i.floor=!i.wall,i.drawGround()}}},gr=(e,t,i,a,s,l)=>{s&&Rr.drawPlot(e,t,s);let r=qt.arrow||qt.throw||l&&l.parabora,n=l&&l.range>=0?l.range**2:K,o=l&&l.radius?l.radius:0,[h,d,m,c]=[e,e,t,t],p=Math.abs(a-t)>Math.abs(i-e);p&&([e,t,i,a]=[t,e,a,i]);let[u,g]=[Math.abs(i-e),Math.abs(a-t)],b=u/2,f=t<a?1:-1,y=t,k=!0,v=e<i?1:-1;for(let a=e+v;i-a+v;a+=v){b-=g,b<0&&(y+=f,b+=u),[d,c]=p?[y,a]:[a,y];let i=vr.coords[d][c];if(s){if(Ut(a,y,e,t)>n){k=!1;break}if(Rr.drawPlot(d,c,s),o&&(l.each||i.fighter&&l.penetrate))i.isObstacle()||br.main({x0:d,y0:c,radius:o,color:s});else if(i.fighter&&(!l||!l.penetrate)&&!r)break}if(i.isObstacle()){k=!1;break}[h,m]=[d,c]}return s&&o&&(k||([d,c]=[h,m]),br.main({x0:d,y0:c,radius:o,color:s})),k},br={transforms:[{xx:1,xy:0,yx:0,yy:1},{xx:0,xy:1,yx:1,yy:0},{xx:0,xy:-1,yx:1,yy:0},{xx:-1,xy:0,yx:0,yy:1},{xx:-1,xy:0,yx:0,yy:-1},{xx:0,xy:-1,yx:-1,yy:0},{xx:0,xy:1,yx:-1,yy:0},{xx:1,xy:0,yx:0,yy:-1}],main({x0:e,y0:t,radius:i,type:a,lvl:s,color:l,lightRad:r,search:n,fighter:o}){if(i){this.radiusSq=i**2,this.width=vr.coords.length,this.height=vr.coords[0].length,this.type=a,this.lvl=s,this.color=l,this.fighter=o,n&&vr.coords[e][t].findHiddenObject(),"Lighten"===this.type&&(this.lightRadSq=r**2,this.oldLitMap=$t.litMapIds,$t.litMapIds={}),this.do(e,t);for(let a=0;a<=7;a++)this.line(a,e,t,i,n),this.around(this.transforms[a],e,t,i,1,1,0);if("Lighten"===this.type)for(let e in this.oldLitMap){let[t,i]=e.split(","),a=vr.coords[t][i];a.drawShadow()}}},line(e,t,i,a,s){for(let l=1;l<=a;l++){let[a,r]=[wt[e].x*l,wt[e].y*l],n=Ut(a,r,0,0);if(n>this.radiusSq)break;let[o,h]=[t+a,i+r];this.do(o,h,n);let d=vr.coords[o][h];if(s&&1===l&&d.findHiddenObject(),d.isObstacle())break}},around(e,t,i,a,s,l,r){for(let n,o=s;o<=a&&!n;o++)for(let s=o;s>=0;s--){let h=t+o*e.xx+s*e.xy,d=i+o*e.yx+s*e.yy;if(h<0||d<0||h>=this.width||d>=this.height)continue;let m=(s+.5)/(o-.5),c=(s-.5)/(o+.5);if(c>l)continue;if(m<r)break;if(s!==o&&0!==s){let e=Ut(o,s,0,0);e<=this.radiusSq&&this.do(h,d,e)}let p=vr.coords[h][d];n?p.isObstacle()?this.rightSlopeSaved=c:(n=!1,l=this.rightSlopeSaved):p.isObstacle()&&(n=!0,this.rightSlopeSaved=c,m<=l&&this.around(e,t,i,a,o+1,l,m))}},do(e,t,i){let a=vr.coords[e][t];if(this.color)Rr.drawPlot(e,t,this.color);else if("Lighten"===this.type){if((!this.lightRadSq||i>this.lightRadSq)&&!a.lighten)return;let s=a.wall&&a.item.a,l=e+","+t;s||($t.litMapIds[l]=!0),this.oldLitMap[l]?delete this.oldLitMap[l]:(a.found=!0,a.drawGround(),s||a.drawShadow(!0))}else if("Light"===this.type){let i=a.wall&&a.item.a;if(!i){let i=e+","+t;$t.litMapIds[i]=!0,a.drawShadow(!0)}a.lighten||(a.lighten=!0,a.found=!0,a.drawGround())}else if("Aim"===this.type){let s=this.fighter,l=a.fighter;l&&s.id!==l.id&&(s.hallucinated||s.isOpponent(l))&&(!s.ce||this.distanceSaved>i)&&l.isShowing()&&gr(s.x,s.y,e,t)&&(s.ce=l,this.distanceSaved=i)}else a.fighter&&this.fighter.isOpponent(a.fighter)&&this.fighter.haveCast(this.type,this.lvl,a.fighter,e,t)}},fr=class{constructor(){this.list=[]}push(e){this.list.push(e),this.upHeap(this.list.length-1)}upHeap(e){if(!e)return;let t=Math.floor((e-1)/2);return this.compare(e,t)?(this.list.swap(e,t),this.upHeap(t),!0):void 0}shift(){let e=this.list.length-1;if(e<=0)return e?null:this.list.shift();this.list.swap(0,e);let t=this.list.pop();return this.downHeap(0),t}delete(e){let t=this.list.length-1;if(t<=0)return t?null:this.list.shift();let i=this.list.indexOf(e);i!==t?(this.list.swap(i,t),this.list.pop(),this.upHeap(i)||this.downHeap(i)):this.list.pop()}downHeap(e){let t,i=2*e+1;if(!this.list[i])return;let a=i+1;return t=this.list[a]?this.compare(i,a)?i:a:i,this.compare(t,e)?(this.list.swap(t,e),this.downHeap(t),!0):void 0}update(e,t){let i=this.list.indexOf(e);t?this.upHeap(i):this.downHeap(i)}compare(e,t){let i=this.list[e],a=this.list[t];return i.fScore<a.fScore||i.fScore===a.fScore&&(i.gScore<a.gScore||i.next)}},yr=class extends ri{constructor(e,t,i,a){super(e,t),this.id=e+","+t,this.gScore=i,this.parent=a}calcScore(e,t,i,a){if(a)this.hScore=0;else{let a=Math.abs(this.x-e),s=Math.abs(this.y-t);this.hScore=i?a+s:a>s?a:s}this.calcFScore()}calcFScore(){this.fScore=this.gScore+this.hScore}},kr={main({x0:e,y0:t,xG:i,yG:a,pas:s,map:l}){if(e===i&&t===a)return[{x:i,y:a}];this.init(i,a,s,l);let r=this.createNode(e,t,0);if(l){var n={};n[e+","+t]=0}for(;this.loop++<F&&(r=this.createNeighborNodes(r),r);){if(l)n[r.x+","+r.y]=r.gScore;else if(r.x===this.xG&&r.y===this.yG){this.getPath(r),this.pathList.pop();break}delete this.openSet[r.id]}return l?n:this.pathList[0]?this.pathList.reverse():null},init(e,t,i,a){this.pas=i,this.map=a,this.loop=0,this.heap=new fr,this.openSet={},this.idList={},this.pathList=[],this.xG=e,this.yG=t},createNode(){let e=new yr(...arguments);return e.calcScore(this.xG,this.yG,this.pas,this.map),this.idList[e.id]=!0,e},createNeighborNodes(e){let t=null,i=null,a=e.gScore+1,s=0;for(let l in wt){if(this.map&&a>J||this.pas&&++s>4)break;let r=e.x+wt[l].x,n=e.y+wt[l].y,o=vr.coords[r][n];if(!(o.wall||this.pas&&o.isClosedDoor())){let s=r+","+n;if(this.idList[s]){if(!(this.openSet[s]&&this.openSet[s].gScore>a))continue;i=this.openSet[s],i.gScore=a,i.calcFScore(),this.heap.update(i)}else i=this.createNode(r,n,a,e),this.openSet[s]=i,this.heap.push(i);!t&&i.hScore<e.hScore&&(t=!0,i.next=!0,this.heap.update(i,!0))}}return this.heap.shift()},getPath(e){this.pathList.push({x:e.x,y:e.y}),e.parent&&this.getPath(e.parent)}},vr={coords:[],init(e,t){if(this.drawShadow(),this.queue=new Br,this.enemyList={},this.itemList={},this.trapList={},this.staircaseList={},this.portal=null,!t){this.coords=[];let t=e?r:h,i=e?n:d;for(let e=0;e<t;e++){this.coords.push([]);for(let a=0;a<i;a++){this.coords[e].push(new qr(e,a));let s=this.coords[e][a];0!==e&&e!==t-1&&0!==a&&a!==i-1||(s.indestructible=!0,s.wall=ve)}}}},drawGround(){for(let e=0,t=this.coords.length;e<t;e++)for(let t of this.coords[e])t.drawGround()},drawObjectAll(){Ct.clearOne(Ct.ctxes.object),$t.blinded||(this.drawObject(this.staircaseList,yt),this.drawObject(this.trapList,gt),this.drawObject(this.itemList,ct),this.portal&&this.drawObject([this.portal],ut),this.drawObject(this.enemyList,mt)),this.drawObject([$t],mt)},drawObject(e,t){for(let i in e){let a=e[i],s=this.coords[a.x][a.y];s.drawObject(t)}},drawShadow(){Ct.clearOne(Ct.ctxes.shadow);let e=Ct.ctxes.shadow,t=e.canvas;Ct.rect({ctx:e,widthPx:t.width,heightPx:t.height})},fill(e){let t=this.coords.length,i=this.coords[0].length;for(let a=1;a<t-1;a++)for(let t=1;t<i-1;t++){let i=this.coords[a][t];e?i.wall||(i.floor=!0):i.floor||i.wall||(Jt(.1)&&cp.item({type:"coin",tabId:1,position:Ee,x:a,y:t}),i.wall=ve)}},draw(e=$t.x,t=$t.y,i,a){let s,l,r,n,o,h,d,m,c=Ct.width,p=Ct.height;if(a){s=l=r=n=0;let e=this.coords.length,t=this.coords[0].length;o=e*Ct.fs,h=t*Ct.fs,c=o/2,p=h/2,d=Math.floor((Ct.width-c)/2),m=Math.floor((Ct.height-p)/2)}else d=m=0,s=e+.5,l=t+.5,r=-Math.floor(c/2),n=-Math.floor(p/2),o=c,h=p;let u=Ct.ctxes.main,g={ctx:u,sx:s,sxPx:r,sy:l,syPx:n,sWidthPx:o,sHeightPx:h,dxPx:d,dyPx:m,dWidthPx:c,dHeightPx:p};Ct.clearOne(u),$t.blinded||(g.img=Ct.canvases.ground,Ct.image(g)),g.img=Ct.canvases.object,Ct.image(g),$t.blinded||a||(g.img=Ct.canvases.shadow,Ct.image(g)),i&&(g.img=Ct.canvases.cursor,Ct.image(g))},redraw(){this.drawGround(),this.drawObjectAll(),this.draw()},lighten(e){for(let t=0,i=this.coords.length;t<i;t++)for(let i of this.coords[t])i.hidden&&(i.hidden=!1,i.wall=!1),i.lighten=!0,i.found=!0,e||i.drawGround();e||(this.drawShadow(),$t.litMapIds={},$t.lightenOrDarken("Lighten"))},drawMini(e){if("a"===e||"s"===e||"c"===e||"e"===e||"i"===e||"M"===e||"<"===e||">"===e||"p"===e||"t"===e)if("c"!==e){if("a"===e||$t.blinded)this.drawObjectAll();else switch(Ct.clearOne(Ct.ctxes.object),e){case"e":this.drawObject(this.enemyList,mt);break;case"s":this.drawObject([$t],mt);break;case"i":this.drawObject(this.itemList,ct);break;case"<":case">":this.drawObject(this.staircaseList,yt);break;case"p":this.portal&&this.drawObject([this.portal],ut);break;case"t":this.drawObject(this.trapList,gt)}this.draw(!1,!1,!1,!0)}else $t.cancelCommand()}},wr=e=>{for(let t in vr.enemyList){let i=vr.enemyList[t];i.invisible&&!e&&$t.ce&&$t.ce.id===i.id&&$t.removeCe()}},xr={all(e){this.search(vr.enemyList,!0,e),this.search(vr.itemList,!1,e),vr.redraw()},search(e,t,i){for(let a in e)t&&e[a].mimic||(i?this.undoOne(e[a]):this.one(e[a],t))},one(e,t,i){let a,s;if(e.nameTemp||(e.nameTemp={}),e.nameTemp.a=e.name.a,e.nameTemp.b=e.name.b,t){a=op[Yt(op.length-1)],s=Yt(rp[a].length-1);var l=rp[a][s];e.name.a=l.name.a,e.name.b=l.name.b,e.symbol=l.symbol,e.color=l.color?l.color:Dt.white}else{a=ip[Yt(ip.length-2)],e.typeHalluc=a,s=_t(1,ep[a].size);var r=ep[a].get(s);e.name.a=r.nameReal.a,e.name.b=r.nameReal.b,e.symbol=r.symbol,e.color=r.color?r.color:Dt.white,i&&(e.__proto__=sp.prototype,e.name.a=e.getName(!1,!1,"a"),e.name.b=e.getName(!1,!1,"b"),e.__proto__=mp.prototype)}if(!t&&!r.equipable||i)return e.shadow=0,void(e.stroke=0);if(t&&l.mod===Pe||!t&&ap[r.type].has(r.tabId)&&Zt()){if(!t)if("amulet"===a&&Jt(1))e.name.a="Amulet of Yendor",e.name.b="イェンダーの魔除け";else{let t=ap[r.type].get(r.tabId),i=t[Yt(t.length-1)];e.getUniqueName(i.name,!0)}e.shadow=Dt.gold,e.stroke=Dt.gold}else if(Zt()){e.stroke=0;let t=_t(1,Lh);if(Zt()){let i=Wh.prefix.get(t).affix,a=i[Yt(i.length-1)];e.name.a=`${e.name.a} ${a.name.a}`,e.name.b=`${a.name.b}${e.name.b}`,e.shadow=Dt.yellow}else{let i=Yt(Wh.suffix.length-1),a=Wh.prefix.get(t),s=Wh.suffix[i];e.name.a=`${a.name.a} ${e.name.a} ${s.name.a}`,e.name.b=`${a.name.b}${e.name.b} "${s.name.b}"`,e.shadow=Dt.aqua}}else e.shadow=0,e.stroke=0},undoOne(e){e.name.a=e.nameTemp.a,e.name.b=e.nameTemp.b,e.typeHalluc=null,e.symbol=e.symbolReal,e.color=e.colorReal,e.shadow=e.shadowReal,e.stroke=e.strokeReal}},Sr={list:{a:{name:{a:"Strength",b:"筋力"},term:"str"},b:{name:{a:"Dexterity",b:"器用さ"},term:"dex"},c:{name:{a:"Constitution",b:"耐久力"},term:"con"},d:{name:{a:"Intelligence",b:"知力"},term:"int"}},drawEnemyBar(e,t){if(!e)return;if(!e.isShowing()||!(t||Ut(e.x,e.y,$t.x,$t.y)<=K&&gr(e.x,e.y,$t.x,$t.y)))return At.barEnemy=null,"";let i=e.getName(!1,!0);return At.barEnemy=e,At.barName=i,t?i:void 0},clearEnemyBar(){At.barEnemy=null}},Rr={init(){let[e,t]=[$t.x,$t.y];this.x=this.cX=e,this.y=this.cY=t,this.draw(),vr.draw(e,t,!0)},draw(){Ct.rect({ctx:Ct.ctxes.cursor,x:this.x,xPx:1,y:this.y,yPx:1,width:1,widthPx:-2,height:1,heightPx:-2,stroke:!0})},drawPlot(e,t,i){let a=Ct.ctxes.cursor;a.save(),a.fillStyle=i,a.globalAlpha=.5,Ct.rect({ctx:a,x:e,y:t,width:1,height:1,clear:!0}),Ct.text({ctx:a,msg:"＊",x:e,y:t}),a.restore()},clear(){Ct.rect({ctx:Ct.ctxes.cursor,x:this.x,y:this.y,width:1,height:1,clear:!0})},clearAll(){Ct.clearOne(Ct.ctxes.cursor)},move(e){let t=ti(e);if(!t)return;let[i,a]=[this.x,this.y],[s,l]=[t.x,t.y],[r,n]=[i+s,a+l],o=vr.coords.length-1,h=vr.coords[0].length-1;if(r<0||r>o||n<0||n>h)return;gp.isShift&&(s*=10,l*=10,r=i+s,(r<0||r>o)&&(s=(r<0?0:o)-i,l&&(l=(l>0?1:-1)*Math.abs(s))),n=a+l,(n<0||n>h)&&(l=(n<0?0:h)-a,s&&(s=(s>0?1:-1)*Math.abs(l)))),this.clear(),this.x+=s,this.y+=l,[i,a]=[this.x,this.y];let d,m,c=Math.floor(Ct.width/2/Ct.fs-.5),p=Math.floor(Ct.height/2/Ct.fs-.5),u=i-this.cX,g=a-this.cY;Math.abs(u)>c&&(d=!0,(l>0&&g>0||l<0&&g<0)&&(m=!0)),Math.abs(g)>p&&(m=!0,(s>0&&u>0||s<0&&u<0)&&(d=!0)),d&&(this.cX=i),m&&(this.cY=a),qt.aim&&$t.examinePlot(),this.draw(),vr.draw(this.cX,this.cY,!0);let b=vr.coords[i][a];b.getInfo()}},Br=class extends fr{constructor(){super()}moveAll(){for(;this.list[0].energy>=0&&this.list[0].id!==re;)if(this.list[0].act(),qt.died)return;if(this.list[0].energy<0)return this.getEnergyAll(),void this.moveAll();$t.cdl&&$t.turn%Y==0&&cp.enemy({position:$e,summon:!0}),$t.turn++,$t.healAndHunger(),vr.drawObjectAll(),vr.draw(),$t.paralyzed||$t.sleeping?($t.decreaseEnergy(),Na.draw(Pt.isEnglish()?`You are still ${$t.sleeping?"sleeping":"paralyzed"}`:`まだ${$t.sleeping?"昏睡":"麻痺"}している`),qt.wait=!0):(qt.wait=!1,$t.done=!1)}getEnergyAll(){let e=this.list;this.list=[];for(let t of e)t.increaseEnergy(),this.push(t)}compare(e,t){return this.list[e].energy>this.list[t].energy}},Lr=1,Mr=2,qr=class extends ri{constructor(e,t){super(e,t),this.item={}}getSymbol(e){let t,i,a,s;switch(e){case mt:let l=this.fighter;t=l.symbol,i=l.color,a=l.shadow,s=l.stroke;break;case ct:let r=Object.keys(this.item).length,n=this.item[vt[r-1]],o=n.identified||$t.hallucinated;t=n.symbol,i=n.color,a=o?n.shadow:0,s=o?n.stroke:0;break;case pt:t=" ",i=Dt.white;break;case ut:let h=this.enter;t=h.symbol,i=h.color,a=h.shadow,s=h.stroke;break;case gt:let d=this.trap;t=d.symbol,i=d.color;break;case bt:t=this.isClosedDoor()?"+":"'",i=Dt.brown;break;case ft:t="#",i=this.indestructible?Dt.brown:Dt.gray;break;case yt:let m=this.stairs;t=m.symbol,i=m.color;break;case kt:t=".",i=Dt.white}return{symbol:t,color:i,shadow:a,stroke:s}}draw(e,t){let{symbol:i,color:a,shadow:s,stroke:l}=this.getSymbol(t),r=Ct.ctxes[e],[n,o]=[this.x,this.y],h={ctx:r,x:n,y:o,width:1,height:1};r.save(),"ground"===e?h.clear=!0:"object"===e&&(r.fillStyle=Dt.black),Ct.rect(h),r.fillStyle=a,Pt.shadow.user?s?r.shadowColor=s:$t.hallucinated:l=0,Ct.text({ctx:r,msg:i,x:n,y:o,stroke:l}),r.restore()}drawGround(){let e;this.found?this.enter&&!this.enter.portal?e=ut:this.wall?e=ft:this.door&&!this.hidden?e=bt:this.floor&&(e=kt):e=pt,e&&this.draw("ground",e)}drawObject(e){let t;e===mt?t=this.fighter&&this.fighter.isShowing():e===ct?t=this.item.a&&this.item.a.isShowing():this.found&&(e===gt?t=this.trap&&!this.hidden:e===yt?t=this.stairs&&!this.hidden:e===ut&&(t=this.enter)),t&&this.draw("object",e)}drawShadow(e){let t=Ct.ctxes.shadow,[i,a]=[this.x,this.y];Ct.rect({ctx:t,x:i,y:a,width:1,height:1,clear:!0}),e||Ct.rect({ctx:t,x:i,y:a,width:1,height:1})}getInfo(e){qt.examine&&$t.examineMsg();let t="";if(qt.examine&&this.fighter&&this.fighter.id!==re&&this.fighter.isShowing()&&(t=Sr.drawEnemyBar(this.fighter,!0)),this.found&&this.stairs&&!this.hidden){let e=this.stairs.getName();Pt.isEnglish()?t+=(t?" on ":"")+e:t=e+(t?"の上に"+t:"")}if(this.item.a){let e=Object.keys(this.item).length,i=this.item[vt[e-1]];if(i.isShowing()){this.found&&!this.stairs&&!this.hidden&&t?t=Pt.isEnglish()?t+" on ":"の上に"+t:1===e&&t?t=Pt.isEnglish()?t+" and ":"と"+t:e>1&&t&&(t=Pt.isEnglish()?t+", ":"と"+t);let a=i.getName();"coin"===i.type&&(Pt.isEnglish()?a="Gold worth "+a:a+="相当の金塊"),this.found&&this.wall&&(Pt.isEnglish()?a+=" through the wall":a="壁の中に"+a),e>1&&(a+=Pt.isEnglish()?" and more":"とアイテムの山"),Pt.isEnglish()?t+=a:t=a+t}}if(this.found&&this.enter){let a=qt.examine;if(!qt.examine){qt.dash&&(qt.dash=!1);var i=!0;this.enter.portal?e&&($t.cdl||$t.pdl)?$t.enterPortal():(a=!0,i=!1):$t.enterBuild(this.enter)}if(a){let e=this.enter.getName();t=t?e+(Pt.isEnglish()?", ":"と")+t:e}}else if(this.found&&this.trap){let i=this.trap.getName();qt.examine&&!this.hidden?t=t?i+(Pt.isEnglish()?", ":"と")+t:i:qt.examine||(!this.trap.protection&&(e||this.hidden&&Zt())?(Na.draw(Pt.isEnglish()?`You got caught in ${i}`:`${i}に捕まった`),$t.trapped(this.trap,e)):this.hidden||(t+=i))}return t&&!$t.blinded&&(Na.draw(Pt.isEnglish()?`You see ${t}`:`${t}が見える`),qt.examine||!this.item.a||this.enter||$t.itemAuto(this.item),qt.dash&&(qt.dash=!1)),i}openOrCloseDoor(){let e=Ut(this.x,this.y,$t.x,$t.y);this.isClosedDoor()?(this.getDoor(),pr.playSound("opendoor",e)):(this.getDoor(!0),pr.playSound("shutdoor",e)),this.drawGround(),$t.litMapIds[this.x+","+this.y]&&$t.lightenOrDarken("Lighten")}deleteItem(e,t=1){let i=this.item[e];i.quantity-=t,i.quantity||(delete vr.itemList[i.id],si(this.item,e))}deleteTrap(e){this.hidden&&(this.hidden=!1),this.trap=null}deleteDoor(e){this.hidden&&(this.hidden=!1,this.wall=!1),this.door=0,this.floor=!0,e&&this.drawGround()}deleteWall(e){this.indestructible&&(this.indestructible=!1),this.wall=!1,this.floor=!0,e&&this.drawGround()}findHiddenObject(){if($t.blinded||!this.hidden||!Ft())return;let e;this.hidden=!1,this.trap?e=this.trap.getName():this.isClosedDoor()?(e=Pt.isEnglish()?"door":"ドア",this.wall=!1,this.drawGround()):this.stairs&&(e=this.stairs.getName()),Na.draw(Pt.isEnglish()?`You found a hidden ${e}`:`隠された${e}を発見した`),qt.dash&&(qt.dash=!1)}isClosedDoor(){return this.door===Lr}isObstacle(){return this.wall||this.isClosedDoor()}getDoor(e){this.door=e?Lr:Mr}},Er=class extends ni{constructor(){super(),this.name={a:"Portal",b:"ポータル"},this.symbol="＊",this.color=Dt.white,this.stroke=Dt.skyblue,this.portal=!0}putDown(e,t){if(vr.portal){let e=vr.coords[vr.portal.x][vr.portal.y];e.enter=null,vr.portal=null}if(this.spiralSearch(e,t,"portal"),this.abort)return;let i=vr.coords[this.x][this.y];i.enter=vr.portal=this}},Ir=[{name:{a:"Protection",b:"守り"},symbol:";",color:Dt.white,circle:!0,protection:!0},{name:{a:"Teleportation",b:"テレポート"},symbol:";",color:Dt.skyblue,circle:!0,nameSkill:dl,lvl:10},{name:{a:"Summons",b:"召喚"},symbol:";",color:Dt.purple,circle:!0,nameSkill:Is,lvl:10},{name:{a:"Life Regeneration",b:"再生"},symbol:";",color:Dt.coral,circle:!0,nameSkill:Qa,lvl:10},{name:{a:"Mana Regeneration",b:"魔力再生"},symbol:";",color:Dt.lightblue,circle:!0,nameSkill:es,lvl:10},{name:{a:"Experience",b:"経験"},symbol:";",color:Dt.bronze,circle:!0,nameSkill:xs,lvl:10},{name:{a:"Skill",b:"スキル"},symbol:";",color:Dt.gold,circle:!0,nameSkill:Ss,lvl:3},{name:{a:"Magic Finding",b:"魔法具探求"},symbol:";",color:Dt.aqua,circle:!0,nameSkill:vs,lvl:10},{name:{a:"Gold Finding",b:"財宝探求"},symbol:";",color:Dt.yellow,circle:!0,nameSkill:ws,lvl:10},{name:{a:"Resist Fire",b:"耐火"},symbol:";",color:Dt.fire,circle:!0,nameSkill:ja,lvl:10},{name:{a:"Resist Water",b:"耐水"},symbol:";",color:Dt.water,circle:!0,nameSkill:ns,lvl:10},{name:{a:"Resist Air",b:"耐風"},symbol:";",color:Dt.air,circle:!0,nameSkill:fs,lvl:10},{name:{a:"Resist Earth",b:"耐土"},symbol:";",color:Dt.earth,circle:!0,nameSkill:zs,lvl:10},{name:{a:"Resist Poison",b:"耐毒"},symbol:";",color:Dt.poison,circle:!0,nameSkill:il,lvl:10},{name:{a:"Combat",b:"戦闘"},symbol:";",color:Dt.steel,circle:!0,nameSkill:xl,lvl:10},{name:{a:"Armor",b:"防護"},symbol:";",color:Dt.brass,circle:!0,nameSkill:Sl,lvl:10},{name:{a:"Trap Door",b:"隠し扉の罠"},symbol:"^",color:Dt.white},{name:{a:"Bear Trap",b:"虎挟み"},symbol:"^",color:Dt.shadow},{name:{a:"Arrow Trap",b:"矢の罠"},symbol:"^",color:Dt.white},{name:{a:"Weakness",b:"薄弱"},symbol:"^",color:Dt.poison,dart:!0,nameSkill:Xs,lvl:1},{name:{a:"Clumsiness",b:"不器用"},symbol:"^",color:Dt.poison,dart:!0,nameSkill:Qs,lvl:1},{name:{a:"Sickliness",b:"病弱"},symbol:"^",color:Dt.poison,dart:!0,nameSkill:el,lvl:1},{name:{a:"Stupidity",b:"愚鈍"},symbol:"^",color:Dt.poison,dart:!0,nameSkill:tl,lvl:1},{name:{a:"Poison",b:"毒"},symbol:"^",color:Dt.poison,gas:!0,nameSkill:Os,lvl:1},{name:{a:"Sleepness",b:"睡眠"},symbol:"^",color:Dt.royalblue,gas:!0,nameSkill:Hs,lvl:1},{name:{a:"Hallucination",b:"幻覚"},symbol:"^",color:Dt.purple,gas:!0,nameSkill:js,lvl:1},{name:{a:"Paralysis",b:"麻痺"},symbol:"^",color:Dt.orange,gas:!0,nameSkill:Gs,lvl:1},{name:{a:"Confusion",b:"混乱"},symbol:"^",color:Dt.yellow,gas:!0,nameSkill:Fs,lvl:1},{name:{a:"Blindness",b:"盲目"},symbol:"^",color:Dt.gray,gas:!0,nameSkill:Ws,lvl:1},{name:{a:"Bacteria",b:"細菌"},symbol:"^",color:Dt.infection,gas:!0,nameSkill:al,lvl:1}],$r=class extends ni{constructor(e,t){super(e),this.hidden=t}putDown(e,t){if(this.spiralSearch(e,t,"trap"),this.abort)return;let i=vr.coords[this.x][this.y];i.trap=this,i.hidden=this.hidden,vr.trapList[this.x+","+this.y]=this}getName(){let e=this.name[Pt.getLanguage()];return this.circle?e=Pt.isEnglish()?`Magic Circle of ${e}`:`${e}の魔法円`:this.dart?e=Pt.isEnglish()?`Dart Trap(${e})`:`投げ矢の罠(${e})`:this.gas&&(e=Pt.isEnglish()?`Gas Trap of ${e}`:`${e}ガスの罠`),e}},Ar=new Map([[at,{name:{a:"down staircase",b:"下り階段"},symbol:">",color:Dt.white,id:at}],[st,{name:{a:"up staircase",b:"上り階段"},symbol:"<",color:Dt.white,id:st}]]),Dr=class extends ni{constructor(e,t){super(e),this.hidden=t}putDown(e,t){if(this.spiralSearch(e,t,"staircase"),this.abort)return;let i=vr.coords[this.x][this.y];i.stairs=this,i.hidden=this.hidden,vr.staircaseList[this.x+","+this.y]=this}},zr=class extends ri{constructor(e,t,i,a){super(e,t),this.dr=i,this.roomId=a}getPosInFrontOf(){let[e,t]=[this.x,this.y];switch(this.dr){case it:e--;break;case at:t++;break;case st:t--;break;case lt:e++}return[e,t]}},Cr=class extends ri{constructor(e,t,i,a,s){super(e,t),this.id=i,this.width=a,this.height=s}},Pr=class extends Cr{constructor(e,t,i,a,s,l){super(e,t,i,a,s),this.lighten=l,this.doors=[],this.doorIds=[]}create(){for(let e=this.x;e<this.x+this.width;e++)for(let t=this.y;t<this.y+this.height;t++){let i=vr.coords[e][t];i.lighten=this.lighten,i.indestructible||e!==this.x&&e!==this.x+this.width-1&&t!==this.y&&t!==this.y+this.height-1?i.floor=!0:i.wall=ve}for(let e=0;e<4;e++)this.doors[e]=this.getDoor(e)}getDoor(e){let t,i;if(e===it){if(this.id%c==0)return null;t=this.x,i=_t(this.y+1,this.y+this.height-2)}else if(e===at){if(Math.floor(this.id/c)===m-1)return null;t=_t(this.x+1,this.x+this.width-2),i=this.y+this.height-1}else if(e===st){if(0===Math.floor(this.id/c))return null;t=_t(this.x+1,this.x+this.width-2),i=this.y}else{if(this.id%c==c-1)return null;t=this.x+this.width-1,i=_t(this.y+1,this.y+this.height-2)}let a=vr.coords[t][i];return a.getDoor(!0),Jt(10)?a.hidden=!0:(a.wall=!1,a.floor=!0),this.doorIds.push(e),new zr(t,i,e,this.id)}createNest(){let e=$t.cdl>=20&&Jt(10),t=be*(e?2:1),i=ne;if(e&&Jt(25)){let e,a=0;jh.shuffle();do{i=jh[a++],e=Wh.prefix.get(i)}while(e.lvl>$t.cdl+t||Jt(e.rarity))}let a=ne;if($t.cdl>=10&&Jt(5))do{a=op[Yt(op.length-2)]}while(rp[a][0].lvl>$t.cdl+t);for(let s=this.x;s<this.x+this.width;s++)for(let l=this.y;l<this.y+this.height;l++){let r=vr.coords[s][l];s!==this.x&&s!==this.x+this.width-1&&l!==this.y&&l!==this.y+this.height-1?(Zt()&&(Zt()?cp.item({position:Ee,x:s,y:l,magic:e,boost:t}):cp.trap(1,ne,Ee,s,l)),r.trap&&r.trap.protection||!Jt(25)||cp.enemy({type:a,position:Ee,x:s,y:l,magic:e,bias:i,boost:t})):e&&(r.wall&&!r.hidden?r.indestructible=!0:(r.door&&(r.hidden=!0),r.wall=ve))}}},Tr={roomIds:i(0,p-1),create(){this.list=[],this.rns=[];let e=0;this.roomIds.shuffle();for(let t of this.roomIds){if(Jt(15)&&++e<=10)continue;let i=_t(b,g),a=_t(f,u),s=Yt(g-i)+t%c*(g+1),l=Yt(u-a)+Math.floor(t/c)*(u+1),r=new Pr(s,l,t,i,a,Ot());r.create(),this.list[t]=r,this.rns.push(t)}this.connect(),this.deleteDoors(),vr.fill();for(let e of this.list)e&&$t.cdl>=10&&Jt(1)&&e.createNest()},connect(){this.connectDoors(!0);for(let e=0,t=_t(3,5);e<t;e++)this.connectDoors()},connectDoors(e){this.rns.shuffle();for(let t=0,i=this.rns.length;t<i-1;t++){let i=this.list[this.rns[t]];if(!i.doorIds.length)continue;let a=this.list[this.rns[t+1]];if(!a.doorIds.length)continue;i.doorIds.shuffle();let s=i.doors[i.doorIds.shift()];a.doorIds.shuffle();let l=a.doors[a.doorIds.shift()];if(this.createPassage(s,l),!e)break}},createPassage(e,t){let[i,a]=e.getPosInFrontOf(),[s,l]=t.getPosInFrontOf(),r=kr.main({x0:i,y0:a,xG:s,yG:l,pas:!0});if(null===r)throw new Error("path error");vr.coords[i][a].floor=!0;for(let e of r)vr.coords[e.x][e.y].floor=!0;e.connected=t.connected=!0},deleteDoors(){for(let e of this.list)if(e)for(let t of e.doors){if(null===t||t.connected)continue;let e=vr.coords[t.x][t.y];e.hidden=!1,e.floor=!1,e.door=!1,t=null}}},Nr=class extends Cr{constructor(){super(...arguments)}create(){for(let e=this.x;e<this.x+this.width;e++)for(let t=this.y;t<this.y+this.height;t++){let i=vr.coords[e][t];i.wall=ve,i.indestructible=!0}this.createEntrance()}createEntrance(){let e,t,i;if(0===this.id||1===this.id){if(1===this.id){[e,t]=[this.x+w-1,this.y];let i=new hi("cure");i.init(Ee,e,t)}[e,t]=[this.x+w-1,this.y+x-1],i=0===this.id?"book":"general"}else if(2===this.id||3===this.id){if(2===this.id){[e,t]=[this.x,this.y];let i=new hi("blacksmith");i.init(Ee,e,t)}[e,t]=[this.x,this.y+x-1],i=2===this.id?"potion":"scroll"}else 4===this.id||5===this.id?([e,t]=[this.x+w-1,this.y],i=4===this.id?"wand":"weapon"):6!==this.id&&7!==this.id||([e,t]=[this.x,this.y],i=6===this.id?"armor":"gamble");let a=new hi(i);a.init(Ee,e,t)}},Or={createAll(){this.list=[];for(let e=0;e<v;e++){let t=3+e%k*w+e%k*2;e%k>=2&&t++;let i=3+Math.floor(e/k)*x+2*Math.floor(e/k);Math.floor(e/k)&&i++,this.createOne(t,i,e,w,x)}let e=new hi("stash"),t=Mt.stash;e.init(Ee,t.x,t.y),vr.fill(!0),vr.lighten(!0)},createOne(){let e=new Nr(...arguments);e.create(),this.list.push(e)}},Fr={clear(){Na.clearFixed(),or.clear();for(let e in this.list)this.list[e].show=!1},getMaxNumber(e){let t;switch(e){case xe:case Re:case Me:t=M;break;case Se:t=$t.numBoxes<V?$t.numBoxes:V;break;case qe:t=I;break;case Le:t=q}return t},getInvName(e){let t,i=Pt.isEnglish();switch(e){case xe:t=i?"Pack":"持物";break;case Re:t=i?"Floor":"床";break;case Me:t=i?"Shop":"店";break;case Se:t=i?"Boxes":"ボックス";break;case qe:t=i?"Alchemy":"錬金術";break;case Le:t=i?"Stash":"物置箱"}return t+(i?" List":"一覧")},sort(e,t,i){let a=!1,s=t[e],l=ip.indexOf(t[e].type);for(let r in t){let n=t[r],o=ip.indexOf(n.type);if(a||!(o<l)){if(r>=e)break;if(a=!0,s.identified){if(n.identified&&n.tabId<=s.tabId&&o===l&&(!(n.charges>=0)||n.tabId!==s.tabId||n.charges>s.charges))continue}else if(o===l)continue;if(i){let i=s;return t.splice(e,1),t.splice(r,0,i),r}{let i=vt.indexOf(e),a=vt.indexOf(r);for(let e=i;e>a;e--)[t[vt[e]],t[vt[e-1]]]=[t[vt[e-1]],t[vt[e]]];return}}}return e},show({list:e,dr:t,a:i,place:a,enter:s}){let l=this.list[t===lt?"right":"left"];l.show=!0;let r=[];if(qt.shop){var n=$t.cn?Number($t.cn):1;i&&n>e[i].quantity&&(n=e[i].quantity)}else if(a===Le)var o=(s.page-1)*M;let h=0,d=0;for(let l in e){let m=e[l];if(!qt.pack&&!m||a===Le&&l<o||qt.drop&&qt.number&&l!=i||qt.stash&&void 0!==i&&l!=i||qt.equip&&!m.equipable||qt.quaff&&"potion"!=m.type||qt.read&&"scroll"!=m.type&&"recipe"!=m.type&&!m.chargeBook||qt.identify&&m.identified&&l!==i||(qt.repair||qt.blacksmith)&&(!m.equipable||m.durab===m.durabMax)||qt.zap&&"wand"!=m.type||qt.eat&&"food"!=m.type||qt.gain&&("book"!=m.type||!m.skill)||qt.destroy&&qt.number&&l!==i||(qt.shop||qt.option)&&i&&l!==i||qt.fuel&&("light"!==m.type&&"oil"!==m.type||$t.equipment.light.torch&!m.torch||!$t.equipment.light.torch&&m.torch))continue;let c,p,u={};if(u.key=a===Le?vt[l-o].toUpperCase():t===lt?l:l.toUpperCase(),qt.pack&&!m||qt.option||qt.cure){if(!qt.pack)if(u.name=m[Pt.getLanguage()],qt.cure)u.price=s.list[l].cost;else if(!qt.option2){let e,t=Pt[m.key]
;e=t.select?t.select[t.user][Pt.getLanguage()]:Pt.isEnglish()?t.user?"yes":"no":t.user?"はい":"いいえ",u.select=e}r.push(u)}else if(u.symbol=m.symbol,u.symbolColor=m.color,u.shadow=m.shadow,u.stroke=m.stroke,c=m.cursed&&m.identified?Dt.red:m.equipable&&!m.durab?Dt.gray:Dt.white,u.nameColor=c,u.name=m.getName(!1,m.quantity,Pt.getLanguage(),qt.gamble&&a===Me),(qt.shop||qt.blacksmith)&&(u.price=qt.shop?m.price*n:m.getDurabPrice()),a===Me||qt.shop&&qt.number?p=n:(p=m.quantity,d+=m.weight*p),u.weight=(m.weight*p).toFixed(1),r.push(u),++h===M)break}if(l.items=r,qt.option||qt.cure)return l.left="",void(l.right="");let m=this.getMaxNumber(a);if(a===Le){let e=s.list.length;h+=(s.page-1)*M,h>e&&(h=e)}l.left=`[${h}/${m}] `+this.getInvName(a);let c="";if(a===Me||qt.shop&&qt.number){let e=Pt.isEnglish()?"Weight":"重量";c=`${e} x${n}`}else if(a===Le)c=` [${s.page}/${E}]`;else{if(qt.gain){let e=Pt.isEnglish()?"Skill Points":"スキルポイント";c=`${e} ${$t.skillPoints} | `}let e=Pt.isEnglish()?"Total":"計";c+=`${e} ${d.toFixed(1)}kg`}if(qt.shop){let e;e=t===lt?Pt.isEnglish()?"Sell Value":"売値":Pt.isEnglish()?"Cost":"買値",c=`${e} x${n} | ${c}`}else a===Le&&(c=(Pt.isEnglish()?"Page ":"ページ ")+c);l.right=c},showEquipment(e,t){let i=this.list.equipment;i.show=!0;let a=[],s=0,l=0,r=0;if(qt.blacksmith)var n=0;for(let i in e.equipment){let o=e.equipment[i];if(qt.destroy&&qt.number&&i!==t||(qt.repair||qt.blacksmith)&&(!o||o.durab===o.durabMax)){s++;continue}let h={};h.key=vt[s++].toUpperCase();let d,m=Pt.isEnglish()?i:Oa.bodyParts[i];if("main"!==i&&"off"!==i||(m+=e.swapped?2:1),h.parts=m,o){if(h.symbol=o.symbol,h.symbolColor=o.color,h.shadow=o.shadow,h.stroke=o.stroke,d=o.cursed?Dt.red:o.durab?Dt.white:Dt.gray,h.nameColor=d,h.name=o.getName(),qt.blacksmith){let e=o.getDurabPrice();h.price=e,n+=e}h.weight=(o.weight*o.quantity).toFixed(1),l+=o.weight*o.quantity,a.push(h),r++}else"off"===i&&e.equipment.main&&e.equipment.main.twoHanded&&(h.name=Pt.isEnglish()?"(two-handed)":"(両手持ち)"),a.push(h)}if(i.items=a,qt.destroy||qt.number||qt.repair||qt.blacksmith)i.statsLeft=[],i.statsRight=[];else{let t=[];for(let[a,s]of nr.entries()){if(!s||!s.equipList){if("end"===a)break;"right"===a&&(i.statsLeft=t,t=[]);continue}let l={};if(e.findBuffStat(a)&&(l.shadow=Dt.buff),!e.lowerRes||"fire"!==a&&"water"!==a&&"air"!==a&&"earth"!==a&&"poison"!==a||(l.color=Dt.red),l.name=s.name[Pt.getLanguage()],l.value=e[a]+(s.perc?"%":""),s.max&&(l.valueMax=e[s.max]+(s.perc?"%":"")),"dmgAvg"===a){let t;if(e.equipment){let i=e.equipment.main;i&&"missile"===i.type&&(t=!0)}l.value+=` x${t?e.timesMissile:e.timesMelee}`}t.push(l)}i.statsRight=t}let o=D;i.left=`[${r}/${o}] `+(Pt.isEnglish()?"Equipment List":"装備一覧");let h=Pt.isEnglish()?"Total":"計";if(qt.blacksmith){let e=Pt.isEnglish()?"Total Cost":"全費用";h=`${e} ${n} ${h}`}i.right=`${h} ${l.toFixed(1)}kg`},showSkill(e,t,i){let a=this.list[i?"keys":"skill"];a.show=!0;let s=[],l=0;for(let a in t){if(qt.number&&t[a]!==e.cs)continue;let r,n={};if(t[a]&&(r=rr.get(t[a].id?t[a].id:t[a])),i){let e;if(r&&(n.shadow=r.color),e="0"===a?Pt.isEnglish()?"Main":"メイン":`F${a}`,n.key=e,!r){s.push(n);continue}}else n.key=a;let o=r.reqLvl<=e.lvl,h=!r.reqSynerzy||r.reqSynerzy<=e.getSynerzy(r);o&&h&&(!qt.gain||e.skillPoints)?(n.shadow=r.color,r.mp>e.mp&&(n.mpColor=Dt.red)):(n.color=Dt.gray,o||(n.reqLvColor=Dt.red),h||(n.reqSyColor=Dt.red)),n.name=r.name[Pt.getLanguage()];let d=0;if(t[a].lvl)d=t[a].lvl;else{let i=e.searchSkill(t[a]);i&&(d=e.skill[i].lvl)}let m=e.getSkillBoost(r);if(n.lvl=`${d}+${m}`,r.rate){let t,i=r.rate*(d+m)+(r.synerzy?r.synerzy*e.getSynerzy(r):0);if("breath"===r.kind)t=Math.ceil(e.hp*ge*(1+i/100));else if(isFinite(r.base)){if(t=r.base+i,r.limit&&t>r.limit&&(t=r.limit),r.radiusRate){let e=Pt.isEnglish()?"radius ":"半径";t=`${e}${t}`}else t>0&&(t=`+${t}`);r.perc&&(t=`${t}%`)}else{let[e,a]=jt.getNums(r.base),s=1+i/100;e=Math.ceil(e*s),a=Math.ceil(a*s),t=`${e}-${a}`}n.value=t}n.mp=r.mp,n.reqLv=r.reqLvl,n.reqSy=r.reqSynerzy,s.push(n),l++}let r,[n,o,h,d,m]=Pt.isEnglish()?["Lv","Value","MP","RLv","RSy"]:["レベル","値","MP","必レ","必シ"],c={lvl:n,value:o,value:o,mp:h,reqLv:d,reqSy:m};s.unshift(c),a.items=s,r=qt.gain?Object.keys(t).length:i?z:T;let p=`[${l}/${r}] `;if(p+=i?Pt.isEnglish()?"Key List":"キー一覧":Pt.isEnglish()?"Skill List":"スキル一覧",a.left=p,!i){let t=Pt.isEnglish()?"Skill Points":"スキルポイント";a.right=`${t} ${e.skillPoints}`}},showStats(e,t){let i=this.list.stats;i.show=!0;let a=[];for(let i in Sr.list){if(t&&i!==t)continue;let s={},l=Sr.list[i];s.key=i.toUpperCase(),s.name=l.name[Pt.getLanguage()],s.select=e[l.term+"Max"],a.push(s)}i.items=a,i.left=Pt.isEnglish()?"Stat List":"ステータス一覧";let[s,l]=Pt.isEnglish()?["Stat Points","Current Values"]:["ステータスポイント","現在値"];i.right=`${s} ${e.statPoints} | ${l}`},showRecipe(){let e=this.list.recipe;e.show=!0;let t=[],i=ep.recipe,a=Pt.getLanguage();for(let[e,s]of i.entries()){if(!$t.recipes[e])continue;let i={};i.name=s.nameReal[a],i.cost=s.cost,i.recipe=s.recipe[a],t.push(i)}let s={};s.name=Pt.isEnglish()?"Name":"名称",s.cost="MP",s.recipe=Pt.isEnglish()?"Recipe":"レシピ",t.unshift(s),e.items=t}};{Fr.list={};let e=["right","left","equipment","skill","keys","stats","recipe"];for(let t of e)Fr.list[t]={items:[],left:"",right:"",show:!1};Fr.list.equipment.statsRight=[],Fr.list.equipment.statsLeft=[]}const Vr=13,Gr=a(1,Vr),[Hr,Wr,jr,Ur,Yr,_r,Zr,Jr,Kr,Xr,Qr,en,tn]=[...Gr],[an,sn,ln,rn,nn,on,hn,dn,mn,cn,pn]=i(0,10),[un,gn,bn,fn,yn,kn,vn,wn,xn,Sn,Rn]=i(0,10),[Bn,Ln,Mn,qn,En,In,$n,An,Dn,zn,Cn,Pn,Tn]=i(0,12),[Nn,On,Fn,Vn,Gn,Hn,Wn]=i(0,6),[jn,Un,Yn,_n,Zn,Jn,Kn,Xn]=i(0,7),[Qn,eo,to,io,ao,so,lo,ro,no]=i(0,8),[oo,ho,mo,co,po,uo,go,bo,fo,yo,ko]=i(0,10),[vo,wo,xo,So,Ro,Bo,Lo,Mo,qo]=i(0,8),[Eo,Io,$o,Ao,Do]=i(0,4),[zo,Co,Po,To,No]=i(0,4),[Oo,Fo,Vo,Go,Ho,Wo,jo,Uo,Yo,_o,Zo,Jo]=i(0,11),[Ko,Xo,Qo,eh,th,ih,ah,sh,lh,rh,nh,oh,hh,dh]=i(0,13),[mh,ch,ph,uh,gh,bh,fh,yh,kh,vh,wh,xh,Sh,Rh,Bh]=i(0,14),Lh=15,[Mh,qh,Eh,Ih,$h,Ah,Dh,zh,Ch,Ph,Th,Nh,Oh,Fh,Vh]=i(1,Lh),Gh=new Map([[Hr,{name:{a:"Cloths",b:"布類"},hRate:1,pRate:1,list:new Map([[an,{name:{a:"linen",b:"亜麻"},rarity:0,color:Dt.linen}],[sn,{name:{a:"Hemp",b:"麻"},rarity:5,color:Dt.flax}],[ln,{name:{a:"Wool",b:"羊毛"},rarity:10,color:Dt.white}],[rn,{name:{a:"Cotton",b:"綿"},rarity:20,color:Dt.white}],[nn,{name:{a:"Silk",b:"絹"},rarity:30,color:Dt.white}],[on,{name:{a:"Mohair",b:"モヘヤ"},rarity:40,color:Dt.white}],[hn,{name:{a:"Cashmere",b:"カシミア"},rarity:50,color:Dt.white}],[dn,{name:{a:"Camel",b:"キャメル"},rarity:60,color:Dt.white}],[mn,{name:{a:"Angora",b:"アンゴラ"},rarity:70,color:Dt.white}],[cn,{name:{a:"Vicuna",b:"ビキューナ"},rarity:80,color:Dt.white}],[pn,{name:{a:"Spiderweb",b:"スパイダーウェブ"},rarity:90,color:Dt.white}]])}],[jr,{name:{a:"Feathers",b:"羽類"},hRate:2,pRate:1.1,bonus:{air:"1d5"},list:new Map([[un,{name:{a:"Chicken Feather",b:"鶏羽"},rarity:0,color:Dt.brown}],[gn,{name:{a:"Peafowl Feather",b:"孔雀羽"},rarity:5,color:Dt.teal}],[bn,{name:{a:"Eagle Feather",b:"鷲羽"},rarity:10,color:Dt.shadow}],[fn,{name:{a:"Hawk Feather",b:"鷹羽"},rarity:20,color:Dt.beigegray}],[yn,{name:{a:"Bat Feather",b:"蝙蝠羽"},rarity:30,color:Dt.shadow}],[kn,{name:{a:"Fairy Feather",b:"フェアリー・フェザー"},rarity:40,color:Dt.lime}],[vn,{name:{a:"Harpy Feather",b:"ハーピー・フェザー"},rarity:50,color:Dt.skyblue}],[wn,{name:{a:"Griffin Feather",b:"グリフォン・フェザー"},rarity:60,color:Dt.white}],[xn,{name:{a:"Angel Feather",b:"エンジェル・フェザー"},rarity:70,color:Dt.white}],[Sn,{name:{a:"Phoenix Feather",b:"フェニックス・フェザー"},rarity:80,color:Dt.red,values:{fire:"1d10"}}],[Rn,{name:{a:"Pegasus Feather",b:"ペガサス・フェザー"},rarity:90,color:Dt.white}]])}],[Wr,{name:{a:"Furs",b:"毛皮類"},hRate:3,pRate:1.2,bonus:{water:"1d5"},list:new Map([[Bn,{name:{a:"Rabbit Fur",b:"兎毛皮"},rarity:0,color:Dt.beige}],[Ln,{name:{a:"Boar Fur",b:"猪毛皮"},rarity:5,color:Dt.brown}],[Mn,{name:{a:"Wolf Fur",b:"狼毛皮"},rarity:10,color:Dt.beigegray}],[qn,{name:{a:"Jackal Fur",b:"ジャッカル毛皮"},rarity:15,color:Dt.goldenyellow}],[En,{name:{a:"Raccoon Fur",b:"ラクーン毛皮"},rarity:20,color:Dt.beige}],[In,{name:{a:"Ferret Fur",b:"フェレット毛皮"},rarity:25,color:Dt.beigegray}],[$n,{name:{a:"Mink Fur",b:"ミンク毛皮"},rarity:30,color:Dt.lightgrey}],[An,{name:{a:"Rum Fur",b:"ラム毛皮"},rarity:40,color:Dt.beige}],[Dn,{name:{a:"Fox Fur",b:"狐毛皮"},rarity:50,color:Dt.fox}],[zn,{name:{a:"Skunk Fur",b:"スカンク毛皮"},rarity:60,color:Dt.shadow}],[Cn,{name:{a:"Lion Fur",b:"ライオン毛皮"},rarity:70,color:Dt.goldenyellow}],[Pn,{name:{a:"Manticore Fur",b:"マンティコア毛皮"},rarity:80,color:Dt.red}],[Tn,{name:{a:"Cerberus Fur",b:"ケルベロス毛皮"},rarity:90,color:Dt.gray}]])}],[Ur,{name:{a:"Skins",b:"皮類"},hRate:4,pRate:1.3,list:new Map([[Nn,{name:{a:"Deerhide",b:"鹿皮"},rarity:0,color:Dt.goldenyellow}],[On,{name:{a:"Sheepskin",b:"羊皮"},rarity:10,color:Dt.beige}],[Fn,{name:{a:"Goatskin",b:"山羊皮"},rarity:20,color:Dt.beigegray}],[Vn,{name:{a:"Horsehide",b:"馬皮"},rarity:30,color:Dt.brown}],[Gn,{name:{a:"Cowhide",b:"牛皮"},rarity:40,color:Dt.white}],[Hn,{name:{a:"Demonhide",b:"デーモン・ハイド"},rarity:80,color:Dt.shadow}],[Wn,{name:{a:"Wyrmhide",b:"ワイアーム・ハイド"},rarity:90,color:Dt.green}]])}],[Yr,{name:{a:"Scales",b:"鱗類"},hRate:5,pRate:1.4,bonus:{poison:"1d5"},list:new Map([[jn,{name:{a:"Serpentskin",b:"蛇皮"},rarity:0,color:Dt.purple}],[Un,{name:{a:"Lizard Skin",b:"トカゲ皮"},rarity:10,color:Dt.lightgreen}],[Yn,{name:{a:"Fish Scale",b:"魚鱗"},rarity:20,color:Dt.blue}],[_n,{name:{a:"Sharkskin",b:"鮫皮"},rarity:30,color:Dt.silver}],[Zn,{name:{a:"Nagascale",b:"ナーガ鱗"},rarity:60,color:Dt.darkgreen}],[Jn,{name:{a:"Hydrascale",b:"ヒュドラ鱗"},rarity:70,color:Dt.green}],[Kn,{name:{a:"Dragonscale",b:"竜鱗"},rarity:80,color:Dt.green}],[Xn,{name:{a:"Lamiascale",b:"ラミア鱗"},rarity:90,color:Dt.teal}]])}],[Kr,{name:{a:"Plating",b:"メッキ製"},hRate:6,pRate:1.5,list:new Map([[Qn,{name:{a:"Tin Plated",b:"錫メッキ"},rarity:0,color:Dt.tin}],[eo,{name:{a:"Zinc Plated",b:"亜鉛メッキ"},rarity:10,color:Dt.zinc}],[to,{name:{a:"Cadmium Plated",b:"カドミウムメッキ"},rarity:20,color:Dt.cadmium}],[io,{name:{a:"Chrome Plated",b:"クロムメッキ"},rarity:30,color:Dt.chrome}],[ao,{name:{a:"Copper Plated",b:"銅メッキ"},rarity:40,color:Dt.copper}],[so,{name:{a:"Silver Plated",b:"銀メッキ"},rarity:50,color:Dt.silver}],[lo,{name:{a:"Gold Plated",b:"金メッキ"},rarity:60,color:Dt.gold}],[ro,{name:{a:"Platinum Plated",b:"プラチナメッキ"},rarity:70,color:Dt.platinum}],[no,{name:{a:"Alumite",b:"アルマイト"},rarity:80,color:Dt.aluminium}]])}],[en,{name:{a:"Woods",b:"木材"},hRate:7,pRate:1.6,bonus:{durabBonus:"1d10"},list:new Map([[oo,{name:{a:"Poplar",b:"ポプラ"},rarity:0,color:Dt.beige}],[ho,{name:{a:"Walnut",b:"クルミ"},rarity:5,color:Dt.walnut}],[mo,{name:{a:"Cypress",b:"イトスギ"},rarity:10,color:Dt.cypress}],[co,{name:{a:"Oak",b:"樫"},rarity:20,color:Dt.oak}],[po,{name:{a:"Beech",b:"ブナ"},rarity:30,color:Dt.beech}],[uo,{name:{a:"Ash",b:"トネリコ"},rarity:40,color:Dt.ash}],[go,{name:{a:"Ebony",b:"黒檀"},rarity:50,color:Dt.ebony}],[bo,{name:{a:"Rosewood",b:"紫檀"},rarity:60,color:Dt.rosewood}],[fo,{name:{a:"Teak",b:"チーク"},rarity:70,color:Dt.teak}],[yo,{name:{a:"Mahogany",b:"マホガニー"},rarity:80,color:Dt.mahogany}],[ko,{name:{a:"Life Tree",b:"生命樹"},rarity:90,color:Dt.brown}]])}],[tn,{name:{a:"Horns",b:"角類"},hRate:8,pRate:2.1,bonus:{dmgBonus:"1d10"},list:new Map([[vo,{name:{a:"Deer Horn",b:"鹿角"},rarity:0,color:Dt.white}],[wo,{name:{a:"Sheep Horn",b:"羊角"},rarity:10,color:Dt.white}],[xo,{name:{a:"Goat Horn",b:"山羊角"},rarity:20,color:Dt.white}],[So,{name:{a:"Cow Horn",b:"牛角"},rarity:30,color:Dt.white}],[Ro,{name:{a:"Rhino Horn",b:"サイ角"},rarity:40,color:Dt.white}],[Mo,{name:{a:"Minotaur Horn",b:"ミノタウロス・ホーン"},rarity:60,color:Dt.white}],[Bo,{name:{a:"Dragon Horn",b:"竜角"},rarity:70,color:Dt.white}],[Lo,{name:{a:"Demon Horn",b:"デーモン・ホーン"},rarity:80,color:Dt.white}],[qo,{name:{a:"Unicorn Horn",b:"ユニコーン・ホーン"},rarity:90,color:Dt.white}]])}],[_r,{name:{a:"Bones",b:"骨類"},hRate:9,pRate:1.7,bonus:{acBonus:"1d10"},list:new Map([[Eo,{name:{a:"Bone",b:"骨"},rarity:0,color:Dt.white}],[Io,{name:{a:"Giantbone",b:"ジャイアント・ボーン"},rarity:10,color:Dt.white}],[$o,{name:{a:"Dragonbone",b:"ドラゴン・ボーン"},rarity:70,color:Dt.white}],[Ao,{name:{a:"Demonbone",b:"デーモン・ボーン"},rarity:80,color:Dt.white}],[Do,{name:{a:"Vampirebone",b:"ヴァンパイア・ボーン"},rarity:90,color:Dt.white}]])}],[Zr,{name:{a:"Shells",b:"甲殻類"},hRate:10,pRate:1.8,bonus:{fire:"1d5"},list:new Map([[zo,{name:{a:"Coral",b:"珊瑚"},rarity:0,color:Dt.coral}],[Co,{name:{a:"Scorpion Shell",b:"サソリ殻"},rarity:10,color:Dt.shadow}],[Po,{name:{a:"Crab Shell",b:"蟹殻"},rarity:20,color:Dt.orange}],[To,{name:{a:"Turtle Shell",b:"亀甲羅"},rarity:30,color:Dt.brown}],[No,{name:{a:"Scarab Shell",b:"スカラブ殻"},rarity:40,color:Dt.gray}]])}],[Jr,{name:{a:"Metals",b:"金属類"},hRate:11,pRate:1.9,list:new Map([[Oo,{name:{a:"Tin",b:"錫"},rarity:0,color:Dt.tin}],[Fo,{name:{a:"Copper",b:"銅"},rarity:5,color:Dt.copper}],[Vo,{name:{a:"Brass",b:"黄銅"},rarity:10,color:Dt.brass}],[Go,{name:{a:"Bronze",b:"青銅"},rarity:15,color:Dt.bronze}],[Ho,{name:{a:"Iron",b:"鉄"},rarity:20,color:Dt.iron}],[Wo,{name:{a:"Steel",b:"鋼"},rarity:30,color:Dt.steel}],[jo,{name:{a:"Silver",b:"銀"},rarity:40,color:Dt.silver}],[Uo,{name:{a:"Gold",b:"金"},rarity:50,color:Dt.gold}],[Yo,{name:{a:"Platinum",b:"プラチナ"},rarity:60,color:Dt.platinum}],[_o,{name:{a:"Titanium",b:"チタン"},rarity:70,color:Dt.titanium}],[Zo,{name:{a:"Adamantite",b:"アダマンタイト"},rarity:80,color:Dt.steel}],[Jo,{name:{a:"Orichalcum",b:"オリハルコン"},rarity:90,color:Dt.brass}]])}],[Qr,{name:{a:"Stones",b:"石材"},hRate:12,pRate:2,bonus:{earth:"1d5"},list:new Map([[Ko,{name:{a:"Stone",b:"石"},rarity:0,color:Dt.white}],[Xo,{name:{a:"Hematite",b:"ヘマタイト"},rarity:5,color:Dt.white}],[Qo,{name:{a:"Moonstone",b:"ムーンストーン"},rarity:10,color:Dt.skyblue}],[eh,{name:{a:"Obsidian",b:"黒曜石"},rarity:15,color:Dt.shadow}],[th,{name:{a:"Onyx",b:"オニキス"},rarity:20,color:Dt.shadow}],[ih,{name:{a:"Morion",b:"モリオン"},rarity:25,color:Dt.shadow}],[ah,{name:{a:"Crystal",b:"クリスタル"},rarity:30,color:Dt.white}],[sh,{name:{a:"Tourmaline",b:"トルマリン"},rarity:35,color:Dt.lightning}],[lh,{name:{a:"Beryl",b:"ベリル"},rarity:40,color:Dt.lightgreen}],[rh,{name:{a:"Spinel",b:"スピネル"},rarity:50,color:Dt.pink}],[nh,{name:{a:"Corundum",b:"コランダム"},rarity:60,color:Dt.white}],[oh,{name:{a:"Ceramic",b:"セラミック"},rarity:70,color:Dt.white}],[hh,{name:{a:"Meteorite",b:"隕石"},rarity:80,color:Dt.gray}],[dh,{name:{a:"Black Diamond",b:"ブラック・ダイヤモンド"},rarity:90,color:Dt.shadow}]])}],[Xr,{name:{a:"Gems",b:"宝石類"},hRate:13,pRate:3,list:new Map([[mh,{name:{a:"Ruby",b:"ルビー"},rarity:0,values:{fire:"1d10"},color:Dt.fire,bias:Mh}],[ch,{name:{a:"Turquoise",b:"ターコイズ"},rarity:0,values:{air:"1d10"},color:Dt.air,bias:Eh}],[ph,{name:{a:"Aquamarine",b:"アクアマリン"},rarity:0,values:{water:"1d10"},color:Dt.water,bias:qh}],[uh,{name:{a:"Amber",b:"アンバー"},rarity:0,values:{earth:"1d10"},color:Dt.earth,bias:Ih}],[gh,{name:{a:"Emerald",b:"エメラルド"},rarity:0,values:{poison:"1d10"},color:Dt.poison,bias:$h}],[bh,{name:{a:"Diamond",b:"ダイヤモンド"},rarity:30,values:{fire:"2d10"},color:Dt.light,bias:Ah}],[fh,{name:{a:"Topaz",b:"トパーズ"},rarity:30,values:{air:"2d10"},color:Dt.lightning,bias:zh}],[yh,{name:{a:"Sapphire",b:"サファイア"},rarity:30,values:{water:"2d10"},color:Dt.cold,bias:Dh}],[kh,{name:{a:"Black Opal",b:"黒真珠"},rarity:30,values:{earth:"2d10"},color:Dt.gravity,bias:Ch}],[vh,{name:{a:"Jade",b:"翡翠"},rarity:30,values:{poison:"2d10"},color:Dt.infection,bias:Ph}],[wh,{name:{a:"Garnet",b:"ガーネット"},rarity:60,values:{fire:"1d10",earth:"1d10"},color:Dt.magma,bias:Fh}],[xh,{name:{a:"Chrysoberyl",b:"クリソベリル"},rarity:60,values:{water:"1d10",poison:"1d10"},color:Dt.acid,bias:Oh}],[Sh,{name:{a:"Fluorite",b:"フローライト"},rarity:60,values:{fire:"1d10",poison:"1d10"},color:Dt.radiation,bias:Vh}],[Rh,{name:{a:"Tanzanite",b:"タンザナイト"},rarity:60,values:{water:"1d10",air:"1d10"},color:Dt.blizzard,bias:Nh}],[Bh,{name:{a:"Citrine",b:"シトリン"},rarity:60,values:{air:"1d10",earth:"1d10"},color:Dt.sand,bias:Th}]])}]]);for(let[e,t]of Gh.entries()){let e=t.hRate,a=Vr+1-e,s=t.pRate,l=t.list;t.nums=i(0,l.size-1);let r=t.bonus;for(let t of l.values()){let i=t.rarity,l=i/10;t.density=e+l++/10,t.hardness=e*l,t.toughness=a*l,t.tBase=Vr*l,t.priceRate=s*l,t.embeddedNum=Math.ceil((i+1)/100*H),t.lvl=Math.ceil(i/3),t.lvl<1&&(t.lvl=1),r&&(t.values||(t.values={}),Tt(t.values,r))}}const Hh=[{name:{a:"Nickel",b:"ニッケル"},color:Dt.nickel},{name:{a:"Cobalt",b:"コバルト"},color:Dt.cobalt},{name:{a:"Magnesium",b:"マグネシウム"},color:Dt.magnesium},{name:{a:"Chrome",b:"クロム"},color:Dt.chrome},{name:{a:"Carbon",b:"カーボン"},color:Dt.carbon},{name:{a:"Silicon",b:"シリコン"},color:Dt.white}];{let e=Gh.get(Jr).list;for(let t of e.values())Hh.push(t)}const Wh={prefix:new Map([[Mh,{name:{a:"Fire",b:"火炎の"},color:Dt.fire,lvl:0,rarity:0,melee:{dmgFire:"1d10"},missile:{dmgFire:"1d10"},staff:{fire:"1d10"},shield:{fire:"2d10"},armor:{fire:"1d10"},cloak:{fire:"1d10"},belt:{fire:"1d10"},helm:{fire:"1d10"},gloves:{fire:"1d10"},boots:{fire:"1d10"},amulet:{fire:"1d10"},ring:{fire:"1d10"},light:{fire:"1d10",lighten:1},gem:{fire:"1d5"},enemy:{fire:"2d10",str:"1d5",dmgFire:"1d10"},affix:[{name:{a:"of Heat",b:"発熱の"},rarity:0},{name:{a:"of Fever",b:"熱狂の"},rarity:5},{name:{a:"of Combustion",b:"燃焼の"},rarity:10},{name:{a:"of Ignition",b:"発火の"},rarity:15},{name:{a:"of Blaze",b:"焔光の"},rarity:20},{name:{a:"of Flame",b:"焔の"},rarity:25},{name:{a:"of Flare",b:"爆炎の"},rarity:30},{name:{a:"of Burning",b:"灼熱の"},rarity:35},{name:{a:"of Inferno",b:"業火の"},rarity:40},{name:{a:"of Salamander",b:"サラマンダーの"},rarity:50},{name:{a:"of Hestia",b:"炉の女神ヘスティアの"},rarity:60},{name:{a:"of Hephaestus",b:"鍛冶の神ヘパイストスの"},rarity:80},{name:{a:"of Prometheus",b:"火神プロメテウスの"},rarity:90}]}],[qh,{name:{a:"Aqua",b:"水の"},color:Dt.water,lvl:0,rarity:0,melee:{atkCold:"1d10"},missile:{atkCold:"1d10"},staff:{water:"1d10"},shield:{water:"2d10"},armor:{water:"1d10"},cloak:{water:"1d10"},belt:{water:"1d10"},helm:{water:"1d10"},gloves:{water:"1d10"},boots:{water:"1d10"},amulet:{water:"1d10"},ring:{water:"1d10"},light:{water:"1d10"},gem:{water:"1d5"},enemy:{water:"2d10",int:"1d5",atkCold:"1d10"},affix:[{name:{a:"of Rain",b:"降雨の"},rarity:0},{name:{a:"of Lake",b:"湖の"},rarity:5},{name:{a:"of River",b:"河川の"},rarity:10},{name:{a:"of Waterfall",b:"滝の"},rarity:15},{name:{a:"of Ocean",b:"大洋の"},rarity:20},{name:{a:"of Flow",b:"流動の"},rarity:25},{name:{a:"of Tide",b:"潮流の"},rarity:30},{name:{a:"of Splashing",b:"飛散の"},rarity:35},{name:{a:"of Flood",b:"氾濫の"},rarity:40},{name:{a:"of Whirlpool",b:"渦潮の"},rarity:45},{name:{a:"of Undine",b:"ウィンディーネの"},rarity:50},{name:{a:"of Triton",b:"人魚の海神トリトンの"},rarity:60},{name:{a:"of Tethys",b:"水の女神テテュスの"},rarity:70},{name:{a:"of Achelous",b:"河神アケオロスの"},rarity:80},{name:{a:"of Poseidon",b:"海王ポセイドンの"},rarity:90}]}],[Eh,{name:{a:"Air",b:"大気の"},color:Dt.air,lvl:0,rarity:0,melee:{dmgLightning:"1d10"},missile:{dmgLightning:"1d10"},staff:{air:"1d10"},shield:{air:"2d10"},armor:{air:"1d10"},cloak:{air:"1d10"},belt:{air:"1d10"},helm:{air:"1d10"},gloves:{air:"1d10"},boots:{air:"1d10"},amulet:{air:"1d10"},ring:{air:"1d10"},light:{air:"1d10"},gem:{air:"1d5"},enemy:{air:"2d10",dex:"1d5",dmgLightning:"1d10",levi:!0},affix:[{name:{a:"of Feather",b:"羽の"},rarity:0},{name:{a:"of Wing",b:"翼の"},rarity:5},{name:{a:"of Wind",b:"風の"},rarity:10},{name:{a:"of Drifting",b:"漂流の"},rarity:15},{name:{a:"of Gust",b:"突風の"},rarity:20},{name:{a:"of Gale",b:"疾風の"},rarity:25},{name:{a:"of Blast",b:"爆風の"},rarity:30},{name:{a:"of Vortex",b:"旋風の"},rarity:35},{name:{a:"of Tempest",b:"暴風の"},rarity:40},{name:{a:"of Cyclone",b:"大竜巻の"},rarity:45},{name:{a:"of Sylph",b:"シルフの"},rarity:50},{name:{a:"of Eurus",b:"東風エウロスの"},rarity:55},{name:{a:"of Zephyrus",b:"西風ゼピュロスの"},rarity:60},{name:{a:"of Notos",b:"南風ノトスの"},rarity:65},{name:{a:"of Boreas",b:"北風ボレアスの"},rarity:70},{name:{a:"of Aeolus",b:"風神アイオロスの"},rarity:80},{name:{a:"of Aether",b:"大気の神アイテルの"},rarity:90}]}],[Ih,{name:{a:"Earth",b:"大地の"},color:Dt.earth,lvl:0,rarity:0,melee:{atkSlow:"1d10"},missile:{atkSlow:"1d10"},staff:{earth:"1d10"},shield:{earth:"2d10"},armor:{earth:"1d10"},cloak:{earth:"1d10"},belt:{earth:"1d10"},helm:{earth:"1d10"},gloves:{earth:"1d10"},boots:{earth:"1d10"},amulet:{earth:"1d10"},ring:{earth:"1d10"},light:{earth:"1d10"},gem:{earth:"1d5"},enemy:{earth:"2d10",con:"1d5",atkSlow:"1d10",acBonus:"1d10"},affix:[{name:{a:"of Rock",b:"岩の"},rarity:0},{name:{a:"of Ground",b:"地の"},rarity:5},{name:{a:"of Highland",b:"高原の"},rarity:10},{name:{a:"of Hill",b:"塚の"},rarity:15},{name:{a:"of Mountain",b:"山岳の"},rarity:20},{name:{a:"of Surface",b:"地表の"},rarity:25},{name:{a:"of Terrestrial",b:"地上の"},rarity:30},{name:{a:"of Gnome",b:"ノームの"},rarity:50},{name:{a:"of Pan",b:"山野の神パンの"},rarity:60},{name:{a:"of Dionysus",b:"陶酔の神デュオニュソスの"},rarity:70},{name:{a:"of Demeter",b:"豊穣の女神デメテルの"},rarity:80},{name:{a:"of Rhea",b:"大地の女神レアの"},rarity:85},{name:{a:"of Gaia",b:"地母神ガイアの"},rarity:90}]}],[$h,{name:{a:"Poison",b:"毒の"},color:Dt.poison,lvl:0,rarity:0,melee:{dmgPoison:"1d10"},missile:{dmgPoison:"1d10"},staff:{poison:"1d10"},shield:{poison:"2d10"},armor:{poison:"1d10"},cloak:{poison:"1d10"},belt:{poison:"1d10"},helm:{poison:"1d10"},gloves:{poison:"1d10"},boots:{poison:"1d10"},amulet:{poison:"1d10"},ring:{poison:"1d10"},light:{poison:"1d10"},gem:{poison:"1d5"},enemy:{poison:"2d10",dmgPoison:"1d10"},affix:[{name:{a:"of Dirtiness",b:"不潔の"},rarity:0},{name:{a:"of Fraud",b:"詐欺の"},rarity:5},{name:{a:"of Malice",b:"悪意の"},rarity:10},{name:{a:"of Hatred",b:"憎悪の"},rarity:15},{name:{a:"of Foulness",b:"悪臭の"},rarity:20},{name:{a:"of Corruption",b:"堕落の"},rarity:25},{name:{a:"of Rot",b:"腐敗の"},rarity:30},{name:{a:"of Toxicity",b:"毒性の"},rarity:35},{name:{a:"of Venom",b:"猛毒の"},rarity:40},{name:{a:"of Filth",b:"不浄の"},rarity:45},{name:{a:"of Arachne",b:"蜘蛛の女王アラクネの"},rarity:60},{name:{a:"of Medusa",b:"メデューサの"},rarity:70},{name:{a:"of Euryale",b:"エウリュアレの"},rarity:80},{name:{a:"of Stheno",b:"ステンノの"},rarity:90}]}],[Ah,{name:{a:"Light",b:"光の"},color:Dt.light,lvl:10,rarity:30,melee:{atkBlind:"1d10",dmgFire:"1d10"},missile:{atkBlind:"1d10",dmgFire:"1d10"},staff:{skillFire:1},shield:{fire:"3d10"},armor:{fire:"2d10"},cloak:{fire:"2d10"},belt:{fire:"2d10"},helm:{fire:"2d10"},gloves:{fire:"2d10"},boots:{fire:"2d10"},amulet:{skillFire:1},ring:{skillFire:1},light:{fire:"2d10",lighten:1},gem:{fire:"1d10"},enemy:{fire:"3d10",skillFire:1,str:"1d5",atkBlind:"1d10",dmgFire:"1d10"},affix:[{name:{a:"of Glow",b:"白熱の"},rarity:0},{name:{a:"of Flash",b:"閃光の"},rarity:5},{name:{a:"of Luminescence",b:"発光の"},rarity:10},{name:{a:"of Brightness",b:"光明の"},rarity:15},{name:{a:"of Shining",b:"光輝の"},rarity:20},{name:{a:"of Holiness",b:"聖なる"},rarity:25},{name:{a:"of Halo",b:"光輪の"},rarity:30},{name:{a:"of Purity",b:"清浄の"},rarity:35},{name:{a:"of Sanctuary",b:"聖域の"},rarity:40},{name:{a:"of Divinity",b:"神性の"},rarity:45},{name:{a:"of Sun",b:"太陽の"},rarity:50},{name:{a:"of Eos",b:"暁の女神エオスの"},rarity:60},{name:{a:"of Phoebe",b:"光明神ボイべの"},rarity:70},{name:{a:"of Hemera",b:"昼の女神ヘメラの"},rarity:75},{name:{a:"of Helios",b:"陽の神エエリオスの"},rarity:85},{name:{a:"of Hyperion",b:"太陽神ヒュペリオンの"},rarity:90}]}],[Dh,{name:{a:"Cold",b:"冷気の"},color:Dt.cold,lvl:10,rarity:30,melee:{atkCold:"2d10"},missile:{atkCold:"2d10"},staff:{skillWater:1},shield:{water:"3d10"},armor:{water:"2d10"},cloak:{water:"2d10"},belt:{water:"2d10"},helm:{water:"2d10"},gloves:{water:"2d10"},boots:{water:"2d10"},amulet:{skillWater:1},ring:{skillWater:1},light:{water:"2d10"},gem:{water:"1d10"},enemy:{water:"3d10",skillWater:1,int:"1d5",atkCold:"2d10"},affix:[{name:{a:"of Chill",b:"寒気の"},rarity:0},{name:{a:"of Snowflake",b:"雪片の"},rarity:5},{name:{a:"of Frost",b:"霜の"},rarity:10},{name:{a:"of Icicle",b:"氷柱の"},rarity:15},{name:{a:"of Icing",b:"氷結の"},rarity:20},{name:{a:"of Freezing",b:"凍結の"},rarity:25},{name:{a:"of Iceberg",b:"氷山の"},rarity:30},{name:{a:"of Avalanche",b:"雪崩の"},rarity:35},{name:{a:"of Permafrost",b:"永久凍土の"},rarity:40},{name:{a:"of Cocytus",b:"コキュートスの"},rarity:50},{name:{a:"of Viviane",b:"湖の女王ヴィヴィアンの"},rarity:80},{name:{a:"of Oceanus",b:"海神オケアノスの"},rarity:90}]}],[zh,{name:{a:"Lightning",b:"稲妻の"},color:Dt.lightning,lvl:10,rarity:30,melee:{dmgLightning:"2d10"},missile:{dmgLightning:"2d10"},staff:{skillAir:1},shield:{air:"3d10"},armor:{air:"2d10"},cloak:{air:"2d10"},belt:{air:"2d10"},helm:{air:"2d10"},gloves:{air:"2d10"},boots:{air:"2d10"},amulet:{skillAir:1},ring:{skillAir:1},light:{air:"2d10"},gem:{air:"1d10"},enemy:{air:"3d10",skillAir:1,dex:"1d5",dmgLightning:"2d10"},affix:[{name:{a:"of Sky",b:"天空の"},rarity:0},{name:{a:"of Electricity",b:"電気の"},rarity:5},{name:{a:"of Charge",b:"帯電の"},rarity:10},{name:{a:"of Discharge",b:"放電の"},rarity:15},{name:{a:"of Spark",b:"煌きの"},rarity:20},{name:{a:"of Potential",b:"電位の"},rarity:25},{name:{a:"of Voltage",b:"電圧の"},rarity:30},{name:{a:"of Power",b:"電力の"},rarity:35},{name:{a:"of Thunder",b:"雷鳴の"},rarity:40},{name:{a:"of Thunderbolt",b:"雷電の"},rarity:45},{name:{a:"of Thunderstroke",b:"雷撃の"},rarity:50},{name:{a:"of Storm",b:"嵐の"},rarity:55},{name:{a:"of Uranus",b:"天の神ウラノスの"},rarity:90},{name:{a:"of Zeus",b:"オリュンポスの主神ゼウスの"},rarity:95}]}],[Ch,{name:{a:"Gravity",b:"重力の"},color:Dt.gravity,lvl:10,rarity:30,melee:{atkSlow:"2d10"},missile:{atkSlow:"2d10"},staff:{skillEarth:1},shield:{earth:"3d10"},armor:{earth:"2d10"},cloak:{earth:"2d10"},belt:{earth:"2d10"},helm:{earth:"2d10"},gloves:{earth:"2d10"},boots:{earth:"2d10"},amulet:{skillEarth:1},ring:{skillEarth:1},light:{earth:"2d10"},gem:{earth:"1d10"},enemy:{earth:"3d10",skillEarth:1,con:"1d5",atkSlow:"2d10"},affix:[{name:{a:"of Star",b:"星の"},rarity:0},{name:{a:"of Asteroid",b:"小惑星の"},rarity:5},{name:{a:"of Planet",b:"惑星の"},rarity:10},{name:{a:"of Cosmos",b:"宇宙の"},rarity:15},{name:{a:"of Galaxy",b:"銀河の"},rarity:20},{name:{a:"of Stardust",b:"星屑の"},rarity:25},{name:{a:"of Celestial",b:"天上の"},rarity:30},{name:{a:"of Mass",b:"大塊の"},rarity:40},{name:{a:"of Astraeus",b:"星神アストライオスの"},rarity:70},{name:{a:"of Selene",b:"月の女神セレネの"},rarity:80},{name:{a:"of Chronos",b:"時の神クロノスの"},rarity:90}]}],[Ph,{name:{a:"Infection",b:"感染の"},color:Dt.infection,lvl:10,rarity:30,melee:{atkInf:"1d10",dmgPoison:"1d10"},missile:{atkInf:"1d10",dmgPoison:"1d10"},staff:{skillPoison:1},shield:{poison:"3d10"},armor:{poison:"2d10"},cloak:{poison:"2d10"},belt:{poison:"2d10"},helm:{poison:"2d10"},gloves:{poison:"2d10"},boots:{poison:"2d10"},amulet:{skillPoison:1},ring:{skillPoison:1},light:{poison:"2d10"},gem:{poison:"1d10"},enemy:{poison:"3d10",skillPoison:1,atkInf:"1d10",dmgPoison:"1d10"},affix:[{name:{a:"of Disease",b:"疾患の"},rarity:0},{name:{a:"of Bacteria",b:"細菌の"},rarity:5},{name:{a:"of Fungus",b:"真菌の"},rarity:10},{name:{a:"of Virus",b:"ウイルス性の"},rarity:15},{name:{a:"of Contagion",b:"伝染の"},rarity:20},{name:{a:"of Epidemic",b:"疫病の"},rarity:25},{name:{a:"of Plague",b:"悪疫の"},rarity:30},{name:{a:"of Alecto",b:"アレクトの"},rarity:70},{name:{a:"of Tisiphone",b:"ティシポネの"},rarity:80},{name:{a:"of Megaera",b:"メガイラの"},rarity:90}]}],[Th,{name:{a:"Sand",b:"砂の"},color:Dt.sand,lvl:20,rarity:50,melee:{atkBlind:"2d10"},missile:{atkBlind:"2d10"},staff:{earth:"1d10",air:"1d10"},shield:{earth:"2d10",air:"2d10"},armor:{earth:"1d10",air:"1d10"},cloak:{earth:"1d10",air:"1d10"},belt:{earth:"1d10",air:"1d10"},helm:{earth:"1d10",air:"1d10"},gloves:{earth:"1d10",air:"1d10"},boots:{earth:"1d10",air:"1d10"},amulet:{earth:"1d10",air:"1d10"},ring:{earth:"1d10",air:"1d10"},light:{earth:"1d10",air:"1d10"},gem:{earth:"1d5",air:"1d5"},enemy:{earth:"2d10",air:"2d10",con:"1d5",dex:"1d5",atkBlind:"2d10"},affix:[{name:{a:"of Drying",b:"乾燥の"},rarity:0},{name:{a:"of Dust",b:"砂塵の"},rarity:5},{name:{a:"of Barren",b:"不毛の"},rarity:10},{name:{a:"of Desert",b:"砂漠の"},rarity:15},{name:{a:"of Ruin",b:"荒廃の"},rarity:20}]}],[Nh,{name:{a:"Blizzard",b:"吹雪の"},color:Dt.blizzard,lvl:20,rarity:50,melee:{atkCold:"1d10",dmgLightning:"1d10"},missile:{atkCold:"1d10",dmgLightning:"1d10"},staff:{water:"1d10",air:"1d10"},shield:{water:"2d10",air:"2d10"},armor:{water:"1d10",air:"1d10"},cloak:{water:"1d10",air:"1d10"},belt:{water:"1d10",air:"1d10"},helm:{water:"1d10",air:"1d10"},gloves:{water:"1d10",air:"1d10"},boots:{water:"1d10",air:"1d10"},amulet:{water:"1d10",air:"1d10"},ring:{water:"1d10",air:"1d10"},light:{water:"1d10",air:"1d10"},gem:{water:"1d5",air:"1d5"},enemy:{water:"2d10",air:"2d10",int:"1d5",dex:"1d5",atkCold:"1d10",dmgLightning:"1d10"},affix:[{name:{a:"of Snow",b:"雪の"},rarity:0},{name:{a:"of Sleet",b:"霙の"},rarity:5},{name:{a:"of Graupel",b:"霰の"},rarity:10},{name:{a:"of Hail",b:"雹の"},rarity:15},{name:{a:"of Glacier",b:"氷河の"},rarity:20}]}],[Oh,{name:{a:"Acid",b:"酸の"},color:Dt.acid,lvl:20,rarity:50,melee:{dmgAcid:"2d10"},missile:{dmgAcid:"2d10"},staff:{water:"1d10",poison:"1d10"},shield:{water:"2d10",poison:"2d10"},armor:{water:"1d10",poison:"1d10"},cloak:{water:"1d10",poison:"1d10"},belt:{water:"1d10",poison:"1d10"},helm:{water:"1d10",poison:"1d10"},gloves:{water:"1d10",poison:"1d10"},boots:{water:"1d10",poison:"1d10"},amulet:{water:"1d10",poison:"1d10"},ring:{water:"1d10",poison:"1d10"},light:{water:"1d10",poison:"1d10"},gem:{water:"1d5",poison:"1d5"},enemy:{water:"2d10",poison:"2d10",int:"1d5",dmgAcid:"2d10"},affix:[{name:{a:"of Rust",b:"錆の"},rarity:30},{name:{a:"of Melting",b:"溶解の"},rarity:5},{name:{a:"of Dissolving",b:"分解の"},rarity:10},{name:{a:"of Corrosion",b:"腐食の"},rarity:15},{name:{a:"of Erosion",b:"浸食の"},rarity:20}]}],[Fh,{name:{a:"Magma",b:"溶岩の"},color:Dt.magma,lvl:20,rarity:50,melee:{dmgFire:"1d10",atkSlow:"1d10"},missile:{dmgFire:"1d10",atkSlow:"1d10"},staff:{fire:"1d10",earth:"1d10"},shield:{fire:"2d10",earth:"2d10"},armor:{fire:"1d10",earth:"1d10"},cloak:{fire:"1d10",earth:"1d10"},belt:{fire:"1d10",earth:"1d10"},helm:{fire:"1d10",earth:"1d10"},gloves:{fire:"1d10",earth:"1d10"},boots:{fire:"1d10",earth:"1d10"},amulet:{fire:"1d10",earth:"1d10"},ring:{fire:"1d10",earth:"1d10"},light:{fire:"1d10",earth:"1d10"},gem:{fire:"1d5",earth:"1d5"},enemy:{fire:"2d10",earth:"2d10",str:"1d5",con:"1d5",dmgFire:"1d10",atkSlow:"1d10"},affix:[{name:{a:"of Smoke",b:"煙の"},rarity:0},{name:{a:"of Ash",b:"灰の"},rarity:5},{name:{a:"of Fissure",b:"亀裂の"},rarity:10},{name:{a:"of Lava",b:"溶岩の"},rarity:15},{name:{a:"of Volcano",b:"火山の"},rarity:20},{name:{a:"of Eruption",b:"噴火の"},rarity:25},{name:{a:"of Mereor",b:"流星の"},rarity:35}]}],[Vh,{name:{a:"Radioactive",b:"放射能の"},color:Dt.radiation,lvl:20,rarity:50,melee:{atkRadi:"2d10"},missile:{atkRadi:"2d10"},staff:{fire:"1d10",poison:"1d10"},shield:{fire:"2d10",poison:"2d10"},armor:{fire:"1d10",poison:"1d10"},cloak:{fire:"1d10",poison:"1d10"},belt:{fire:"1d10",poison:"1d10"},helm:{fire:"1d10",poison:"1d10"},gloves:{fire:"1d10",poison:"1d10"},boots:{fire:"1d10",poison:"1d10"},amulet:{fire:"1d10",poison:"1d10"},ring:{fire:"1d10",poison:"1d10"},light:{fire:"1d10",poison:"1d10"},gem:{fire:"1d5",poison:"1d5"},enemy:{fire:"2d10",poison:"2d10",str:"1d5",atkRadi:"2d10"},affix:[{name:{a:"of Decay",b:"崩壊の"},rarity:0},{name:{a:"of Contamination",b:"汚染の"},rarity:5},{name:{a:"of Nucleus",b:"核の"},rarity:10},{name:{a:"of Fission",b:"分裂の"},rarity:15},{name:{a:"of Fusion",b:"融合の"},rarity:20},{name:{a:"of Catastrophe",b:"大惨事の"},rarity:25}]}]]),suffix:[{name:{a:"of Digging",b:"採掘"},lvl:1,rarity:0,melee:{digging:"3d10"}},{name:{a:"of Killer to Animal",b:"動物殺し"},lvl:1,rarity:0,melee:{dmgAnimal:"3d10"},missile:{dmgAnimal:"3d10"},gloves:{dmgAnimal:"2d10"}},{name:{a:"of Killer to Human",b:"人間殺し"},lvl:5,rarity:0,melee:{dmgHuman:"3d10"},missile:{dmgHuman:"3d10"},gloves:{dmgHuman:"2d10"},enemy:{dmgHuman:"2d10"}},{name:{a:"of Killer to Undead",b:"不死殺し"},lvl:10,rarity:0,melee:{dmgUndead:"3d10"},missile:{dmgUndead:"3d10"},gloves:{dmgUndead:"2d10"}},{name:{a:"of Killer to Dragon",b:"竜殺し"},lvl:15,rarity:0,melee:{dmgDragon:"3d10"},missile:{dmgDragon:"3d10"},gloves:{dmgDragon:"2d10"}},{name:{a:"of Killer to Giant",b:"巨人殺し"},lvl:15,rarity:0,melee:{dmgGiant:"3d10"},missile:{dmgGiant:"3d10"},gloves:{dmgGiant:"2d10"}},{name:{a:"of Killer to Demon",b:"悪魔殺し"},lvl:20,rarity:0,melee:{dmgDemon:"3d10"},missile:{dmgDemon:"3d10"},gloves:{dmgDemon:"2d10"}},{name:{a:"of Killer to Spirit",b:"精霊殺し"},lvl:20,rarity:0,melee:{dmgSpirit:"3d10"},missile:{dmgSpirit:"3d10"},gloves:{dmgSpirit:"2d10"}},{name:{a:"of Killer to God",b:"神殺し"},lvl:25,rarity:0,melee:{dmgGod:"3d10"},missile:{dmgGod:"3d10"},gloves:{dmgGod:"2d10"}},{name:{a:"of Multi Color",b:"万色"},lvl:25,rarity:50,shield:{resistAll:"2d10"},amulet:{resistAll:"1d10"},ring:{resistAll:"1d10"},enemy:{resistAll:"2d10"}},{name:{a:"of All Aound",b:"万能"},lvl:20,rarity:80,melee:{skillAll:1},
missile:{skillAll:1},staff:{skillAll:1},amulet:{skillAll:1},ring:{skillAll:1},enemy:{skillAll:1}},{name:{a:"of Strength",b:"筋力"},lvl:1,rarity:0,melee:{str:"1d5"},gloves:{str:"1d5"},ring:{str:"1d5"},enemy:{str:"1d5"}},{name:{a:"of Dexterity",b:"器用さ"},lvl:1,rarity:0,missile:{dex:"1d5"},boots:{dex:"1d5"},ring:{dex:"1d5"},enemy:{dex:"1d5"}},{name:{a:"of Constitution",b:"耐久力"},lvl:1,rarity:0,armor:{con:"1d5"},belt:{con:"1d5"},amulet:{con:"1d5"},enemy:{con:"1d5"}},{name:{a:"of Intelligence",b:"知力"},lvl:1,rarity:0,staff:{int:"1d5"},helm:{int:"1d5"},amulet:{int:"1d5"},enemy:{int:"1d5"}},{name:{a:"of Speed",b:"速度"},lvl:10,rarity:30,cloak:{spd:"2d10"},amulet:{spd:"1d10"},ring:{spd:"1d10"},gem:{spd:"1d5"},enemy:{spd:"2d10"}},{name:{a:"of Magic Finding",b:"魔法具探求"},lvl:1,rarity:30,light:{mf:"3d10"},amulet:{mf:"2d10"},ring:{mf:"2d10"},gem:{mf:"1d10"},enemy:{mf:"3d10"}},{name:{a:"of Gold Finding",b:"財宝探求"},lvl:1,rarity:0,light:{gf:"4d10"},amulet:{gf:"3d10"},ring:{gf:"3d10"},gem:{gf:"2d10"},enemy:{gf:"4d10"}},{name:{a:"of Life",b:"生命力"},lvl:1,rarity:0,shield:{hp:"2d10"},armor:{hp:"3d10"},belt:{hp:"2d10"},gem:{hp:"1d10"},enemy:{hp:"3d10"}},{name:{a:"of Mana",b:"魔力"},lvl:1,rarity:0,staff:{mp:"1d10"},armor:{mp:"2d10"},helm:{mp:"1d10"},gem:{mp:"1d5"},enemy:{mp:"2d10"}},{name:{a:"of Life Regeneration",b:"回復力"},lvl:5,rarity:50,shield:{hpReg:"1d10"},light:{hpReg:"1d10"},belt:{hpReg:"2d10"},amulet:{hpReg:"1d10"},ring:{hpReg:"1d10"},gem:{hpReg:"1d5"},enemy:{hpReg:"2d10"}},{name:{a:"of Mana Regeneration",b:"魔力回復"},lvl:5,rarity:50,staff:{mpReg:"1d10"},light:{mpReg:"1d10"},belt:{mpReg:"2d10"},amulet:{mpReg:"1d10"},ring:{mpReg:"1d10"},gem:{mpReg:"1d5"},enemy:{mpReg:"2d10"}},{name:{a:"of Attack Speed",b:"攻撃速度"},lvl:10,rarity:20,melee:{ias:"2d10"},missile:{ias:"2d10"},gloves:{ias:"2d10"},ring:{ias:"2d10"},gem:{ias:"1d10"},enemy:{ias:"2d10"}},{name:{a:"of Faster Cast",b:"詠唱速度"},lvl:10,rarity:20,staff:{fcr:"2d10"},helm:{fcr:"2d10"},amulet:{fcr:"2d10"},gem:{fcr:"1d10"},enemy:{fcr:"2d10"}},{name:{a:"of Faster Run Walk",b:"早足"},lvl:10,rarity:20,boots:{frw:"2d10"},gem:{frw:"1d5"},enemy:{frw:"2d10"}},{name:{a:"of Minimum Damage",b:"最小ダメージ"},lvl:10,rarity:0,melee:{dmgMinBonus:"1d5"},missile:{dmgMinBonus:"1d5"},enemy:{dmgMinBonus:"1d5"}},{name:{a:"of Maximum Damage",b:"最大ダメージ"},lvl:5,rarity:0,melee:{dmgMaxBonus:"1d10"},missile:{dmgMaxBonus:"1d10"},enemy:{dmgMaxBonus:"1d10"}},{name:{a:"of Life Steal",b:"生命力吸収"},lvl:5,rarity:20,melee:{stealLife:"1d3"},missile:{stealLife:"1d3"},gloves:{stealLife:"1d3"},ring:{stealLife:"1d3"},gem:{stealLife:1},enemy:{stealLife:"1d3"}},{name:{a:"of Mana Steal",b:"魔力吸収"},lvl:5,rarity:20,melee:{stealMana:"1d3"},missile:{stealMana:"1d3"},gloves:{stealMana:"1d3"},ring:{stealMana:"1d3"},gem:{stealMana:1},enemy:{stealMana:"1d3"}},{name:{a:"of Damage",b:"ダメージ"},lvl:1,rarity:0,melee:{dmgBonus:"3d10"},missile:{dmgBonus:"2d10"},gloves:{dmgBonus:"2d10"},ring:{dmgBonus:"2d10"},gem:{dmgBonus:"1d10"},enemy:{dmgBonus:"2d10"}},{name:{a:"of Accuracy",b:"精度"},lvl:1,rarity:0,melee:{rateBonus:"2d10"},missile:{rateBonus:"3d10"},gloves:{rateBonus:"2d10"},ring:{rateBonus:"2d10"},light:{rateBonus:"2d10"},gem:{rateBonus:"1d10"},enemy:{rateBonus:"2d10"}},{name:{a:"of Protection",b:"守り"},lvl:1,rarity:0,staff:{acBonus:"2d10"},shield:{acBonus:"3d10"},armor:{acBonus:"2d10"},cloak:{acBonus:"2d10"},belt:{acBonus:"2d10"},helm:{acBonus:"2d10"},gloves:{acBonus:"2d10"},boots:{acBonus:"2d10"},amulet:{acBonus:"2d10"},gem:{acBonus:"1d10"},enemy:{acBonus:"2d10"}},{name:{a:"of Experience",b:"経験"},lvl:15,rarity:50,amulet:{expBonus:"1d10"},ring:{expBonus:"1d10"},gem:{expBonus:"1d5"}},{name:{a:"of Stealth",b:"隠密"},lvl:1,rarity:0,staff:{stealth:"2d10"},cloak:{stealth:"3d10"},boots:{stealth:"2d10"},amulet:{stealth:"2d10"},ring:{stealth:"2d10"},gem:{stealth:"1d10"},enemy:{stealth:"3d10"}},{name:{a:"of Detection",b:"探知"},lvl:1,rarity:0,staff:{searching:"2d10"},helm:{searching:"2d10"},amulet:{searching:"2d10"},ring:{searching:"2d10"},light:{searching:"3d10"},gem:{searching:"1d10"},enemy:{searching:"3d10"}},{name:{a:"of Slow Digestion",b:"遅消化"},lvl:1,rarity:0,staff:{digest:"2d10"},armor:{digest:"2d10"},belt:{digest:"3d10"},amulet:{digest:"2d10"},ring:{digest:"2d10"},gem:{digest:"1d10"}},{name:{a:"of Illumination",b:"イルミネーション"},lvl:1,rarity:0,light:{lighten:1}},{name:{a:"High Capasity",b:"大容量"},lvl:1,rarity:50,belt:{numBoxes:1},light:{fuelBonus:"4d10"}},{name:{a:"of Sustain Strength",b:"筋力維持"},lvl:1,rarity:0,gloves:{strSus:!0},ring:{strSus:!0}},{name:{a:"of Sustain Dexterity",b:"器用さ維持"},lvl:1,rarity:0,boots:{dexSus:!0},ring:{dexSus:!0}},{name:{a:"of Sustain Constitution",b:"耐久力維持"},lvl:1,rarity:0,belt:{conSus:!0},amulet:{conSus:!0}},{name:{a:"of Sustain Intelligence",b:"知力維持"},lvl:1,rarity:0,helm:{intSus:!0},amulet:{intSus:!0}},{name:{a:"of Levitation",b:"浮遊"},lvl:1,rarity:80,ring:{levi:!0}},{name:{a:"of Aggravation",b:"憤怒"},lvl:5,rarity:50,melee:{aggravating:!0,cursed:!0},missile:{aggravating:!0,cursed:!0},staff:{aggravating:!0,cursed:!0},shield:{aggravating:!0,cursed:!0},armor:{aggravating:!0,cursed:!0},cloak:{aggravating:!0,cursed:!0},belt:{aggravating:!0,cursed:!0},helm:{aggravating:!0,cursed:!0},gloves:{aggravating:!0,cursed:!0},boots:{aggravating:!0,cursed:!0},amulet:{aggravating:!0,cursed:!0},ring:{aggravating:!0,cursed:!0},light:{aggravating:!0,cursed:!0},enemy:{aggravating:!0,cursed:!0}},{name:{a:"of Teleportation",b:"テレポート"},lvl:5,rarity:50,melee:{teleported:!0,cursed:!0},missile:{teleported:!0,cursed:!0},staff:{teleported:!0,cursed:!0},shield:{teleported:!0,cursed:!0},armor:{teleported:!0,cursed:!0},cloak:{teleported:!0,cursed:!0},belt:{teleported:!0,cursed:!0},helm:{teleported:!0,cursed:!0},gloves:{teleported:!0,cursed:!0},boots:{teleported:!0,cursed:!0},amulet:{teleported:!0,cursed:!0},ring:{teleported:!0,cursed:!0},light:{teleported:!0,cursed:!0},enemy:{teleported:!0,cursed:!0}},{name:{a:"of Indestructible",b:"破壊不能"},lvl:30,rarity:80,indestructible:!0,melee:{indestructible:!0},missile:{indestructible:!0},staff:{indestructible:!0},shield:{indestructible:!0},armor:{indestructible:!0},cloak:{indestructible:!0},belt:{indestructible:!0},helm:{indestructible:!0},gloves:{indestructible:!0},boots:{indestructible:!0},amulet:{indestructible:!0},ring:{indestructible:!0},light:{indestructible:!0},enemy:{indestructible:!0}},{name:{a:"of Durability",b:"耐久度"},lvl:1,rarity:0,melee:{durabBonus:"2d10"},missile:{durabBonus:"2d10"},staff:{durabBonus:"2d10"},shield:{durabBonus:"2d10"},armor:{durabBonus:"2d10"},cloak:{durabBonus:"2d10"},belt:{durabBonus:"2d10"},helm:{durabBonus:"2d10"},gloves:{durabBonus:"2d10"},boots:{durabBonus:"2d10"},amulet:{durabBonus:"2d10"},ring:{durabBonus:"2d10"},gem:{durabBonus:"1d10"},light:{durabBonus:"2d10"}},{name:{a:"of Art",b:"技巧"},lvl:10,rarity:40,melee:{embeddedBonus:1},missile:{embeddedBonus:1},staff:{embeddedBonus:1},shield:{embeddedBonus:1},armor:{embeddedBonus:1},cloak:{embeddedBonus:1},belt:{embeddedBonus:1},helm:{embeddedBonus:1},gloves:{embeddedBonus:1},boots:{embeddedBonus:1},amulet:{embeddedBonus:1},ring:{embeddedBonus:1},light:{embeddedBonus:1}}],restrict:{str:20,dex:20,con:20,int:20,skillFire:20,skillWater:20,skillAir:20,skillEarth:20,skillPoison:20,skillAll:50,numBoxes:50,lighten:50}};if(Lh<Wh.prefix.size)throw new Error("Incorrect bias numbers");for(let e of Wh.prefix.values())for(let t in e.affix){let i=e.affix[t],a=i.rarity,s=Math.floor(a/2-20);s<=0&&(s=1),i.lvl=s,i.min=a>=50?Math.ceil((a-50)/10)+2:1}const jh=i(1,Lh),Uh=i(0,Wh.suffix.length-1),Yh=(()=>{let e=new Map;for(let[t,a]of Wh.prefix.entries())e.set(t,i(0,a.affix.length-1));return e})(),_h=class extends ni{constructor(e){super(e),this.symbolReal=this.symbol,this.colorReal||(this.colorReal=this.color),this.shadow||(this.shadow=0),this.shadowReal||(this.shadowReal=this.shadow),this.stroke=0,this.strokeReal=0}static evalMod(e,t,i){e===ze?t/=1:e===Ce?t/=4:e===Pe&&(t/=10);let a=5;return i||(a+=t),a>95&&(a=95),Jt(a)}getVolumeBase(){let e;switch(this.type){case"enemy":case"armor":e=1;break;case"shield":e=.5;break;case"helm":case"boots":e=.4;break;case"gloves":case"melee":case"missile":case"staff":e=.3;break;case"light":e=.2;break;case"cloak":case"belt":e=.1;break;case"amulet":e=.02;case"ring":e=.01}return 10*e}getTRateBase(){let e;switch(this.type){case"shield":e=1;break;case"armor":e=.8;break;case"cloak":e=.7;break;case"gloves":e=.6;break;case"enemy":case"helm":e=.5;break;case"boots":e=.4;break;case"belt":e=.3}return e}getBaseandWeight(e){let t="enemy"===this.type,i=this.getVolumeBase()*this.volumeRate;this.weight=Math.ceil(i/10*e.density*100)/100;let a=1;if(this.weapon||t){let i=e.hardness*this.volumeRate;1===this.edge&&(i*=1.1,a*=.75),this.atkType===tt&&(a*=5/4),"staff"===this.type&&(i*=.5),this.dmgBase=Math.ceil(i),t&&(this.dmgBare=this.dmgBase)}if(this.armor||t){let t=this.getTRateBase();this.acTRate||(this.acTRate=1);let a=i*e.hardness,s=i*e.toughness,l=i*e.tBase*t*this.acTRate;this.acSBase=this.getAcVar(a,Qe),this.acBBase=this.getAcVar(s,tt),this.acTBase=this.getAcVar(l,et),this.acAvg=Math.ceil((this.acSBase+this.acBBase+this.acTBase)/3)}t||(this.durabRate=a)}getAcVar(e,t){if(!e)return 0;let i;t===Qe?i=10:t===et?i=15:t===tt&&(i=5);let a=Math.ceil(e*i/100);a=_t(-a,a);let s=a?Math.ceil:Math.floor;return e=s(e+a),e<1&&(e=1),e}getMaterialBase(){let e=0,t=[...Gr];for(t.shuffle();!(this.material&t[e]);)e++;return t[e]}getMaterial(e,t){let i=this.lvl;e||(e=this.getMaterialBase()),this.material=e;let a,s=Gh.get(e),l=s.list;if(t>=0)a=l.get(t);else{let e=s.nums;e.shuffle();let r=0;do{t=e[r++],a=l.get(t)}while(a.lvl>i||Jt(a.rarity))}this.matId=t,this.priceRate=a.priceRate,"enemy"!==this.type&&this.embeddedLimit>a.embeddedNum&&(this.embeddedLimit=a.embeddedNum),a.values&&Zh({obj:this,obj2:a.values,perc:0,max:1,min:1});let[r,n]=[a.name.a,a.name.b];e===Xr&&(this.bias=a.bias),e===_r&&"enemy"===this.type?(r=r.replace(/bone$/i,""),n=n.replace(/ボーン$|骨$/,"")):n+="の",r&&n&&("enemy"===this.type?(this.name.a=r+" "+this.name.a,this.name.b=n+this.name.b):(this.nameReal.a=r+" "+this.nameReal.a,this.nameReal.b=n+this.nameReal.b,this.mod===Pe&&this.getUniqueName())),this.color=this.colorReal=a.color,this.getBaseandWeight(a)}getMagic(e){let t,i,a=this.lvl,s="enemy"===this.type;if(e!==ne)t=Wh.prefix.get(e);else if(Zt()){let i=0;jh.shuffle();do{e=jh[i++],t=Wh.prefix.get(e)}while(!t[this.type]||t.lvl>a||Jt(t.rarity))}if(!t||Zt()){let e=0;Uh.shuffle();do{i=Wh.suffix[Uh[e++]]}while(!i[this.type]||i.lvl>a||Jt(i.rarity)||i.indestructible&&s&&Jt(99))}let l,r=Math.ceil(a+fe),n=Math.floor(a/10)+1,o="",h="",d={};t&&(Zh({obj:d,obj2:t[this.type],perc:r,max:n}),l=t.color,this.material&Xr||(o=t.name.a,h=t.name.b));let m="",c="";i&&(Zh({obj:d,obj2:i[this.type],perc:r,max:n}),m=i.name.a,c=i.name.b),o&&(o=`<${o}> `),h&&(h=`<${h}>`),m&&(m=` <${m}>`),c&&(c=`<${c}>`),s?(l&&(this.color=l),this.name.a=`${o}${this.name.a}${m}`,this.name.b=`${h}${this.name.b}${c}`,this.getOrLooseStats(d,!0,!0),t&&this.getBias(e)):(l&&(this.colorMod=l),this.nameReal.a=`${o}${this.nameReal.a}${m}`,this.nameReal.b=`${h}${this.nameReal.b}${c}`,Zh({obj:this,obj2:d,fixed:!0})),this.modList=d,this.mod=ze,this.shadow=this.shadowReal=Dt.aqua}getRare(e){let t,i,a=this.lvl,s="enemy"===this.type;if(e===ne){let i=0;jh.shuffle();do{e=jh[i++],t=Wh.prefix.get(e)}while(!t[this.type]||t.lvl>a||Jt(t.rarity))}else t=Wh.prefix.get(e);let l=0,r=Yh.get(e);r.shuffle();do{i=t.affix[r[l++]]}while(i.lvl>a||Jt(i.rarity));let n=Math.ceil(a+i.rarity),o=Math.floor(a/10)+1,h=i.min;h>o&&(h=o);let d,m={};Zh({obj:m,obj2:t[this.type],perc:n,max:o});let c=0,p=0,u=n;Uh.shuffle();do{if(d=Wh.suffix[Uh[c++]],d[this.type]&&d.lvl<=a&&!Jt(d.rarity)&&!(d.indestructible&&s&&Jt(99))&&(Zh({obj:m,obj2:d[this.type],perc:n,max:o,min:h}),++p>=j)){if(p>=h||!Jt(u))break;u/=2}}while(void 0!==Uh[c]);this.mod=Ce,this.shadow=this.shadowReal=Dt.yellow;let g=` <${i.name.a}>`,b=`<${i.name.b}>`;s?(i.color&&(this.color=i.color),this.name.a=`${this.name.a}${g}`,this.name.b=`${b}${this.name.b}`,this.getOrLooseStats(m,!0,!0),this.getBias(e)):(i.color&&(this.colorMod=i.color),this.nameReal.a=`${this.nameReal.a}${g}`,this.nameReal.b=`${b}${this.nameReal.b}`,Zh({obj:this,obj2:m,fixed:!0})),this.modList=m}getUnique(e){if(this.shadow=this.shadowReal=this.boss?Dt.indigo:Dt.gold,this.stroke=this.strokeReal=Dt.gold,"enemy"===this.type)$t.cue[this.name[se]]=!0;else{Zh({obj:this,obj2:e.values,fixed:!0});let t=e.name;this.nameUnique={a:t.a,b:t.b,pre:t.pre},this.mod=Pe,this.modList={},Tt(this.modList,e.values)}}getUniqueName(e,t){e||(e=this.nameUnique);let[i,a]=[e.a,e.b],[s,l]=e.pre?[`<${a}の>`,""]:["",`<${a}>`],r=t?this.name:this.nameReal;r.a=`${r.a} <of ${i}>`,r.b=`${s}${r.b}${l}`}makeMaterial(e){this.modList||(this.modList={});for(let e in this.modList){if(this.modList[e]===le){delete this.modList[e];continue}let t=this.modList[e];this.modList[e]=_t(1,t)}let t=this.getMaterialBase(),i=Gh.get(t);if(i.bonus||t===Xr){let e;if(t===Xr){if(void 0===this.matId)return;e=i.list.get(this.matId).values}else e=i.bonus;Zh({obj:this.modList,obj2:e,perc:0,max:1,min:1})}if(!Object.keys(this.modList).length)return;let a={};if(Tt(a,this.modList),e)a.modList={},Tt(a.modList,this.modList),a.desc={a:"",b:`埋め込み可能な${i.name.b}の装備品に合成すると属性値が付与される。`};else{a.modParts={},a.modParts[this.type]={},Tt(a.modParts[this.type],this.modList);let e=Oa.item[this.type];a.desc={a:"",b:`埋め込み可能な${i.name.b}の${e}に合成すると属性値が付与される。`}}if(a.name={},a.nameReal={},Tt(a.name,this.name),Tt(a.nameReal,this.name),a.color=a.colorReal=this.colorReal,a.shadow=a.shadowReal=this.shadowReal,a.stroke=a.strokeReal=this.strokeReal,a.lvl=this.lvl,a.mod=this.mod,a.rarity=this.rarity,a.material=t,a.identified=!1,a.quantity=1,a.type="material",a.tabId=Gr.indexOf(t),a.weight=Rt[a.type],a.priceRate=Gh.get(t).pRate,a.__proto__=sp.prototype,a.symbolReal=a.symbol=e?"'":"`",a.piece=!e||this.piece,a.calcPrice(),!e)return a;a.putDown(this.x,this.y,!0)}},Zh=({obj:e,obj2:t,perc:i,max:a,min:s,fixed:l,remove:r})=>{let n=0;for(let o in t){let h=t[o],d=0;if(l||!0===h||h===le)d=h,r&&(d=-d);else{if(!n){n++;let e=Wh.restrict[o]?1-Wh.restrict[o]/100:1;for(;n<s||n<a&&Jt(i*e);)n++,i/=2}for(let e=0;e<n;e++)d+=isFinite(h)?h:jt.dice(h)}e[o]?e[o]+=d:e[o]=d}},[Jh,Kh,Xh,Qh,ed,td,id,ad,sd,ld,rd,nd,od,hd]=i(1,15),dd=1,[md,cd,pd,ud,gd,bd,fd,yd,kd,vd,wd,xd,Sd,Rd,Bd,Ld,Md,qd,Ed,Id,$d,Ad,Dd,zd,Cd,Pd,Td,Nd,Od,Fd,Vd,Gd,Hd,Wd,jd,Ud,Yd,_d,Zd,Jd]=i(1,40),[Kd,Xd,Qd,em,tm,im,am,sm,lm,rm,nm,om,hm,dm,mm,cm,pm,um,gm,bm,fm]=i(1,21),[ym,km,vm,wm,xm,Sm,Rm,Bm,Lm,Mm,qm,Em]=i(1,12),[Im,$m,Am,Dm,zm,Cm,Pm,Tm,Nm,Om,Fm]=i(1,11),[Vm,Gm,Hm,Wm]=i(1,4),[jm,Um,Ym]=i(1,3),[_m,Zm]=i(1,2),[Jm,Km,Xm,Qm,ec,tc]=i(1,6),[ic,ac,sc]=i(1,3),[lc,rc]=i(1,2),[nc,oc,hc,dc,mc]=i(1,5),[cc,pc,uc,gc,bc]=i(1,5),[fc,yc,kc,vc]=i(1,4),[wc,xc,Sc]=i(1,3),[Rc,Bc]=i(1,2),Lc=1,Mc=1,[qc,Ec,Ic,$c,Ac,Dc,zc,Cc,Pc,Tc]=i(1,10),Nc=1,[Oc,Fc,Vc]=i(1,3),Gc=1,[Hc,Wc,jc,Uc,Yc,_c,Zc,Jc,Kc,Xc,Qc]=i(1,11),ep={coin:new Map([[Gc,{nameReal:{a:"Coin",b:"硬貨"},color:Dt.yellow,lvl:1,rarity:0}]]),recipe:new Map([[Hc,{nameReal:{a:"Wrought Gold",b:"錬金"},priceRate:1,lvl:1,rarity:0,cost:5,recipe:{a:"Jewel [1-4] -> Coin",b:"ジュエル [1-4] -> 硬貨"}}],[_c,{nameReal:{a:"Torch",b:"松明"},priceRate:1,lvl:1,rarity:0,cost:1,recipe:{a:"Torches [2-4] -> Torch [fuel sum]",b:"松明 [2-4] -> 松明 [燃料 計]"}}],[Zc,{nameReal:{a:"Lamp",b:"ランプ"},priceRate:1,lvl:1,rarity:0,cost:1,recipe:{a:"Lamps or Lanthanums + oil [2-4] -> Light Source [fuel sum]",b:"ランプまたはランタン + オイル [2-4] -> ランプまたはランタン [燃料 計]"}}],[Jc,{nameReal:{a:"Embed",b:"埋め込み"},priceRate:1,lvl:1,rarity:0,cost:10,recipe:{a:"Embeddable Equipment + The Same Materials・Jewel・Orb -> Equipment [Materials・Jewel・Orb]",b:"埋め込み可能な装備品 + 同素材・ジュエル・オーブ -> 装備品 [素材・ジュエル・オーブ]"}}],[Kc,{nameReal:{a:"Remove",b:"取り外し"},priceRate:1,lvl:5,rarity:10,cost:10,recipe:{a:"Equipment [Materials・Jewel・Orb] -> Embeddable Equipment + The Same Materials・Jewel・Orb",b:"装備品 [素材・ジュエル・オーブ] -> 埋め込み可能な装備品 + 同素材・ジュエル・オーブ"}}],[Uc,{nameReal:{a:"Wand",b:"魔法棒"},priceRate:1,lvl:10,rarity:10,cost:1,recipe:{a:"Wands [2-4] -> Wand [charges sum]",b:"魔法棒 [2-4] -> 魔法棒 [充填 計]"}}],[Yc,{nameReal:{a:"Charge Book",b:"充填書"},priceRate:1,lvl:15,rarity:20,cost:1,recipe:{a:"Charge Book + Scroll -> Charge book [charges sum]",b:"充填書 + 巻物 -> 充填書 [充填 計]"}}],[Wc,{nameReal:{a:"Extra Healing",b:"特大回復"},priceRate:1,lvl:20,rarity:30,cost:20,recipe:{a:"Potion of Greater Healing [3] -> Potion of Extra Healing",b:"大回復の薬 [3] -> 特大回復の薬"}}],[jc,{nameReal:{a:"Extra Mana",b:"魔力特大回復"},priceRate:1,lvl:20,rarity:30,cost:20,recipe:{a:"Potion of Greater Mana [3] -> Potion of Extra Mana",b:"魔力大回復の薬 [3] -> 魔力特大回復の薬"}}],[Xc,{nameReal:{a:"Extend",b:"拡張"},priceRate:1,lvl:25,rarity:40,cost:30,recipe:{a:"Unembeddable Normal Equipment + Jewel + Orb -> Embeddable Equipment",b:"ノーマルの埋め込み不可な装備品 + ジュエル + オーブ -> 埋め込み可能な装備品"}}],[Qc,{nameReal:{a:"Materialize",b:"素材化"},priceRate:1,lvl:30,rarity:50,cost:50,recipe:{a:"Unembeddable Magic or Rare Equipment + Jewel + Orb + The Same Materials -> Materials",b:"マジックまたはレアの埋め込み不可な装備品 + ジュエル + オーブ + 同素材 -> 素材"}}]]),book:new Map([[Jh,{nameReal:{a:"Blank Paper",b:"白紙"},color:Dt.gray,type2:"Charge Book",priceRate:5,lvl:10,rarity:10}],[Kh,{nameReal:{a:"Spells for Beginners",b:"初級魔術"},color:Dt.gray,priceRate:1,shop:!0,lvl:1,rarity:0,skill:!0,list:{a:Va,b:ms,c:ys,d:Bs,e:Hl,f:Ua,g:Vs,h:hl,i:dl,j:ja,k:ns,l:fs,m:zs,n:il,o:Ls,p:jl,q:Ds,r:Ms}}],[Xh,{nameReal:{a:"Intermediate Spells",b:"中級魔術"},color:Dt.gray,priceRate:10,shop:!0,lvl:10,rarity:10,skill:!0,list:{a:Ga,b:Fl,c:_s,d:cl,e:gs,f:Ya,g:Wa,h:Es,i:Rs,j:nl,k:ts,l:is,m:as,n:ss,o:Ja,p:lr,q:Wl,r:Zs}}],[Qh,{nameReal:{a:"Advanced Spells",b:"上級魔術"},color:Dt.gray,priceRate:30,lvl:20,rarity:30,skill:!0,list:{a:ol,b:Ks,c:rl,d:us,e:Js,f:Ql,g:Ns,h:rs,i:qs,j:ls,k:os,l:Jl,m:Xl,n:Yl,o:ll,p:Kl,q:Ka}}],[ed,{nameReal:{a:"Skills for Beginners",b:"初級武術"},color:Dt.brown,priceRate:1,shop:!0,lvl:1,rarity:0,skill:!0,list:{a:xl,b:Sl,c:ul,d:gl,e:bl,f:fl,g:yl}}],[td,{nameReal:{a:"Intermediate Skills",b:"中級武術"},color:Dt.brown,priceRate:10,shop:!0,lvl:15,rarity:10,skill:!0,list:{a:Tl,b:Ol,c:vl,d:kl}}],[id,{nameReal:{a:"Ares",b:"アレス"},color:Dt.bronze,priceRate:50,lvl:30,rarity:50,skill:!0,list:{a:ul,b:Tl,c:gl,d:Ol,e:Nl}}],[ad,{nameReal:{a:"Apollo",b:"アポロン"},color:Dt.orange,priceRate:50,lvl:30,rarity:50,skill:!0,list:{a:bl,b:fl,c:yl,d:vl,e:kl,f:wl}}],[sd,{nameReal:{a:"Heraclitus",b:"ヘラクレイトス"},color:Dt.fire,priceRate:50,lvl:30,rarity:50,skill:!0,list:{a:Va,b:ol,c:Ua,d:Ha,e:Wa,f:Ya,g:ja,h:Ga,i:ts,j:Yl}}],[ld,{nameReal:{a:"Thales",b:"タレス"},color:Dt.water,priceRate:50,lvl:30,rarity:50,skill:!0,list:{a:Ja,b:ss,c:rl,d:nl,e:ls,f:rs,g:ms,h:ns,i:os,j:Ka,k:cs}}],[rd,{nameReal:{a:"Anaximenes",b:"アナクシメネス"},color:Dt.air,priceRate:50,lvl:30,rarity:50,skill:!0,list:{a:ys,b:ll,c:rl,d:Vl,e:gs,f:fs,g:us,h:is,i:Fl}}],[nd,{nameReal:{a:"Xenophanes",b:"クセノパネス"},color:Dt.earth,priceRate:50,lvl:30,rarity:50,skill:!0,list:{a:ks,b:ll,c:ol,d:Ns,e:Bs,f:Es,g:Rs,h:zs,i:qs,j:Ps,k:as,l:Ms,m:Ls,n:Ql,o:Ds,p:Kl,q:Xl,r:lr}}],[od,{nameReal:{a:"Hippocrates",b:"ヒポクラテス"},color:Dt.poison,priceRate:50,lvl:30,rarity:50,skill:!0,list:{a:Hl,b:nl,c:sl,d:_s,e:Vs,f:il,g:Ks,h:Wl,i:Yl,j:Jl,k:Js}}],[hd,{nameReal:{a:"Democritus",b:"デモクリトス"},color:Dt.atom,priceRate:50,lvl:30,rarity:70,skill:!0,list:{a:hl,b:dl,c:cl,d:pl,e:Cs}}]]),food:new Map([[dd,{nameReal:{a:"Ration",b:"レーション"},nameSkill:qs,skillLvl:20,color:Dt.brown,priceRate:.5,shop:!0,lvl:1,rarity:0}]]),oil:new Map([[Nc,{nameReal:{a:"Olive Oil",b:"オリーブ油"},color:Dt.yellow,fuelValue:2500,weight:.3,priceRate:1,shop:!0,lvl:1,rarity:0}]]),potion:new Map([[md,{nameReal:{a:"Poison",b:"毒"},nameSkill:Os,skillLvl:1,priceRate:.1,lvl:1,rarity:0}],[cd,{nameReal:{a:"Confusion",b:"混乱"},nameSkill:Fs,skillLvl:3,priceRate:.1,lvl:1,rarity:0}],[pd,{nameReal:{a:"Paralysis",b:"麻痺"},nameSkill:Gs,skillLvl:3,priceRate:.1,lvl:3,rarity:0}],[ud,{nameReal:{a:"Sleep",b:"眠り"},nameSkill:Hs,skillLvl:3,priceRate:.1,lvl:3,rarity:0}],[gd,{nameReal:{a:"Blindness",b:"盲目"},nameSkill:Ws,skillLvl:3,priceRate:.1,lvl:3,rarity:0}],[bd,{nameReal:{a:"Disease",b:"病気"},nameSkill:al,skillLvl:3,priceRate:.1,lvl:5,rarity:0}],[fd,{nameReal:{a:"Hallucination",b:"幻覚"},nameSkill:js,skillLvl:10,priceRate:.1,lvl:5,rarity:0}],[yd,{nameReal:{a:"Slowness",b:"鈍足"},nameSkill:Ts,skillLvl:10,priceRate:.1,lvl:5,rarity:0}],[kd,{nameReal:{a:"Cancellation",b:"封印"},nameSkill:Ys,skillLvl:10,priceRate:.1,lvl:10,rarity:0}],[vd,{nameReal:{a:"Weakness",b:"薄弱"},nameSkill:Xs,skillLvl:1,priceRate:.1,lvl:10,rarity:0}],[wd,{nameReal:{a:"Clumsiness",b:"不器用"},nameSkill:Qs,skillLvl:1,priceRate:.1,lvl:10,rarity:0}],[xd,{nameReal:{a:"Sickliness",b:"病弱"},nameSkill:el,skillLvl:1,priceRate:.1,lvl:10,rarity:0}],[Sd,{nameReal:{a:"Stupidity",b:"愚鈍"},nameSkill:tl,skillLvl:1,priceRate:.1,lvl:10,rarity:0}],[Rd,{nameReal:{a:"Healing",b:"回復"},nameSkill:Ja,skillLvl:10,priceRate:2,shop:!0,lvl:1,rarity:0}],[Bd,{nameReal:{a:"Greater Healing",b:"大回復"},nameSkill:Ja,skillLvl:30,priceRate:6,shop:!0,lvl:5,rarity:10}],[Ld,{nameReal:{a:"Extra Healing",b:"特大回復"},nameSkill:Ka,skillLvl:10,priceRate:10,lvl:10,rarity:30}],[Md,{nameReal:{a:"Mana",b:"魔力回復"},nameSkill:Xa,skillLvl:10,priceRate:2,shop:!0,lvl:1,rarity:0}],[qd,{nameReal:{a:"Greater Mana",b:"魔力大回復"},nameSkill:Xa,skillLvl:30,priceRate:6,shop:!0,lvl:5,rarity:10}],[Ed,{nameReal:{a:"Extra Mana",b:"魔力特大回復"},nameSkill:ar,skillLvl:10,priceRate:10,lvl:10,rarity:30}],[Id,{nameReal:{a:"Rejuvenation",b:"活性"},nameSkill:sr,skillLvl:1,priceRate:15,lvl:15,rarity:40}],[$d,{nameReal:{a:"Full Rejuvenation",b:"完全活性"},nameSkill:sr,skillLvl:14,priceRate:20,lvl:20,rarity:50}],[Ad,{nameReal:{a:"Restore Strength",b:"筋力復活"},nameSkill:ts,skillLvl:10,priceRate:1,shop:!0,lvl:10,rarity:0}],[Dd,{nameReal:{a:"Restore Dexterity",b:"器用さ復活"},nameSkill:is,skillLvl:10,priceRate:1,shop:!0,lvl:10,rarity:0}],[zd,{nameReal:{a:"Restore Constitution",b:"耐久力復活"},nameSkill:as,skillLvl:10,priceRate:1,shop:!0,lvl:10,rarity:0}],[Cd,{nameReal:{a:"Restore Intelligence",b:"知力復活"},nameSkill:ss,skillLvl:10,priceRate:1,shop:!0,lvl:10,rarity:0}],[Pd,{nameReal:{a:"Restore All",b:"全復活"},nameSkill:ls,skillLvl:10,priceRate:10,lvl:20,rarity:50}],[Td,{nameReal:{a:"Resist Fire",b:"耐火"},nameSkill:ja,skillLvl:20,priceRate:2,lvl:1,rarity:0}],[Nd,{nameReal:{a:"Resist Water",b:"耐水"},nameSkill:ns,skillLvl:20,priceRate:2,lvl:1,rarity:0}],[Od,{nameReal:{a:"Resist Air",b:"耐風"},nameSkill:fs,skillLvl:20,priceRate:2,lvl:1,rarity:0}],[Fd,{nameReal:{a:"Resist Earth",b:"耐土"},nameSkill:zs,skillLvl:20,priceRate:2,lvl:1,rarity:0}],[Vd,{nameReal:{a:"Resist Poison",b:"耐毒"},nameSkill:il,skillLvl:20,priceRate:2,lvl:1,rarity:0}],[Gd,{nameReal:{a:"Resist All",b:"耐性"},nameSkill:os,skillLvl:20,priceRate:20,lvl:20,rarity:50}],[Hd,{nameReal:{a:"Speed",b:"速度"},nameSkill:gs,skillLvl:10,priceRate:5,lvl:10,rarity:20}],[Wd,{nameReal:{a:"See Invisible",b:"透視"},nameSkill:Ya,skillLvl:10,priceRate:3,shop:!0,lvl:10,rarity:0}],[jd,{nameReal:{a:"Raise Level",b:"レベル上昇"},nameSkill:hs,skillLvl:1,priceRate:100,lvl:20,rarity:99}],[Ud,{nameReal:{a:"Enlightenment",b:"啓蒙"},nameSkill:ks,skillLvl:10,priceRate:15,lvl:20,rarity:50}],[Yd,{nameReal:{a:"Lower Resist",b:"耐性低下"},nameSkill:Ks,skillLvl:10,priceRate:.1,lvl:25,rarity:20}],[_d,{nameReal:{a:"Cure All",b:"全治療"},nameSkill:rs,skillLvl:10,priceRate:30,lvl:25,rarity:50}],[Zd,{nameReal:{a:"Restore Experience",b:"経験値復活"},nameSkill:Jl,skillLvl:10,priceRate:3,shop:!0,lvl:15,rarity:0}],[Jd,{nameReal:{a:"Lethe",b:"レテ"},nameSkill:ds,skillLvl:10,color:Dt.white,type2:"water",lethe:!0,priceRate:200,lvl:10,rarity:80}]]),scroll:new Map([[Kd,{nameReal:{a:"Short Teleportation",b:"ショート・テレポート"},nameSkill:hl,skillLvl:10,priceRate:1,shop:!0,lvl:1,rarity:0}],[Xd,{nameReal:{a:"Teleportation",b:"テレポート"},nameSkill:dl,skillLvl:10,priceRate:1.5,shop:!0,lvl:1,rarity:0}],[Qd,{nameReal:{a:"Remove Curse",b:"解呪"},nameSkill:Wa,skillLvl:10,priceRate:2,shop:!0,lvl:1,rarity:0}],[em,{nameReal:{a:"Identify",b:"識別"},nameSkill:Rs,skillLvl:10,priceRate:1,shop:!0,lvl:1,rarity:0}],[tm,{nameReal:{a:"Monster Detection",b:"モンスター感知"},nameSkill:Bs,skillLvl:10,priceRate:1,shop:!0,lvl:5,rarity:0}],[im,{nameReal:{a:"Item Detection",b:"アイテム感知"},nameSkill:Ls,skillLvl:10,priceRate:2,shop:!0,lvl:10,rarity:0}],[am,{nameReal:{a:"Magic Mapping",b:"魔法地図"},nameSkill:Ms,skillLvl:10,priceRate:3,shop:!0,lvl:15,rarity:0}],[sm,{nameReal:{a:"Town Portal",b:"タウン・ポータル"},nameSkill:Cs,skillLvl:10,priceRate:1,shop:!0,lvl:5,rarity:0}],[lm,{nameReal:{a:"Touch of Confusion",b:"混乱の手"},nameSkill:Vs,skillLvl:10,priceRate:4,shop:!0,lvl:10,rarity:0}],[rm,{nameReal:{a:"Hold Monster",b:"モンスター束縛"},nameSkill:Zs,skillLvl:10,priceRate:10,lvl:10,rarity:20}],[nm,{nameReal:{a:"Aggravate Monster",b:"反感"},nameSkill:bs,skillLvl:10,priceRate:.1,lvl:1,rarity:0}],[om,{nameReal:{a:"Create Monster",b:"モンスター生成"},nameSkill:Is,skillLvl:10,priceRate:.1,lvl:5,rarity:0}],[hm,{nameReal:{a:"Create Magic Monster",b:"マジック・モンスター生成"},nameSkill:Gl,skillLvl:10,priceRate:.1,lvl:20,rarity:50}],[dm,{nameReal:{a:"Create Trap",b:"トラップ生成"},nameSkill:As,skillLvl:10,priceRate:.1,lvl:3,rarity:0}],[mm,{nameReal:{a:"Restore Durability",b:"耐久度復活"},nameSkill:Ds,skillLvl:10,priceRate:1,shop:!0,lvl:10,rarity:0}],[cm,{nameReal:{a:"Repair All",b:"全修復"},nameSkill:Kl,skillLvl:10,priceRate:20,lvl:20,rarity:50}],[pm,{nameReal:{a:"Disintegration",b:"分解"},nameSkill:pl,skillLvl:10,priceRate:100,lvl:30,rarity:80}],[um,{nameReal:{a:"Magic Circle of Protection",b:"守護魔法円"},nameSkill:Za,skillLvl:10,priceRate:30,lvl:30,rarity:50}],[gm,{nameReal:{a:"Light",b:"光"},nameSkill:Ua,skillLvl:10,priceRate:1,shop:!0,lvl:1,rarity:0}],[bm,{nameReal:{a:"Spiderweb",b:"スパイダー・ウェブ"},nameSkill:Ns,skillLvl:10,priceRate:50,lvl:20,rarity:30}],[fm,{nameReal:{a:"Earthquake",b:"地震"},nameSkill:Ql,skillLvl:20,priceRate:25,lvl:20,rarity:30}]]),wand:new Map([[ym,{nameReal:{a:"Teleport Away",b:"テレポート・アウェイ"},nameSkill:cl,skillLvl:10,priceRate:2,lvl:10,rarity:0}],[km,{nameReal:{a:"Stone to Mud",b:"岩石溶解"},nameSkill:Es,skillLvl:10,priceRate:1.5,shop:!0,lvl:1,rarity:0}],[vm,{nameReal:{a:"Fire Bolt",b:"ファイア・ボルト"},nameSkill:Va,skillLvl:10,priceRate:1,shop:!0,lvl:1,rarity:0}],[wm,{nameReal:{a:"Lightning",b:"ライトニング"},nameSkill:ys,skillLvl:10,priceRate:1,shop:!0,lvl:5,rarity:50}],[xm,{nameReal:{a:"Ice Bolt",b:"アイス・ボルト"},nameSkill:ms,skillLvl:10,priceRate:1,shop:!0,lvl:10,rarity:50}],[Sm,{nameReal:{a:"Haste Monster",b:"モンスター加速"},nameSkill:gs,skillLvl:10,priceRate:.1,lvl:1,rarity:0}],[Rm,{nameReal:{a:"Invisibility",b:"透明"},nameSkill:_a,skillLvl:10,priceRate:.1,lvl:10,rarity:0}],[Bm,{nameReal:{a:"Polymorph",b:"変容"},nameSkill:Us,skillLvl:10,priceRate:.1,lvl:15,rarity:0}],[Lm,{nameReal:{a:"Slow Monster",b:"スロー・モンスター"},nameSkill:Ts,skillLvl:10,priceRate:1,lvl:1,rarity:0}],[Mm,{nameReal:{a:"Cancellation",b:"封印"},nameSkill:Ys,skillLvl:10,priceRate:3,lvl:20,rarity:80}],[qm,{nameReal:{a:"Teleport To",b:"引き寄せ"},nameSkill:ml,skillLvl:10,priceRate:.1,lvl:5,rarity:0}],[Em,{nameReal:{a:"Lower Resist",b:"耐性低下"},nameSkill:Ks,skillLvl:10,priceRate:5,lvl:30,rarity:80}]]),melee:new Map([[Im,{nameReal:{a:"Knife",b:"ナイフ"},symbol:"|",shop:!0,lvl:1,rarity:0,iasBase:50,volumeRate:.5,embeddedLimit:2,atkType:Qe|et,edge:1,material:en|_r}],[$m,{nameReal:{a:"Dagger",b:"短剣"},symbol:"|",shop:!0,lvl:1,rarity:0,iasBase:30,volumeRate:.7,embeddedLimit:3,atkType:Qe|et,edge:2,material:Qr|Jr}],[Am,{nameReal:{a:"Sword",b:"剣"},symbol:"|",shop:!0,lvl:1,rarity:0,iasBase:0,volumeRate:1,embeddedLimit:4,atkType:Qe,edge:2,material:Jr|Qr}],[Dm,{nameReal:{a:"Spear",b:"槍"},symbol:"/",shop:!0,lvl:1,rarity:0,iasBase:0,volumeRate:1,embeddedLimit:4,atkType:et,material:Jr|Qr}],[zm,{nameReal:{a:"Club",b:"棍棒"},symbol:"￥",shop:!0,lvl:1,rarity:0,iasBase:20,volumeRate:.8,embeddedLimit:3,atkType:tt,material:en|_r}],[Cm,{nameReal:{a:"Mace",b:"メイス"},symbol:"￥",shop:!0,lvl:1,rarity:0,iasBase:0,volumeRate:1,embeddedLimit:4,atkType:tt,material:Jr|Qr}],[Pm,{nameReal:{a:"Axe",b:"斧"},symbol:"/",shop:!0,lvl:1,rarity:0,iasBase:-10,volumeRate:1.2,embeddedLimit:4,atkType:Qe,edge:1,material:Jr}],[Nm,{nameReal:{a:"Pick",b:"ピック"},symbol:"￥",shop:!0,lvl:1,rarity:0,iasBase:-20,volumeRate:.8,embeddedLimit:3,atkType:et,digging:100,material:Jr}],[Tm,{nameReal:{a:"Two-handed Axe",b:"両手斧"},symbol:"/",lvl:5,rarity:20,iasBase:-30,volumeRate:1.5,embeddedLimit:5,atkType:Qe,twoHanded:!0,material:Jr}],[Fm,{nameReal:{a:"Two-handed Hammer",b:"両手槌"},symbol:"￥",lvl:10,rarity:30,iasBase:-40,volumeRate:2,embeddedLimit:5,atkType:tt,twoHanded:!0,material:Qr}],[Om,{nameReal:{a:"Maul",b:"大木槌"},symbol:"￥",lvl:15,rarity:40,iasBase:-50,volumeRate:3,embeddedLimit:6,atkType:tt,twoHanded:!0,material:en}]]),missile:new Map([[Vm,{nameReal:{a:"Sling",b:"スリング"},throwType:"sling",shop:!0,lvl:1,rarity:0,iasBase:-10,volumeRate:.7,embeddedLimit:2,atkType:tt,material:Ur}],[Gm,{nameReal:{a:"Staff Sling",b:"棒スリング"},throwType:"sling",lvl:5,rarity:20,iasBase:-20,volumeRate:.5,embeddedLimit:3,atkType:tt,material:en}],[Hm,{nameReal:{a:"Bow",b:"弓"},throwType:"bow",shop:!0,lvl:1,rarity:0,iasBase:0,volumeRate:1,embeddedLimit:4,atkType:et,twoHanded:!0,material:en|_r|tn}],[Wm,{nameReal:{a:"Crossbow",b:"クロスボウ"},throwType:"crossbow",shop:!0,lvl:1,rarity:0,iasBase:-20,volumeRate:1,embeddedLimit:4,atkType:et,twoHanded:!0,material:Jr}]]),staff:new Map([[jm,{nameReal:{a:"Stick",b:"スティック"},shop:!0,lvl:1,rarity:0,fcrBase:10,volumeRate:.5,embeddedLimit:2,atkType:tt,material:en}],[Um,{nameReal:{a:"Rod",b:"ロッド"},shop:!0,lvl:1,rarity:0,fcrBase:20,volumeRate:.7,embeddedLimit:3,atkType:tt,material:Jr}],[Ym,{nameReal:{a:"Staff",b:"杖"},shop:!0,lvl:1,rarity:0,fcrBase:50,volumeRate:1,embeddedLimit:4,atkType:tt,twoHanded:!0,material:en}]]),ammo:new Map([[Oc,{nameReal:{a:"Rock",b:"石"},color:Dt.gray,throwType:"sling",weight:.1,priceRate:1,shop:!0,atkType:tt,lvl:1,rarity:0,dmgBonus:100}],[Fc,{nameReal:{a:"Arrow",b:"矢"},color:Dt.brown,throwType:"bow",weight:.02,priceRate:2,shop:!0,atkType:et,lvl:1,rarity:0}],[Vc,{nameReal:{a:"Bolt",b:"ボルト"},color:Dt.brown,throwType:"crossbow",weight:.04,priceRate:3,shop:!0,atkType:et,lvl:1,rarity:0}]]),shield:new Map([[_m,{nameReal:{a:"Shield",b:"盾"},shop:!0,lvl:1,rarity:0,volumeRate:1,embeddedLimit:4,material:Ur|Yr|Jr|_r|en|Qr|Zr|tn}],[Zm,{nameReal:{a:"Shield",b:"盾"},lvl:5,rarity:80,volumeRate:1,embeddedLimit:4,material:Xr}]]),armor:new Map([[Xm,{nameReal:{a:"Vestment",b:"法衣"},lvl:5,rarity:60,volumeRate:.2,embeddedLimit:4,material:Xr}],[Jm,{nameReal:{a:"Robe",b:"ローブ"},shop:!0,lvl:1,rarity:0,volumeRate:.3,embeddedLimit:2,material:Hr|jr}],[Km,{nameReal:{a:"Vest",b:"ベスト"},shop:!0,lvl:1,rarity:0,volumeRate:.7,embeddedLimit:3,material:Wr|Ur}],[Qm,{nameReal:{a:"Armor",b:"鎧"},shop:!0,lvl:1,rarity:0,volumeRate:1,embeddedLimit:4,material:Jr|Yr|Kr|_r|Zr}],[ec,{nameReal:{a:"Splint Mail",b:"小札鎧"},lvl:5,rarity:20,volumeRate:1.1,embeddedLimit:5,material:Jr|en}],[tc,{nameReal:{a:"Plate Mail",b:"板金鎧"},lvl:10,rarity:40,volumeRate:1.2,embeddedLimit:6,material:Jr|Qr}]]),cloak:new Map([[sc,{nameReal:{a:"Cloak",b:"クローク"},shop:!0,lvl:1,rarity:0,volumeRate:.5,embeddedLimit:2,material:Hr}],[ac,{nameReal:{a:"Coat",b:"コート"},shop:!0,lvl:1,rarity:0,volumeRate:.7,embeddedLimit:2,material:jr|Wr}],[ic,{nameReal:{a:"Mantle",b:"マント"},shop:!0,lvl:1,rarity:0,volumeRate:1,embeddedLimit:2,material:Ur|Yr}]]),belt:new Map([[lc,{nameReal:{a:"Sash",b:"腰帯"},shop:!0,lvl:1,rarity:0,numBoxes:1,volumeRate:.5,embeddedLimit:2,material:Hr|jr|Wr}],[rc,{nameReal:{a:"Belt",b:"ベルト"},shop:!0,lvl:1,rarity:0,numBoxes:1,volumeRate:1,embeddedLimit:2,material:Ur|Yr|Kr|_r}]]),helm:new Map([[hc,{nameReal:{a:"Crown",b:"王冠"},lvl:5,rarity:60,volumeRate:.2,embeddedLimit:4,material:Xr}],[nc,{nameReal:{a:"Circlet",b:"冠"},shop:!0,lvl:1,rarity:0,volumeRate:.1,embeddedLimit:2,material:jr|Kr}],[oc,{nameReal:{a:"Cap",b:"帽子"},shop:!0,lvl:1,rarity:0,volumeRate:.3,embeddedLimit:2,material:Hr|Wr|Ur|Yr}],[dc,{nameReal:{a:"Mask",b:"仮面"},shop:!0,lvl:1,rarity:0,volumeRate:.5,embeddedLimit:2,material:en|Qr}],[mc,{nameReal:{a:"Helm",b:"兜"},shop:!0,lvl:1,rarity:0,volumeRate:1,embeddedLimit:3,material:Jr|_r|Zr|tn}]]),gloves:new Map([[pc,{nameReal:{a:"Bracer",b:"ブレイサー"},lvl:5,rarity:60,volumeRate:.2,embeddedLimit:4,material:Xr}],[cc,{nameReal:{a:"Mitten",b:"ミトン"},shop:!0,lvl:1,rarity:0,volumeRate:.3,embeddedLimit:2,material:Hr|Wr|jr}],[gc,{nameReal:{
a:"Vambrace",b:"腕甲"},shop:!0,lvl:1,rarity:0,volumeRate:.7,embeddedLimit:2,material:_r|Zr|Qr}],[uc,{nameReal:{a:"Gloves",b:"手袋"},shop:!0,lvl:1,rarity:0,volumeRate:1,embeddedLimit:3,material:Ur|Yr|Kr}],[bc,{nameReal:{a:"Gauntlets",b:"小手"},lvl:5,rarity:20,iasBase:-10,volumeRate:1.2,embeddedLimit:4,material:Jr}]]),boots:new Map([[fc,{nameReal:{a:"Sandals",b:"サンダル"},shop:!0,lvl:1,rarity:0,frwBase:50,volumeRate:.3,embeddedLimit:2,material:Hr|jr}],[yc,{nameReal:{a:"Shoes",b:"短靴"},shop:!0,lvl:1,rarity:0,frwBase:30,volumeRate:.7,embeddedLimit:2,material:Wr|Ur|en}],[kc,{nameReal:{a:"Boots",b:"靴"},shop:!0,lvl:1,rarity:0,frwBase:0,volumeRate:1,embeddedLimit:3,material:Yr|Kr|_r|Zr}],[vc,{nameReal:{a:"Greaves",b:"脛当て"},lvl:5,rarity:20,frwBase:-20,volumeRate:1.2,embeddedLimit:4,material:Jr}]]),light:new Map([[wc,{nameReal:{a:"Torch",b:"松明"},shop:!0,lvl:1,rarity:0,lighten:1,fuelValue:5e3,volumeRate:.5,embeddedLimit:1,torch:!0,material:en}],[xc,{nameReal:{a:"Lamp",b:"ランプ"},shop:!0,lvl:1,rarity:0,lighten:2,fuelValue:1e4,volumeRate:1.2,embeddedLimit:1,material:Qr}],[Sc,{nameReal:{a:"Lanthanum",b:"ランタン"},shop:!0,lvl:1,rarity:0,lighten:3,fuelValue:7500,volumeRate:1,embeddedLimit:1,material:Jr}]]),amulet:new Map([[Lc,{nameReal:{a:"Amulet",b:"首飾り"},color:Dt.orange,mod:ze,lvl:1,rarity:0,volumeRate:1,embeddedLimit:1,material:_r|jr|tn}]]),ring:new Map([[Rc,{nameReal:{a:"Ring",b:"指輪"},color:Dt.red,mod:ze,lvl:1,rarity:0,volumeRate:1,embeddedLimit:1,material:Jr|Qr}],[Bc,{nameReal:{a:"Ring",b:"指輪"},color:Dt.red,mod:ze,lvl:5,rarity:80,volumeRate:1,embeddedLimit:1,material:Xr}]]),gem:new Map([[Mc,{nameReal:{a:"Jewel",b:"ジュエル"},color:Dt.white,mod:ze,priceRate:1,lvl:1,rarity:0,desc:{a:"",b:"埋め込み可能な装備品に合成すると属性値が付与される。"}}]]),orb:new Map([[qc,{name:{a:"<10>",b:"<10>"},nameReal:{a:"Kingship",b:"王国"},color:Dt.olive,lvl:1,rarity:0,modParts:{melee:{digging:30},missile:{stealth:20},staff:{searching:20},shield:{stealth:20},amulet:{digest:20},ring:{digest:20},light:{searching:30},armor:{digest:20},cloak:{stealth:30},belt:{digest:30},helm:{searching:20},gloves:{searching:20},boots:{stealth:20}}}],[Ec,{name:{a:"<9>",b:"<9>"},nameReal:{a:"Foundation",b:"基礎"},color:Dt.purple,lvl:4,rarity:5,modParts:{melee:{dmgBonus:30},missile:{rateBonus:30},staff:{acBonus:20},shield:{acBonus:30},amulet:{acBonus:20},ring:{dmgBonus:20},light:{rateBonus:20},armor:{acBonus:20},cloak:{acBonus:20},belt:{acBonus:20},helm:{acBonus:20},gloves:{rateBonus:20},boots:{acBonus:20}}}],[Ic,{name:{a:"<8>",b:"<8>"},nameReal:{a:"Splendour",b:"栄光"},color:Dt.orange,lvl:7,rarity:10,modParts:{melee:{stealLife:3},missile:{stealLife:3},staff:{stealLife:3},shield:{hp:20},amulet:{hpReg:10},ring:{hpReg:10},light:{gf:40},armor:{hp:30},cloak:{gf:30},belt:{hpReg:20},helm:{gf:30},gloves:{stealLife:3},boots:{gf:30}}}],[$c,{name:{a:"<7>",b:"<7>"},nameReal:{a:"Eternity",b:"勝利"},color:Dt.green,lvl:10,rarity:15,modParts:{melee:{dmgPoison:20},missile:{dmgPoison:20},staff:{skillPoison:1},shield:{poison:30},amulet:{skillPoison:1},ring:{skillPoison:1},light:{poison:20},armor:{poison:20},cloak:{poison:20},belt:{poison:20},helm:{poison:20},gloves:{dmgPoison:20},boots:{poison:20}}}],[Ac,{name:{a:"<6>",b:"<6>"},nameReal:{a:"Beauty",b:"美"},color:Dt.yellow,lvl:13,rarity:20,modParts:{melee:{stealMana:3},missile:{stealMana:3},staff:{stealMana:3},shield:{mp:10},amulet:{mpReg:10},ring:{mpReg:10},light:{mf:30},armor:{mp:20},cloak:{mf:20},belt:{mpReg:20},helm:{mp:10},gloves:{stealMana:3},boots:{mf:20}}}],[Dc,{name:{a:"<5>",b:"<5>"},nameReal:{a:"Severity",b:"峻厳"},color:Dt.red,lvl:16,rarity:25,modParts:{melee:{dmgFire:20},missile:{dmgFire:20},staff:{skillFire:1},shield:{fire:30},amulet:{skillFire:1},ring:{skillFire:1},light:{lighten:1},armor:{fire:20},cloak:{fire:20},belt:{fire:20},helm:{fire:20},gloves:{str:5},boots:{fire:20}}}],[zc,{name:{a:"<4>",b:"<4>"},nameReal:{a:"Kindness",b:"慈悲"},color:Dt.blue,lvl:19,rarity:30,modParts:{melee:{atkCold:20},missile:{atkCold:20},staff:{skillWater:1},shield:{water:30},amulet:{skillWater:1},ring:{skillWater:1},light:{water:20},armor:{water:20},cloak:{water:20},belt:{water:20},helm:{int:5},gloves:{atkCold:20},boots:{water:20}}}],[Cc,{name:{a:"<3>",b:"<3>"},nameReal:{a:"Understanding",b:"理解"},color:Dt.shadow,lvl:22,rarity:35,modParts:{melee:{atkSlow:20},missile:{atkSlow:20},staff:{skillEarth:1},shield:{earth:30},amulet:{skillEarth:1},ring:{skillEarth:1},light:{earth:20},armor:{earth:20},cloak:{earth:20},belt:{con:5},helm:{earth:20},gloves:{atkSlow:20},boots:{earth:20}}}],[Pc,{name:{a:"<2>",b:"<2>"},nameReal:{a:"Wisdom",b:"知恵"},color:Dt.gray,lvl:25,rarity:40,modParts:{melee:{dmgLightning:20},missile:{dmgLightning:20},staff:{skillAir:1},shield:{air:30},amulet:{skillAir:1},ring:{skillAir:1},light:{air:20},armor:{air:20},cloak:{spd:20},belt:{air:20},helm:{air:20},gloves:{dmgLightning:20},boots:{dex:5}}}],[Tc,{name:{a:"<1>",b:"<1>"},nameReal:{a:"Crown",b:"王冠"},color:Dt.white,lvl:30,rarity:50,modParts:{melee:{ias:20},missile:{ias:20},staff:{fcr:20},shield:{resistAll:20},amulet:{fcr:20},ring:{ias:20},light:{resistAll:10},armor:{resistAll:10},cloak:{resistAll:10},belt:{resistAll:10},helm:{fcr:20},gloves:{ias:20},boots:{frw:20}}}]])},tp=(()=>{let e=new Map;for(let t in ep)e.set(t,i(1,ep[t].size));return e})(),ip=Object.keys(ep);ip.push("material");const ap={melee:new Map([]),missile:new Map([[Hm,[{name:{a:"Pandarus",b:"パンダロス",pre:!0},lvl:25,rarity:20,matBase:tn,matId:xo,values:{hp:50,mp:50,dmgMinBonus:10,dmgBonus:50,rateBonus:50}}]]]),staff:new Map([]),shield:new Map([]),armor:new Map([]),cloak:new Map([]),belt:new Map([]),helm:new Map([]),gloves:new Map([]),boots:new Map([]),light:new Map([]),ring:new Map([]),amulet:new Map([]),gem:new Map([])},sp=class extends _h{constructor(e,t){super(e),this.id=-1,this.quantity=t}static goldAmount(e){return 50*e+_t(1,50*(e+1))}init(e,t,i,a,s,l,r,n,o){this.lvl=s;let h="gem"===this.type;if(this.equipable||h){if(h||(this.durabBonus=0,this.equipable&&(this.embeddedNum=0,this.embeddedList=[])),a||(a=this.mod===ze||!r&&_h.evalMod(ze,$t.mf,qt.shop)),a&&!qt.shop&&ap[this.type].has(this.tabId)&&(l>=0||_h.evalMod(Pe,$t.mf))){let e=ap[this.type].get(this.tabId);for(let t=0,i=e.length;t<i;t++){if(l>=0&&l!==t)continue;let i=e[t],s=this.type+","+this.tabId+","+t;if(!$t.cui[s]&&(l>=0||i.lvl<=this.lvl&&!Jt(i.rarity))){this.getUnique(i),this.uniqueId=t,$t.cui[s]=!0,n=i.matBase,o=i.matId,a=!1;break}}a&&(this.mod=Ce)}if(h||this.getMaterial(n,o),a||this.material===Xr){let e=this.bias?this.bias:ne;this.mod===Ce||_h.evalMod(Ce,$t.mf)?this.getRare(e):this.getMagic(e)}else this.mod||(this.mod=De,this.cursed=!r&&!qt.shop&&Jt(Z));if(this.equipable&&(this.calcDurab(!0),r?this.embeddedMax=0:this.adjustEmbeddedNum()),"light"===this.type)this.fuelBonus&&(this.fuelValue=Math.ceil(this.fuelValue*(1+this.fuelBonus/100))),this.fuelMax=this.fuelValue,qt.shop||r||(this.fuelValue=Math.ceil(this.fuelValue*(Yt(100)/100))),this.calcFuelLvl();else if(this.weapon){if(this.dmgBonus||(this.dmgBonus=0),this.rateBonus||(this.rateBonus=0),!r&&!qt.shop&&(this.cursed||this.mod===De&&$t.cdl)){let e;"staff"===this.type?(this.acBonus||(this.acBonus=0),(this.cursed||Jt(25))&&(this.acBonus+=(this.cursed?-1:1)*_t(1,20),e=!0)):((this.cursed||Jt(25))&&(this.dmgBonus+=(this.cursed?-1:1)*_t(1,20),e=!0),(this.cursed||Jt(25))&&(this.rateBonus+=(this.cursed?-1:1)*_t(1,20),e=!0)),!this.cursed&&e&&this.getSuperiorName()}this.calcDmgOne()}else this.armor&&(this.acBonus||(this.acBonus=0),r||qt.shop||!(this.cursed||this.mod===De&&$t.cdl&&Jt(25))||(this.acBonus+=(this.cursed?-1:1)*_t(1,20),this.cursed||this.getSuperiorName()),this.calcAcOne());this.colorMod||(this.colorMod=this.color),this.calcPrice(),(qt.shop||r)&&(this.identified=!0,this.changeNameAndPrice())}else this.mod=De,qt.shop&&(this.identified=!0),"ammo"===this.type?1===this.quantity&&(this.quantity=_t(80,100)):"coin"===this.type?(1===this.quantity?this.priceReal=Math.ceil(sp.goldAmount($t.cdl)*(1+$t.gf/100)):(this.priceReal=this.quantity,this.quantity=1),this.nameReal.a=this.nameReal.b="$"+this.priceReal):"wand"===this.type?this.charges=_t(3,6):("potion"===this.type&&!this.lethe||"scroll"===this.type)&&(1!==this.quantity||qt.synthesize||(this.quantity=_t(1,5))),"coin"!==this.type&&this.calcPrice(),(qt.shop||ep[this.type].get(this.tabId).identified)&&("wand"===this.type&&!qt.shop&&this.identified&&(this.identified=!1),this.changeNameAndPrice());this.weight||(this.weight=Rt[this.type]),qt.shop&&(this.price*=qt.gamble?10:2),e!==Ie&&super.init(e,t,i)}putDown(e,t,i){do{this.id=Math.random()}while(vr.itemList[this.id]);if(this.spiralSearch(e,t,"item"),this.abort)return;this.place=Re,vr.itemList[this.id]=this;let a=vr.coords[this.x][this.y],s=Object.keys(a.item).length;a.item[vt[s]]=this,i&&pr.playSound(this.type),$t.hallucinated&&xr.one(this)}indexOf(e){for(let t in e)if(Object.is(e[t],this))return t}equal(e){return this.type===e.type&&this.tabId===e.tabId&&("wand"===this.type&&this.identified&&e.identified||this.chargeBook?this.charges===e.charges:"wand"===this.type||this.equipable||"gem"===this.type||"material"===this.type?this.identified&&e.identified&&JSON.stringify(this,sp.replacer)===JSON.stringify(e,sp.replacer):this.identified===e.identified)}static replacer(e,t){return"quantity"===e||"place"===e||"price"===e?void 0:t}dropped(){let e=this.getName();Na.draw(Pt.isEnglish()?`Dropped ${e}`:`${e}を落とした`)}calcDmgOne(){let e=1+(this.dmgBonus?this.dmgBonus/100:0),t=this.dmgMinBonus?this.dmgMinBonus:0,i=this.dmgMaxBonus?this.dmgMaxBonus:0;this.dmgValue=Math.floor((this.dmgBase+(t+i)/2)*e),this.reqStr=Math.ceil(10*(this.weight-3)),this.reqStr<=0&&(this.reqStr=void 0)}calcAcOne(){let e=1+this.acBonus/100;this.acSValue=Math.floor(this.acSBase*e),this.acTValue=Math.floor(this.acTBase*e),this.acBValue=Math.floor(this.acBBase*e),this.acAvgValue=Math.floor(this.acAvg*e)}calcDurab(e){this.durabRate||(this.durabRate=1);let t=oe+this.weight*he;this.durabMax=Math.ceil(t*this.durabRate+this.durabBonus),(e||this.durab>this.durabMax)&&(this.durab=this.durabMax)}calcFuelLvl(){this.fuelLvl=Math.ceil(this.fuelValue/this.fuelMax*100)}identifyAll(){ep[this.type].get(this.tabId).identified=!0,this.identified=!0,this.changeNameAndPrice(),lp.main(this.nameReal[se],this.type)}identifyWand(){let e=ep[this.type].get(this.tabId);e.identified||(e.identified=!0,lp.main(this.nameReal[se],this.type))}getDurabPrice(){let e=(this.durabMax-this.durab)*de;return e}getSuperiorName(){this.superior=!0,this.nameReal.a="Superior "+this.nameReal.a,this.nameReal.b="上等な"+this.nameReal.b,this.identified&&(this.name.a="Superior "+this.name.a,this.name.b="上等な"+this.name.b)}uncurse(){if(this.cursed=!1,pr.playSound("uncurse"),this.embeddedList&&this.embeddedList.length)for(let e of this.embeddedList)if(e.cursed){e.cursed=!1;let t=e.modParts?e.modParts[this.type]:e.modList;t.cursed=!1}}calcPrice(){if(this.price=this.priceReal=Bt[this.type],this.priceRate&&(this.priceReal=Math.round(this.priceReal*this.priceRate)),this.equipable||"gem"===this.type||"material"===this.type){let e;switch(this.mod){case De:e=1;break;case ze:e=2;break;case Ce:e=5;break;case Pe:e=10,this.priceReal+=1e3}if(this.priceReal*=e,this.equipable){let e=1+this.weight/2;this.price=Math.round(this.price*e),this.priceReal=this.cursed?1:Math.round(this.priceReal*e)}}}changeNameAndPrice(){let e=!!this.typeHalluc,t=e?this.nameTemp:this.name;if(t.a=this.nameReal.a,t.b=this.nameReal.b,this.changePrice(),this.equipable||"material"===this.type||"gem"===this.type||"orb"===this.type){let t=this.colorMod?this.colorMod:this.colorReal;this.colorReal=t,e||(this.color=t)}}changePrice(){"wand"===this.type?this.price=Math.round(this.priceReal*(1+this.charges*me)):this.price=this.priceReal}getName(e,t=this.quantity,i=Pt.getLanguage(),a){let s,l=this.typeHalluc?this.typeHalluc:this.type,r=!!this.typeHalluc,n=i===se;if(a)return s=n?ei(l):Oa.item[l],t>1&&(s+=` x${t}`),s;if(s=e?this.nameReal[i]:this.name[i],"book"===l||"potion"===l||"scroll"===l||"recipe"===l||"wand"===l||"orb"===l){let e;this.type2&&(l=this.type2),n?(e=ei(l),this.identified||r?s=`${e} of ${s}`:"potion"===l||"wand"===l?s+=` ${e}`:"scroll"===l||"recipe"===l?s=`${e} titled ${s}`:"orb"===l&&(s=`${e} engraved ${s}`)):(e=Oa.item[l],this.identified||"scroll"!==l&&"recipe"!==l||r?this.identified||"orb"!==l||r?s+=`の${e}`:s+=`と刻まれた${e}`:s+=`と名付けられた${e}`)}if(!r){if("light"===l&&this.identified)s+=` [${this.fuelLvl}%]`;else if("material"===l){let e;this.piece?(e=n?"Piece":"欠片",n&&(e=li(e,!1,!0,t))):e=Gh.get(this.material).name[i].replace(n?/s$/:/類$|製$|材$/,""),s=n?`${e} of ${s}`:`${s}の${e}`}if(this.equipable){let e="";this.weapon?(this.twoHanded&&(e+=" (2H)"),this.identified&&(e+=` (${this.dmgValue})`)):this.armor&&this.identified&&(e+=` [${this.acAvgValue}]`,$t.isWizard&&(e+=` [${this.acSValue},${this.acTValue},${this.acBValue}]`)),s+=e}this.identified&&(this.durabMax&&(s+=` {${this.durab}}`),this.charges>=0&&(s+=` [${this.charges}]`),this.embeddedMax&&(s+=` <${this.embeddedNum}/${this.embeddedMax}>`)),(this.equipable||"material"===l||"gem"===l)&&(this.identified?this.cursed&&(s=(n?"Cursed ":"呪われた")+s):s+=n?" (Unid)":" (未識別)")}return t>1&&(s+=` x${t}`),s}split(e,t){let i={};if(Tt(i,this),i.embeddedList&&i.embeddedList.length)for(let e of i.embeddedList)e.__proto__=sp.prototype;if(i.__proto__=sp.prototype,i.quantity=e,this.quantity-=e,!this.quantity){let e=this.indexOf(t);this.place===Se||this.place===Be?t[e]=null:this.place===Le?t.splice(e,1):si(t,e),this.place===Re&&delete vr.itemList[i.id]}return i}adjustEmbeddedNum(){let e=this.embeddedLimit;if(this.mod===De)this.embeddedMax=Jt(50)?0:_t(1,e);else{let t=this.embeddedBonus;t?(this.mod===ze?t>4&&(t=4):this.mod===Ce&&t>2&&(t=2),t>e&&(t=e),this.embeddedMax=this.embeddedBonus=t):this.embeddedMax=0}}isShowing(){let e=vr.coords[this.x][this.y];return!$t.blinded&&(e.found&&!e.wall||this.detected)}static getType(e){let t;do{if(e)if(Jt(20))t=Zt()?"gem":"orb";else{let e=St.length;t=St[Yt(e-1)]}else t=ip[Yt(ip.length-2)]}while(Jt(Lt[t])||qt.shop&&("coin"===t||"recipe"===t||"orb"===t||"gem"===t));return t}static getTabId(e,t,i){let a,s,l=0,r=tp.get(e);r.shuffle();do{a=r[l++],s=ep[e].get(a),s||(l=0,e=sp.getType(i),r=tp.get(e),r.shuffle())}while(!s||s.abort||$t.lethe&&s.lethe||"recipe"===s.type&&$t.recipes[a]||s.lvl>t||Jt(s.rarity));return[e,a]}static getSymbol(e){let t;switch(e){case"book":case"scroll":case"recipe":t="?";break;case"food":t=":";break;case"potion":case"oil":t="!";break;case"wand":t="-";break;case"food":t=":";break;case"missile":t="}";break;case"staff":t="_";break;case"shield":t=")";break;case"armor":t="[";break;case"cloak":t="(";break;case"belt":t="~";break;case"helm":case"gloves":case"boots":t="]";break;case"light":t="＊";break;case"ring":t="=";break;case"amulet":t='"';break;case"gem":t="*";break;case"orb":t="・";break;case"ammo":t="{";break;case"coin":t="$"}return t}static initTab(){for(let e in ep)for(let[t,i]of ep[e].entries()){if(i.type=e,i.tabId=t,i.symbol||(i.symbol=sp.getSymbol(i.type)),i.name||(i.name={}),"book"===e||"food"===e||"coin"===e||"ammo"===e||"oil"===e||"misc"===e?i.identified=!0:"melee"!==e&&"missile"!==e&&"staff"!==e&&"shield"!==e&&"armor"!==e&&"cloak"!==e&&"belt"!==e&&"helm"!==e&&"gloves"!==e&&"boots"!==e&&"light"!==e&&"ring"!==e&&"amulet"!==e||(i.equipable=!0,i.grade=Te,"melee"===e||"missile"===e||"staff"===e?i.weapon=!0:"light"===e||"ring"===e||"amulet"===e?i.ornament=!0:i.armor=!0),(i.equipable||"gem"===e)&&(i.name.a=i.nameReal.a,i.name.b=i.nameReal.b),"book"===e){if(!i.skill)continue;let e=i.list,t=Object.keys(e);for(let i,a=0,s=t.length;a<s-1;a++,i=!1){for(let l=s-1;l>a;l--){let[a,s]=[t[l-1],t[l]];rr.get(e[a]).reqLvl>rr.get(e[s]).reqLvl&&([e[a],e[s]]=[e[s],e[a]],i=!0)}if(!i)break}}else"scroll"===e?i.color=Dt.white:"recipe"===e&&(i.color=Dt.red,i.desc={a:"",b:"錬金術で使用されるレシピ。読み上げる事で習得する。"});"orb"===e&&(i.mod=De,i.shadow=Dt.orange,i.priceRate=(10+t)/10,i.desc={a:"",b:"埋め込み可能な装備品に合成すると種類に応じて属性値が付与される。"})}}};sp.initTab();const lp={main(e,t){this.loop($t.pack,e,t),this.loop($t.boxes,e,t),this.loop(vr.itemList,e,t);for(let i in vr.enemyList)this.loop(vr.enemyList[i].pack,e,t)},loop(e,t,i){for(let a in e){let s=e[a];s&&s.type===i&&s.nameReal[se]===t&&("wand"!==s.type&&(s.identified=!0),s.changeNameAndPrice())}}},rp={ants:[{name:{a:"Giant Ant",b:"巨蟻"},symbol:"a",color:Dt.acid,race:Ue,mod:De,grade:Te,lvl:8,rarity:0,hpRate:-10,mpRate:0,str:10,dex:10,con:5,int:5,spd:-50,dmgBase:10,acBase:50,dmgAcid:10,group:!0,dropNum:0,matDropRate:3,material:Zr,atkType:et}],bats:[{name:{a:"Giant Bat",b:"大蝙蝠"},symbol:"b",color:Dt.gray,race:Ue,mod:De,grade:Te,lvl:4,rarity:0,hpRate:-9,mpRate:0,str:5,dex:20,con:10,int:5,spd:50,dmgBase:10,acBase:20,stealLife:30,dropNum:0,matDropRate:3,material:jr,atkType:et,grow:Ve}],canines:[{name:{a:"She-wolf",b:"雌狼"},symbol:"c",color:Dt.brown,race:Ue,mod:De,grade:Te,lvl:1,rarity:0,hpRate:-10,mpRate:0,str:5,dex:10,con:5,int:5,spd:0,dmgBase:10,acBase:25,frw:20,dropNum:0,matDropRate:2,material:Wr,atkType:Qe,grow:Ve},{name:{a:"Laelaps, the Hound of Cephalus",b:"狩人ケパロスの猟犬ラエラプス"},symbol:"c",color:Dt.brown,race:Ue,mod:Pe,grade:Te,lvl:20,rarity:30,hpRate:-2,mpRate:0,str:40,dex:80,con:30,int:25,spd:25,dmgBase:70,acBase:100,frw:100,dropNum:2,matDropRate:0,material:Wr,atkType:Qe|et,skillProb:1/6,skill:{a:{id:gl,lvl:5}},desc:{a:"",b:"女神アルテミスより授与された、どんな獲物も逃がさないとされる猟犬。同じく、どんな追手にも捕まらないという狐と膠着状態となり、ゼウスにより両者は石に変えられる。"}}],felines:[{name:{a:"Lion",b:"獅子"},symbol:"f",color:Dt.yellow,race:Ue,mod:De,grade:Te,lvl:13,rarity:0,hpRate:-4,mpRate:0,str:25,dex:30,con:25,int:5,spd:25,dmgBase:30,acBase:80,dropNum:0,matDropRate:2,material:Wr,atkType:Qe|et,grow:Fe},{name:{a:"Nemean lion",b:"ネメアの獅子"},symbol:"f",color:Dt.yellow,race:Ue,mod:Pe,grade:Te,lvl:21,rarity:30,hpRate:0,mpRate:0,str:50,dex:50,con:30,int:25,spd:25,dmgBase:75,acBase:250,acRed:25,earth:50,frw:50,dropNum:2,matDropRate:0,material:Wr,atkType:Qe|et,skillProb:.2,skill:{a:{id:gl,lvl:5}},desc:{a:"",b:"ネメアの谷に住む獅子。その毛皮は棍棒や矢では傷付かないが、ヘラクレスに手づかみにされ絞殺される。"}}],golems:[{name:{a:"Golem",b:"ゴーレム"},symbol:"g",color:null,race:Je,mod:De,grade:Te,lvl:14,rarity:0,hpRate:0,mpRate:0,str:30,dex:10,con:25,int:5,spd:-50,dmgBase:null,acBase:null,piece:!0,volumeRate:1,dropNum:0,matDropRate:2,material:Qr,atkType:tt,grow:Ge}],humanoids:[{name:{a:"Incarnation",b:"化身"},symbol:"h",color:Dt.white,race:Xe,mod:Ce,grade:Te,lvl:25,rarity:0,hpRate:0,mpRate:0,str:50,dex:50,con:50,int:50,spd:25,dmgBase:100,acBase:100,fire:30,water:30,air:30,earth:30,poison:30,dropNum:3,matDropRate:1,atkType:tt},{name:{a:"Calypso, the Sea Goddess",b:"海の女神カリュプソ"},symbol:"h",color:Dt.blue,race:Xe,mod:Pe,grade:Te,lvl:30,rarity:30,hpRate:0,mpRate:0,str:150,dex:150,con:150,int:150,spd:100,dmgBase:200,acBase:200,water:100,strSus:!0,dexSus:!0,conSus:!0,intSus:!0,dropNum:4,matDropRate:0,atkType:tt,skillProb:.25,skill:{a:{id:ms,lvl:10},b:{id:Ja,lvl:10},c:{id:Bl,lvl:10}},desc:{a:"",b:"巨人アトラスの娘、仙女。海に漂流したオデュッセウスを救護し、7年間孤島で共に暮す。"}}],incubuses:[{name:{a:"Incubuses",b:"夢魔"},symbol:"i",color:Dt.gray,race:Ye,mod:De,grade:Te,lvl:26,rarity:0,hpRate:0,mpRate:0,str:50,dex:75,con:50,int:50,spd:50,dmgBase:70,acBase:100,stealMana:30,levi:!0,awake:!0,dropNum:2,matDropRate:2,material:Ur,atkType:Qe}],mimics:[{name:{a:"Mimic",b:"ミミック"},symbol:"m",color:Dt.brown,race:null,mod:De,grade:Te,lvl:10,rarity:0,hpRate:-10,mpRate:0,str:25,dex:25,con:5,int:5,spd:0,dmgBase:75,acBase:50,stillness:!0,canAttack:!0,awake:!0,mimic:!0,dropNum:1,matDropRate:1,atkType:tt}],persons:[{name:{a:"Warrior",b:"戦士"},symbol:"p",color:Dt.brown,race:je,mod:De,grade:Te,lvl:7,rarity:0,hpRate:2,mpRate:0,str:15,dex:10,con:10,int:5,spd:0,dmgBase:1,acBase:0,dropNum:1,matDropRate:2,material:_r,atkType:tt,grow:Fe,starter:[{type:"melee",tabId:zm},{type:"armor",tabId:Qm}]},{name:{a:"Hunter",b:"狩人"},symbol:"p",color:Dt.red,race:je,mod:De,grade:Te,lvl:10,rarity:0,hpRate:-2,mpRate:0,str:10,dex:20,con:10,int:10,spd:0,dmgBase:1,acBase:0,dropNum:1,matDropRate:2,material:_r,atkType:tt,grow:Ve,starter:[{type:"missile",tabId:Hm},{type:"ammo",tabId:Fc},{type:"armor",tabId:Km},{type:"melee",tabId:Im,side:"a"}]},{name:{a:"Magus",b:"魔術師"},symbol:"p",color:Dt.purple,race:je,mod:De,grade:Te,lvl:15,rarity:0,hpRate:-5,mpRate:2,str:5,dex:5,con:5,int:10,spd:0,dmgBase:1,acBase:0,dropNum:2,matDropRate:2,skillProb:.2,skill:{a:{id:Va,lvl:10},b:{id:hl,lvl:1}},material:_r,atkType:tt,grow:He,starter:[{type:"staff",tabId:Ym},{type:"armor",tabId:Jm}]},{name:{a:"Thief",b:"盗賊"},symbol:"p",color:Dt.gray,race:je,mod:De,grade:Te,lvl:20,rarity:0,hpRate:0,mpRate:0,str:25,dex:50,con:25,int:25,spd:25,dmgBase:1,acBase:0,atkStealItem:20,atkStealGold:20,stealth:25,dropNum:2,matDropRate:2,material:_r,atkType:tt,grow:Ve,starter:[{type:"melee",tabId:$m},{type:"armor",tabId:Km}]},{name:{a:"Iros, the Beggar",b:"乞食イロス"},symbol:"p",color:Dt.brown,race:je,mod:Pe,grade:Te,lvl:5,rarity:30,hpRate:-8,mpRate:0,str:10,dex:10,con:10,int:10,spd:0,dmgBase:1,acBase:0,atkStealItem:20,dropNum:1,matDropRate:0,material:_r,atkType:tt,starter:[{type:"staff",tabId:jm,matBase:en,matId:mo},{type:"armor",tabId:Jm,matBase:Hr,matId:an}],desc:{a:"",b:"イタケの町を徘徊する土着の乞食。同業に対して頭面をしていたが、乞食に扮したオデュッセウスと格闘の末打ち据えられる。"}},{name:{a:"Dolon, the Spy",b:"偵察者ドロン"},symbol:"p",color:Dt.bronze,race:je,mod:Pe,grade:Te,lvl:10,rarity:30,hpRate:-2,mpRate:0,str:35,dex:40,con:30,int:25,spd:50,dmgBase:1,acBase:0,dropNum:1,matDropRate:0,material:_r,atkType:tt,skillProb:.1,skill:{a:{id:hl,lvl:1},b:{id:dl,lvl:1}},starter:[{type:"missile",tabId:Hm,matBase:en,matId:mo},{type:"melee",tabId:Dm,matBase:Jr,matId:Go,side:"a"},{type:"cloak",tabId:ac,matBase:Wr,matId:Mn},{type:"helm",tabId:oc,matBase:Wr,matId:In},{type:"ammo",tabId:Fc}],desc:{a:"",b:"伝令使エウメデスの子、トロイア人。ギリシャ軍の偵察任務を買って出たが捕らわれる。尋問の後、懇願するもディオメデスにより殺される。"}},{name:{a:"Pandarus, the Archer of Troy",b:"トロイアの射手パンダロス"},symbol:"p",color:Dt.bronze,race:je,mod:Pe,grade:Te,lvl:22,rarity:30,hpRate:0,mpRate:0,str:50,dex:100,con:50,int:50,spd:50,dmgBase:1,acBase:0,dexSus:!0,dropNum:2,matDropRate:0,material:_r,atkType:tt,starter:[{type:"missile",tabId:Hm,uniqueId:0},{type:"ammo",tabId:Fc},{type:"melee",tabId:Dm,matBase:Jr,matId:Go,side:"a"},{type:"armor",tabId:Qm,matBase:Jr,matId:Go}],skillProb:1/8,skill:{a:{id:hl,lvl:1},b:{id:xl,lvl:1}},desc:{a:"",b:"ゼレイア王リュカオンの子。メネラウスに急所を射る矢を放つも、アテネにより防がれ、同じく庇護を受けたディオメデスの槍で息絶える。"}},{name:{a:"Nestor, the Knight of Gerenia",b:"ゲレニアの騎士ネストル"},symbol:"p",color:Dt.bronze,race:je,mod:Pe,grade:Te,lvl:29,rarity:30,hpRate:2,mpRate:0,str:100,dex:100,con:100,int:125,spd:50,dmgBase:1,acBase:0,ias:50,strSus:!0,dexSus:!0,conSus:!0,dropNum:2,matDropRate:0,material:_r,atkType:tt,skillProb:1/6,skill:{a:{id:Tl,lvl:5},b:{id:gs,lvl:5}},starter:[{type:"melee",tabId:Am,matBase:Jr,matId:Go},{type:"melee",tabId:Dm,matBase:Jr,matId:Go,side:"a"},{type:"shield",tabId:_m,matBase:Jr,matId:Uo,magic:!0},{type:"armor",tabId:Qm,matBase:Jr,matId:Go},{type:"cloak",tabId:sc,matBase:Hr,matId:ln},{type:"belt",tabId:lc,matBase:Hr,matId:ln},{type:"helm",tabId:mc,matBase:Jr,matId:Go},{type:"boots",tabId:yc,matBase:Hr,matId:ln}],desc:{a:"",b:"ネレウスの子、ピュロスの王、ギリシャ軍の武将。老齢期にトロイア戦争に参加、助言・相談役を果たす。"}},{name:{a:"Orlando, the Frenzy",b:"狂乱のオルランド"},symbol:"p",color:Dt.orange,race:je,mod:Pe,grade:Te,lvl:32,rarity:30,hpRate:6,mpRate:0,str:150,dex:100,con:150,int:1,spd:100,dmgBase:50,acBase:50,ias:100,frw:100,strSus:!0,dexSus:!0,conSus:!0,awake:!0,dropNum:4,matDropRate:0,material:_r,atkType:tt,desc:{a:"",b:"シャルルマーニュの甥、聖騎士。思い人のアンジェリカが他妻となり発狂。その怪力で自身の鎧ごと衣服を引き裂き、分別なく暴れ狂う。"}}],quadrupeds:[{name:{a:"Boar",b:"猪"},symbol:"q",color:Dt.brown,race:Ue,mod:De,grade:Te,lvl:2,rarity:0,hpRate:-8,mpRate:0,str:5,dex:5,con:10,int:5,spd:0,dmgBase:20,acBase:25,dropNum:0,matDropRate:2,material:Wr,atkType:tt,grow:Ge},{name:{a:"Horse",b:"馬"},symbol:"q",color:Dt.orange,race:Ue,mod:De,grade:Te,lvl:3,rarity:0,hpRate:-9,mpRate:0,str:10,dex:15,con:5,int:5,spd:0,dmgBase:15,acBase:25,frw:100,dropNum:0,matDropRate:2,material:Ur,atkType:tt,grow:Ve},{name:{a:"Rays of the Sun, the Horse of Rhesus",b:"トラキア王レソスの馬 `陽光の矢`"},symbol:"q",color:Dt.white,race:Ue,mod:Pe,grade:Te,lvl:12,rarity:30,hpRate:0,mpRate:0,str:25,dex:35,con:25,int:25,spd:50,dmgBase:30,acBase:100,frw:100,dropNum:2,matDropRate:0,material:Ur,atkType:tt,desc:{a:"",b:"トラキア産の駿馬。大型で、雪よりも白く、走る速さは風にも劣らない。トロイア軍から奪った際、ネストルはこの馬を見て感嘆し、陽光の矢と評する。"}},{name:{a:"Calydonian Boar",b:"カリュドーンの大猪"},symbol:"q",color:Dt.brown,race:Ue,mod:Pe,grade:Te,lvl:23,rarity:30,hpRate:2,mpRate:0,str:100,dex:50,con:100,int:50,spd:25,dmgBase:150,acBase:100,frw:50,matDropRate:0,dropNum:2,material:Wr,atkType:tt,skillProb:1/6,skill:{a:{id:Tl,lvl:5}},desc:{a:"",b:"女神アルテミスがカリュドーンの町に放った大猪。辺り一帯を荒すが、青年期のネストルを含む勇士達により討伐される。"}}],skeletons:[{name:{a:"Skeleton",b:"スケルトン"},symbol:"s",color:null,race:_e,mod:De,grade:Te,lvl:3,rarity:0,hpRate:-9,mpRate:0,str:5,dex:5,con:5,int:5,spd:0,dmgBase:null,acBase:null,piece:!0,volumeRate:1,dropNum:0,matDropRate:3,material:_r,atkType:tt}],worms:[{name:{a:"Giant Worm",b:"大芋虫"},symbol:"w",color:Dt.white,race:Ue,mod:De,grade:Te,lvl:1,rarity:0,hpRate:-15,mpRate:0,str:1,dex:1,con:1,int:1,spd:-100,dmgBase:null,acBase:null,atkSlow:20,group:!0,piece:!0,volumeRate:.5,dropNum:0,matDropRate:3,material:Hr,atkType:tt}],zombies:[{name:{a:"Living Bush",b:"生ける繁み"},symbol:"z",color:Dt.gray,race:_e,mod:De,grade:Te,lvl:5,rarity:0,hpRate:-8,mpRate:0,str:1,dex:1,con:1,int:1,spd:-100,dmgBase:null,acBase:null,atkInf:20,group:!0,piece:!0,volumeRate:.5,dropNum:0,matDropRate:3,material:en,atkType:tt}],angels:[{name:{a:"Fallen Angel",b:"堕天使"},symbol:"A",color:Dt.shadow,race:Ye,mod:De,grade:Te,lvl:28,rarity:0,hpRate:2,mpRate:2,str:50,dex:50,con:50,int:100,spd:50,dmgBase:100,acBase:150,air:50,levi:!0,dropNum:2,matDropRate:1,material:jr,atkType:tt,skillProb:.2,skill:{a:{id:Ja,lvl:10},b:{id:gs,lvl:10},c:{id:Sl,lvl:10}}}],birds:[{name:{a:"Eagle",b:"鷲"},symbol:"B",color:Dt.shadow,race:Ue,mod:De,grade:Te,lvl:1,rarity:0,hpRate:-10,mpRate:0,str:1,dex:20,con:1,int:5,spd:50,dmgBase:15,acBase:5,air:30,levi:!0,dropNum:0,matDropRate:2,material:jr,atkType:et,grow:Ve},{name:{a:"Aedon, the Nightingale",b:"夜鶯アエドン"},symbol:"B",color:Dt.yellowgreen,race:Ue,mod:Pe,grade:Te,lvl:15,rarity:30,hpRate:-6,mpRate:0,str:25,dex:50,con:50,int:25,spd:100,dmgBase:25,acBase:50,air:30,levi:!0,awake:!0,dropNum:3,matDropRate:0,material:jr,atkType:Qe|et,skillProb:1/8,skill:{a:{id:Ll,lvl:5},b:{id:bs,lvl:5}},desc:{a:"",b:"パンダレオスの娘。ニオベに多くの子がいる事を妬み、子の殺害を試みるが、自身の子を誤って殺害。悲しみに泣き暮れる様をゼウスが夜鶯の姿に変化させる。"}},{name:{a:"Nisos, the White-tailed Eagle",b:"尾白鷲ニソス"},symbol:"B",color:Dt.shadow,race:Ue,mod:Pe,grade:Te,lvl:27,rarity:30,hpRate:-6,mpRate:0,str:50,dex:100,con:50,int:50,spd:50,dmgBase:100,acBase:50,air:30,ias:25,levi:!0,dropNum:4,matDropRate:0,material:jr,atkType:Qe|et,skillProb:1/6,skill:{a:{id:gl,lvl:10}},desc:{a:"",b:"メガラの王。娘スキュラが敵将に恋慕し、父を殺し国を差し出すも拒まれ、海に飛び込む。その後鳥の姿となるが、同じく大鷲と化した父ニソスが復讐を狙う。"}}],chimeras:[{name:{a:"Chimera",b:"キメラ"},symbol:"C",color:null,race:Ue,mod:De,grade:Te,lvl:12,rarity:0,hpRate:-5,mpRate:0,str:25,dex:25,con:25,int:25,spd:50,dmgBase:null,acBase:null,piece:!0,volumeRate:1,dropNum:1,matDropRate:2,material:Ur,atkType:et}],dragons:[{name:{a:"Dragon",b:"竜"},symbol:"D",color:Dt.green,race:Ze,mod:ze,grade:Te,lvl:24,rarity:0,hpRate:4,mpRate:0,str:40,dex:40,con:40,int:40,spd:25,dmgBase:60,acBase:200,fire:10,water:10,air:10,earth:10,poison:10,dropNum:4,matDropRate:1,material:Yr|_r|tn,matMain:Yr,atkType:Qe|et|tt,grow:Ge},{name:{a:"Dragon, the Never-sleeping",b:"眠らずの竜"},symbol:"D",color:Dt.green,race:Ze,mod:Pe,grade:Te,lvl:28,rarity:30,hpRate:4,mpRate:1,str:150,dex:100,con:150,int:50,spd:50,dmgBase:200,acBase:250,fire:10,water:10,air:10,earth:10,poison:45,conSus:!0,awake:!0,dropNum:6,matDropRate:0,material:Yr,atkType:Qe|et|tt,skillProb:.2,skill:{a:{id:Ml,lvl:10}},desc:{a:"",b:"神ヘルメスがもたらした金羊毛を守護する。メデイアの魔法薬により、眠らないとされるこの竜が昏睡し、その間にイアソンは金羊毛を奪取する。"}}],elementals:[{name:{a:"Elemental",b:"精霊"},symbol:"E",color:Dt.white,race:Ke,mod:Ce,grade:Te,lvl:5,rarity:0,hpRate:-8,mpRate:1,str:1,dex:1,con:1,int:25,spd:0,dmgBase:15,acBase:25,fire:20,water:20,air:20,earth:20,poison:20,moveRnd:!0,dropNum:0,matDropRate:3,atkType:Qe,skillProb:.2}],fairies:[{name:{a:"Fairy",b:"妖精"},symbol:"F",color:Dt.lime,race:Ke,mod:De,grade:Te,lvl:6,rarity:0,hpRate:-6,mpRate:0,str:1,dex:25,con:1,int:15,spd:50,dmgBase:1,acBase:25,atkStealGold:25,fire:10,water:10,air:10,earth:10,poison:10,levi:!0,moveRnd:!0,dropNum:0,matDropRate:2,material:jr,atkType:Qe,grow:Ve}],ghosts:[{name:{a:"Phantom",b:"亡者"},symbol:"G",color:Dt.skyblue,race:_e,mod:De,grade:Te,lvl:15,rarity:0,hpRate:-8,mpRate:0,str:15,dex:35,con:10,int:15,spd:0,dmgBase:25,acBase:5,levi:!0,invisible:!0,moveRnd:!0,dropNum:0,matDropRate:2,atkType:tt}],hybrids:[{name:{a:"Snake Woman",b:"蛇女"},symbol:"H",color:Dt.green,race:je|Ue,mod:De,grade:Te,lvl:8,rarity:0,hpRate:-7,mpRate:0,str:20,dex:20,con:20,int:10,spd:0,dmgBase:20,acBase:50,poison:30,atkCon:20,dropNum:1,matDropRate:2,material:Yr,atkType:tt},{name:{a:"Harpy",b:"ハーピー"},symbol:"H",color:Dt.skyblue,race:je|Ue,mod:De,grade:Te,lvl:9,rarity:0,hpRate:-7,mpRate:0,str:10,dex:30,con:10,int:10,spd:25,dmgBase:20,acBase:80,air:30,levi:!0,dropNum:1,matDropRate:2,material:jr,atkType:Qe|et,grow:Ve,skillProb:.1,skill:{a:{id:bs,lvl:5}}},{name:{a:"Centaur",b:"ケンタウロス"},symbol:"H",color:Dt.yellow,race:je|Ue,mod:De,grade:Te,lvl:23,rarity:0,hpRate:2,mpRate:0,str:40,dex:75,con:50,int:25,spd:25,dmgBase:70,acBase:100,frw:75,dexSus:!0,dropNum:3,matDropRate:1,material:_r,atkType:tt,grow:Ve,starter:[{type:"missile",tabId:Hm},{type:"ammo",tabId:Fc}]},{name:{a:"Minotaur",b:"ミノタウロス"},symbol:"H",color:Dt.orange,race:je|Ue,mod:De,grade:Te,lvl:27,rarity:0,hpRate:2,mpRate:0,str:150,dex:75,con:75,int:15,spd:0,dmgBase:120,acBase:100,strSus:!0,dropNum:3,matDropRate:1,material:_r|tn,matMain:tn,atkType:tt,grow:Fe,starter:[{type:"melee",tabId:Tm}]}],nymphs:[{name:{a:"Nymph",b:"ニンフ"},symbol:"N",color:Dt.olive,race:Ke,mod:De,grade:Te,lvl:16,rarity:0,hpRate:-6,mpRate:0,str:10,dex:25,con:15,int:15,spd:0,dmgBase:15,acBase:20,fire:10,water:10,air:10,earth:10,poison:10,atkStealItem:25,moveRnd:!0,dropNum:1,matDropRate:2,atkType:Qe}],snakes:[{name:{a:"Serpent",b:"大蛇"},symbol:"J",color:Dt.purple,race:Ue,mod:De,grade:Te,lvl:3,rarity:0,hpRate:-10,mpRate:0,str:5,dex:10,con:5,int:5,spd:0,dmgBase:15,acBase:30,poison:30,dmgPoison:10,dropNum:0,matDropRate:2,material:Yr,atkType:et},{name:{a:"Amphisbaena,the Serpent of the Two-headed",b:"双頭の大蛇`アンフィスバエナ`"},symbol:"J",color:Dt.purple,race:Ue,mod:Pe,grade:Te,lvl:24,rarity:30,hpRate:-4,mpRate:0,str:80,dex:80,con:50,int:25,spd:50,dmgBase:100,acBase:50,poison:50,dmgPoison:200,dropNum:2,matDropRate:0,material:Yr,atkType:et,skillProb:1/6,skill:{a:{id:Ml,lvl:20}},desc:{a:"",b:"リビアの砂漠に住むという双頭の毒蛇。ペルセウスが切り落とした、メデューサの首から落ちた血液により、この蛇は生まれたという。"}}],multiheads:[{name:{a:"Hydra",b:"ヒュドラ"},symbol:"M",color:Dt.green,race:Ze,mod:De,grade:Te,lvl:29,rarity:0,hpRate:4,mpRate:0,str:200,dex:100,con:200,int:50,spd:0,dmgBase:30,acBase:100,fire:-30,poison:20,hpReg:100,ias:50,dmgPoison:25,dropNum:2,matDropRate:1,material:Yr,atkType:et|tt,grow:Ge,skillProb:1/8,skill:{a:{id:Ml,lvl:10}}},{name:{a:"Scylla, the Sea-monster",b:"海の怪物スキュラ"},symbol:"M",color:Dt.green,race:Ze,mod:Pe,grade:Te,lvl:31,rarity:80,hpRate:4,mpRate:0,str:200,dex:100,con:200,int:50,spd:0,dmgBase:50,acBase:100,fire:-30,poison:20,hpReg:100,ias:100,dmgPoison:25,dropNum:4,matDropRate:0,material:Yr,atkType:et|tt,skillProb:.2,skill:{a:{id:Bl,lvl:10},b:{id:ml,lvl:1}},desc:{a:"",b:"12本の足、6つの頭、3列に並んだ歯を持つ。元は女性であったが、グラウコスの求愛を拒み続け、それを妬んだキルケの毒により怪物に変貌する。"}}],giants:[{name:{a:"Giant",b:"巨人"},symbol:"P",color:Dt.yellow,race:Je,mod:De,grade:Te,lvl:18,rarity:0,hpRate:3,mpRate:0,str:100,dex:15,con:30,int:15,spd:-100,dmgBase:100,acBase:50,earth:50,dropNum:0,matDropRate:1,material:_r,atkType:tt,grow:Ge},{name:{a:"Cyclopes",b:"サイクロプス"},symbol:"P",color:Dt.orange,race:Je,mod:De,grade:Te,lvl:21,rarity:0,hpRate:5,mpRate:0,str:100,dex:50,con:40,int:15,spd:-100,dmgBase:100,acBase:50,earth:50,dropNum:0,matDropRate:1,material:_r,atkType:tt,grow:Ge,starter:[{type:"missile",tabId:Vm},{type:"ammo",tabId:Oc}]},{name:{a:"Polyphemus,the One Eyed Giant",b:"隻眼の巨人ポリュペモス"},symbol:"P",color:Dt.orange,race:Je,mod:Pe,grade:Te,lvl:25,rarity:30,hpRate:5,mpRate:0,str:200,dex:75,
con:200,int:25,spd:-100,dmgBase:300,acBase:50,earth:50,conSus:!0,dropNum:4,matDropRate:0,material:_r,atkType:tt,skillProb:.2,skill:{a:{id:$s,lvl:1},b:{id:ml,lvl:1}},desc:{a:"",b:"神ポセイドンの子、一つ目の巨人。洞窟内に閉じ込められたオデュッセウスは、この巨人が泥酔し寝ている間に、丸太を目に突き立て盲いにし脱出する。"}}],spiders:[{name:{a:"Giant Spider",b:"大蜘蛛"},symbol:"S",color:Dt.gray,race:Ue,mod:De,grade:Te,lvl:11,rarity:0,hpRate:-6,mpRate:0,str:15,dex:25,con:10,int:5,spd:0,dmgBase:25,acBase:60,atkSlow:20,dropNum:0,matDropRate:2,material:Hr,atkType:et},{name:{a:"Giant Scorpion",b:"大サソリ"},symbol:"S",color:Dt.brown,race:Ue,mod:De,grade:Te,lvl:17,rarity:0,hpRate:-5,mpRate:0,str:15,dex:25,con:15,int:5,spd:0,dmgBase:30,acBase:120,atkPara:10,dropNum:0,matDropRate:2,material:Zr,atkType:et}],demons:[{name:{a:"Demon",b:"悪魔"},symbol:"U",color:Dt.gray,race:Ye,mod:De,grade:Te,lvl:22,rarity:0,hpRate:4,mpRate:0,str:50,dex:50,con:50,int:30,spd:0,dmgBase:80,acBase:150,fire:50,dropNum:2,matDropRate:1,material:Ur|tn,matMain:Ur,atkType:Qe|tt,skillProb:1/8,skill:{a:{id:Rl,lvl:10},b:{id:xl,lvl:5}}}],vampires:[{name:{a:"Vampire",b:"吸血鬼"},symbol:"V",color:Dt.gray,race:_e,mod:De,grade:Te,lvl:19,rarity:0,hpRate:0,mpRate:0,str:30,dex:30,con:30,int:30,spd:0,dmgBase:40,acBase:100,fire:-50,stealLife:30,dropNum:2,matDropRate:2,material:_r,atkType:et}],wraiths:[{name:{a:"Wraith",b:"生霊"},symbol:"W",color:Dt.gray,race:_e,mod:De,grade:Te,lvl:25,rarity:0,hpRate:-2,mpRate:0,str:50,dex:50,con:25,int:50,spd:0,dmgBase:50,acBase:100,atkDrain:50,dropNum:2,matDropRate:2,material:Hr|_r,matMain:_r,atkType:et}],statues:[{name:{a:"Trap Statue ",b:"罠像"},symbol:"%",color:null,race:null,mod:De,grade:Te,lvl:10,rarity:0,hpRate:0,mpRate:0,str:1,dex:1,con:1,int:1,spd:0,dmgBase:null,acBase:null,fire:50,water:50,air:50,earth:50,poison:50,stillness:!0,awake:!0,piece:!0,volumeRate:1,dropNum:0,matDropRate:3,material:Qr|Kr,atkType:tt,skillProb:1/8,skill:{a:{id:As,lvl:1}}},{name:{a:"Summon Statue",b:"召喚像"},symbol:"%",color:null,race:null,mod:De,grade:Te,lvl:20,rarity:0,hpRate:0,mpRate:0,str:1,dex:1,con:1,int:1,spd:0,dmgBase:null,acBase:null,fire:50,water:50,air:50,earth:50,poison:50,awake:!0,stillness:!0,piece:!0,skillProb:1/8,dropNum:0,matDropRate:3,material:Qr|Kr,atkType:tt,volumeRate:1,skill:{a:{id:Is,lvl:1}}},{name:{a:"Gargoyle Statue",b:"ガーゴイル像"},symbol:"%",color:null,race:Ye,mod:ze,grade:Te,lvl:30,rarity:30,hpRate:0,mpRate:0,str:50,dex:50,con:50,int:50,spd:0,dmgBase:null,acBase:null,fire:50,water:50,air:50,earth:50,poison:50,stillness:!0,canAttack:!0,awake:!0,piece:!0,volumeRate:1,dropNum:0,matDropRate:2,material:Qr|Kr,atkType:Qe}],misc:[{name:{a:"Rogue",b:"ローグ"},symbol:"@",color:Dt.white,race:je,mod:De,grade:Te,lvl:1,rarity:0,hpRate:0,mpRate:0,str:10,dex:10,con:10,int:10,spd:0,dmgBase:1,acBase:0,acSRate:1,acTRate:1,acBRate:1,awake:!0,dropNum:0,matDropRate:0,atkType:tt,starter:[{type:"melee",tabId:$m,starter:!0},{type:"armor",tabId:Km,starter:!0},{type:"book",tabId:Kh},{type:"book",tabId:ed},{type:"food",tabId:dd,quantity:5},{type:"light",tabId:wc,starter:!0}]},{name:{a:"Yeti",b:"イエティ"},symbol:"Y",color:Dt.white,mod:De,grade:Te,lvl:1,rarity:0,hpRate:0,mpRate:0,str:1,dex:1,con:1,int:1,spd:0,dmgBase:1,acBase:1,acSRate:1,acTRate:1,acBRate:1,dropNum:0,matDropRate:0,atkType:tt},{name:{a:"Beelzebub, the Lord of the Flies",b:"蝿の王ベルゼブブ"},symbol:"U",color:Dt.gray,race:Ye,mod:Pe,grade:Te,boss:!0,lvl:33,rarity:0,hpRate:4,mpRate:5,str:300,dex:300,con:200,int:200,spd:100,dmgBase:150,acBase:300,acSRate:1,acTRate:1,acBRate:1,acRed:50,fire:20,water:20,air:20,earth:20,poison:20,dmgPoison:100,levi:!0,awake:!0,strSus:!0,dexSus:!0,conSus:!0,intSus:!0,dropNum:8,matDropRate:0,atkType:Qe|et|tt,skillProb:1/6,skill:{a:{id:cs,lvl:20},b:{id:Ml,lvl:5},c:{id:Al,lvl:5},d:{id:Gl,lvl:1}},desc:{a:"",b:"地獄の君主、十六の悪魔の指揮官、悪魔達の皇帝。人間を誘惑し嫉妬心を生み出す。しばしばサタンと同一視される。"}}]};{let e={golems:2,statues:1.5,chimeras:1,skeletons:.7,zombies:.5,worms:.2,giants:2,dragons:1.9,multiheads:1.8,demons:1.7,vampires:1.6,incubuses:1.5,angels:1.4,wraiths:1.3,ghosts:1.2,hybrids:1.1,humanoids:1,persons:1,quadrupeds:.9,felines:.8,canines:.8,nymphs:.7,elementals:.7,fairies:.6,birds:.5,snakes:.4,spiders:.3,ants:.2,bats:.1,mimics:1},t=e=>{if(!e.material)return[1,1];let t=e.matMain?e.matMain:e.material,i=Gh.get(t).hRate,a=(1+Vr)/2,s=1+(i-a)/10,l=1-(i-a)/10;return[s,l]};for(let i in rp)if("misc"!==i)for(let a of rp[i])null!==a.acBase&&(a.acTRate=e[i],[a.acSRate,a.acBRate]=t(a))}const np=(()=>{let e=new Map;for(let t in rp)e.set(t,i(0,rp[t].length-1));return e})(),op=Object.keys(rp),hp=class extends _h{constructor(e){if(super(e),this.lvlMax=this.lvl,this.levi=!!this.levi,this.hpSum=0,this.hpReg||(this.hpReg=0),this.hpRegBuff=0,this.mpSum=0,this.mpReg=0,this.mpRegBuff=0,this.strMax=this.str,this.strBonus=0,this.strSus=0,this.dexMax=this.dex,this.dexBonus=0,this.dexSus=0,this.conMax=this.con,this.conBonus=0,this.conSus=0,this.intMax=this.int,this.intBonus=0,this.intSus=0,this.spdMax=this.spd,this.spdBuff=0,this.spdNerf=0,this.spdBuffDur=0,this.spdNerfDur=0,this.mf=0,this.mfBuff=0,this.gf=0,this.gfBuff=0,this.expBonus=0,this.atkBare=this.atkType,this.dmgBare=this.dmgBase,this.dmgBonus=0,this.dmgBuff=0,this.digging=0,this.dmgHuman=0,this.dmgDemon=0,this.dmgAnimal=0,this.dmgDragon=0,this.dmgUndead=0,this.dmgGiant=0,this.dmgSpirit=0,this.dmgGod=0,this.dmgFire=0,this.dmgLightning=0,this.dmgPoison||(this.dmgPoison=0),this.dmgAcid||(this.dmgAcid=0),this.dmgMinBonus=0,this.dmgMaxBonus=0,this.atkCon||(this.atkCon=0),this.atkPara||(this.atkPara=0),this.atkSlow||(this.atkSlow=0),this.atkInf||(this.atkInf=0),this.atkBlind||(this.atkBlind=0),this.atkRadi||(this.atkRadi=0),this.atkCold||(this.atkCold=0),this.atkDrain||(this.atkDrain=0),this.atkStealGold||(this.atkStealGold=0),this.atkStealItem||(this.atkStealItem=0),this.rateBonus=0,this.rateBuff=0,this.acBonus||(this.acBonus=0),this.acSValueSum=0,this.acTValueSum=0,this.acBValueSum=0,this.acSBaseSum=0,this.acTBaseSum=0,this.acBBaseSum=0,this.acSBase=this.getAcVar(this.acBase*this.acSRate,Qe),this.acTBase=this.getAcVar(this.acBase*this.acTRate,et),this.acBBase=this.getAcVar(this.acBase*this.acBRate,tt),this.acBuff=0,this.acRed||(this.acRed=0),this.iasBase=0,this.fcrBase=0,this.frwBase=0,this.ias||(this.ias=0),this.fcr||(this.fcr=0),this.frw||(this.frw=0),this.pack={},this.fire||(this.fire=0),this.water||(this.water=0),this.air||(this.air=0),this.earth||(this.earth=0),this.poison||(this.poison=0),this.fireMax=this.fire,this.fireBuff=0,this.waterMax=this.water,this.waterBuff=0,this.airMax=this.air,this.airBuff=0,this.earthMax=this.earth,this.earthBuff=0,this.poisonMax=this.poison,this.poisonBuff=0,this.lowerRes=0,this.physicalBuff=0,this.physicalBuffDur=0,this.physicalNerf=0,this.physicalNerfDur=0,this.statPoints=0,this.skillPoints=0,this.skillFire=0,this.skillWater=0,this.skillAir=0,this.skillEarth=0,this.skillPoison=0,this.skillAll=0,this.cost=ce,this.invisible&&(this.invisible=le),this.teleported=0,this.aggravating=0,this.stealth=0,this.digest=0,this.searching=0,this.lighten=0,this.stealLife||(this.stealLife=0),this.stealMana||(this.stealMana=0),this.healCount=0,this.totalWeight=0,this.side={a:null,b:null},this.swapped=!1,this.numBoxes=0,this.initSynerzy(),this.equipment={},this.race&(je|Je))for(let e in xt)this.equipment[xt[e]]=null;if(this.starter){this.eqt={},this.numBoxes=G,this.boxes={};for(let e=1;e<=this.numBoxes;e++)this.boxes[e]=null}this.sleeping=0,this.paralyzed=0,this.confused=0,this.blinded=0,this.hallucinated=0,this.canceled=0,this.infected=0,this.poisoned=0,this.expBuff=0,this.seeInvisible=0,this.invisibility=0,this.ecco=0,this.enchantSelfDur=0,this.venomDur=0,this.confusing=0}initSynerzy(){this.synerzyMelee=0,this.synerzyMissile=0,this.synerzyFire=0,this.synerzyWater=0,this.synerzyAir=0,this.synerzyEarth=0,this.synerzyPoison=0}gainExp(e,t){let i;for(this.exp+=Math.floor(e*(t?1:1+this.expBonus/100)),this.exp>this.expMax&&(this.expMax=this.exp);(this.id===re&&this.lvl<C||this.id!==re)&&this.exp>=Vt(this.lvl+1);)++this.lvl<=this.lvlMax||(this.lvlMax=this.lvl,i=!0,pr.playSound("level"),this.skillPoints++,this.id===re?(Na.draw(Pt.isEnglish()?`Welcome to level ${this.lvl}`:`レベル${this.lvl}へようこそ`),this.statPoints+=5):this.gainStats());i&&(this.expGain=this.getExp(),this.expNext=this.calcNextLvl(),this.calcHP(),this.calcMP(),this.hp=this.hpMax,this.mp=this.mpMax)}getExp(){let e=Vt(this.lvl+1)-Vt(this.lvl);return this.mod===Pe?e/=this.boss?1:2:e/=50,this.group&&(e/=10),this.race&Ze?e*=3:this.race&Je&&(e*=2),this.mod===Ce?e*=4:this.mod===ze&&(e*=2),this.expRate&&(e*=this.expRate),Math.ceil(e)}calcNextLvl(){return this.lvl>=C?0:Vt(this.lvl+1)}calcHP(){this.hpMax=(this.lvl-1+this.con)*(this.hpRate+ye)+this.hpSum,this.hpMax<1&&(this.hpMax=1),this.hp>this.hpMax&&(this.hp=this.hpMax)}calcMP(){this.mpMax=(this.lvl-1+this.int)*(this.mpRate+ke)+this.mpSum,this.mpMax<1&&(this.mpMax=1),this.mp>this.mpMax&&(this.mp=this.mpMax)}calcDmg(e){let t=0,i=0,a=0,s=0,l=Math.ceil(this.dmgBase+this.str/2);this.dmgSBase=this.atkType&Qe?jt.getBase(l,Et.get(Qe)):0,this.dmgTBase=this.atkType&et?jt.getBase(l,Et.get(et)):0,this.dmgBBase=this.atkType&tt?jt.getBase(l,Et.get(tt)):0,this.dmgSValue=this.dmgTValue=this.dmgBValue=0,this.dmgSBase&&([this.dmgSValue,t]=this.getDmgMinMax(this.dmgSBase),s++),this.dmgTBase&&([this.dmgTValue,i]=this.getDmgMinMax(this.dmgTBase),s++),this.dmgBBase&&([this.dmgBValue,a]=this.getDmgMinMax(this.dmgBBase),s++),this.dmgAvg=Math.floor((t+i+a)/s);let r=this.equipment.main,n=r?3-r.weight:0;this.id===re&&n<0&&10*n+this.str<0&&(n=-1e3,e&&Na.draw(Na.get(Ca))),this.rateValue=Math.floor((20*this.dex+100*n)*(1+this.rateBonus/100)*(1+this.rateBuff/100)),this.rateValue<1&&(this.rateValue=1);let o=Math.floor(5*(1+this.iasBase/100)*this.ias),h=Math.floor(5*(1+this.fcrBase/100)*this.fcr),d=2*this.str,m=2*this.dex,c=2*this.int;this.spdMelee=o<d?o:d,this.spdMissile=o<m?o:m,this.spdSpell=h<c?h:c;let p=ce/2;this.spdMelee>p&&(this.spdMelee=p),this.spdMissile>p&&(this.spdMissile=p),this.spdSpell>p&&(this.spdSpell=p),this.spdMeleeRate=Math.floor(this.spdMelee/ce*100),this.spdMissileRate=Math.floor(this.spdMissile/ce*100),this.spdSpellRate=Math.floor(this.spdSpell/ce*100),this.timesMelee=Math.floor(this.spdMelee/100)+1,this.timesMissile=Math.floor(this.spdMissile/100)+1,this.timesMelee>5&&(this.timesMelee=5),this.timesMissile>5&&(this.timesMissile=5)}getDmgMinMax(e){let[t,i]=jt.getNums(e,this.dmgMinBonus,this.dmgMaxBonus),a=1+this.dmgBonus/100,s=1+this.dmgBuff/100;t*=a*s,i*=a*s;let l=Math.floor(t)+"-"+Math.floor(i),r=(t+i)/2;return[l,r]}calcMoveTimes(){this.spdMove=Math.floor(5*(1+this.frwBase/100)*this.frw);let e=ce/2;this.spdMove>e&&(this.spdMove=e),this.spdMoveRate=Math.floor(this.spdMove/ce*100)}calcAc(){let e=1+this.acBonus/100,t=this.acBonus/100,i=1+this.acBuff/100;this.acSValue=this.acSBase*e+this.dex,this.acSBonusValue=this.acSBaseSum*t,this.acSValueTotal=Math.floor((this.acSValue+this.acSBonusValue+this.acSValueSum)*i),this.acSValueTotal<0&&(this.acSValueTotal=0),this.acTValue=this.acTBase*e+this.dex,this.acTBonusValue=this.acTBaseSum*t,this.acTValueTotal=Math.floor((this.acTValue+this.acTBonusValue+this.acTValueSum)*i),this.acTValueTotal<0&&(this.acTValueTotal=0),this.acBValue=this.acBBase*e+this.dex,this.acBBonusValue=this.acBBaseSum*t,this.acBValueTotal=Math.floor((this.acBValue+this.acBBonusValue+this.acBValueSum)*i),this.acBValueTotal<0&&(this.acBValueTotal=0),this.acAvgValueTotal=Math.floor((this.acSValueTotal+this.acTValueTotal+this.acBValueTotal)/3)}calcAttack(e,t,i,a,s){let l,r,n,o;r=a?a.atkType?a.atkType:tt:this.atkType,[n,o]=this.getEnemyAc(r,e);let h=Math.floor(this.rateValue/(this.rateValue+n)*100);h>95&&(h=95),h<5&&(h=5);let d=0;if(!Jt(h))return[d,h,o];let m=0;a?(l=a.dmgBase,l&&(l=jt.getBase(Math.ceil(l+this.str/2),Et.get(o))),a.dmgBonus&&(m=a.dmgBonus)):(l=o===Qe?this.dmgSBase:o===et?this.dmgTBase:o===tt?this.dmgBBase:null,s&&s.dmgBonus&&(m=s.dmgBonus)),l||(l="1-2"),e.race&&(m+=this.getRaceBoost(e.race)),e.material===Qr&&(m+=this.digging),t&&(m+=this.calcSkillValue(t,i)),d=this.getDmg(l,this.dmgMinBonus,this.dmgMaxBonus,this.dmgBonus,this.dmgBuff,m);let c=d,p=t?t.element:"physical";return d*=1-e[p]/100,this.dmgFire&&(d+=c*(this.dmgFire/100)*(1-e.fire/100)),this.dmgLightning&&(d+=c*(this.dmgLightning/100)*(1-e.lightning/100)),this.dmgPoison&&(d+=c*(this.dmgPoison/100)*(1-e.poison/100)),this.dmgAcid&&(d+=c*(this.dmgAcid/100)*(1-e.acid/100)),d=d<1?1:Math.floor(d),[d,h,o]}getDmg(e,t=0,i=0,a=0,s=0,l=0){return jt.roll(e,t,i)*(1+a/100)*(1+s/100)*(1+l/100)}getEnemyAc(e,t){let i,a=NaN;return e&Qe&&!(a<=t.acSValueTotal)&&(a=t.acSValueTotal,i=Qe),e&et&&!(a<=t.acTValueTotal)&&(a=t.acTValueTotal,i=et),e&tt&&!(a<=t.acBValueTotal)&&(a=t.acBValueTotal,i=tt),[a,i]}getRaceBoost(e){let t=0;return e&je&&(t+=this.dmgHuman),e&Ue&&(t+=this.dmgAnimal),e&Ye&&(t+=this.dmgDemon),e&_e&&(t+=this.dmgUndead),e&Ze&&(t+=this.dmgDragon),e&Je&&(t+=this.dmgGiant),e&Ke&&(t+=this.dmgSpirit),e&Xe&&(t+=this.dmgGod),t}attack({enemy:e,missile:t,skill:i,lvl:a,itemThrown:s}){let l,r,n,o=e.getName(),h=Pt.isEnglish(),d=0;s?l=s.getName(!1,1):t?(n=this.ci,l=n.getName(!1,1)):i?(l=i.name[Pt.getLanguage()],"missile"===i.type&&(n=this.ci)):(l=h?this.getName(!0):this.getName()+"の",r=!0);let m=h&&(s||t||i||this.id!==re);do{let c,p,[u,g,b]=i&&"spell"===i.type?[this.calcSkillValue(i,a,e),100,null]:this.calcAttack(e,i,a,s,n),f=l,y=!u||e.indestructible||this.id!==re&&e.boss;if(r?(p=this.getAttackTypeName(b,h,m),h||(f+=p)):h&&(p="hit"+(m?"s":"")),y?(c=h?"miss":"外れた",m&&(c+="es")):(c=h?p:`${u}のダメージを与えた`,e.hp-=u),t||s){let t=n||s,i=y||t.indestructible||Jt(50);this.deleteAmmo(t,i,e.x,e.y)}let k=h?`${f} ${c} ${o}`+(y?"":" by "+u):`${f}は${o}に${c}`;if($t.isWizard&&(k+=h?` (hit rating ${g})`:` (命中率 ${g})`),Na.draw(k),d++,(qt.dash||qt.rest)&&(qt.dash=qt.rest=!1),!i||"spell"!==i.type){if(!u)continue;if(this.stealLife){let e=this.stealLife>100?1:this.stealLife/100;this.hp+=Math.ceil(u*e),this.hp>this.hpMax&&(this.hp=this.hpMax)}if(this.stealMana){let t=this.stealMana>100?1:this.stealMana/100,i=Math.ceil(u*t);i>e.mp&&(i=e.mp),e.mod!==Pe&&(e.mp-=i),this.mp+=i,this.mp>this.mpMax&&(this.mp=this.mpMax)}this.dmgFire&&this.getElementEffect("fire",1,e),this.dmgLightning&&this.getElementEffect("lightning",1,e),this.dmgPoison&&this.getElementEffect("poison",1,e),this.dmgAcid&&this.getElementEffect("acid",1,e),this.cursed&&Jt(50-(e.lvl-this.lvl))&&e.gotCursed(),this.atkCon&&Jt(this.atkCon)&&this.haveCast(Fs,1,e),this.atkPara&&Jt(this.atkPara)&&this.haveCast(Gs,1,e),this.atkSlow&&Jt(this.atkSlow)&&this.haveCast(Ts,10,e),this.atkInf&&Jt(this.atkInf)&&this.haveCast(al,1,e),this.atkBlind&&Jt(this.atkBlind)&&this.haveCast(Ws,1,e),this.atkRadi&&Jt(this.atkRadi)&&this.haveCast(_l,1,e),this.atkCold&&Jt(this.atkCold)&&this.haveCast(Zl,1,e),this.atkDrain&&Jt(this.atkDrain-(e.lvl-this.lvl))&&e.decayOrRestore(We,!1,this.expGain,this),i||t||this.confused||(this.atkStealGold&&Jt(this.atkStealGold)&&this.stealGold(e)&&(d=NaN),d&&this.atkStealItem&&Jt(this.atkStealItem)&&this.stealItem(e)&&(d=NaN))}if(s||i&&"spell"===i.type||this.decreaseDurab(!0)&&(d=NaN),e.decreaseDurab(),i&&i.effect&&(e.hp>0&&!y||i.effect.self)&&Jt(i.effect.prob)&&this.haveCast(i.effect.id,a,e),e.hp<=0){e.died(this);break}if(e.sleeping&&e.wakeUp(),this.id===re&&this.getCe(e,!t&&!i),i&&this.getElementEffect(i.element,a,e),i||s)break}while(t&&this.timesMissile>d&&n.quantity>d||!t&&this.timesMelee>d)}getAttackTypeName(e,t,i){let a;return e===Qe?a=t?"slash":"斬撃":e===et?a=t?"thrust":"刺突":e===tt&&(a=t?"beat":"打撃"),i&&(a=li(a,!0)),a}dig(e){let t;this.atkType&et?t=3:this.atkType&Qe?t=2:this.atkType&tt&&(t=1),this.digging&&(t*=10*(1+this.digging/100)),e.indestructible||(e.wall-=t),this.decreaseDurab(!0),pr.playSound("dig"),e.wall<=0&&(e.deleteWall(!0),$t.lightenOrDarken("Lighten"))}getElementEffect(e,t,i){let a;switch(e){case"fire":case"lightning":case"acid":return void i.decreaseDurab(!1,e);case"poison":a=Os;break;case"sand":case"light":a=Ws;break;case"cold":case"blizzard":a=Zl;break;case"infection":a=al;break;case"gravity":a=Ts;break;case"radiation":a=_l}a&&this.haveCast(a,t,i)}calcSkillValue(e,t,i,a){let s,l=qt.skill&&e.synerzy?this.getSynerzy(e):0,r=i?i[e.element]:0,n=e.rate*t+e.synerzy*l;if("breath"===e.kind)s=this.hp*ge*(1+n/100);else if(isFinite(e.base))s=e.base+n;else{let t=a?jt.getAvg(e.base):jt.roll(e.base);s=t*(1+n/100)}let o=e.limit;return o&&s>o&&(s=o),Math.ceil(s*(1-r/100))}calcSkillDur(e,t,i){let a=i?jt.getAvg(e.durBase):jt.roll(e.durBase);return a+e.durRate*t}calcResist(){this.fireSum=this.fireMax+this.fireBuff+this.lowerRes,this.waterSum=this.waterMax+this.waterBuff+this.lowerRes,this.airSum=this.airMax+this.airBuff+this.lowerRes,this.earthSum=this.earthMax+this.earthBuff+this.lowerRes,this.poisonSum=this.poisonMax+this.poisonBuff+this.lowerRes;let e=this.fireSum>=100?100:this.fireSum,t=this.waterSum>=100?100:this.waterSum,i=this.airSum>=100?100:this.airSum,a=this.earthSum>=100?100:this.earthSum,s=this.poisonSum>=100?100:this.poisonSum,l=75;this.fire=e>=l?l:e,this.water=t>=l?l:t,this.air=i>=l?l:i,this.earth=a>=l?l:a,this.poison=s>=l?l:s,this.light=Math.floor(e/2),this.cold=Math.floor(t/2),this.lightning=Math.floor(i/2),this.gravity=Math.floor(a/2),this.infection=Math.floor(s/2),this.sand=Math.floor(a/4+i/4),this.blizzard=Math.floor(t/4+i/4),this.acid=Math.floor(t/4+s/4),this.magma=Math.floor(e/4+a/4),this.radiation=Math.floor(e/4+s/4),this.physicalMax=Math.floor(a/4+this.acRed),this.physical=Math.floor(this.physicalMax+this.physicalBuff+this.physicalNerf),this.physical>l&&(this.physical=l)}getSkillBoost(e){let t=0;switch(e.element){case"fire":case"light":t=this.skillFire;break;case"water":case"cold":t=this.skillWater;break;case"air":case"lightning":t=this.skillAir;break;case"earth":case"gravity":t=this.skillEarth;break;case"poison":case"infection":t=this.skillPoison;break;case"sand":t=this.skillEarth+this.skillAir;break;case"blizzard":t=this.skillWater+this.skillAir;break;case"acid":t=this.skillWater+this.skillPoison;break;case"magma":t=this.skillFire+this.skillEarth;break;case"radiation":t=this.skillFire+this.skillPoison}return t+=this.skillAll,Math.floor(t)}getSynerzy(e){let t=0;if("melee"===e.type)t=this.synerzyMelee;else if("missile"===e.type)t=this.synerzyMissile;else switch(e.element){case"fire":case"light":t=this.synerzyFire;break;case"water":case"cold":t=this.synerzyWater;break;case"air":case"lightning":t=this.synerzyAir;break;case"earth":case"gravity":t=this.synerzyEarth;break;case"poison":case"infection":t=this.synerzyPoison;break;case"sand":t=this.synerzyAir+this.synerzyEarth;break;case"blizzard":t=this.synerzyWater+this.synerzyAir;break;case"acid":t=this.synerzyWater+this.synerzyPoison;break;case"magma":t=this.synerzyFire+this.synerzyEarth;break;case"radiation":t=this.synerzyFire+this.synerzyPoison}return Math.floor(t)}calcWeightLimit(){this.weightLimit=25+3*this.str/5,this.weightLimit>ae&&(this.weightLimit=ae),this.calcSpeed()}calcSpeed(){this.totalWeight=Math.round(100*this.totalWeight)/100,this.spd=this.spdMax+this.spdBuff+this.spdNerf-(this.totalWeight>this.weightLimit?10*Math.ceil(this.totalWeight-this.weightLimit):0),this.spd>100&&(this.spd=100)}calcCondition(){let e,t=this.getName(!0),i=this.mod===Pe?5:1;if(this.poisoned){if(this.indestructible||(this.hp-=Math.floor(this.poisonedVal*(1-this.poison/100))),this.hp<=0){let e;return this.poisonedId&&this.poisonedId!==this.id&&(e=this.poisonedId===re?$t:vr.enemyList[this.poisonedId]),this.poisonedId=0,this.died(e),null}this.poisoned-=i,this.poisoned<=0&&(this.poisoned=0,Na.draw(Pt.isEnglish()?`${t} recovered from poison`:`${t}毒状態から復帰した`)),(qt.dash||qt.rest)&&(qt.dash=qt.rest=!1)}if(this.confused&&(this.confused-=i,this.confused<=0&&(this.confused=0,this.id!==re&&this.removeCe(),Na.draw(Pt.isEnglish()?`${t} recovered from confusion`:`${t}混乱状態から復帰した`))),this.paralyzed&&(this.paralyzed-=i,this.paralyzed<=0&&(this.paralyzed=0,Na.draw(Pt.isEnglish()?`${t} recovered from paralysis`:`${t}麻痺状態から復帰した`))),this.sleeping>0&&(this.sleeping-=i,this.sleeping<=0&&(this.sleeping=0,this.wakeUp())),this.blinded&&(this.blinded-=i,this.blinded<=0&&(this.blinded=0,this.id===re?this.goBlind(!0):this.removeCe(),Na.draw(Pt.isEnglish()?`${t} recovered from blindness`:`${t}盲目状態から復帰した`))),this.infected>0&&(this.infected-=i,Zt()&&this.decayOrRestore(),this.infected<=0&&(this.infected=0,Na.draw(Pt.isEnglish()?`${t} recovered from infection`:`${t}感染状態から復帰した`))),this.hallucinated&&(this.hallucinated-=i,this.hallucinated<=0&&(this.hallucinated=0,this.id===re?xr.all(!0):this.removeCe(),Na.draw(Pt.isEnglish()?`${t} recovered from hallucination`:`${t}幻覚状態から復帰した`))),this.canceled&&(this.canceled-=i,this.canceled<=0&&(this.canceled=0,Na.draw(Pt.isEnglish()?`${t} recovered from cancellation`:`${t}封印状態から復帰した`))),this.seeInvisible>0&&0==--this.seeInvisible&&(Na.draw(Pt.isEnglish()?`${t} can no longer see invisible things`:`${t}もう透明な物体を見ることが出来なくなった`),wr(!1)),this.invisibility&&0==--this.invisibility&&(this.invisible=!1),this.ecco&&0==--this.ecco&&Na.draw(Pt.isEnglish()?`${t} lost the effect of Ecco`:`${t}エコーの効果を失った`),this.enchantSelfDur&&0==--this.enchantSelfDur&&(this.dmgBonus-=this.enchantSelf,this.rateBonus-=this.enchantSelf,this.acBonus-=this.enchantSelf,this.ias-=this.enchantSelf,this.enchantSelf=0,this.calcDmg(),this.calcAc(),Na.draw(Pt.isEnglish()?`${t} lost the effect of Enchant Self`:`${t}自己強化の効果を失った`)),this.venomDur&&0==--this.venomDur&&(this.dmgPoison-=this.venom,this.venom=0,Na.draw(Pt.isEnglish()?`${t} lost the effect of Venom Hands`:`${t}猛毒の手の効果を失った`)),this.confusing&&0==--this.confusing){this.atkCon=0;let e=this.getName(!0);Na.draw(Pt.isEnglish()?`${e} lost the effect of Touch of Confusion`:`${e}混乱の手の効果を失った`)}this.spdBuffDur&&(this.spdBuffDur-=i,this.spdBuffDur<=0&&(this.spdBuffDur=0,this.spdBuff=0,this.calcSpeed())),this.spdNerfDur&&0==--this.spdNerfDur&&(this.spdNerf=0,this.calcSpeed()),this.hpRegBuffDur&&0==--this.hpRegBuffDur&&(this.hpReg-=this.hpRegBuff,this.hpRegBuff=0,Na.draw(Pt.isEnglish()?`${t} lost the effect of Life Regeneration`:`${t}再生の効果を失った`)),this.mpRegBuffDur&&0==--this.mpRegBuffDur&&(this.mpReg-=this.mpRegBuff,this.mpRegBuff=0,Na.draw(Pt.isEnglish()?`${t} lost the effect of Mana Regeneration`:`${t}魔力再生の効果を失った`)),this.mfBuffDur&&0==--this.mfBuffDur&&(this.mf-=this.mfBuff,this.mfBuff=0,Na.draw(Pt.isEnglish()?`${t} lost the effect of Magic Finding`:`${t}魔法具探求の効果を失った`)),this.gfBuffDur&&0==--this.gfBuffDur&&(this.gf-=this.gfBuff,this.gfBuff=0,Na.draw(Pt.isEnglish()?`${t} lost the effect of Gold Finding`:`${t}財宝探求の効果を失った`)),this.expBuffDur&&0==--this.expBuffDur&&(this.expBonus-=this.expBuff,this.expBuff=0,Na.draw(Pt.isEnglish()?`${t} lost the effect of Experience`:`${t}経験の効果を失った`)),this.skillBuffDur&&0==--this.skillBuffDur&&(this.skillAll-=this.skillBuff,this.skillBuff=0,Na.draw(Pt.isEnglish()?`${t} lost the effect of Skill`:`${t}スキルの効果を失った`)),this.fireBuffDur&&0==--this.fireBuffDur&&(this.fireBuff=0,Na.draw(Pt.isEnglish()?`${t} lost the effect of Resist Fire`:`${t}耐火の効果を失った`),e=!0),this.waterBuffDur&&0==--this.waterBuffDur&&(this.waterBuff=0,Na.draw(Pt.isEnglish()?`${t} lost the effect of Resist Water`:`${t}耐水の効果を失った`),e=!0),this.airBuffDur&&0==--this.airBuffDur&&(this.airBuff=0,Na.draw(Pt.isEnglish()?`${t} lost the effect of Resist Air`:`${t}耐風の効果を失った`),e=!0),this.earthBuffDur&&0==--this.earthBuffDur&&(this.earthBuff=0,Na.draw(Pt.isEnglish()?`${t} lost the effect of Resist Earth`:`${t}耐土の効果を失った`),e=!0),this.poisonBuffDur&&0==--this.poisonBuffDur&&(this.poisonBuff=0,Na.draw(Pt.isEnglish()?`${t} lost the effect of Resist Poison`:`${t}耐毒の効果を失った`),e=!0),this.physicalBuffDur&&0==--this.physicalBuffDur&&(this.physicalBuff=0,Na.draw(Pt.isEnglish()?`${t} lost the effect of Resist Physical`:`${t}耐物の効果を失った`),e=!0),this.lowerResDur&&(this.lowerResDur-=i,this.lowerResDur<=0&&(this.lowerResDur=0,this.lowerRes=0,Na.draw(Pt.isEnglish()?`${t} recovered from the effect of Lower Resist`:`${t}耐性低下の効果から復帰した`),e=!0)),e&&this.calcResist(),this.dmgBuffDur&&(0==--this.dmgBuffDur&&(this.dmgBuff=this.rateBuff=0,Na.draw(Pt.isEnglish()?`${t} lost the effect of Combat`:`${t}戦闘の効果を失った`)),this.calcDmg()),this.acBuffDur&&(0==--this.acBuffDur&&(this.acBuff=0,Na.draw(Pt.isEnglish()?`${t} lost the effect of Armor`:`${t}防護の効果を失った`)),this.calcAc()),this.stuckTrap&&0==--this.stuckTrap&&Na.draw(Pt.isEnglish()?`${t} can move again`:`${t}動けるようになった`),this.teleported&&Jt(this.teleported)&&this.haveCast(dl,10,this)}decayOrRestore(e,t,i,a){let s=this.getName(!0);switch(e>=0?e:Yt(3)){case Fe:if(t)this.str<this.strMax&&(Na.draw(Pt.isEnglish()?`${s} restored the strength`:`${s}筋力が元に戻った`),this.str=this.strMax);else{if(this.strSus||!(this.str-this.strBonus))return;this.str-=_t(1,5),this.str-this.strBonus<0&&(this.str=this.strBonus),Na.draw(Pt.isEnglish()?`${s} got weak`:`${s}薄弱になった`)}this.calcWeightLimit(),this.calcDmg();break;case Ve:if(t)this.dex<this.dexMax&&(Na.draw(Pt.isEnglish()?`${s} restored the dexterity`:`${s}器用さが元に戻った`),this.dex=this.dexMax);else{if(this.dexSus||!(this.dex-this.dexBonus))return;this.dex-=_t(1,5),this.dex-this.dexBonus<0&&(this.dex=this.dexBonus),Na.draw(Pt.isEnglish()?`${s} got clumsy`:`${s}不器用になった`)}this.calcAc(),this.calcDmg();break;case Ge:if(t)this.con<this.conMax&&(Na.draw(Pt.isEnglish()?`${s} restored the constitution`:`${s}耐久力が元に戻った`),this.con=this.conMax);else{if(this.conSus||!(this.con-this.conBonus))return;this.con-=_t(1,5),this.con-this.conBonus<0&&(this.con=this.conBonus),Na.draw(Pt.isEnglish()?`${s} got sick`:`${s}病弱になった`)}this.calcHP();break;case He:if(t)this.int<this.intMax&&(Na.draw(Pt.isEnglish()?`${s} restored the intelligence`:`${s}知力が元に戻った`),this.int=this.intMax);else{if(this.intSus||!(this.int-this.intBonus))return;this.int-=_t(1,5),this.int-this.intBonus<0&&(this.int=this.intBonus),Na.draw(Pt.isEnglish()?`${s} got stupid`:`${s}愚鈍になった`)}this.calcMP();break;case We:if(t)this.exp<this.expMax&&(Na.draw(Pt.isEnglish()?`${s} restored the experience`:`${s}経験値が元に戻った`),this.exp=this.expMax,this.lvl=this.lvlMax);else{if(!this.exp||Jt(2*this.con/5))return;for(i>this.exp&&(i=this.exp),this.exp-=i,a&&(a.exp+=i,a.exp>a.expMax&&(a.exp=a.expMax));this.exp<Vt(this.lvl);)this.lvl--;Na.draw(Pt.isEnglish()?`${s} got poor`:`${s}貧弱になった`)}this.calcHP(),this.calcMP(),t||(this.hp>this.hpMax&&(this.hp=this.hpMax),this.mp>this.mpMax&&(this.mp=this.mpMax))}}heal(){5==this.healCount++&&(!this.poisoned&&this.hp<this.hpMax&&(this.hp+=Math.ceil(this.hpMax*(this.con/10+this.hpReg)/1e3),this.hp>this.hpMax&&(this.hp=this.hpMax)),this.mp<this.mpMax&&(this.mp+=Math.ceil(this.mpMax*(this.int/10+this.mpReg)/1e3),this.mp>this.mpMax&&(this.mp=this.mpMax)),this.healCount=0)}drawOrErase(e,t){let i=vr.coords[this.x][this.y];i.fighter=e?this:null,this.id===re&&e&&(this.lightenOrDarken("Lighten",t),this.distMap=kr.main({x0:this.x,y0:this.y,map:!0}))}lightenOrDarken(e,t,i){br.main({x0:this.x,y0:this.y,radius:J,type:e,lightRad:this.lighten,search:t})}replace(e){this.drawOrErase(!1),e.drawOrErase(!1),[this.x,this.y,e.x,e.y]=[e.x,e.y,this.x,this.y],this.drawOrErase(!0),e.drawOrErase(!0),this.id===re?vr.coords[this.x][this.y].traces=++this.numSteps:e.id===re&&(vr.coords[e.x][e.y].traces=++e.numSteps)}showInventory(e,t){let i,a,s;switch(e){case xe:i=this.pack,a=lt;break;case Re:i=vr.coords[this.x][this.y].item,a=lt;break;case Se:i=this.boxes,a=it;break;case Me:case Le:s=vr.coords[this.x][this.y].enter,i=s.list,a=it;break;case qe:i=this.cube,a=it;break;case Be:return void this.equipmentList(xt[t])}Fr.show({list:i,dr:a,a:t,place:e,enter:s})}equipmentList(e){Fr.showEquipment(this,e)}showSkill(e,t){Fr.showSkill(this,e,t)}findBuffStat(e){let t;switch(e){case"dmgAvg":case"dmgSValue":case"dmgTValue":case"dmgBValue":this.dmgBuff&&(t=!0);break;case"rateValue":this.rateBuff&&(t=!0);break;case"acAvgValueTotal":case"acSValueTotal":case"acTValueTotal":case"acBValueTotal":this.acBuff&&(t=!0);break;case"fire":this.fireBuff&&(t=!0);break;case"water":this.waterBuff&&(t=!0);break;case"air":this.airBuff&&(t=!0);break;case"earth":this.earthBuff&&(t=!0);break;case"poison":this.poisonBuff&&(t=!0);break;case"physical":this.physicalBuff&&(t=!0);break;case"spd":this.spdBuff&&(t=!0);break;case"hpReg":this.hpRegBuff&&(t=!0);break;case"mpReg":this.mpRegBuff&&(t=!0);break;case"mf":this.mfBuff&&(t=!0);break;case"gf":this.gfBuff&&(t=!0);break;case"skillAll":this.skillBuff&&(t=!0);break;case"dmgPoison":this.venom&&(t=!0);break;case"atkCon":this.confusing&&(t=!0);break;case"expBonus":this.expBuff&&(t=!0);break;case"dmgPoison":this.venom&&(t=!0);case"dmgBonus":case"rateBonus":case"acBonus":case"ias":this.enchantSelf&&(t=!0)}return t}deletePackItem(e,t){let i=this.pack[e];this.gainOrloseWeight(i,t),i.quantity-=t,i.quantity||si(this.pack,e)}inventoryOut(e,t){let i;switch(e.place){case xe:i=this.pack;break;case Se:i=this.boxes;break;case Be:i=this.equipment;break;case Re:i=vr.coords[e.x][e.y].item}return e=e.split(t,i),e.place===Re?(e.id=-1,e.x=e.y=0,$t.hallucinated&&xr.undoOne(e)):this.gainOrloseWeight(e,t),e.place===Be&&e.durab&&(this.getOrLooseStats(e),this.calcAll()),e}gainOrloseWeight(e,t=e.quantity,i){this.totalWeight+=e.weight*t*(i?1:-1),this.calcSpeed()}deleteBoxItem(e,t){let i=this.boxes[e];i.quantity-=t,this.gainOrloseWeight(i,t),i.quantity||(this.boxes[e]=null)}deleteEquipment(e,t){let i=this.equipment[e];i.quantity-=t,this.gainOrloseWeight(i,t),i.quantity||(this.equipment[e]=null,i.durab&&(this.getOrLooseStats(i,!1),this.calcAll()))}stashAdd(e,t){t.place=Le;let i=this.canCarryItem(e,t);if(i>=0)return e[i].quantity+=t.quantity,i;let a=e.length;return e[a]=t,Fr.sort(a,e,!0)}packAdd(e){if(!qt.pack&&this.numBoxes&&this.listAdd(this.boxes,e))return e.place=Se,!0;if(this.listAdd(this.pack,e))return e.place=xe,!0;let t=Object.keys(this.pack).length;return t<M?(e.place=xe,this.pack[vt[t]]=e,Fr.sort(vt[t],this.pack),this.gainOrloseWeight(e,e.quantity,!0),!0):(e.putDown(this.x,this.y,!0),!1)}boxAdd(e,t){let i=this.boxes[t];i?i.equal(e)?i.quantity+=e.quantity:(e.place=Se,i=this.inventoryOut(i,i.quantity),this.packAdd(i),this.boxes[t]=e):(e.place=Se,this.boxes[t]=e),this.gainOrloseWeight(e,e.quantity,!0)}listAdd(e,t){let i=this.canCarryItem(e,t);return void 0!==i&&(e[i].quantity+=t.quantity,this.gainOrloseWeight(t,t.quantity,!0)),i}canCarryItem(e,t){let i;for(let a in e){let s=e[a];if(s&&(s.equal(t)&&(i=a),i))break}return i}createItemIntoPack({uniqueId:e,starter:t,magic:i,lvl:a,times:s=1,type:l=ne,tabId:r=ne,quantity:n=1}){for(let o=0;o<s;o++)this.packAdd(cp.item({type:l,tabId:r,quantity:n,position:Ie,magic:i,lvl:a,uniqueId:e,starter:t}))}getOrLooseStats(e,t,i,a){let s=t?1:-1;i&&(e.cursed&&(this.cursed=e.cursed),e.invisible&&(this.invisible=e.invisible)),e.dmgMinBonus&&(this.dmgMinBonus+=s*e.dmgMinBonus),e.dmgMaxBonus&&(this.dmgMaxBonus+=s*e.dmgMaxBonus),!e.acBonus||!i&&e.armor||(this.acBonus+=s*e.acBonus),e.atkType&&(this.atkType=t?e.atkType:this.atkBare),e.dmgBase&&(this.dmgBase=t?e.dmgBase:this.dmgBare),e.acSBase&&(this.acSBaseSum+=s*e.acSBase),e.acTBase&&(this.acTBaseSum+=s*e.acTBase),e.acBBase&&(this.acBBaseSum+=s*e.acBBase),e.dmgBonus&&(this.dmgBonus+=s*e.dmgBonus),e.rateBonus&&(this.rateBonus+=s*e.rateBonus),e.acSValue&&(this.acSValueSum+=s*e.acSValue),e.acTValue&&(this.acTValueSum+=s*e.acTValue),e.acBValue&&(this.acBValueSum+=s*e.acBValue),e.acRed&&(this.acRed+=s*e.acRed),e.str&&(this.str+=s*e.str,this.strMax+=s*e.str,this.strBonus+=s*e.str),e.dex&&(this.dex+=s*e.dex,this.dexMax+=s*e.dex,this.dexBonus+=s*e.dex),e.con&&(this.con+=s*e.con,this.conMax+=s*e.con,this.conBonus+=s*e.con),e.int&&(this.int+=s*e.int,this.intMax+=s*e.int,this.intBonus+=s*e.int),e.spd&&(this.spd+=s*e.spd,this.spdMax+=s*e.spd),e.mf&&(this.mf+=s*e.mf),e.gf&&(this.gf+=s*e.gf),e.hp&&(this.hpSum+=s*e.hp),e.mp&&(this.mpSum+=s*e.mp),e.hpRate&&(this.hpRate+=s*e.hpRate),e.mpRate&&(this.mpRate+=s*e.mpRate),e.fire&&(this.fireMax+=s*e.fire),e.water&&(this.waterMax+=s*e.water),e.air&&(this.airMax+=s*e.air),e.earth&&(this.earthMax+=s*e.earth),e.poison&&(this.poisonMax+=s*e.poison),e.resistAll&&(this.fireMax+=s*e.resistAll,this.waterMax+=s*e.resistAll,this.airMax+=s*e.resistAll,this.earthMax+=s*e.resistAll,
this.poisonMax+=s*e.resistAll),e.skillFire&&(this.skillFire+=s*e.skillFire),e.skillWater&&(this.skillWater+=s*e.skillWater),e.skillAir&&(this.skillAir+=s*e.skillAir),e.skillEarth&&(this.skillEarth+=s*e.skillEarth),e.skillPoison&&(this.skillPoison+=s*e.skillPoison),e.skillAll&&(this.skillAll+=s*e.skillAll),e.iasBase&&(this.iasBase+=s*e.iasBase),e.ias&&(this.ias+=s*e.ias),e.fcrBase&&(this.fcrBase+=s*e.fcrBase),e.frwBase&&(this.frwBase+=s*e.frwBase),e.fcr&&(this.fcr+=s*e.fcr),e.frw&&(this.frw+=s*e.frw),e.hpReg&&(this.hpReg+=s*e.hpReg),e.mpReg&&(this.mpReg+=s*e.mpReg),e.digest&&(this.digest+=s*e.digest),e.stealth&&(this.stealth+=s*e.stealth),e.searching&&(this.searching+=s*e.searching),e.levi&&(this.levi+=s*e.levi),e.teleported&&(this.teleported+=s*e.teleported),e.aggravating&&(this.aggravating+=s*e.aggravating),e.strSus&&(this.strSus+=s*e.strSus),e.dexSus&&(this.dexSus+=s*e.dexSus),e.conSus&&(this.conSus+=s*e.conSus),e.intSus&&(this.intSus+=s*e.intSus),e.digging&&(this.digging+=s*e.digging),e.dmgHuman&&(this.dmgHuman+=s*e.dmgHuman),e.dmgDemon&&(this.dmgDemon+=s*e.dmgDemon),e.dmgAnimal&&(this.dmgAnimal+=s*e.dmgAnimal),e.dmgDragon&&(this.dmgDragon+=s*e.dmgDragon),e.dmgUndead&&(this.dmgUndead+=s*e.dmgUndead),e.dmgGiant&&(this.dmgGiant+=s*e.dmgGiant),e.dmgSpirit&&(this.dmgSpirit+=s*e.dmgSpirit),e.dmgGod&&(this.dmgGod+=s*e.dmgGod),e.dmgFire&&(this.dmgFire+=s*e.dmgFire),e.dmgLightning&&(this.dmgLightning+=s*e.dmgLightning),e.dmgPoison&&(this.dmgPoison+=s*e.dmgPoison),e.dmgAcid&&(this.dmgAcid+=s*e.dmgAcid),e.stealLife&&(this.stealLife+=s*e.stealLife),e.stealMana&&(this.stealMana+=s*e.stealMana),e.atkCon&&(this.atkCon+=s*e.atkCon),e.atkPara&&(this.atkPara+=s*e.atkPara),e.atkSlow&&(this.atkSlow+=s*e.atkSlow),e.atkInf&&(this.atkInf+=s*e.atkInf),e.atkBlind&&(this.atkBlind+=s*e.atkBlind),e.atkRadi&&(this.atkRadi+=s*e.atkRadi),e.atkCold&&(this.atkCold+=s*e.atkCold),e.atkDrain&&(this.atkDrain+=s*e.atkDrain),e.atkStealGold&&(this.atkStealGold+=s*e.atkStealGold),e.atkStealItem&&(this.atkStealItem+=s*e.atkStealItem),e.expBonus&&(this.expBonus+=s*e.expBonus),e.lighten&&(!i&&e.fuelValue||i)&&(this.lighten+=s*e.lighten,i||a||this.lightenOrDarken("Lighten")),e.numBoxes&&(t?this.getBoxes(e.numBoxes):this.looseBoxes(e.numBoxes),this.numBoxes+=s*e.numBoxes)}getBoxes(e){let t=this.numBoxes+1;if(!(t>V)){for(let i=t;i<=this.numBoxes+e&&i<=V;i++){this.id===re?Vue.set(At.rogue.boxes,i,null):this.boxes[i]=null;let e=this.eqt[i];e&&(this.boxAdd(e,i),delete this.eqt[i])}if(Object.keys(this.eqt).length){for(let e in this.eqt){let t=this.eqt[e];this.packAdd(t)||t.dropped()}this.eqt={}}}}looseBoxes(e){let t=this.numBoxes-e+1;if(!(t>V))for(let e=t;e<=this.numBoxes&&e<=V;e++){let t=this.boxes[e];this.id===re?Vue.delete(At.rogue.boxes,e):delete this.boxes[e],t&&(this.gainOrloseWeight(t,t.quantity),qt.equip?this.eqt[e]=t:this.packAdd(t)||t.dropped())}}calcAll(e){this.calcHP(),this.calcMP(),this.calcWeightLimit(),this.calcDmg(e),this.calcAc(),this.calcResist(),this.calcMoveTimes()}haveCast(e,t,i=this,a,s){let l,r=i.getName(!0),n=i.boss,o=rr.get(e);if(o){if("attack"===o.kind||"breath"===o.kind)return void this.attack({enemy:i,skill:o,lvl:t});o.durBase&&(l=this.calcSkillDur(o,t))}switch(e){case Ja:case Ka:{let a=this.calcSkillValue(o,t),s=i.hpMax-i.hp;a>s&&(a=s),i.hp+=a,Na.draw(Pt.isEnglish()?`${r} got well (+${a})`:`${r}傷が癒えた(+${a})`),i.poisoned=0,i.confused=0,i.blinded&&(i.blinded=0,this.goBlind(!0)),e===Ka&&(i.infected=0,i.hallucinated&&(i.hallucinated=0,i.id===re&&xr.all(!0)));break}case Xa:case ar:{let e=this.calcSkillValue(o,t),a=i.mpMax-i.mp;e>a&&(e=a),i.mp+=e;break}case sr:{let e=this.calcSkillValue(o,t),a=Math.ceil(i.hpMax*e/100),s=Math.ceil(i.mpMax*e/100),l=i.hpMax-i.hp,r=i.mpMax-i.mp;a>l&&(a=l),s>r&&(s=r),i.hp+=a,i.mp+=s;break}case Qa:i.hpReg-=i.hpRegBuff,i.hpRegBuff=this.calcSkillValue(o,t),i.hpReg+=i.hpRegBuff,i.hpRegBuffDur=l,Na.draw(Pt.isEnglish()?`${r} got an effect of Life Regeneration`:`${r}再生の効果を得た`);break;case es:i.mpReg-=i.mpRegBuff,i.mpRegBuff=this.calcSkillValue(o,t),i.mpReg+=i.mpRegBuff,i.mpRegBuffDur=l,Na.draw(Pt.isEnglish()?`${r} got an effect of Mana Regeneration`:`${r}魔力再生の効果を得た`);break;case Xs:if(n||Jt(i.poison))return;i.decayOrRestore(Fe);break;case Qs:if(n||Jt(i.poison))return;i.decayOrRestore(Ve);break;case el:if(n||Jt(i.poison))return;i.decayOrRestore(Ge);break;case tl:if(n||Jt(i.poison))return;i.decayOrRestore(He);break;case ts:i.decayOrRestore(Fe,!0);break;case is:i.decayOrRestore(Ve,!0);break;case as:i.decayOrRestore(Ge,!0);break;case ss:i.decayOrRestore(He,!0);break;case Jl:i.decayOrRestore(We,!0);break;case ls:i.decayOrRestore(Fe,!0),i.decayOrRestore(Ve,!0),i.decayOrRestore(Ge,!0),i.decayOrRestore(He,!0),i.decayOrRestore(We,!0);break;case rs:i.confused=i.canceled=i.poisoned=i.infected=i.paralyzed=i.sleeping=0,i.blinded&&(i.blinded=0,i.id===re&&i.goBlind(!0)),i.hallucinated&&(i.hallucinated=0,i.id===re&&xr.all(!0)),i.spdNerfDur&&(i.spdNerfDur=0,i.spdNerf=0,i.calcSpeed());break;case ja:i.fireBuff=this.calcSkillValue(o,t),i.fireBuffDur=l,Na.draw(Pt.isEnglish()?`${r} got an effect of Resist Fire`:`${r}耐火の効果を得た`),i.calcResist();break;case ns:i.waterBuff=this.calcSkillValue(o,t),i.waterBuffDur=l,Na.draw(Pt.isEnglish()?`${r} got an effect of Resist Water`:`${r}耐水の効果を得た`),i.calcResist();break;case fs:i.airBuff=this.calcSkillValue(o,t),i.airBuffDur=l,Na.draw(Pt.isEnglish()?`${r} got an effect of Resist Air`:`${r}耐風の効果を得た`),i.calcResist();break;case zs:i.earthBuff=this.calcSkillValue(o,t),i.earthBuffDur=l,Na.draw(Pt.isEnglish()?`${r} got an effect of Resist Earth`:`${r}耐土の効果を得た`),i.calcResist();break;case il:i.poisonBuff=this.calcSkillValue(o,t),i.poisonBuffDur=l,Na.draw(Pt.isEnglish()?`${r} got an effect of Resist Poison`:`${r}耐毒の効果を得た`),i.calcResist();break;case os:i.fireBuff=i.waterBuff=i.airBuff=i.earthBuff=i.poisonBuff=this.calcSkillValue(o,t),i.fireBuffDur=i.waterBuffDur=i.airBuffDur=i.earthBuffDur=i.poisonBuffDur=l,Na.draw(Pt.isEnglish()?`${r} got an effect of Resist All`:`${r}全耐性の効果を得た`),i.calcResist();break;case lr:i.physicalBuff=this.calcSkillValue(o,t),i.physicalBuffDur=l,Na.draw(Pt.isEnglish()?`${r} got an effect of Resist Physical`:`${r}耐物の効果を得た`),i.calcResist();break;case Ks:if(Jt(i.poison))return;i.lowerRes=this.calcSkillValue(o,t),i.lowerResDur=l,Na.draw(Pt.isEnglish()?`${r} got an effect of Lower Resist`:`${r}耐性低下の効果を受けた`),i.calcResist();break;case ks:if(i.id!==re)return;vr.lighten();break;case Ps:return Fr.clear(),gp.eventFlag(88),qt.wormhole=!0,null;case hl:i.teleport(!0);break;case dl:i.teleport(!1,Q);break;case cl:i.teleport(!1,this.calcSkillValue(o,t)**2);break;case ml:i.teleport(!1,!1,this.x,this.y);break;case Wa:for(let e in i.equipment){let t=i.equipment[e];t&&t.cursed&&t.uncurse()}break;case Rs:{gp.switchFlag(),qt.identify=!0;let e=Na.get(ki)+Na.get(ui);return this.showInventory(xe),this.equipmentList(),Na.draw(e,!0),null}case pl:return gp.switchFlag(),qt.disint=!0,Na.draw(Na.get(vi),!0),null;case Ds:{gp.switchFlag(),qt.repair=!0;let e=Na.get(wi)+Na.get(ui);return this.showInventory(xe),this.equipmentList(),Na.draw(e,!0),null}case Kl:this.repairAll();break;case Ua:br.main({x0:this.x,y0:this.y,radius:this.calcSkillValue(o,t),type:"Light"}),$t.lightenOrDarken("Lighten");break;case Ms:pr.playSound("probe");case Bs:case Ls:case bs:ur.main({x0:this.x,y0:this.y,type:e,radius:this.calcSkillValue(o,t)}),e===Ls&&pr.playSound("probe2");break;case Ql:{let i=this.calcSkillValue(o,t);ur.main({x0:this.x,y0:this.y,type:e,radius:o.radius,perc:i}),vr.drawShadow(),$t.litMapIds={},$t.lightenOrDarken("Lighten");break}case qs:i.hunger+=$*this.calcSkillValue(o,t)/100,i.hunger>$&&(i.hunger=$);break;case Cs:{let e=new Er;e.init(Ee,this.x,this.y),Na.draw(Pt.isEnglish()?"Created a Town Portal":"タウン・ポータルを生成した");break}case gs:i.spdBuff=this.calcSkillValue(o,t),i.spdBuffDur=l,i.calcSpeed(),Na.draw(Pt.isEnglish()?`${r} speeded up`:`${r}加速した`),pr.playSound("speed");break;case Vl:i.ecco=l,Na.draw(Pt.isEnglish()?`${r} got an effect of Ecco`:`${r}エコーの効果を得た`);break;case Os:{if(Jt(i.poison))return;let e=this.calcSkillValue(o,t);i.poisonedVal=e,i.poisoned=l,i.poisonedId=this.id,Na.draw(Pt.isEnglish()?`${r} got poisoned(-${e})`:`${r}毒を受けた(-${e})`);break}case _l:if(n||Jt(i.radiation))return;i.decayOrRestore();break;case Ts:case Ns:if(n||Jt(i.gravity))return;i.spdNerf=this.calcSkillValue(o,t),i.spdNerfDur=l,i.calcSpeed(),Na.draw(Pt.isEnglish()?`${r} slowed down`:`${r}減速した`),pr.playSound("slow");break;case Fs:if(n||Jt(i.poison))return;i.confused=l,Na.draw(Pt.isEnglish()?`${r} got confused`:`${r}混乱した`);break;case Vs:i.atkCon=this.calcSkillValue(o,t),i.confusing=l,Na.draw(Pt.isEnglish()?`${r} got an effect of Touch of Confusion`:`${r}混乱の手の効果を得た`);break;case Wl:i.venom&&(i.dmgPoison-=i.venom),i.venom=this.calcSkillValue(o,t),i.dmgPoison+=i.venom,i.venomDur=l,Na.draw(Pt.isEnglish()?`${r} got an effect of Venom Hands`:`${r}猛毒の手の効果を得た`);break;case Xl:i.enchantSelf&&(i.dmgBonus-=i.enchantSelf,i.rateBonus-=i.enchantSelf,i.acBonus-=i.enchantSelf,i.ias-=i.enchantSelf),i.enchantSelf=this.calcSkillValue(o,t),i.enchantSelfDur=l,i.dmgBonus+=i.enchantSelf,i.rateBonus+=i.enchantSelf,i.acBonus+=i.enchantSelf,i.ias+=i.enchantSelf,i.calcDmg(),i.calcAc(),Na.draw(Pt.isEnglish()?`${r} got an effect of Enchant Self`:`${r}自己強化の効果を得た`);break;case Gs:case Zs:if(n||Jt(i.poison))return;i.paralyzed=l,Na.draw(Pt.isEnglish()?`${r} got paralyzed`:`${r}麻痺した`),pr.playSound("paralyze");break;case Hs:case _s:if(n||Jt(i.poison))return;i.sleeping=l,Na.draw(Pt.isEnglish()?`${r} fell asleep`:`${r}昏睡した`);break;case Ws:if(n||Jt(i.poison))return;i.blinded=l,i.id===re&&i.goBlind(),Na.draw(Pt.isEnglish()?`${r} got blinded`:`${r}盲目になった`),pr.playSound("blind");break;case _a:if(n||i.invisible)return;i.invisibility=l,i.invisible=!0;break;case Ya:i.seeInvisible=l,i.id===re&&wr(!0),Na.draw(Pt.isEnglish()?`${r} can see invisible things`:`${r}透明の物体が見えるようになった`),i.blinded&&(i.blinded=0,i.id===re&&i.goBlind(!0));break;case al:if(n||Jt(i.infection))return;i.infected=l,Na.draw(Pt.isEnglish()?`${r} got infected`:`${r}感染した`);break;case js:case Js:{if(n||Jt(i.poison))return;let e;i.hallucinated||i.id!==re||(e=!0),i.hallucinated=l,i.id!==re&&i.removeCe(),e&&xr.all(),Na.draw(Pt.isEnglish()?`${r} got hallucinated`:`${r}幻覚状態になった`),pr.playSound("hallucinate");break}case Us:{if(i.id===re||i.mod===Pe||Jt(i.poison))return;let[e,t]=[i.x,i.y];i.died(),cp.enemy({position:Ee,x:e,y:t,summon:!0,noGroup:!0}),Na.draw(Pt.isEnglish()?`${r} got polymorphed`:`${r}変容した`);break}case Ys:if(n||Jt(i.poison))return;i.canceled=l*(i.mod!==Pe?1:2),i.invisible&&(i.invisible!==le&&(i.invisibility=0),i.invisible=!1),i.mimic&&!i.identified&&(xr.undoOne(i),i.identified=!0),Na.draw(Pt.isEnglish()?`${r} got canceled`:`${r}封印された`);break;case hs:i.lvl!==C&&i.gainExp(Vt(i.lvl+1)-i.exp,!0);break;case Is:case Gl:case $s:{let t;e===Is||e===Gl?t=ne:e===$s&&(t="giants"),cp.enemy({times:_t(1,3),type:t,position:Ee,x:this.x,y:this.y,summon:!0,magic:e===Gl}),pr.playSound("summon");break}case As:cp.trap(5,ne,Ee,this.x,this.y);break;case Za:cp.trap(1,0,Ee,this.x,this.y,!0);break;case vs:i.mf-=i.mfBuff,i.mfBuff=this.calcSkillValue(o,t),i.mf+=i.mfBuff,i.mfBuffDur=l,Na.draw(Pt.isEnglish()?`${r} got an effect of Magic Finding`:`${r}魔法具探求の効果を得た`);break;case ws:i.gf-=i.gfBuff,i.gfBuff=this.calcSkillValue(o,t),i.gf+=i.gfBuff,i.gfBuffDur=l,Na.draw(Pt.isEnglish()?`${r} got an effect of Gold Finding`:`${r}財宝探求の効果を得た`);break;case xs:i.expBuff&&(i.expBonus-=i.expBuff),i.expBuff=this.calcSkillValue(o,t),i.expBonus+=i.expBuff,i.expBuffDur=l,Na.draw(Pt.isEnglish()?`${r} got an effect of Experience`:`${r}経験の効果を得た`);break;case Ss:i.skillBuff&&(i.skillAll-=i.skillBuff),i.skillBuff=this.calcSkillValue(o,t),i.skillAll+=i.skillBuff,i.skillBuffDur=l,Na.draw(Pt.isEnglish()?`${r} got an effect of Skill`:`${r}スキルの効果を得た`);break;case xl:i.dmgBuff=i.rateBuff=this.calcSkillValue(o,t),i.dmgBuffDur=l,Na.draw(Pt.isEnglish()?`${r} got an effect of Combat`:`${r}戦闘の効果を得た`),i.calcDmg(),pr.playSound("encourage");break;case Sl:i.acBuff=this.calcSkillValue(o,t),i.acBuffDur=l,Na.draw(Pt.isEnglish()?`${r} got an effect of Armor`:`${r}守護の効果を得た`),i.calcAc();break;case ds:if(i.mod===Pe)return;i.respec();break;case Zl:case tr:{if(i.cost>2*ce||Jt(i.cold))return;let t=ce*(e===tr?2:1)-5*i.cold;i.mod===Pe&&(t/=5),i.cost+=t;break}case ir:this.cost-=_t(100,300);break;case Es:if(vr.coords[a][s].isObstacle()){let e=vr.coords[a][s];e.wall?e.deleteWall(!0):e.deleteDoor(!0),$t.lightenOrDarken("Lighten"),pr.playSound("dig",Ut(this.x,this.y,a,s))}i.material===Qr&&this.attack({enemy:i,skill:o,lvl:t})}}aim({x1:e,y1:t,nameSkill:i,ecco:a,key:s=null}){if("x"===s)return this.blinded?void Na.draw(Na.get(Mi)):(qt.examine=!0,Rr.init(),void vr.coords[$t.x][$t.y].getInfo());if(null!==s)if("t"===s)[e,t]=[this.x,this.y];else{var l=ti(s);if(null===l)return}let r,n;if(qt.zap){var o=this.ci;this.ci=null,i=o.nameSkill,r=rr.get(i),n=o.skillLvl;let e=o.getName(!1,1);Na.draw(Pt.isEnglish()?`Zapped ${e}`:`${e}を振った`)}else if(qt.skill){i||(i=this.cs.id),r=rr.get(i),n=this.cs.lvl+this.getSkillBoost(r);let e=r.name[Pt.getLanguage()],t=this.getName(!0);this.consumeMana(r),Na.draw(Pt.isEnglish()?`${t} cast ${e}`:"spell"===r.type?`${t}${e}を唱えた`:`${t}${e}を放った`),"missile"===r.type&&pr.playSound("shoot"),pr.playSound(r.element)}else if(qt.scroll)i=this.ci.nameSkill,r=rr.get(i),n=this.ci.skillLvl;else if(qt.throw){let e=this.ci.getName(!1,1);Na.draw(Pt.isEnglish()?`Threw ${e}`:`${e}を投げた`),pr.playSound("throw")}else qt.arrow&&pr.playSound("shoot");let h=qt.arrow||qt.throw;if(qt.zap&&!o.charges)Na.draw(Na.get(qi)),qt.zap=!1;else{let s=!1,g=!1,[b,f]=[this.x,this.y];if(h||0!==r.range){let a,y=!l&&(h||r.parabora),k=!h&&r.range?r.range**2:K;l&&([e,t]=[this.x+l.x*J,this.y+l.y*J]);var[d,m,c,p]=[this.x,this.x,this.y,this.y],u=Math.abs(t-c)>Math.abs(e-d);u&&([d,c,e,t]=[c,d,t,e]);let[v,w]=[Math.abs(e-d),Math.abs(t-c)],x=v/2,S=c<t?1:-1,R=c,B=!0,L=d<e?1:-1;for(let l=d+L;e-l+L;l+=L){if(x-=w,x<0&&(R+=S,x+=v),[b,f]=u?[R,l]:[l,R],a=vr.coords[b][f],Ut(l,R,d,c)>k){B=!1;break}if(!h&&r.each)a.isObstacle()||br.main({x0:b,y0:f,radius:r.radius,type:i,lvl:n,fighter:this});else if((!y||y&&l===e&&R===t)&&a.fighter&&this.isOpponent(a.fighter)){let e=a.fighter;if(g=!0,h){qt.arrow?this.attack({enemy:e,missile:!0}):qt.throw&&this.haveThrown(this.ci,e,b,f);break}if(r.radius?br.main({x0:b,y0:f,radius:r.radius,type:i,lvl:n,fighter:this}):this.haveCast(i,n,e,b,f),!qt.zap||o.identified||r.wall||(s=!0),!r.penetrate)break}if(a.isObstacle()){B=!1;break}[m,p]=[b,f]}B||(!h&&r.wall&&(a.wall&&!a.indestructible||a.isClosedDoor())?(this.haveCast(i,n,void 0,b,f),qt.zap&&!o.identified&&(s=!0)):[b,f]=[m,p])}if(qt.died)return;if(h||!r.radius||g&&!r.penetrate||br.main({x0:b,y0:f,radius:r.radius,type:i,lvl:n,fighter:this}),h)g||this.deleteAmmo(this.ci,!0,b,f),qt.arrow=qt.throw=!1;else if(qt.skill){if(!a&&this.ecco&&this.mp>=r.mp)return u&&([e,t]=[t,e]),void this.aim({x1:e,y1:t,nameSkill:i,ecco:!0});r.move&&(i===gl&&g?this.teleport(!1,!1,m,p,!0):i!==Tl&&i!==Nl&&i!==Ol||this.teleport(!1,!1,b,f,!0)),"missile"===r.type&&this.deleteAmmo(this.ci),qt.skill=!1}else qt.scroll?(qt.aim&&this.deleteItem(this.ci,1),qt.scroll=!1):qt.zap&&(s&&o.identifyWand(),this.reduceItemCharge(o),qt.zap=!1)}this.id===re&&(qt.examine||Rr.clearAll(),Fr.clear(),$t.done=!0,qt.aim=!1,qt.regular=!0)}checkToCast(e){let t,i=!0;return e?this.id!==re||this.haveBook(e.id)?e.mp>this.mp?(t=ha,i=!1):"missile"===e.type?this.haveMissile(!0)?(this.ci=this.getAmmo(this.equipment.main.throwType),this.ci||(t=Si,i=!1)):i=!1:"melee"===e.type&&this.haveMissile()&&(t=da,i=!1):(t=oa,i=!1):this.skill.a?this.canceled?(t=na,i=!1):this.canRead(!0)||(i=!1):(t=ra,i=!1),this.id===re&&t&&Na.draw(Na.get(t)),i}canRead(e){let t=!0;if(this.blinded||this.confused||!$t.litMapIds[this.x+","+this.y]){if(this.id===re){let t=e?fi:bi;Na.draw(Na.get(t))}t=!1}return t}haveBook(e){let t=this.haveBookLoop(this.pack,e);return t||(t=this.haveBookLoop(this.boxes,e)),t}haveBookLoop(e,t){for(let i in e){let a=e[i];if(a&&"book"===a.type&&t&&a.skill)for(let e in a.list)if(a.list[e]===t)return!0}}castSelfSpell(e,t){let i=this.cs.lvl+this.getSkillBoost(e),a=this.getName(!0),s=e.name[Pt.getLanguage()];if(Na.draw(Pt.isEnglish()?`${a} cast ${s}`:"spell"===e.type?`${a}${s}を唱えた`:`${a}${s}を放った`),null===this.haveCast(e.id,i,this))return null;this.consumeMana(e),!t&&this.ecco&&this.mp>=e.mp&&e.id!==Vl&&this.castSelfSpell(e,!0)}searchSkill(e){for(let t in this.skill)if(this.skill[t].id===e)return t;return!1}consumeMana(e){this.cost-=this["spd"+ei(e.type)],this.mp-=e.mp}haveMissile(e){let t=!0;return this.equipment.main&&"missile"===this.equipment.main.type||(e&&Na.draw(Na.get(xi)),t=!1),t}getAmmo(e){let t=this.getAmmoLoop(this.boxes,e);return t||(t=this.getAmmoLoop(this.pack,e)),t||(t=this.getAmmoLoop(vr.coords[this.x][this.y].item,e)),t}getAmmoLoop(e,t){for(let i in e){let a=e[i];if(a&&"ammo"===a.type&&a.throwType===t)return a}return null}deleteAmmo(e,t,i,a){t?(e=this.inventoryOut(e,1),e.putDown(i,a,!0),this.ci=null):this.deleteItem(e,1)}deleteItem(e,t){if(qt.scroll&&(qt.scroll=!1,e.chargeBook))this.reduceItemCharge(e);else{switch(e.place){case xe:this.deletePackItem(e.indexOf(this.pack),t);break;case Se:this.deleteBoxItem(e.indexOf(this.boxes),t);break;case Re:let i=vr.coords[e.x][e.y];i.deleteItem(e.indexOf(i.item),t);break;case Be:this.deleteEquipment(e.indexOf(this.equipment),t)}this.ci=null}}reduceItemCharge(e){e.quantity>1?(e=this.inventoryOut(e,1),e.charges--,e.identified&&e.changePrice(),e.place!==xe&&e.place!==Se||this.packAdd(e)?e.place===Re&&e.putDown(e.x,e.y,!0):e.dropped()):(e.charges--,e.identified&&(e.changePrice(),e.place===xe&&Fr.sort(this.getItemIndex(e),this.pack)))}getItemIndex(e){let t;switch(e.place){case xe:t=e.indexOf(this.pack);break;case Se:t=e.indexOf(this.boxes);break;case Re:let i=vr.coords[e.x][e.y];t=e.indexOf(i.item);break;case Be:t=e.indexOf(this.equipment)}return t}swap(){let e=this.getName(!0);if(this.equipment.main&&this.equipment.main.cursed||this.equipment.off&&this.equipment.off.cursed){let t;return t=this.equipment.main&&this.equipment.main.cursed?Pt.isEnglish()?"unwield":"離す":Pt.isEnglish()?"take off":"外す",Na.draw(Pt.isEnglish()?`${e} can't ${t} the cursed item`:`${e}呪われたアイテムを${t}事が出来ない`),null}let t=this.equipment.main,i=this.equipment.off,a=this.side.a,s=this.side.b;t&&t.durab&&this.getOrLooseStats(t,!1),i&&i.durab&&this.getOrLooseStats(i,!1),a&&a.durab&&this.getOrLooseStats(a,!0),s&&s.durab&&this.getOrLooseStats(s,!0),[this.equipment.main,this.equipment.off,this.side.a,this.side.b]=[a,s,t,i],this.calcAll(),this.swapped=!this.swapped,Na.draw(Pt.isEnglish()?`${e} swapped gear`:`${e}装備を持ち替えた`),pr.playSound("grab"),this.id===re&&($t.done=!0,this.equipmentList(),qt.clearInv=!0)}stealGold(e){if(!e.purse||Jt(2*e.dex/5))return;let t=sp.goldAmount(this.lvl);t<e.purse/50?t=e.purse/50:t>e.purse&&(t=e.purse),t=Math.ceil(t),e.purse-=t,this.createItemIntoPack({type:"coin",tabId:Gc,quantity:t});let i=this.getName(!0);return Na.draw(Pt.isEnglish()?`${i} stole $${t}`:`${i}$${t}を盗んだ`),this.teleport(!1,Q),!0}stealItem(e){if(Jt(2*e.dex/5))return;let t,{pack:a,box:s}=e.haveItem();if(!a&&!s)return;if(a&&s&&(a=Zt(),s=!a),a){let i=vt[Yt(Object.keys(e.pack).length-1)];t=e.pack[i]}else{let a=i(1,e.numBoxes);a.shuffle();for(let i=0;i<e.numBoxes;i++)if(e.boxes[a[i]]){t=e.boxes[a[i]];break}}t=e.inventoryOut(t,1),this.packAdd(t);let l=t.getName(),r=this.getName(!0);return Na.draw(Pt.isEnglish()?`${r} stole ${l}`:`${r}${l}を盗んだ`),this.teleport(!1,Q),!0}haveItem(){let e,t=!!this.pack.a;for(let t in this.boxes)if(this.boxes[t]){e=!0;break}return{pack:t,box:e}}decreaseDurab(e,t){let i,a=this.equipment[e?"main":xt[vt[Yt(D-1)]]];if(!a||!a.durab||a.indestructible)return;if(t){let e;switch(t){case"acid":e=Jr;break;case"fire":e=Hr|Wr|jr|Ur|Yr|en;break;case"lightning":e=_r|Zr|Xr|Qr|tn}a.material&e&&(i=_t(1,5))}else Jt(5)&&(i=1);if(!i)return;if(a.durab-=i,a.durab<0&&(a.durab=0),a.durab)return;this.getOrLooseStats(a),this.calcAll();let s=a.getName();return pr.playSound("broken"),Na.draw(Pt.isEnglish()?`${s} broke`:`${s}は壊れた`),!0}gotCursed(){let e=this.equipment[xt[vt[Yt(D-1)]]];if(!e||e.cursed)return;let t=e.getName();Na.draw(Pt.isEnglish()?`${t} is cursed`:`${t}は呪われた`),e.cursed=!0,pr.playSound("curse")}gainSynerzy(e,t){if("melee"===e.type)this.synerzyMelee+=t;else if("missile"===e.type)this.synerzyMissile+=t;else switch(e.element){case"fire":case"light":this.synerzyFire+=t;break;case"water":case"cold":this.synerzyWater+=t;break;case"air":case"lightning":this.synerzyAir+=t;break;case"earth":case"gravity":this.synerzyEarth+=t;break;case"poison":case"infection":this.synerzyPoison+=t;break;case"sand":this.synerzyAir+=t/2,this.synerzyEarth+=t/2;break;case"blizzard":this.synerzyWater+=t/2,this.synerzyAir+=t/2;break;case"magma":this.synerzyFire+=t/2,this.synerzyEarth+=t/2;break;case"radiation":this.synerzyFire+=t/2,this.synerzyPoison+=t/2;break;case"acid":this.synerzyWater+=t/2,this.synerzyPoison+=t/2}}decreaseEnergy(){this.energy-=this.cost*(1+(this.spd<0?-this.spd/100:0))+_t(-100,100),this.cost!==ce&&(this.cost=ce),vr.queue.update(this)}increaseEnergy(){this.energy+=ce*(1+(this.spd>0?this.spd/100:0))+_t(-100,100)}teleport(e,t,i,a,s){if(this.drawOrErase(!1),e||t){let s,l=e?NaN:0,[r,n]=[this.x,this.y],o=0;do{this.getPositionRandomly(!1,!1,!0),s=Ut(this.x,this.y,r,n),(e&&!(s>=l)||!e&&s>l)&&([i,a]=[this.x,this.y],l=s)}while((e&&(s>Q||s<16)||!e&&s<=t)&&++o<100);o>=100&&([this.x,this.y]=[i,a])}else this.spiralSearch(i,a,"fighter");if(this.drawOrErase(!0),this.sleeping&&(this.sleeping=0),!s){let e=Ut(this.x,this.y,$t.x,$t.y);pr.playSound("teleport",e)}if(this.id===re){let e=vr.coords[this.x][this.y];e.traces=++this.numSteps,e.getInfo()}}wakeUp(){if(this.sleeping=0,this.id!==re&&!this.isShowing())return;let e=this.getName(!0);Na.draw(Pt.isEnglish()?`${e} woke up`:`${e}目覚めた`),(qt.dash||qt.rest)&&(qt.dash=qt.rest=!1)}getParts(e,t){let i,a;switch(e.type){case"melee":case"missile":case"staff":if(e.twoHanded){if(this.equipment.main&&this.equipment.off)return void(this.id===re&&Na.draw(Na.get(Ci)));this.equipment.main?a="main":this.equipment.off&&(a="off")}else this.equipment.main&&(a="main");i="main";break;case"shield":this.equipment.main&&this.equipment.main.twoHanded?a="main":this.equipment.off&&(a="off"),i="off";break;case"amulet":this.equipment.neck&&(a="neck"),i="neck";break;case"ring":this.equipment["R-ring"]&&this.equipment["L-ring"]?(a="R-ring",i="R-ring"):i=this.equipment["R-ring"]?"L-ring":"R-ring";break;case"light":this.equipment.light&&(a="light"),i="light";break;case"armor":this.equipment.body&&(a="body"),i="body";break;case"cloak":this.equipment.back&&(a="back"),i="back";break;case"belt":this.equipment.waist&&(a="waist"),i="waist";break;case"helm":this.equipment.head&&(a="head"),i="head";break;case"gloves":this.equipment.hands&&(a="hands"),i="hands";break;case"boots":this.equipment.feet&&(a="feet"),i="feet"}return a&&(t||null===this.unequip(!1,a))&&(i=null),i}getStarterItems(){for(let e of this.starter){let t=e.quantity?e.quantity:1,i=cp.item({type:e.type,tabId:e.tabId,quantity:t,position:Ie,lvl:this.lvl,uniqueId:e.uniqueId,starter:e.starter,matBase:e.matBase,matId:e.matId,magic:e.magic});i.equipable&&!e.pack&&this.equipStarterItem(i,e.side)||this.packAdd(i)}}equipStarterItem(e,t){let i=!1;if(t)this.side[t]||(this.side[t]=e,i=!0);else{let t=this.getParts(e,!0);t&&(this.equipment[t]=e,i=!0)}if(i)return e.place=Be,this.gainOrloseWeight(e,e.quantity,!0),!t&&e.durab&&this.getOrLooseStats(e,!0,!1,!0),!0}respec(){this.statPoints=this.skillPoints=this.lvl-1,this.statPoints*=5,this.strMax=1+this.strBonus,this.dexMax=1+this.dexBonus,this.conMax=1+this.conBonus,this.intMax=1+this.intBonus,this.str=this.strMax,this.dex=this.dexMax,this.con=this.conMax,this.int=this.intMax,this.skill={},this.initSynerzy(),this.calcAll(),this.id===re&&this.initKeys();let e=this.getName(!0);Na.draw(Pt.isEnglish()?`${e} forgot everything`:`${e}自らを忘却した`)}searchCe(){br.main({x0:this.x,y0:this.y,radius:J,type:"Aim",fighter:this})}getShootMsg(e){let t=this.getName(!0),i=e.getName(!1,1);Na.draw(Pt.isEnglish()?`${t} shot ${i}`:`${t}${i}を放った`)}},dp=class extends hp{constructor(){super(rp.misc[0]),this.name.a=this.name.b=dr.name,this.id=re,this.expMax=this.exp=0,this.expGain=this.getExp(),this.expNext=this.calcNextLvl(),this.cube={},this.cubeIndex={},this.hunger=$/2,this.purse=500,this.keysList={},this.numSteps=0,this.skill={},this.detected=!0,this.ce=null,this.dl=0,this.pdl=0,this.cdl=0,this.cui={},this.cue={},this.recipes={},this.recipes[Jc]=!0,this.lethe=0,this.turn=1,this.done=!1,this.initKeys(),this.isWizard=l}init(){this.starter&&this.getStarterItems(),this.calcAll(),this.hp=this.hpMax,this.mp=this.mpMax,this.energy=this.spd/100}initKeys(){for(let e=0;e<z;e++)this.keysList[e]=null}move(e,t){this.confused?t=wt[Yt(wt.length-1)]:e&&(t=ti(e));let i=vr.coords[this.x+t.x][this.y+t.y];if(i.isClosedDoor()&&!i.hidden)i.openOrCloseDoor(),$t.done=!0;else if(i.fighter){if(this.haveMissile()){let t=this.getAmmo(this.equipment.main.throwType);if(!t)return Na.draw(Na.get(Si)),null;this.ci=t,qt.arrow=!0,this.getShootMsg(t),this.aim({key:e})}else pr.playSound("swing"),this.attack({enemy:i.fighter});$t.done=!0}else this.stuckTrap?(Na.draw(Na.get(ga)),$t.done=!0,qt.dash&&(qt.dash=!1)):i.wall?pr.playSound("hitwall"):(this.drawOrErase(!1,!0),this.x+=t.x,this.y+=t.y,i.traces=++this.numSteps,this.drawOrErase(!0,!0),i.getInfo()||($t.done=!0,this.cost-=this.spdMove))}rest(){this.decreaseEnergy(),vr.queue.moveAll(),!qt.rest||this.hp===this.hpMax&&this.mp===this.mpMax?qt.rest=!1:setTimeout(this.rest.bind(this),pe)}dash(e){if(this.confused)return;let t=ti(e),i=vr.coords[this.x+t.x][this.y+t.y];if(i.isClosedDoor()&&!i.hidden)return i.openOrCloseDoor(),void($t.done=!0);if(i.wall)return void pr.playSound("hitwall");qt.dash=!0;let a=ai(t,!0),s=ai(t);var l=0,r=!1,n=!1;vr.coords[this.x+a.x][this.y+a.y].wall&&(r=!0),vr.coords[this.x+s.x][this.y+s.y].wall&&(n=!0),this.dashLoop(t,a,s,r,n,l)}dashLoop(e,t,i,a,s,l){let r=vr.coords[this.x+e.x][this.y+e.y];r.isObstacle()||qt.died?qt.dash=!1:(null===this.move(null,e)&&(qt.dash=!1),this.decreaseEnergy(),vr.queue.moveAll(),qt.dash&&this.dashCheck(e,t,i,a,s,l))}dashCheck(e,t,i,a,s,l){var r=!1;a&&!s?vr.coords[this.x+t.x][this.y+t.y].wall&&!vr.coords[this.x+i.x][this.y+i.y].wall||(r=!0):!a&&s?vr.coords[this.x+i.x][this.y+i.y].wall&&!vr.coords[this.x+t.x][this.y+t.y].wall||(r=!0):a&&s?(l&&(e=vr.coords[this.x+e.x][this.y+e.y].wall?this.dashSearch(e):null,e?(l=0,t=ai(e,!0),i=ai(e)):r=!0),vr.coords[this.x+t.x][this.y+t.y].wall&&vr.coords[this.x+i.x][this.y+i.y].wall||l++):(vr.coords[this.x+t.x][this.y+t.y].wall||vr.coords[this.x+i.x][this.y+i.y].wall)&&(r=!0),r?qt.dash=!1:setTimeout(this.dashLoop.bind(this,e,t,i,a,s,l),pe)}dashSearch(e){let t=-1,i=-1;for(let a in wt)if(!vr.coords[this.x+wt[a].x][this.y+wt[a].y].wall&&-wt[a].x!==e.x&&-wt[a].y!==e.y)if(a<4){if(-1!==t)return;t=a}else{if(-1!==i)return;i=a}return-1!==i&&wt[i].x!==wt[t].x&&wt[i].y!==wt[t].y?null:wt[t]}searchDoor(){let e,t,i=0;for(let a in wt){let[s,l]=[this.x+wt[a].x,this.y+wt[a].y],r=vr.coords[s][l];!r.door||r.isClosedDoor()!==qt.openDoor||r.fighter||r.item.a||r.hidden||(i||([e,t]=[s,l]),i++)}return 1===i&&(vr.coords[e][t].openOrCloseDoor(),this.done=!0),i}openOrCloseDoor(e){let t=ti(e);if(!t)return;let i=vr.coords[this.x+t.x][this.y+t.y];!i.door||i.isClosedDoor()!==qt.openDoor||i.item.a||i.fighter||(i.openOrCloseDoor(),this.done=!0,qt.openDoor=qt.closeDoor=!1,qt.regular=!0,Fr.clear())}searchHiddenObject(){for(let e=this.x-1;e<=this.x+1;e++)for(let t=this.y-1;t<=this.y+1;t++)vr.coords[e][t].findHiddenObject();$t.done=!0}attackStationary(e){if(null!==this.keysList[0])this.castAssignedSkill("M",e);else if(this.haveMissile()){let t=this.getAmmo(this.equipment.main.throwType);t?(this.ci=t,qt.arrow=!0,this.getShootMsg(t),this.aim({key:e})):Na.draw(Na.get(Si))}else{let t=ti(e),i=vr.coords[this.x+t.x][this.y+t.y];i.wall?this.dig(i):(pr.playSound("swing"),i.fighter&&this.attack({enemy:i.fighter})),$t.done=!0}}died(){Fr.clear(),this.blinded&&(this.blinded=0),this.hallucinated?(this.hallucinated=0,xr.all(!0)):(vr.drawObjectAll(),vr.draw()),pr.playSound("kill"),pr.stop(pr.curTrack),pr.playMusic("gameover"),Na.draw(Na.get(ba)),Na.draw(Na.get(Pa),!0),$t.done=!1,Ht(),qt.regular=!1,qt.wait=!1,qt.died=!0,dr.delete()}getStartPointInTown(){if(!$t.cdl&&$t.dl){let e=Mt.hell;[this.x,this.y]=[e.x,e.y]}else{let e=Mt.start;[this.x,this.y]=[e.x,e.y]}}putDown(e,t,i,a){e?this.getStartPointInTown():t?[this.x,this.y]=[i,a]:this.getPositionRandomly(!0),vr.coords[this.x][this.y].traces=++this.numSteps,this.drawOrErase(!0),vr.queue.push(this)}downOrUpStairs(e,t){let i=vr.coords[this.x][this.y];if(!t&&!i.stairs||i.hidden)return;let a=t?null:i.stairs.id;t||a===at&&">"===e?(t||pr.playSound("staircase"),Pt.autosave.user&&dr.save(),pp.clearLevel(),33===$t.cdl?($t.cdl=0,cp.town()):($t.dl<++$t.cdl&&($t.dl=$t.cdl),cp.dungeon(!t,a))):a===st&&"<"===e&&(pr.playSound("staircase"),Pt.autosave.user&&dr.save(),pp.clearLevel(),--$t.cdl?cp.dungeon(!0,a):cp.town())}enterPortal(){if(this.cdl){this.pdl=this.cdl,pp.clearLevel(),cp.town(),this.cdl=0;let e=new Er;e.init(Ee,this.x,this.y)}else Pt.autosave.user&&dr.save(),pp.clearLevel(),this.cdl=this.pdl,cp.dungeon();pr.playSound("tplevel")}enterBuild(e){if(gp.switchFlag(),vr.drawObjectAll(),vr.draw(),e.stash){qt.stash=!0,e.page=1;let t=Na.get(Ui);return this.showInventory(xe),this.showInventory(Le),void Na.draw(t,!0)}if(e.shop){qt.shop=!0,this.cn=1,qt.gamble=e.gamble;let t=Na.get(ji);t=e.name[Pt.getLanguage()]+t,this.showInventory(xe),e.list.a||e.createShopItem(),this.showInventory(Me),Na.draw(t,!0)}else if(e.cure)qt.cure=!0,Fr.show({list:e.list,dr:lt,enter:e}),Na.draw(Na.get(Zi),!0);else if(e.blacksmith){qt.blacksmith=!0;let e=Na.get(_i);this.equipmentList(),this.showInventory(xe),Na.draw(e,!0)}let t=e.getName();Na.draw(Pt.isEnglish()?`You entered The ${t}`:`${t}に入った`)}itemAuto(e){let t;for(let i in e)do{t=!1;let a,s=e[i];if(!s)break;if("coin"===s.type||"ammo"===s.type&&this.equipment.main&&this.equipment.main.throwType===s.throwType)qt.grab=!0,t=null!==this.grabItem(null,i);else if(!s.identified&&Pt["auto-identify"].user&&this.checkItem(s,Rs),s.identified&&("scroll"===s.type||s.charges&&1===s.quantity)&&Pt["auto-charge"].user&&this.mp&&(a=this.checkItem(s,er)),a||Pt["auto-destroy"].user)if(a&&!a.delete||(si(e,i),delete vr.itemList[s.id],t=!0),a){let e=a.item.getName();Na.draw(Pt.isEnglish()?`Charged ${e}`:`${e}を充填した`)}else{let e=s.getName();Na.draw(Pt.isEnglish()?`Destroyed ${e}`:`${e}を破壊した`)}}while(t)}grabItem(e,t){let i=vr.coords[this.x][this.y];if(qt.grab){if(e&&(t=Kt(e)),!t||!i.item[t])return;let a=i.item[t];if(a=this.inventoryOut(a,a.quantity),Fr.clear(),qt.grab=!1,qt.regular=!0,"coin"!==a.type&&!this.packAdd(a))return Na.draw(Na.get(Ai)),null;{let e=a.getName();"coin"===a.type&&(this.purse+=a.price),Na.draw(Pt.isEnglish()?`Picked up ${e}`:`${e}を拾った`),pr.playSound("grab"),$t.done=!0}}else{if(!i.item.a)return;if(qt.grab=!0,i.item.b){gp.switchFlag();let e=Na.get(Di);this.showInventory(Re),Na.draw(e,!0)}else this.grabItem("a")}}drop(e){let t;if(qt.number){t=this.ci;let e=this.cn;e>t.quantity&&(e=t.quantity),t=this.inventoryOut(t,e),this.ci=null}else{let i=Qt(e);if(!i)return;if(i=i.toLowerCase(),t=this.getItem(i),!t||t.place===Be&&t.cursed)return;if(t.quantity>1)return this.ci=t,qt.number=!0,Fr.clear(),this.showInventory(t.place,i),void this.inputNumber();t=this.inventoryOut(t,1)}t.putDown(this.x,this.y,!0),t.dropped(),Fr.clear(),qt.drop=!1,qt.regular=!0,$t.done=!0}equip(e){if(this.switchInventory(e,zi))return;let t=Qt(e);if(!t||gp.isShift)return;let i=this.getItem(t,qt.floor);if(!i||!i.equipable)return;qt.floor=!1;let a=this.getParts(i);if(!a)return;i=this.inventoryOut(i,1),i.place=Be,this.equipment[a]=i,this.gainOrloseWeight(i,i.quantity,!0);let s=i.getName();if(i.weapon?Na.draw(Pt.isEnglish()?`Wielding ${s}`:`${s}を握った`):Na.draw(Pt.isEnglish()?`Wearing ${s}`:`${s}を身に付けた`),i.cursed&&pr.playSound("curse"),this.eqt.a){
let e=this.eqt.a;this.packAdd(e)||e.dropped(),delete this.eqt.a}i.durab&&this.getOrLooseStats(i,!0),this.calcAll(!0),Fr.clear(),this.equipmentList(),qt.equip=!1,qt.regular=!0,$t.done=!0,qt.clearInv=!0}unequip(e,t){if(!t){let i=Kt(e);if(!i)return;i=i.toLowerCase(),t=xt[i]}let i,a=this.equipment[t];if(!a)return;if(i=a.weapon?Pt.isEnglish()?"unwield":"離す":Pt.isEnglish()?"take off":"外す",a.cursed)return Na.draw(Pt.isEnglish()?`You can't ${i} the cursed item`:`呪われたアイテムを${i}ことが出来ない`),null;let s=a.getName();Pt.isEnglish()?(i=ei(i),Na.draw(`${i} ${s}`)):(i=i.charAt(0),Na.draw(`${s}を${i}した`)),pr.playSound("grab"),this.equipment[t]=null,this.gainOrloseWeight(a),qt.equip?this.eqt.a=a:this.packAdd(a)||a.dropped(),a.durab&&this.getOrLooseStats(a,!1),$t.done=!0,Fr.clear(),qt.unequip=!1,qt.regular=!0,qt.equip||(this.calcAll(),this.equipmentList(),qt.clearInv=!0)}isNaked(){for(let e in xt)if(this.equipment[xt[e]])return!1;return!0}fuel(e,t){if(this.switchInventory(e,Pi,!0))return;let i;if(t)i=t;else{let t=Qt(e);if(!t||gp.isShift)return;if(i=this.getItem(t,qt.floor),!i||"light"!==i.type&&"oil"!==i.type)return}let a=this.equipment.light;if(a.torch&&!i.torch||!a.torch&&i.torch)return;qt.floor=!1,!a.fuelValue&&i.fuelValue&&a.durab&&(this.lighten+=a.lighten,this.lightenOrDarken("Lighten")),a.fuelValue+=i.fuelValue,a.fuelValue>a.fuelMax&&(a.fuelValue=a.fuelMax),a.calcFuelLvl(),i.mod!==De?(i.fuelValue=0,i.calcFuelLvl()):this.deleteItem(i,1);let s=a.getName();Na.draw(Pt.isEnglish()?`Fueled ${s}`:`${s}を補給した`),$t.done=!0,Fr.clear(),qt.fuel=!1,qt.regular=!0}eat(e,t){if(this.switchInventory(e,Ii))return;let i;if(t)i=t;else{var a=Qt(e);if(!a)return;if(i=this.getItem(a,qt.floor),!i||"food"!==i.type)return;qt.floor=!1}let s=i.getName(!0,!0);Na.draw(Pt.isEnglish()?`Ate ${s}`:`${s}を食べた`),pr.playSound("eat"),this.haveCast(i.nameSkill,i.skillLvl,this),this.deleteItem(i,1),t||(Fr.clear(),qt.eat=!1,qt.regular=!0),$t.done=!0}quaffPotion(e,t){if(this.switchInventory(e,Ei))return;let i;if(t)i=t;else{var a=Qt(e);if(!a)return;if(i=this.getItem(a,qt.floor),!i||"potion"!==i.type)return;qt.floor=!1}if(!i.identified&&(i.identifyAll(),i.place===xe))var s=!0;let l=i.getName(!0,!0);Na.draw(Pt.isEnglish()?`Quaffed ${l}`:`${l}を飲んだ`),pr.playSound("quaff"),this.haveCast(i.nameSkill,i.skillLvl,this),this.hunger+=A,this.hunger>$&&(this.hunger=$),this.deleteItem(i,1),t||(s&&i.quantity>0&&Fr.sort(a,this.pack),Fr.clear(),qt.quaff=!1,qt.regular=!0),$t.done=!0}zap(e,t){if(this.switchInventory(e,Ri))return;let i;if(t)gp.switchFlag(),qt.zap=!0,i=t;else{let t=Qt(e);if(!t)return;if(i=this.getItem(t,qt.floor),!i||"wand"!==i.type)return}Fr.clear(),this.ci=i,qt.floor=!1,Na.draw(Na.get(Li)+Na.get(Bi),!0),qt.aim=!0,this.examinePlot(!0)}throw(e){if(this.switchInventory(e,Ma))return;let t=Qt(e);if(!t||gp.isShift)return;let i=this.getItem(t,qt.floor);i&&(Fr.clear(),this.ci=i,qt.floor=!1,Na.draw(Na.get(qa)+Na.get(Bi),!0),qt.aim=!0,this.examinePlot(!0))}haveThrown(e,t,i,a){if("potion"===e.type||"wand"===e.type)if(this.haveCast(e.nameSkill,e.skillLvl,t,i,a),this.deleteAmmo(e,!1,i,a),t.abort||this.getCe(t,!1),"potion"===e.type)e.identifyAll();else{let i=rr.get(e.nameSkill);i.wall||t.material===Qr||e.identifyWand()}else this.attack({enemy:t,itemThrown:e})}read(e,t){if(this.switchInventory(e,gi))return;let i;if(t)i=t;else{var a=Qt(e);if(!a)return;if(i=this.getItem(a,qt.floor),!i||"scroll"!==i.type&&"recipe"!==i.type&&!i.chargeBook)return}if(i.chargeBook&&!i.charges)return;qt.floor=!1,i.identified||(i.identifyAll(),i.place===xe&&Fr.sort(a,this.pack));let s=i.getName(!0,1);if(Na.draw(Pt.isEnglish()?`Read ${s}`:`${s}を読んだ`),"recipe"!==i.type||this.recipes[i.tabId]||(this.recipes[i.tabId]=!0,Na.draw(Pt.isEnglish()?"Learned a new recipe":"新たなレシピを習得した")),qt.read=!1,"recipe"!==i.type)if(qt.scroll=!0,0===rr.get(i.nameSkill).range){if(this.ci=i,!t)return Fr.clear(),qt.aim=!0,Na.draw(Na.get(la)+Na.get(Bi),!0),void this.examinePlot(!0);this.aim({x1:this.x,y1:this.y})}else if(null===this.haveCast(i.nameSkill,i.skillLvl,this))return void(this.ci=i);this.deleteItem(i,1),Fr.clear(),qt.regular=!0,$t.done=!0}identify(e,t){if(this.switchInventory(e,ki,!0))return;if(null!==e){var i=Qt(e);if(!i)return;i=i.toLowerCase(),t=this.getItem(i,qt.floor)}if(!t||t.identified)return;qt.floor=!1,"wand"===t.type&&!ep[t.type].get(t.tabId).identified||"potion"===t.type||"scroll"===t.type||"recipe"===t.type||"orb"===t.type?t.identifyAll():(t.identified=!0,t.changeNameAndPrice());let a=t.getName();Na.draw(Pt.isEnglish()?`Identified ${a}`:`${a}を判別した`),e&&(Fr.clear(),this.showInventory(t.place,i),or.main(t,t.place===Be||t.place===Se?lt:it),t.place===xe&&Fr.sort(i,this.pack),$t.done=!0,qt.identify=!1,qt.regular=!0,qt.clearInv=!0),qt.skill?(this.consumeMana(rr.get(Rs)),qt.skill=!1):qt.scroll&&this.deleteItem(this.ci,1)}repairAll(e=""){let t;for(let e in this.equipment){let i=this.equipment[e];i&&i.durab<i.durabMax&&(this.repairOne(i,!0),t=!0)}t&&Na.draw(Pt.isEnglish()?`Repaired your equipment${e}`:`装備を${e}修復した`)}getDurabPriceAll(){let e=0;for(let t in this.equipment){let i=this.equipment[t];i&&i.durab<i.durabMax&&(e+=i.getDurabPrice())}return e}repair(e){let t=qt.blacksmith&&"Enter"===e;if(!t){if(!qt.blacksmith&&this.switchInventory(e,wi,!0))return;let t=Qt(e);if(!t)return;t=t.toLowerCase();var i=this.getItem(t,qt.floor);if(!i||!i.equipable||i.durab===i.durabMax)return;qt.floor=!1}let a="";if(qt.blacksmith){var s=t?this.getDurabPriceAll():i.getDurabPrice();if(!s)return;if(this.purse<s)return void Na.draw(Na.get(Wi));a=Pt.isEnglish()?` for $${s}`:`$${s}で`,t&&this.repairAll(a)}if(!t){this.repairOne(i,gp.isShift);let e=i.getName();Na.draw(Pt.isEnglish()?`Repaired ${e}${a}`:`${e}を${a}修復した`)}if(Fr.clear(),qt.blacksmith){this.purse-=s;let e=Na.get(_i);return this.equipmentList(),this.showInventory(xe),void Na.draw(e,!0)}qt.skill?(this.consumeMana(rr.get(Ds)),qt.skill=!1):qt.scroll&&this.deleteItem(this.ci,1),$t.done=!0,qt.repair=!1,qt.regular=!0,qt.clearInv=!0}repairOne(e,t){e.cursed&&e.uncurse(),!e.durab&&t&&(this.getOrLooseStats(e,!0),this.calcAll()),e.durab=e.durabMax}disintegrate(e){let t="%"===e?e:Kt(e);if(!t)return;let i,a=rr.get(pl);i=qt.skill?this.cs.lvl+this.getSkillBoost(a):this.ci.skillLvl;let s=this.calcSkillValue(a,i);ur.main({x0:this.x,y0:this.y,type:pl,radius:s,symbol:t}),Fr.clear(),qt.skill?(this.consumeMana(a),qt.skill=!1):qt.scroll&&this.deleteItem(this.ci,1),qt.disint=!1,qt.regular=!0,$t.done=!0}wormhole(e,t){let i=rr.get(Ps),a=this.cs.lvl+this.getSkillBoost(i),s=this.calcSkillValue(i,a)**2,l=vr.coords[e][t];!l.found||l.isObstacle()||Ut(e,t,this.x,this.y)>s?Na.draw(Na.get(yi)):(this.teleport(!1,!1,e,t),this.consumeMana(i),qt.skill=!1,qt.wormhole=!1,qt.examine=!1,qt.regular=!0,$t.done=!0,Fr.clear(),Sr.clearEnemyBar(),Rr.clearAll())}investigate(e,t,i,a){if(or.clear(),!t){if(this.switchInventory(e,Ni,!0))return;let i=Qt(e);if(!i)return;if(i=i.toLowerCase(),t=this.getItem(i,qt.floor),!t)return}t.identified&&!t.typeHalluc?(void 0===a&&(a=t.place===Be||t.place===Se?lt:it),or.main(t,a)):Na.draw(Na.get(Ea))}getSkillInfo(e,t,i){let a=e.desc[Pt.getLanguage()];if(e.rate){i||(qt.skill=!0);let s=this.calcSkillValue(e,t,void 0,!0);e.limit&&s>e.limit&&(s=e.limit),isFinite(e.base)||(s=(Pt.isEnglish()?"about ":"約")+s),e.perc&&(s>0&&(s="+"+s),s+="%");let l=e.radiusRate?"{radiusRate}":"{value}";a=a.replace(l,s),qt.skill=!1}if(e.radius&&(a=a.replace("{radius}",e.radius)),e.durBase){let i=Pt.isEnglish()?"about ":"約";i+=this.calcSkillDur(e,t,!0),a=a.replace("{dur}",i)}return a}synthesize(e){if(qt.recipe){if("c"!==e)return;qt.recipe=!1,Fr.list.recipe.show=!1;let t=Na.get(Fi)+Na.get(qt.floor?pi:ui);return void Na.draw(t,!0)}if(gp.isCtrl&&"r"===e)return qt.recipe=!0,Na.draw(Na.get(Ia),!0),void Fr.showRecipe();if(this.switchInventory(e,Fi))return;let t=Object.keys(this.cube).length;if("Enter"===e&&t>=1)return qt.floor=!1,void this.tryToSynthesize();let i=Qt(e);if(!i)return;if(i=i.toLowerCase(),!gp.isShift&&t===I)return void Na.draw(Na.get(Oi));let a=gp.isShift?this.cube[i]:this.getItem(i,qt.floor);if(a){if(gp.isShift)this.returnItem(a,i),si(this.cube,i),si(this.cubeIndex,i);else{let e="scroll"===a.type?a.quantity:1;this.cube[vt[t]]=this.inventoryOut(a,e),this.cubeIndex[vt[t]]=i}this.showInventory(qt.floor?Re:xe),this.showInventory(qe)}}tryToSynthesize(){let e,t,i=0,a=0,s=0,l=0,r=0,n=0,o=0,h=0,d=0,m=0,c=0,p=0,u=0,g=0,b=0,f=0,y=this.mp,k=Object.keys(this.cube).length;for(let e=0;e<k;e++){let t=this.cube[vt[e]];t.identified&&(t.equipable&&(t.embeddedMax||p++,t.embeddedNum&&u++,t.embeddedNum<t.embeddedMax&&c++),"potion"===t.type?i++:"wand"===t.type?a++:"gem"===t.type?(h++,g++):"orb"===t.type?(d++,g++):"material"===t.type?(m++,g++):"light"===t.type?t.torch?s++:l++:"oil"===t.type?r++:"book"===t.type?n++:"scroll"===t.type&&o++)}let v=ep.recipe;if(k===i){if(f=1,3===k){let t,i,a=0,s=0,l=!0;for(let e in this.cube){let t=this.cube[e];if(t.tabId===Bd)a++;else{if(t.tabId!==qd)break;s++}}a===k?(t=Wc,i=Ld,e=Pt.isEnglish()?"Potion of Extra Healing":"特大回復の薬"):s===k?(t=jc,i=Ed,e=Pt.isEnglish()?"Potion of Extra Mana":"魔力特大回復の薬"):l=!1,t&&(b=v.get(t).cost),l&&this.checkRecipe(t,b)?this.createItemIntoPack({type:"potion",tabId:i,quantity:1}):e=""}}else if(k===a){let t=Uc;if(b=v.get(t).cost,k>1&&this.checkRecipe(t,b)){let t=!0,i="a",a=this.cube[i];for(let e in this.cube){if(e===i)continue;let s=this.cube[e];if(a.nameSkill!==s.nameSkill){t=!1;break}a.charges<s.charges&&(a=s,i=e)}if(t&&a.charges<W){f=0;for(let e in this.cube){if(e===i)continue;let t=this.cube[e],s=this.chargeItem(a,t,b,f);s.return&&this.returnItem(t,e),s.charges&&(f+=s.charges)}this.packAdd(a),e=a.getName()}}}else if(k===h){let t=Hc;if(b=v.get(t).cost,this.checkRecipe(t,b)){let t=0;for(let e in this.cube){let i=this.cube[e];y<b*(f+1)?this.returnItem(i,e):(f++,this.purse+=i.price,t+=i.price)}e="$"+t}}else if(k>1&&k===s+l+r){let t=k===s?_c:Zc;if(b=v.get(t).cost,(k===s||l&&k===l+r)&&this.checkRecipe(t,b)){let t,i;for(let e in this.cube){let a=this.cube[e];if("oil"!==a.type){t=a,i=e;break}}let a=0;for(let e in this.cube){if(i===e)continue;let t=this.cube[e];y<b*(f+1)?this.returnItem(t,e):(f++,a+=t.fuelValue,"light"!==t.type||t.mod===De&&!t.embeddedList.length||(t.fuelValue=0,t.calcFuelLvl(),this.packAdd(t)))}t.fuelValue+=a,t.fuelValue>t.fuelMax&&(t.fuelValue=t.fuelMax),t.calcFuelLvl(),this.packAdd(t),e=t.getName()}}else if(k===n+o){let t=Yc;if(b=v.get(t).cost,k>1&&n&&this.checkRecipe(t,b)){let t,i,a,s,l,r,n=0;for(let e in this.cube){let o=this.cube[e];"book"===o.type?(o.tabId===Jh&&(a=!0),(!t||o.charges>t.charges)&&(t=o,l=e)):"scroll"===o.type&&(i=o,r=e),(o.chargeBook||"scroll"===o.type)&&(s?s===o.nameSkill&&n++:(s=o.nameSkill,n++))}if(2===k&&a&&i){t.chargeBook=!0,t.charges=0,t.name.a=t.nameReal.a=i.nameReal.a,t.name.b=t.nameReal.b=i.nameReal.b,t.nameSkill=i.nameSkill,t.skillLvl=i.skillLvl,t.tabId=100+i.tabId;let a=this.chargeItem(t,i,b,f);a.return&&this.returnItem(i,r),a.charges&&(f+=a.charges),this.packAdd(t),e=t.getName()}else if(k>1&&t&&k===n&&t.charges<W){for(let e in this.cube){if(e===l)continue;let i=this.cube[e],a=this.chargeItem(t,i,b,f);a.return&&this.returnItem(i,e),a.charges&&(f+=a.charges)}this.packAdd(t),e=t.getName()}}}else if(1===c&&g&&k===c+g){let t,i=Jc;b=v.get(i).cost;for(let e in this.cube){let i=this.cube[e];if(i.equipable){t=i;break}}if(g<=t.embeddedMax-t.embeddedNum&&this.checkRecipe(i,b)){let i=!0;for(let e in this.cube){let a=this.cube[e];if(!a.equipable&&("material"===a.type&&a.material!==t.material||a.modParts&&!a.modParts[t.type])){i=!1;break}}if(i){let i=0;for(let e in this.cube){let a=this.cube[e];if(a.equipable)continue;if(y<b*(f+1)){this.returnItem(a,e);continue}f++;let s=a.modParts?a.modParts[t.type]:a.modList;Zh({obj:t,obj2:s,fixed:!0}),i+=a.weight,t.embeddedNum++,t.embeddedList.push(a)}t.calcDurab(),t.weight=Math.round(100*(t.weight+i))/100,t.weapon?t.calcDmgOne():t.armor&&t.calcAcOne(),this.packAdd(t),e=t.getName()}}}else if(u&&1===k){let e=Kc;b=v.get(e).cost,f=1;let i=this.cube.a;if(!i.cursed&&this.checkRecipe(e,b)){let e=0;for(let t of i.embeddedList){let a=t.modParts?t.modParts[i.type]:t.modList;Zh({obj:i,obj2:a,fixed:!0,remove:!0}),e-=t.weight,this.packAdd(t)}i.embeddedNum=0,i.embeddedList=[],i.weight=Math.round(100*(i.weight+e))/100,i.calcDurab(),i.weapon?i.calcDmgOne():i.armor&&i.calcAcOne(),this.packAdd(i),t=Pt.isEnglish()?"Removed materials":"素材を取り除いた"}}else if(3===k&&p&&h&&d){let t,i=Xc;b=v.get(i).cost,f=1;for(let e in this.cube){let i=this.cube[e];if(i.equipable){t=i;break}}t.mod===De&&this.checkRecipe(i,b)&&(t.embeddedMax=_t(1,t.embeddedLimit),this.packAdd(t),e=t.getName())}else if(4===k&&p&&h&&d&&m){let t,i,a=Qc;b=v.get(a).cost,f=1;for(let e in this.cube){let a=this.cube[e];if(a.equipable?t=a:"material"===a.type&&(i=a),t&&i)break}t.mod!==ze&&t.mod!==Ce||t.material!==i.material||!this.checkRecipe(a,b)||(t=t.makeMaterial(),this.packAdd(t),e=t.getName())}e||t?(this.cube={},this.cubeIndex={},t||(t=Pt.isEnglish()?`Synthesized ${e}`:`${e}を合成した`),Na.draw(t),this.mp-=b*f):(this.returnCubeItem(),Na.draw(Na.get(qi))),Fr.clear(),qt.synthesize=!1,qt.regular=!0,$t.done=!0}checkRecipe(e,t){return this.recipes[e]&&this.mp>=t}chargeItem(e,t,i,a){let s={};if(this.mp<=i*a||e.charges>=W)return s.return=!0,s;let l="scroll"===t.type?t.quantity:t.charges,r=Math.floor(this.mp/i)-a,n=W-e.charges;return n>r&&(n=r),l>n&&(l=n,s.return=!0,"scroll"===t.type?t.quantity-=l:t.charges-=l),e.charges+=l,s.charges=l,s}returnCubeItem(){for(let e in this.cube)this.returnItem(this.cube[e],e);this.cube={},this.cubeIndex={}}returnItem(e,t){switch(e.place){case xe:this.packAdd(e);break;case Se:this.boxAdd(e,this.cubeIndex[t]);break;case Re:e.putDown(this.x,this.y,!0)}}packOrUnpack(e){if(qt.pack!==xe){if(this.switchInventory(e,Vi)||gp.isShift)return;let t=Qt(e);if(!t)return;t=t.toLowerCase();let i=this.getItem(t,qt.floor);if(!i)return;if(i.place!==Se)return this.ci=i,qt.pack=xe,void(1===Object.keys(this.boxes).length?this.packOrUnpack("1"):Na.draw(Na.get(Gi),!0));i=this.inventoryOut(i,i.quantity),this.packAdd(i)||i.dropped()}else{let t=Xt(e);if(!t||void 0===this.boxes[t])return;let i=this.inventoryOut(this.ci,this.ci.quantity);this.ci=null,this.boxAdd(i,t),qt.pack=!0}Fr.clear();let t=Na.get(Vi)+Na.get(qt.floor?pi:ui);this.showInventory(qt.floor?Re:xe),this.showInventory(Se),Na.draw(t,!0)}useBoxItem(e){let t=this.boxes[e];t&&("potion"===t.type?this.quaffPotion(null,t):"scroll"===t.type||t.chargeBook?this.canRead(t.chargeBook)&&this.read(null,t):"food"===t.type?this.eat(null,t):"wand"===t.type?this.zap(null,t):"light"===t.type||"oil"===t.type?this.equipment.light&&this.fuel(null,t):"ammo"===t.type&&this.equipment.main&&this.equipment.main.throwType===t.throwType&&this.autoAim(t))}autoAim(e){let t,i;if(this.ce){if([t,i]=[this.ce.x,this.ce.y],!this.litMapIds[t+","+i]&&(!this.ce.detected||Ut(t,i,this.x,this.y)>K)||!gr(this.x,this.y,t,i))return}else{if(this.searchCe(),!this.ce)return;[t,i]=[this.ce.x,this.ce.y]}this.ci=e,qt.arrow=!0,this.getShootMsg(e),this.aim({x1:t,y1:i})}examine(e){let t=vr.coords[Rr.x][Rr.y];if("x"===e)t.item.a&&this.litMapIds[Rr.x+","+Rr.y]&&Ut(Rr.x,Rr.y,this.x,this.y)<=K&&gr(this.x,this.y,Rr.x,Rr.y)&&(qt.floor=!0,qt.clearInv=!0,Fr.show({list:t.item,dr:lt,place:Re}));else if("c"===e||"m"===e||"e"===e||"i"===e){let i=t.fighter;if(i&&i.isShowing()&&(i.id===re||!$t.hallucinated)){if(i.mimic&&!i.identified&&!$t.isWizard)return;"c"===e?(qt.character=!0,or.main(i,dt,!0),Vue.nextTick(function(){or.scroll(null,!0)})):("m"===e?i.showSkill(i.skill):"e"===e&&this.isWizard?i.equipmentList():"i"===e&&this.isWizard&&i.showInventory(xe),qt.clearInv=!0)}}else if("t"===e||"r"===e){if(qt.wormhole){if("r"!==e)return void this.wormhole(Rr.x,Rr.y);qt.wormhole=!1}if("r"===e)this.ce=null;else if(t.fighter&&t.fighter.id!==re&&t.fighter.isShowing())this.ce=t.fighter;else if(!qt.aim)return void t.getInfo();if(qt.aim&&"t"===e){if(qt.skill||qt.scroll){let e=qt.skill?this.cs.id:this.ci.nameSkill;0===rr.get(e).range&&([Rr.x,Rr.y]=[this.x,this.y])}this.aim({x1:Rr.x,y1:Rr.y})}this.cancelCommand()}else Rr.move(e)}examinePlot(e){Rr.clearAll();let t,[i,a]=e?[this.x,this.y]:[Rr.x,Rr.y],s=Dt.white;qt.zap?(this.ci.identified||ep[this.ci.type].get(this.ci.tabId).identified)&&(t=rr.get(this.ci.nameSkill),s=t.color):(qt.skill||qt.scroll)&&(t=rr.get(qt.skill?this.cs.id:this.ci.nameSkill),s=t.color,0===t.range&&([i,a]=[this.x,this.y])),gr(this.x,this.y,i,a,s,t),e&&vr.draw(i,a,!0)}examineMsg(){let e=Na.get(Yi);this.isWizard&&(e+=Na.get(ma)),Na.draw(e+` (${Rr.x},${Rr.y})`,!0)}cancelCommand(){qt.synthesize?this.returnCubeItem():qt.aim||qt.examine?(Rr.clearAll(),vr.draw(),this.checkCe()):qt.minimap&&(vr.drawObjectAll(),vr.draw()),Fr.clear(),Ht(),this.ci=null}assginSkills(e){let t=/^F\d/.test(e);if(1===qt.assign)if("M"===e||t){let t="M"===e?0:e.replace("F","");if(!this.keysList[t])return;this.keysList[t]=null,Fr.clear(),this.showSkill(this.skill),this.showSkill(this.keysList,!0),Na.draw(Na.get(ia),!0)}else{let t=Kt(e);if(!t||!this.skill[t])return;qt.assign=2,this.ca=t,Na.draw(Na.get(aa),!0)}else{if("M"!==e&&!t)return;let i="M"===e?0:e.replace("F","");this.keysList[i]=this.skill[this.ca].id,qt.assign=1,Fr.clear(),this.showSkill(this.skill),this.showSkill(this.keysList,!0),Na.draw(Na.get(ia),!0)}}gainStatOrSkill(e){if(1!==qt.gain||qt.number)if(2!==qt.gain||qt.number){if(2===qt.gain){let e=rr.get(this.cs),t=this.searchSkill(this.cs),i=t?this.skill[t].lvl:0,a=this.lvl-(i+e.reqLvl)+1;N<i+a&&(a=N-i);let s=this.skillPoints>=a?a:this.skillPoints,l=this.cn;l>s&&(l=s);let r=e.name[Pt.getLanguage()];t?Na.draw(Pt.isEnglish()?`You studied ${r} deeply`:`${r}の知識を深めた`):(t=vt[Object.keys(this.skill).length],this.skill[t]={},this.skill[t].id=this.cs,this.skill[t].lvl=0,Na.draw(Pt.isEnglish()?`You gained ${r}`:`${r}を習得した`)),this.skillPoints-=l,this.skill[t].lvl+=l,this.gainSynerzy(e,l)}else if(3===qt.gain){let e=Sr.list[this.ca],t=e.term+"Max",i=P-this[t],a=this.statPoints>=i?i:this.statPoints,s=this.cn;s>a&&(s=a);let l=e.name[Pt.getLanguage()];Na.draw(Pt.isEnglish()?`You gained ${l}`:`${l}を得た`),this.statPoints-=s,this[t]+=s,this[e.term]=this[t],this.calcAll()}Fr.clear(),qt.gain=!1,qt.regular=!0,$t.done=!0}else{let t=Kt(e);if(!t)return;t=t.toLowerCase();let i=this.pack[this.ca].list[t];if(!i)return;let a=rr.get(i);if(gp.isShift)return void or.skill(this,a);let s=this.searchSkill(i),l=s?this.skill[s].lvl:0;if(this.lvl<a.reqLvl+l||a.reqSynerzy&&a.reqSynerzy>this.getSynerzy(a))return;if(!this.skillPoints||!s&&Object.keys(this.skill).length>=T)return void Na.draw(Na.get(Qi));if(s&&l===N){let e=a.name[Pt.getLanguage()];return void Na.draw(Pt.isEnglish()?`You can't study ${e} anymore`:`これ以上${e}の知識を得られない`)}this.cs=i,qt.number=!0,Fr.clear(),this.showSkill(this.pack[this.ca].list),this.inputNumber()}else{let t=gp.isShift,i=Kt(e);if(!i)return;if(i=i.toLowerCase(),t&&!Sr.list[i]||!t&&!this.pack[i])return;if(t){if(!this.statPoints)return void Na.draw(Na.get(ea));if(this[Sr.list[i].term+"Max"]>=P){let e=Sr.list[i].name[Pt.getLanguage()];return void Na.draw(Pt.isEnglish()?`You can't gain ${e} anymore`:`これ以上${e}を取得が出来ない`)}}else if("book"!==this.pack[i].type||!this.pack[i].skill||!this.canRead(!0))return;this.ca=i,Fr.clear(),t?(Fr.showStats(this,i),qt.gain=3,qt.number=!0,this.inputNumber()):(this.showSkill(this.pack[i].list),qt.gain=2,Na.draw(Na.get(ca),!0))}}castSkill(e){if(gp.isCtrl&&"s"===e&&Object.keys(this.skill).length>=2)return qt.skill=!1,qt.sortSkill=1,Fr.clear(),this.showSkill(this.skill),void Na.draw(Na.get(Ki),!0);let t=Kt(e);if(t=t.toLowerCase(),!t||!this.skill[t])return;let i=rr.get(this.skill[t].id);if(gp.isShift)return Fr.clear(),this.showSkill(this.skill),or.skill(this,i),qt.skill=!0,void Na.draw(Na.get(sa),!0);if(this.checkToCast(i)){if(Fr.clear(),this.cs=this.skill[t],"self"!==i.kind)return qt.aim=!0,Na.draw(Na.get(la)+Na.get(Bi),!0),void this.examinePlot(!0);null!==this.castSelfSpell(i)&&(qt.skill=!1,$t.done=!0,qt.regular=!0)}}castAssignedSkill(e,t){let i="M"===e?0:e.replace("F","");if(!this.keysList[i]||!this.checkToCast())return;let a=this.keysList[i],s=rr.get(a);if(this.checkToCast(s))if(qt.skill=!0,this.cs=this.skill[this.searchSkill(a)],"self"===s.kind){if(null===this.castSelfSpell(s))return;$t.done=!0,qt.skill=!1}else if(0===s.range)this.aim({x1:this.x,y1:this.y,nameSkill:a});else if("M"===e)this.aim({key:t,nameSkill:a});else if(s.wall)gp.switchFlag(),qt.aim=!0,Na.draw(Na.get(la)+Na.get(Bi),!0),this.examinePlot(!0);else{let e,t;if(this.ce){if([e,t]=[this.ce.x,this.ce.y],!this.litMapIds[e+","+t]&&(!this.ce.detected||Ut(e,t,this.x,this.y)>K)||!gr(this.x,this.y,e,t))return void(qt.skill=!1)}else{if(this.searchCe(),!this.ce)return void(qt.skill=!1);[e,t]=[this.ce.x,this.ce.y]}this.aim({x1:e,y1:t,nameSkill:a})}}sortSkill(e){if(1===qt.sortSkill){if(this.ca=Kt(e),!this.ca||!this.skill[this.ca])return;qt.sortSkill=2,Na.draw(Na.get(Xi),!0)}else{let t=Kt(e);if(!t||!this.skill[t]||t===this.ca)return;[this.skill[t],this.skill[this.ca]]=[this.skill[this.ca],this.skill[t]],Fr.clear(),this.showSkill(this.skill),qt.sortSkill=1,Na.draw(Na.get(Ki),!0)}}getItem(e,t){let i;return i=isFinite(e)?this.boxes[e]:t?vr.coords[this.x][this.y].item[e]:gp.isShift?this.equipment[xt[e]]:this.pack[e],i}switchInventory(e,t,i){if(","!==e&&"."!==e)return!1;Fr.clear();let a=Na.get(t);return(qt.synthesize||qt.pack)&&this.showInventory(qt.pack?Se:qe),","===e?(qt.floor=!1,i&&this.equipmentList(),a+=Na.get(ui),this.showInventory(xe)):"."===e&&(qt.floor=!0,a+=Na.get(pi),this.showInventory(Re)),Na.draw(a,!0),!0}destroy(e){if(qt.number){let e=this.ci,t=this.cn;t>e.quantity&&(t=e.quantity),this.deleteItem(e,t);let i=e.getName(!1,t);Na.draw(Pt.isEnglish()?`Destroyed ${i}`:`${i}を破壊した`),Fr.clear(),qt.destroy=!1,qt.regular=!0,$t.done=!0}else{if(this.switchInventory(e,di,!0))return;let t=Qt(e);if(!t)return;t=t.toLowerCase();let i=this.getItem(t,qt.floor);if(!i)return;if(i.indestructible||i.cursed&&gp.isShift&&qt.floor)return void Na.draw(Na.get(mi));Fr.clear(),qt.number=!0,qt.floor=!1,this.showInventory(i.place,t),this.inputNumber(),this.ci=i}}shop(e,t){let i=vr.coords[this.x][this.y].enter;if(qt.number){let e=this.ci;this.ci=null;let t=this.cn;t>e.quantity&&(t=e.quantity);let a=e.price*t;if(e.place===xe){e=this.inventoryOut(e,t);let s=Object.keys(i.list).length;i.list[vt[s]]=e,e.place=Me,this.purse+=a,e.identified||(e.identified=!0,e.changeNameAndPrice()),e.price*=2;let l=e.getName();Na.draw(Pt.isEnglish()?`Sold ${l} for $${a}`:`${l}を$${a}で売却した`),pr.playSound("coin")}else if(this.purse<a)Na.draw(Na.get(Wi));else{e=e.split(t,i.list),e.changeNameAndPrice(),this.packAdd(e),this.purse-=a;let s=e.getName();Na.draw(Pt.isEnglish()?`Bought ${s} for $${a}`:`${s}を$${a}で購入した`),pr.playSound("grab")}qt.number=!1,Fr.clear(),this.cn=1;let s=Na.get(ji);s=i.name[Pt.getLanguage()]+s,this.showInventory(xe),this.showInventory(Me),Na.draw(s,!0)}else{let a=gp.isShift,s=Kt(e);if(!s)return;s=s.toLowerCase();let l=a?i.list[s]:this.pack[s];if(!l)return;if(t){if(qt.gamble&&a)return;let e=a?Me:xe,t=a?lt:it;return void this.investigate(null,l,e,t)}if(!a&&Object.keys(i.list).length===M)return void Na.draw(Na.get(Hi));if(a&&Object.keys(this.pack).length>=M&&!this.canCarryItem(this.pack,l)&&!this.canCarryItem(this.boxes,l))return void Na.draw(Na.get(Ai));this.ca=s,this.ci=l,Fr.clear(),qt.number=!0,this.showInventory(l.place,s),this.inputNumber()}}stash(e,t){let i=vr.coords[this.x][this.y].enter;if(qt.number){let e=this.ci;this.ci=null;let t=this.cn;if(t>e.quantity&&(t=e.quantity),e.place===Le){e=e.split(t,i.list),this.packAdd(e);let a=e.getName();Na.draw(Pt.isEnglish()?`Take out ${a}`:`${a}を持物に加えた`)}else{e=this.inventoryOut(e,t);let a=this.stashAdd(i.list,e);i.page=Math.ceil((Number(a)+1)/M);let s=e.getName();Na.draw(Pt.isEnglish()?`Stored ${s}`:`${s}を保管した`)}qt.number=!1,Fr.clear();let a=Na.get(Ui);this.showInventory(xe),this.showInventory(Le),Na.draw(a,!0)}else{if("<"===e||">"===e){">"===e&&i.page<E?i.page++:"<"===e&&i.page>1&&i.page--,Fr.clear();let t=Na.get(Ui);return this.showInventory(xe),this.showInventory(Le),void Na.draw(t,!0)}let a,s;if(gp.isShift){if(!Kt(e))return;let t=vt.indexOf(e.toLowerCase());if(t>=M)return;a=t+(i.page-1)*M,s=i.list[a]}else{if(a=Qt(e),!a)return;a=a.toLowerCase(),s=this.getItem(a)}if(!s)return;if(t){let e=gp.isShift?Le:xe,t=gp.isShift?lt:it;return void this.investigate(null,s,e,t)}if(!gp.isShift&&Object.keys(i.list).length===q&&!this.canCarryItem(i.list,s))return void Na.draw(Na.get(Oi));if(gp.isShift&&Object.keys(this.pack).length>=M&&!this.canCarryItem(this.pack,s)&&!this.canCarryItem(this.boxes,s))return void Na.draw(Na.get(Ai));this.ci=s,qt.number=!0,1===s.quantity?(this.cn=1,this.stash()):(this.ca=a,Fr.clear(),this.showInventory(s.place,a),this.inputNumber())}}cureShop(e){let t=vr.coords[this.x][this.y].enter,i=Kt(e);if(!i||!t.list[i])return;let a=t.list[i].cost;if(a>this.purse)return void Na.draw(Na.get(Wi));this.purse-=a;let s=t.list[i][se];"recover completely"===s?this.recovery():"restore health and mana"===s?(this.hp=this.hpMax,this.mp=this.mpMax):"restore stats"===s?this.haveCast(ls,10,this):"restore condition"===s?this.haveCast(rs,10,this):"have a meal"===s&&(this.hunger=$),qt.cure=!1,qt.regular=!0,Fr.clear()}revive(){this.recovery(),qt.died=!1,qt.regular=!0,$t.cdl=0,pp.clearLevel(),cp.town()}recovery(){this.haveCast(ls,10,this),this.haveCast(rs,10,this),this.hunger=$,this.hp=this.hpMax,this.mp=this.mpMax}trapped(e,t){qt.dash&&(qt.dash=!1);let i=vr.coords[this.x][this.y];if(i.hidden&&(i.hidden=!1),Zt()&&i.deleteTrap(),e.nameSkill)return void this.haveCast(e.nameSkill,e.lvl,this);let a=e.name[se];if("Trap Door"===a)this.levi&&!t?Na.draw(Na.get(ya)):(33!==$t.cdl||this.inferno)&&this.downOrUpStairs(null,!0);else if("Bear Trap"===a)this.stuckTrap=_t(4,6);else if("Arrow Trap"===a){let e=_t(4,6);this.hp-=e,Na.draw(Pt.isEnglish()?`An arrow hits you by ${e}`:`矢はあなたに${e}のダメージを与えた`),this.hp<=0&&this.died()}}healAndHunger(){let e=this.equipment.light;if(e&&e.fuelValue&&e.durab&&(0==--e.fuelValue&&(this.lighten-=e.lighten,this.lightenOrDarken("Lighten"),Na.draw(Na.get(ka))),e.calcFuelLvl()),this.hunger>0){this.heal();let e=Math.floor((this.hpReg+this.mpReg-this.digest)/10),t=this.hunger;e>0?(this.hunger-=e,this.hunger<0&&(this.hunger=0)):$t.turn%(1-e)==0&&this.hunger--,t>200&&this.hunger<=200&&pr.playSound("hungry"),this.hunger||Na.draw(Na.get(va))}else this.hp--,this.hp<=0&&this.died();this.hunger||!qt.dash&&!qt.rest||(qt.dash=qt.rest=!1),this.checkCe(),this.calcCondition()}inputNumber(e){if(!e)return this.cn=1,void Na.draw(Na.get(ci)+this.cn,!0);let t=Xt(e),i="a"===e,a="Enter"===e,s="Backspace"===e;if((t||i||a||s)&&!("0"===t&&(""===this.cn||1===this.cn)||a&&""===this.cn))if(s||t){1===this.cn&&(this.cn=""),s?this.cn=this.cn.substr(0,this.cn.length-1):this.cn+=t,qt.shop&&(Fr.clear(),this.showInventory(this.ci.place,this.ca));let e=Na.get(ci)+this.cn;Na.draw(e,!0)}else this.cn=i?1/0:Number(this.cn),qt.drop?this.drop():qt.gain?this.gainStatOrSkill():qt.destroy?this.destroy():qt.shop?this.shop():qt.stash&&this.stash(),qt.number=!1}checkUnique(){this.checkUniqueLoop(vr.itemList);for(let e in vr.enemyList){let t=vr.enemyList[e];this.checkUniqueLoop(t.pack),this.checkUniqueLoop(t.equipment),this.checkUniqueLoop(t.side),this.checkUniqueLoop(t.boxes),t.mod===Pe&&delete this.cue[t.name[se]]}}checkUniqueLoop(e){for(let t in e){let i=e[t];if(i)if(i.mod!==Pe||i.identified)i.lethe&&this.lethe--;else{let e=i.type+","+i.tabId+","+i.uniqueId;this.cui[e]&&delete this.cui[e]}}}checkItem(e,t){let i=this.checkItemLoop(this.boxes,e,t);return i}checkItemLoop(e,t,i){for(let a in e){let s=e[a];if(s){if(i===er&&("wand"===t.type&&"wand"===s.type||("scroll"===t.type||t.chargeBook)&&s.chargeBook)&&s.nameSkill===t.nameSkill&&s.charges<W){if(s.quantity>1)continue;t.charges&&t.charges>s.charges&&([t.charges,s.charges]=[s.charges,t.charges]);let e={},i=ep.recipe.get(s.chargeBook?Yc:Uc).cost,a=this.chargeItem(s,t,i,0);return e.delete=!a.return,a.charges&&(this.mp-=a.charges),e.item=s,e}if(i===Rs&&s.nameSkill===Rs&&(!s.chargeBook||s.charges))return this.ci=s,qt.scroll=!0,void this.identify(null,t)}}return!1}checkCe(){Sr.clearEnemyBar(),this.ce&&(this.ce.isShowing()?Sr.drawEnemyBar(this.ce):(Sr.clearEnemyBar(),this.ce=null))}getCe(e,t){e.id===re||!t&&this.ce||!e.isShowing()||(this.ce=e)}getName(e,t){let i;return i=t?this.name[Pt.getLanguage()]:Pt.isEnglish()?e?"You":"you":e?"":"あなた",i}isOpponent(e){return e.id!==re}isShowing(){return!this.invisible}removeCe(){this.ce=null,Sr.clearEnemyBar()}goBlind(e){vr.drawObjectAll(),vr.draw(),e||this.removeCe()}},mp=class extends hp{constructor(e){super(e),this.sensing=ee,this.type="enemy",this.ce=$t}gainStats(){for(let e=0;e<5;e++)switch(this.grow&&Zt()?this.grow:Yt(3)){case Fe:this.str=++this.strMax;break;case Ve:this.dex=++this.dexMax;break;case Ge:this.con=++this.conMax;break;case He:this.int=++this.intMax}}init(e,t,i,a,s,l,r){if(this.mod!==Pe&&r>this.lvl){let e=Yt(r-this.lvl);for(let t=0;t<e;t++)this.gainStats();this.lvlMax=this.lvl=this.lvl+e}this.skillPoints=this.lvl-1,this.exp=this.expMax=Vt(this.lvl),this.expGain=this.getExp(),this.expNext=this.calcNextLvl(),this.piece&&this.getMaterial(),this.mod===Pe?this.getUnique():(this.mod!==De||s||this.material===Xr||_h.evalMod(ze,$t.mf))&&(this.bias&&(l=this.bias),this.mod===Ce||_h.evalMod(Ce,$t.mf)?this.getRare(l):this.getMagic(l)),Jt(10)&&this.dropNum++,this.mf&&(this.dropNum+=Math.ceil(this.mf/30)),this.gainSynerzyAll(),this.starter&&this.getStarterItems(),this.mod!==De&&this.getOrLooseStats(It.get(this.mod),!0),this.calcAll(),this.sleeping=this.awake||this.aggravating||a?0:le,this.mimic&&xr.one(this,!1,!0),this.dropNum&&this.createItemIntoPack({times:this.dropNum,magic:this.mf||this.mod===Pe,lvl:this.lvl}),this.gf&&this.createItemIntoPack({times:_t(1,Math.ceil(this.gf/40)),type:"coin",tabId:Gc}),this.hp=this.hpMax,this.mp=this.mpMax,this.energy=ce*(a?-1:this.spd/100),super.init(e,t,i)}putDown(e,t){do{this.id=Math.random()}while(vr.enemyList[this.id]);this.spiralSearch(e,t,"fighter"),this.abort||(vr.enemyList[this.id]=this,vr.queue.push(this),$t.hallucinated&&xr.one(this,!0),this.drawOrErase(!0))}act(){let e=null;if(null===this.calcCondition())return;this.heal(),this.ce||(this.hallucinated&&this.searchCe(),this.ce||(this.ce=$t));let t=Ut(this.x,this.y,this.ce.x,this.ce.y);if(this.paralyzed||this.sleeping)return void(this.sleeping<0&&t<=K&&(this.ce.aggravating||this.probWakeUp(t))?this.wakeUp():this.decreaseEnergy());let i=t<=K&&gr(this.x,this.y,this.ce.x,this.ce.y);this.blinded||this.confused||this.moveRnd&&Zt()?e=this.getDirection(i,void 0,!0):i?e=this.decide(t):t<=K?e=this.getDrToMinDistance():t<=this.sensing&&(e=this.getDirection(i,!0)),!e&&this.drTemp&&(e=this.drTemp),e&&(this.dr=e,this.drTemp=null,this.move(e,i)),(qt.dash||qt.rest)&&i&&this.isShowing()&&(!this.mimic||this.identified)&&(qt.dash=qt.rest=!1),this.decreaseEnergy()}move(e,t){let[i,a]=[this.x+e.x,this.y+e.y],s=vr.coords[i][a];if(s.trap&&s.trap.protection){if(this.stillness&&!this.canAttack)return;this.attackCircle(s)}else if(s.fighter&&this.isOpponent(s.fighter)){if(this.stillness&&!this.canAttack)return;this.attack({enemy:s.fighter})}else if(!this.stillness)if(!s.isClosedDoor()||s.hidden&&!this.searching)this.drawOrErase(!1),this.x+=e.x,this.y+=e.y,this.drawOrErase(!0),this.cost-=this.spdMove;else{if(s.hidden){if(!Jt(this.searching))return;s.hidden=!1,s.wall=!1}s.openOrCloseDoor()}}getDirection(e,t,i){let a;return t?a=ii(this.x,this.y,this.ce.x,this.ce.y):i&&(a=this.blinded&&this.dr?this.dr:wt[Yt(wt.length-1)]),this.canMove(a)||(a=this.getDrAround(a,e)),a}getDrAround(e,t){let i=Zt(),a=ai(e,i);if(!this.canMove(a)){let s=ai(e,!i);if(this.canMove(s))a=s;else{if(!t||this.drTemp)return null;let e=ai(a,i);if(!this.canMove(e)&&(e=ai(s,!i),!this.canMove(e)))return null;a=e}}return a}canMove(e){let[t,i]=[this.x+e.x,this.y+e.y],a=vr.coords[t][i];return a.fighter?this.isOpponent(a.fighter):!!(!a.wall||a.hidden&&this.searching)&&(!(!this.drTemp&&a.trap&&a.trap.protection)||(this.drTemp=e,!1))}getDrToMinDistance(){
if(this.ce.id!==re)return this.getDirection(!0,!0);let e,t=J+1,i=$t.distMap[this.x+","+this.y];for(let a of wt){let[s,l]=[this.x+a.x,this.y+a.y];if(t>$t.distMap[s+","+l]){if(!this.canMove(a))continue;if(e=a,t=$t.distMap[s+","+l],t<i)break}}return e||this.getDirection(!0,!0)}attackCircle(e){if(Jt(25)){if(!e.hidden){pr.playSound("broken");let e=this.getName(!0);Na.draw(Pt.isEnglish()?`${e} broke Magic Circle of Protection`:`${e}守りの魔法円を破壊した`)}e.deleteTrap(!0)}}died(e){this.abort=!0;let t=vr.coords[this.x][this.y];t.fighter=null,delete vr.enemyList[this.id],vr.queue.delete(this),$t.ce&&$t.ce.id===this.id&&$t.removeCe();for(let e in vr.enemyList){let t=vr.enemyList[e];t.ce&&t.ce.id===this.id&&t.removeCe()}if(pr.playSound("kill",Ut($t.x,$t.y,this.x,this.y)),!e)return;($t.hallucinated||this.mimic&&!this.identified)&&xr.undoOne(this);let i=this.getName(),a=e.getName(!0);if(Na.draw(Pt.isEnglish()?`${a} defeated ${i}`:`${a}${i}を倒した`),e.gainExp(this.expGain),e.id===re){this.material&&this.probMaterial()&&this.makeMaterial(!0),this.dropEquipment(this.equipment),this.dropEquipment(this.side);for(let e in this.pack)this.pack[e].putDown(this.x,this.y,!0);this.boss&&33===$t.cdl&&(cp.stairs(1,at,Ee,this.x,this.y,!0),33!==$t.cdl||$t.lethe||cp.item({type:"potion",tabId:Jd,position:Ee,x:this.x,y:this.y}),33===$t.cdl&&($t.inferno=!0))}}probMaterial(){let e;switch(this.mod){case De:case Pe:e=0;break;case ze:e=20;break;case Ce:e=10}return!(!e||!this.matDropRate)&&Jt(e/this.matDropRate)}dropEquipment(e){for(let t in e){let i=e[t];i&&(i.putDown(this.x,this.y,!0),e[t]=null)}}decide(e){if(!(this.skill&&this.skill.a&&Jt(100*this.skillProb)&&this.checkToCast()&&this.castSkill(e))){if(this.haveMissile()){let e=this.getAmmo(this.equipment.main.throwType);if(e)return this.ci=e,qt.arrow=!0,this.getShootMsg(e),void this.aim({x1:this.ce.x,y1:this.ce.y});if(!this.equipment.main.cursed)return void this.swap()}return this.getDrToMinDistance()}}castSkill(e){let t,i=Object.keys(this.skill);i.shuffle();for(let a of i){let i=this.skill[a].id,s=rr.get(i);if(this.checkToCast(s)){if("self"!==s.kind&&s.range>=0){let t=s.range;if(t+=s.radius?s.radius:0,t**2<e)continue}if(i===ml||i===gl){if(1>e)continue}else if(i===Ja){if(this.hp>=this.hpMax)continue}else if(i===xl){if(this.dmgBuffDur)continue}else if(i===Sl){if(this.acBuffDur)continue}else if(i===gs&&this.spdBuffDur)continue;if(this.cs=this.skill[a],"self"!==s.kind){t=!0,qt.skill=!0;let[e,a]=0===s.range?[this.x,this.y]:[this.ce.x,this.ce.y];this.aim({x1:e,y1:a,nameSkill:i});break}if(t=null!==this.castSelfSpell(s),t)break}}return t}probWakeUp(e){let t=100*(1-e/K)-(this.ce.stealth-this.stealth);return t>99?t=99:t<1&&(t=1),Jt(t)}getBias(e){switch(e){case Mh:this.getSkill(Rl);break;case qh:this.getSkill(Bl);break;case Eh:this.getSkill(Ll);break;case $h:this.getSkill(Ml);break;case Ah:this.getSkill(ql);break;case Dh:this.getSkill(El);break;case zh:this.getSkill(Il);break;case Ch:this.getSkill($l);break;case Ph:this.getSkill(Al);break;case Nh:this.getSkill(Dl);break;case Th:this.getSkill(zl);break;case Oh:this.getSkill(Cl);break;case Fh:this.getSkill(Pl);break;case Vh:this.getSkill(Ul)}}getSkill(e){if(!this.skillPoints)return;let t=rr.get(e);if("breath"===t.kind&&this.race===je||"breath"!==t.kind&&"spell"===t.type&&this.int<50)return;this.skill||(this.skillProb=1/(("breath"===t.kind&&this.race&Ze?7:10)-Math.floor(this.lvl/20)),this.skill={});let i=0;for(;this.skill[vt[i]]&&this.skill[vt[i]].id!==e;)i++;if(i>=T)return;this.skill[vt[i]]||(this.skill[vt[i]]={}),t=this.skill[vt[i]],t.id=e,t.lvl||(t.lvl=0);let a=N-t.lvl;a>this.skillPoints&&(a=this.skillPoints),t.lvl+=a,this.skillPoints-=a}gainSynerzyAll(){for(let e in this.skill)this.gainSynerzy(rr.get(this.skill[e].id),this.skill[e].lvl)}getName(e){let t;return this.isShowing()?(t=this.name[Pt.getLanguage()],this.cursed&&this.mod!==Pe&&(t=(Pt.isEnglish()?"Cursed ":"呪われた")+t)):t=Pt.isEnglish()?"Something":"何か",e&&!Pt.isEnglish()&&(t+="は"),t}isOpponent(e){return this.ce&&this.ce.id===e.id||this.confused||this.blinded}isShowing(){return($t.litMapIds[this.x+","+this.y]||this.detected)&&!$t.blinded&&(!this.invisible||$t.seeInvisible)}removeCe(){this.ce=null}},cp={input(e){if("Enter"!==e)return Qt(e)?this.string+=e:/^\s$|Spacebar/.test(e)?this.string+=" ":"Backspace"===e?this.string=this.string.substr(0,this.string.length-1):"ArrowDown"===e&&this.stringSave?this.string=this.stringSave:e||(this.string=""),void Na.draw(this.string,!0);this.stringSave=this.string;let[t,i,a,s]=this.string.split(" ").map(e=>isNaN(Number(e))?e:Number(e));"item"===qt.create?"coin"===t?i>0?$t.purse+=i:Na.draw("Incorrect syntax"):(void 0===a||a>0)&&ep[t]&&ep[t].has(i)?($t.createItemIntoPack({type:t,tabId:i,quantity:a,uniqueId:s}),vr.drawObjectAll(),vr.draw()):Na.draw("Incorrect syntax"):"fighter"===qt.create&&(rp[t]&&rp[t][i]?(this.enemy({type:t,tabId:i,position:Ee,x:$t.x,y:$t.y,summon:!0}),vr.drawObjectAll(),vr.draw()):Na.draw("Incorrect syntax")),Fr.clear(),qt.create=!1,qt.regular=!0},dungeon(e,t){vr.init(),Tr.create();let i=33===$t.cdl&&!$t.inferno;this.stairs(_t(B,L),i?st:ne,Ae),this.trap(_t(S,R),ne,Ae);let[a,s]=Object.keys(vr.staircaseList)[t===at?0:1].split(",");$t.putDown(!1,e,Number(a),Number(s)),i&&this.enemy({type:"misc",tabId:2}),this.enemy({times:U,position:Ae}),this.item({times:_,position:Ae}),vr.redraw();let l=pr.getDungeonTrack($t.cdl,i);pr.curTrack!==l&&(pr.stop(pr.curTrack),pr.playMusic(l))},town(){vr.init(!0),Or.createAll();let e=Mt.hell;this.stairs(1,at,Ee,e.x,e.y,!0),$t.putDown(!0),vr.redraw(),pr.stop(pr.curTrack),pr.playMusic($t.inferno?"town2":"town")},enemy({position:e,x:t,y:i,summon:a,noGroup:s,magic:l,boost:r,times:n=1,type:o=ne,tabId:h=ne,bias:d=ne}){r||(r=$t.cdl?0:1);let m=$t.cdl+r;for(let r=0;r<n;r++){let r,[n,c]=[o,h];if(o===ne)do{n=op[Yt(op.length-2)]}while(rp[n][0].lvl>m);if(h===ne){let e=0,t=np.get(n);t.shuffle();do{if(c=t[e++],void 0===c)return;r=rp[n][c]}while(r.mod===Pe&&$t.cue[r.name[se]]||r.lvl>m||Jt(r.rarity))}else r=rp[n][c];let p=!s&&r.group?_t(2,4):1,[u,g,b]=[e,t,i];for(let e=0;e<p;e++){let e=new mp(r);e.init(u,g,b,a,l,d,m),r.group&&u!==Ee&&(u=Ee,[g,b]=[e.x,e.y])}}},setEnemyList(e,t,i){this.enemyList={};for(let a in rp)for(let[s,l]of rp[a].entries()){if("misc"===a&&l.mod!==Pe)continue;if(l.mod===Pe){if(!i)continue}else if(!t)continue;let r=Nt,n=r(l.lvl,2,!0),o=`Lv: ${n}`;if(e){let e=r(l.hpRate,3),t=r(l.mpRate,3),i=r(l.str,3),a=r(l.dex,3),s=r(l.con,3),n=r(l.int,3),h=r(l.spd,4),d=r(l.dmgBase,3),m=r(l.acBase,3),c=r(l.acSRate,3),p=r(l.acTRate,3),u=r(l.acBRate,3);o+=`, HR: ${e}, MR: ${t}, Str: ${i}, Dex: ${a}, Con: ${s}, Int: ${n}, Spd: ${h}, Dmg: ${d}, AC: ${m}, SR: ${c}, TR: ${p}, BR: ${u}`}o+=`, Mod: ${l.mod}, ${a} ${s}`,this.enemyList[o]=`${l.name.b}`}},item({position:e,x:t,y:i,magic:a,boost:s,lvl:l,uniqueId:r,starter:n,matBase:o,matId:h,times:d=1,type:m=ne,tabId:c=ne,quantity:p=1}){s||(s=$t.cdl?0:1),l||(l=$t.cdl+s),r>=0&&(a=!0);for(let s=0;s<d;s++){let[s,d]=[m,c];m===ne&&(s=sp.getType(a)),c===ne&&([s,d]=sp.getTabId(s,l,a));let u=ep[s].get(d);u.lethe&&$t.lethe++;let g=new sp(u,p);if(g.init(e,t,i,a,l,r,n,o,h),e===Ie)return g.place=qt.shop?Me:xe,g}},setItemList(){this.itemList={},qt.shop=!0;for(let e of St){this.itemList[e]=[];for(let[t,i]of ep[e]){let a=0,s=[...Gr];for(s.shuffle();!(i.material&s[a]);)a++;let l=s[a];s=Gh.get(l).list;for(let i=0,a=s.size;i<a;i++){let a=this.item({type:e,tabId:t,position:Ie,lvl:99,matBase:l,matId:i});a.embeddedMax=0;let s=a.getName();this.itemList[e].push(`${s},${a.weight}kg`)}}}qt.shop=!1},trap(e,t=ne,i,a,s,l){for(let r=0;r<e;r++){let e=t;t===ne&&(e=Yt(Ir.length-1));let r=new $r(Ir[e],!l);r.init(i,a,s)}},stairs(e,t,i,a,s,l){for(let r=0;r<e;r++){let e=t;i===Ae?(t===ne&&(e=r<=1?r?at:st:r%2?at:st),l=r<=1||Zt()):t===ne&&(e=Zt()?at:st);let n=new Dr(Ar.get(e),!l);n.init(i,a,s)}},setList(){$t.isWizard&&(this.setEnemyList(!0,!0,!0),this.setItemList())}},pp={title(e){Ct.clearAll(),qt.title=!0,pr.stop(pr.curTrack),e&&l||pr.playMusic("title")},over(){Ct.clearAll(),qt.retry=!0},quit(e,t){"N"===e&&(qt.quit=!1,qt.regular=!0,Fr.clear()),"Y"===e&&(qt.died=!0,qt.title=!0,qt.regular=!1,this.title(),t||dr.delete())},start(){Ht(),Gt(),pr.init(),$t=new dp,$t.init(),At.rogue=$t,vr.stashList=[],Na.clear(),this.clearLevel(),cp.town(),cp.setList()},clearLevel(){Ct.clearAll(),Sr.clearEnemyBar(),$t.checkUnique(),$t.numSteps=0,$t.ce=null,$t.litMapIds={}}},up={listLeft:[{cmd:{a:"Arrow keys",b:"方向キー"},name:{a:"move",b:"移動"}},{cmd:{a:"h",b:"h"},name:{a:"move left",b:"左移動"}},{cmd:{a:"j",b:"j"},name:{a:"move down",b:"下移動"}},{cmd:{a:"k",b:"k"},name:{a:"move up",b:"上移動"}},{cmd:{a:"l",b:"l"},name:{a:"move right",b:"右移動"}},{cmd:{a:"y",b:"y"},name:{a:"move upleft",b:"左上移動"}},{cmd:{a:"b",b:"b"},name:{a:"move downleft",b:"左下移動"}},{cmd:{a:"u",b:"u"},name:{a:"move upright",b:"右上移動"}},{cmd:{a:"n",b:"n"},name:{a:"move downright",b:"右下移動"}},{cmd:{a:"i",b:"i"},name:{a:"inventory list",b:"持物一覧"}},{cmd:{a:"e",b:"e"},name:{a:"equipment list",b:"装備一覧"}},{cmd:{a:"w",b:"w"},name:{a:"wear or wield",b:"装備する"}},{cmd:{a:"T",b:"T"},name:{a:"take off or unwield",b:"装備を外す"}},{cmd:{a:"G",b:"G"},name:{a:"grab item",b:"アイテムを拾う"}},{cmd:{a:"d",b:"d"},name:{a:"drop item",b:"アイテムを置く"}},{cmd:{a:"o",b:"o"},name:{a:"open door",b:"ドアを開ける"}},{cmd:{a:"c",b:"c"},name:{a:"close door",b:"ドアを閉める"}},{cmd:{a:"s",b:"s"},name:{a:"search",b:"捜索する"}},{cmd:{a:"r",b:"r"},name:{a:"read scroll",b:"巻物を読む"}},{cmd:{a:"q",b:"q"},name:{a:"quaff potion",b:"薬を飲む"}},{cmd:{a:"z",b:"z"},name:{a:"zap wand",b:"魔法棒を振る"}},{cmd:{a:"p",b:"p"},name:{a:"pack item",b:"アイテムを詰める"}},{cmd:{a:"E",b:"E"},name:{a:"eat food",b:"食事する"}},{cmd:{a:"Q",b:"Q"},name:{a:"quit",b:"ゲームを放棄する"}},{cmd:{a:"x",b:"x"},name:{a:"examine things",b:"探査する"}},{cmd:{a:"m",b:"m"},name:{a:"use skill",b:"スキルを使う"}},{cmd:{a:"a",b:"a"},name:{a:"assign skill",b:"スキルを割り当てる"}},{cmd:{a:"G",b:"G"},name:{a:"gain stat/skill",b:"ステータス/スキルを得る"}},{cmd:{a:"f",b:"f"},name:{a:"fire",b:"射る"}},{cmd:{a:"t",b:"t"},name:{a:"throw item",b:"アイテムを投げる"}},{cmd:{a:"S",b:"S"},name:{a:"swap gear",b:"装備を持ち替える"}},{cmd:{a:"C",b:"C"},name:{a:"character description",b:"キャラ詳細"}},{cmd:{a:"F",b:"F"},name:{a:"fuel",b:"補給する"}},{cmd:{a:"R",b:"R"},name:{a:"Rest",b:"休む"}},{cmd:{a:"A",b:"A"},name:{a:"alchemy",b:"錬金術"}}],listRight:[{cmd:{a:"Esc",b:"Esc"},name:{a:"cancel command",b:"取り消す"}},{cmd:{a:"1-9",b:"1-9"},name:{a:"use item",b:"アイテムを使う"}},{cmd:{a:"F1-F12",b:"F1-F12"},name:{a:"use skill",b:"スキルを使う"}},{cmd:{a:"Alt+dir",b:"Alt+方向"},name:{a:"attack stationary/dig",b:"その場で攻撃する/掘る"}},{cmd:{a:"Shift+dir",b:"Shift+方向"},name:{a:"dash",b:"走る"}},{cmd:{a:".",b:"."},name:{a:"step on",b:"踏む"}},{cmd:{a:">",b:">"},name:{a:"down stairs",b:"階段を降りる"}},{cmd:{a:"<",b:"<"},name:{a:"up stairs",b:"階段を昇る"}},{cmd:{a:"=",b:"="},name:{a:"option",b:"オプション"}},{cmd:{a:"?",b:"?"},name:{a:"show command",b:"コマンドを表示"}},{cmd:{a:"Ctrl+p",b:"Ctrl+p"},name:{a:"previous message",b:"メッセージ履歴"}},{cmd:{a:"Ctrl+r",b:"Ctrl+r"},name:{a:"redraw",b:"再描写"}},{cmd:{a:"Ctrl+m",b:"Ctrl+m"},name:{a:"mute",b:"消音"}},{cmd:{a:"Ctrl+s",b:"Ctrl+s"},name:{a:"save",b:"記録する"}},{cmd:{a:"Ctrl+d",b:"Ctrl+d"},name:{a:"destroy item",b:"アイテムを破壊する"}},{cmd:{a:"Ctrl+x",b:"Ctrl+x"},name:{a:"save and exit",b:"記録して終了する"}},{cmd:{a:"Ctrl+v",b:"Ctrl+v"},name:{a:"game version",b:"ゲームのバージョン"}}],listWizard:[{cmd:{a:"Ctrl+e",b:"Ctrl+e"},name:{a:"*enlightenment*",b:"*啓蒙*"}},{cmd:{a:"Ctrl+z",b:"Ctrl+z"},name:{a:"*indestructible*",b:"*破壊不能*"}},{cmd:{a:"Ctrl+q",b:"Ctrl+q"},name:{a:"*create trap*",b:"*罠を生成する*"}},{cmd:{a:"Ctrl+a",b:"Ctrl+a"},name:{a:"*create monster*",b:"*モンスターを生成する*"}},{cmd:{a:"Ctrl+i",b:"Ctrl+i"},name:{a:"*create item*",b:"*アイテムを生成する*"}}],scroll(e,t){if(t){Na.draw(Na.get(Da)+Na.get(Aa),!0);let e=At.$refs.help.$refs;this.eleP=e.commandListBox,this.eleC=e.commandList.$el.firstElementChild}gp.scroll(this.eleP,this.eleC,e,t)}},gp={init(){document.onkeyup=this.onkeyup.bind(this),document.onkeydown=this.onkeydown.bind(this)},onkeyup(e){let t=e.key;"Shift"===t&&(this.isShift=!1),"Control"===t&&(this.isCtrl=!1)},onkeydown(e){let t=e.key;return qt.wait?(qt.died||vr.queue.moveAll(),!1):"Shift"===t||"Control"===t?("Shift"===t&&(this.isShift=!0),"Control"===t&&(this.isCtrl=!0),!1):qt.dash||qt.rest?(Na.draw(Na.get(La)),qt.dash=qt.rest=!1,!1):(qt.clearInv&&(Fr.clear(),qt.clearInv=!1),/^Esc/.test(t)||!qt.create&&/^\s$|Spacebar/.test(t)?qt.died||qt.retry||qt.title||qt.failed||(Na.clear(),$t.cancelCommand()):qt.regular?this.eventFlag(t,e.altKey):qt.number?$t.inputNumber(t):qt.openDoor||qt.closeDoor?$t.openOrCloseDoor(t):qt.investigate?$t.investigate(t):qt.drop?$t.drop(t):qt.destroy?$t.destroy(t):qt.equip?$t.equip(t):qt.unequip?$t.unequip(t):qt.eat?$t.eat(t):qt.quaff?$t.quaffPotion(t):qt.read?$t.read(t):qt.synthesize?$t.synthesize(t):qt.grab?$t.grabItem(t):qt.character?or.scroll(t):qt.examine?$t.examine(t):qt.identify?$t.identify(t):qt.repair||qt.blacksmith?$t.repair(t):qt.disint?$t.disintegrate(t):qt.aim?$t.aim({key:t}):qt.zap?$t.zap(t):qt.throw?$t.throw(t):qt.skill?$t.castSkill(t):qt.sortSkill?$t.sortSkill(t):qt.message?Na.scroll(t):qt.pack?$t.packOrUnpack(t):qt.assign?$t.assginSkills(t):qt.gain?$t.gainStatOrSkill(t):qt.fuel?$t.fuel(t):qt.shop?$t.shop(t,e.altKey):qt.cure?$t.cureShop(t):qt.stash?$t.stash(t,e.altKey):qt.help?up.scroll(t):qt.create?cp.input(t):qt.minimap?vr.drawMini(t):qt.option?Pt.main(t):qt.quit&&pp.quit(t),qt.failed?"Y"===t&&(pp.start(),dr.delete(),Na.draw(Pt.isEnglish()?"Deleted the data":"データ消去しました")):qt.died?"Enter"===t&&(qt.retry||qt.title?dr.load():$t&&$t.isWizard?$t.revive():pp.over()):(qt.equipment&&$t.equipmentList(),qt.inventory&&$t.showInventory(xe),$t.done&&($t.decreaseEnergy(),vr.queue.moveAll())),"m"===t&&this.isCtrl&&pr.mute(),!("I"!==t||!this.isCtrl)&&void(this.isShift=this.isCtrl=!1))},eventFlag(e,t){switch(e){case"b":case"h":case"j":case"k":case"l":case"n":case"u":case"y":case"B":case"H":case"J":case"K":case"L":case"N":case"U":case"Y":if(!Pt.rogueStyleMove.user)break;case"ArrowLeft":case"ArrowUp":case"ArrowRight":case"ArrowDown":case"Left":case"Up":case"Right":case"Down":case"Home":case"End":case"PageUp":case"PageDown":if(this.isCtrl)break;t?$t.attackStationary(e):this.isShift?$t.dash(e):$t.move(e);break;case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":if(this.isCtrl)break;$t.useBoxItem(e);break;case"a":if(this.isCtrl){if(!$t.isWizard)break;this.switchFlag(),qt.create="fighter",cp.input(),Na.draw("Input type and tabId",!0)}else this.switchFlag(),$t.showSkill($t.skill),$t.showSkill($t.keysList,!0),Na.draw(Na.get(ia),!0),qt.assign=1;break;case"A":{if(!Object.keys($t.recipes).length){Na.draw(Na.get($a));break}this.switchFlag(),qt.synthesize=!0,$t.showInventory(xe),$t.showInventory(qe);let e=Na.get(Fi)+Na.get(ui);Na.draw(e,!0);break}case"c":case"o":if(this.isCtrl)break;if("o"===e?qt.openDoor=!0:qt.closeDoor=!0,$t.searchDoor()<=1){qt.openDoor=qt.closeDoor=!1;break}this.switchFlag(),Na.draw(Na.get(wa),!0);break;case"C":this.switchFlag(),qt.character=!0,or.main($t,dt,!0),Vue.nextTick(function(){or.scroll(e,!0)});break;case"d":if(this.isCtrl){this.switchFlag();let e=Na.get(di)+Na.get(ui);Na.draw(e,!0),qt.destroy=!0,$t.showInventory(xe),$t.equipmentList()}else{this.switchFlag(),qt.drop=!0;let e=Na.get($i);$t.showInventory(xe),$t.equipmentList(),Na.draw(e,!0)}break;case"e":if(this.isCtrl){if(!$t.isWizard)break;vr.lighten(),vr.draw()}else qt.equipment=!qt.equipment,qt.equipment?$t.equipmentList():(Fr.clear(),qt.inventory&&$t.showInventory(xe));break;case"E":{this.switchFlag(),qt.eat=!0;let e=Na.get(Ii)+Na.get(ui);$t.showInventory(xe),Na.draw(e,!0);break}case"f":if(this.isCtrl)break;if(!$t.haveMissile(!0))break;if($t.ci=$t.getAmmo($t.equipment.main.throwType),!$t.ci){Na.draw(Na.get(Si));break}this.switchFlag(),qt.arrow=!0,qt.aim=!0,Na.draw(Na.get(Ra)+Na.get(Bi),!0),$t.examinePlot(!0);break;case"F":{if(!$t.equipment.light){Na.draw(Na.get(Ti));break}this.switchFlag(),qt.fuel=!0;let e=Na.get(Pi)+Na.get(ui);$t.showInventory(xe),$t.equipmentList(),Na.draw(e,!0);break}case"g":if(this.isCtrl)break;$t.grabItem();break;case"G":{this.switchFlag(),qt.gain=1,$t.showInventory(xe),Fr.showStats($t);let e=Na.get(ta);Na.draw(e,!0);break}case"i":if(this.isCtrl){if(!$t.isWizard)break;this.switchFlag(),qt.create="item",cp.input(),Na.draw("Input type, tabId and quantity",!0)}else qt.inventory=!qt.inventory,qt.inventory?$t.showInventory(xe):(Fr.clear(),qt.equipment&&$t.equipmentList());break;case"I":{if(this.isCtrl)break;this.switchFlag(),qt.investigate=!0;let e=Na.get(Ni)+Na.get(ui);$t.showInventory(xe),$t.equipmentList(),Na.draw(e,!0);break}case"m":if(this.isCtrl)break;if(!$t.checkToCast())break;this.switchFlag(),qt.skill=!0,$t.showSkill($t.skill),Na.draw(Na.get(sa),!0);break;case"M":this.switchFlag(),qt.minimap=!0,vr.drawMini("a"),Na.draw(Na.get(Ji),!0);break;case"p":if(this.isCtrl)this.switchFlag(),qt.message=!0,Vue.nextTick(function(){Na.scroll(!1,!0)});else{this.switchFlag(),qt.pack=!0;let e=Na.get(Vi)+Na.get(ui);$t.showInventory(xe),$t.showInventory(Se),Na.draw(e,!0)}break;case"q":if(this.isCtrl){if(!$t.isWizard)break;$t.haveCast(As,10),vr.draw()}else{this.switchFlag(),qt.quaff=!0;let e=Na.get(Ei)+Na.get(ui);$t.showInventory(xe),Na.draw(e,!0)}break;case"Q":this.switchFlag(),qt.quit=!0,Na.draw(Na.get(Ba),!0);break;case"r":if(this.isCtrl)vr.redraw();else{if(!$t.canRead())break;this.switchFlag(),qt.read=!0;let e=Na.get(gi)+Na.get(ui);$t.showInventory(xe),Na.draw(e,!0)}break;case"R":qt.rest=!0,$t.rest();break;case"s":this.isCtrl?dr.save():$t.searchHiddenObject();break;case"S":$t.swap();break;case"t":{if(this.isCtrl)break;this.switchFlag();let e=Na.get(Ma)+Na.get(ui);$t.showInventory(xe),Na.draw(e,!0),qt.throw=!0;break}case"T":{if($t.isNaked()){Na.draw(Na.get(xa));break}this.switchFlag();let e=Na.get(Sa);Na.draw(e,!0),$t.equipmentList(),$t.showInventory(xe),qt.unequip=!0;break}case"v":this.isCtrl&&Na.draw(`Death and Birth ver ${s.toFixed(3)}`);break;case"w":{if(this.isCtrl)break;this.switchFlag(),qt.equip=!0;let e=Na.get(zi)+Na.get(ui);$t.showInventory(xe),$t.equipmentList(),Na.draw(e,!0);break}case"x":if(this.isCtrl)this.switchFlag(),dr.exit();else{if($t.blinded){Na.draw(Na.get(Mi));break}this.switchFlag(),qt.examine=!0,Rr.init(),vr.coords[$t.x][$t.y].getInfo()}break;case"z":if(this.isCtrl){if(!$t.isWizard)break;$t.indestructible=!$t.indestructible}else{this.switchFlag(),qt.zap=!0;let e=Na.get(Ri)+Na.get(ui);$t.showInventory(xe),Na.draw(e,!0)}break;case"F1":case"F2":case"F3":case"F4":case"F5":case"F6":case"F7":case"F8":case"F9":case"F10":case"F11":case"F12":if(this.isCtrl)break;$t.castAssignedSkill(e);break;case"=":if(this.isCtrl)break;this.switchFlag(),qt.option=!0,Na.draw(Na.get(pa),!0),Fr.show({list:Pt.list,dr:lt});break;case"<":case">":if(this.isCtrl)break;$t.downOrUpStairs(e);break;case".":if(this.isCtrl)break;vr.coords[$t.x][$t.y].getInfo(!0)||($t.done=!0);break;case"?":if(this.isCtrl)break;this.switchFlag(),qt.help=!0,Vue.nextTick(function(){up.scroll(!1,!0)})}},switchFlag(){Fr.clear(),qt.inventory=!1,qt.equipment=!1,qt.regular=!1},scroll(e,t,i,a){if(!a&&"c"===i)return void $t.cancelCommand();let s,l,r,n,o,h,d=ti(i);(a||d)&&(a?(s=-e.scrollWidth,l=-e.scrollHeight):d.id===it?r=!0:d.id===at?n=!0:d.id===st?o=!0:d.id===lt&&(h=!0),o||n?(this.isCtrl?l=e.scrollHeight:this.isShift?l=e.getBoundingClientRect().height:t&&(l=t.getBoundingClientRect().height),o&&(l=-l)):(r||h)&&(this.isCtrl?s=e.scrollWidth:this.isShift?s=e.getBoundingClientRect().width:t&&(s=t.getBoundingClientRect().width),r&&(s=-s)),void 0!==s&&(e.scrollLeft+=s),void 0!==l&&(e.scrollTop+=l))}};Vue.component("item-key",{props:["item"],template:'\n        <li class="item-key">{{ item.key }}</li>\n    '}),Vue.component("item-parts",{props:["item"],template:'\n        <li\n        v-show="item.parts"\n        class="item-parts">{{ item.parts }}</li>\n    '}),Vue.component("item-symbol",{props:["item"],template:"\n        <li\n            class=\"item-symbol\"\n            v-show=\"item.symbol\"\n            :style=\"{ \n                color: item.symbolColor,\n                'text-shadow': item.shadow ? '1px 1px 0 ' + item.shadow : '',\n                'text-stroke': item.stroke ? '1px ' + item.stroke : '',\n            }\"\n        >{{ item.symbol }}</li>\n    "}),Vue.component("item-name",{props:["item"],template:"\n        <li\n            class=\"item-name flex-ellipsis\"\n            :style=\"{ \n                color: item.nameColor ? item.nameColor : '',\n                'text-shadow': item.shadow ? '1px 1px 0 ' + item.shadow : '',\n                'text-stroke': item.stroke ? '1px ' + item.stroke : '',\n            }\"\n        >{{ item.name }}</li>\n    "}),Vue.component("item-price",{props:["item"],template:'\n        <li\n            v-show="item.price"\n            class="item-price"\n        >{{ item.price }}</li>\n    '}),Vue.component("item-weight",{props:["item"],template:'\n        <li\n            v-show="item.weight"\n            class="item-weight"\n        >{{ item.weight + \' kg\' }}</li>\n    '}),Vue.component("item-select",{props:["item"],template:'\n        <li\n            v-show="item.select !== undefined"\n            class="item-select"\n        >{{ item.select }}</li>\n    '}),Vue.component("item-list",{props:["items"],template:'\n        <ul class="item-list">\n            <li v-for="item in items">\n                <ul class="item-prop-list">\n                    <item-key :item="item"></item-key>\n                    <item-parts :item="item"></item-parts>\n                    <item-symbol :item="item"></item-symbol>\n                    <item-name :item="item"></item-name>\n                    <item-price :item="item"></item-price>\n                    <item-weight :item="item"></item-weight>\n                    <item-select :item="item"></item-select>\n                </ul>\n            </li>\n        </ul>\n    '}),Vue.component("inv-bottom",{props:["left","right"],template:'\n        <ul \n            v-show="left || right"\n            class="inv-bottom"\n         >\n            <li v-show="left">{{ left }}</li>\n            <li v-show="right">{{ right }}</li>\n        </ul>\n    '}),Vue.component("inventory",{props:["inv"],template:'\n        <div\n            v-if="inv.show"\n            class="inventory"\n        >\n            <item-list :items="inv.items"></item-list>\n            <inv-bottom\n                :left="inv.left"\n                :right="inv.right"\n            ></inv-bottom>\n        </div>\n    '}),Vue.component("stats-list",{props:["list"],template:"\n        <ul class=\"stats-list\">\n            <li\n                class=\"stats-prop-list\"\n                v-for=\"stats in list\"\n                :style=\"{ \n                    color: stats.color ? stats.color : '',\n                    'text-shadow': stats.shadow ? '1px 1px 0 ' + stats.shadow : ''\n                }\"\n            >\n                <span class=\"flex-ellipsis\">{{ stats.name }}</span>\n                <span>\n                    {{ stats.value }}\n                    <span v-show=\"stats.valueMax !== undefined\">{{ ' (' + stats.valueMax + ')' }}</span>\n                </span>\n            </li>\n        </ul>\n    "}),Vue.component("equipment",{props:["inv"],template:'\n        <div\n            v-if="inv.show"\n            class="inventory left"\n        >\n            <item-list :items="inv.items"></item-list>\n            <div class="stats-list-box">\n                <stats-list :list="inv.statsLeft"></stats-list>\n                <stats-list :list="inv.statsRight"></stats-list>\n            </div>\n            <inv-bottom\n                :left="inv.left"\n                :right="inv.right"\n            ></inv-bottom>\n        </div>\n    '}),Vue.component("skill-list",{props:["skills","invest"],template:'\n        <ul class="skill-list">\n            <li\n                v-for="skill in skills"\n                class="skill"\n                :style="{\n                    color: skill.color ? skill.color : \'\',\n                    \'text-shadow\': skill.shadow ? \'1px 1px 0 \' + skill.shadow : \'\'\n                }"\n            >\n                <ul class="skill-prop-list">\n                    <li\n                        v-if="!invest"\n                        class="skill-key"\n                    >{{ skill.key }}</li>\n                    <li\n                        class="skill-name flex-ellipsis"\n                    >{{ skill.name }}</li>\n                    <li \n                        v-if="!invest"\n                        class="skill-lvl"\n                    >{{ skill.lvl }}</li>\n                    <li\n                        v-if="!invest"\n                        class="skill-value"\n                    >{{ skill.value }}</li>\n                    <li\n                        v-if="invest"\n                        class="skill-element"\n                    >{{ skill.element }}</li>\n                    <li\n                        v-if="!invest"\n                        class="skill-mp"\n                        :style="{\n                            color: skill.mpColor ? skill.mpColor : \'\',\n                            \'text-shadow\': skill.mpColor ? \'none\' : \'\',\n                        }"\n                    >{{ skill.mp }}</li>\n                    <li class="skill-reqLv"\n                        :style="{\n                            color: skill.reqLvColor ? skill.reqLvColor : \'\',\n                            \'text-shadow\': skill.reqLvColor ? \'none\' : \'\',\n                        }"\n                    >{{ skill.reqLv }}</li>\n                    <li \n                        class="skill-reqSy"\n                        :style="{\n                            color: skill.reqSyColor ? skill.reqSyColor : \'\',\n                            \'text-shadow\': skill.reqSyColor ? \'none\' : \'\',\n                        }"\n                    >{{ skill.reqSy }}</li>\n                </ul>\n            </li>\n        </ul>\n    '}),Vue.component("skill",{props:["inv"],template:'\n        <div\n            v-if="inv.show"\n            class="inventory"\n        >\n            <skill-list :skills="inv.items"></skill-list>\n            <inv-bottom\n                :left="inv.left"\n                :right="inv.right"\n            ></inv-bottom>\n        </div>\n    '}),Vue.component("command-list",{props:["cmdList","isEnglish"],template:'\n        <ul class="command-list">\n            <li v-for="command in cmdList">\n                <ul class="command">\n                    <li class="command-key">{{ command.cmd[isEnglish ? \'a\' : \'b\'] }}</li>\n                    <li class="command-text">{{ command.name[isEnglish ? \'a\' : \'b\'] }}</li>\n                </ul>\n            </li>\n        </ul>\n    '}),Vue.component("help",{props:["help","rogue","isEnglish"],template:'\n        <div\n            class="inventory middle"\n        >\n            <div \n                ref="commandListBox"\n                class="command-list-box"\n            >\n                <command-list\n                    ref="commandList"\n                    :cmd-list="help.listLeft"\n                    :isEnglish="isEnglish"\n                ></command-list>\n                <div class="command-list-box-right">\n                    <command-list\n                        :cmd-list="help.listRight"\n                        :isEnglish="isEnglish"\n                    ></command-list>\n                    <command-list\n                        v-if="rogue&&rogue.isWizard"\n                        :cmd-list="help.listWizard"\n                        :isEnglish="isEnglish"\n                    ></command-list>\n                </div>\n            </div>\n            <inv-bottom\n                :left="isEnglish ? \'Command List\' : \'コマンド一覧\'"\n            ></inv-bottom>\n        </div>\n    '}),Vue.component("message-temp",{props:["list"],template:"\n        <div class=\"message-temp-box\">\n            <ul>\n                <li\n                    v-for=\"msg in list\"\n                >{{ msg.text + (msg.count > 1 ? ' (x' + msg.count + ')' : '') }}</li>\n            </ul>\n        </div>\n    "}),Vue.component("message-prev",{props:["list","total"],template:'\n        <div class="inventory middle">\n            <ul ref="messagePrevList"\n                class="message-list"\n            >\n                <li v-for="msg in list">{{ msg.text + (msg.count > 1 ? \' (x\' + msg.count + \')\' : \'\') }}</li>\n            </ul>\n            <inv-bottom\n                :left="total"\n            ></inv-bottom>\n        </div>\n    '}),Vue.component("investigation-item",{props:["inv"],template:'\n        <div\n            v-if="inv.show"\n            class="inventory investigation"\n        >\n            <ul class="item-prop-list">\n                <item-symbol :item="inv.obj"></item-symbol>\n                <item-name :item="inv.obj"></item-name>\n            </ul>\n            <p\n                v-show="inv.desc"\n                class="description"\n                >{{ inv.desc }}</p>\n            <ul class="base-prop-list">\n                <li v-for="prop in inv.basePropList">\n                    <ul\n                        class="base-prop"\n                        :style="{ \n                            \'text-shadow\': prop && prop.shadow ? \'1px 1px 0 \' + prop.shadow : \'\'\n                        }"\n                    >\n                        <li>{{ prop.text }}</li>\n                        <li>{{ prop.value }}</li>\n                    </ul>\n                </li>\n            </ul>\n            <ul class="embedded-list">\n                <li v-for="item in inv.embeddedList">\n                    <ul class="embedded-prop">\n                        <item-symbol :item="item"></item-symbol>\n                        <item-name :item="item"></item-name>\n                    </ul>\n                </li>\n            </ul>\n            <ul class="mod-prop-list">\n                <li v-for="prop in inv.modPropList">\n                    <ul class="mod-prop buff">\n                        <li>{{ prop.text }}</li>\n                        <li v-show="prop.value">{{ prop.value }}</li>\n                    </ul>\n                </li>\n            </ul>\n            <ul class="mod-parts-list">\n                <li v-for="(props, key) in inv.modPartsList">\n                    <ul class="mod-parts-prop-list">\n                        <li class="mod-parts">{{ key }}</li>\n                        <li>\n                            <ul\n                                v-for="prop in props"\n                                class="mod-prop buff"\n                            >\n                                <li>{{ prop.text }}</li>\n                                <li v-show="prop.value">{{ prop.value }}</li>\n                            </ul>\n                        </li>\n                    </ul>\n                </li>\n            </ul>\n            <skill-list\n                :skills="inv.skills"\n                :invest="true"\n            ></skill-list>\n        </div>\n    '}),Vue.component("investigation-fighter",{props:["inv"],
template:'\n        <div\n            v-if="inv.show"\n            class="inventory investigation"\n        \n        >\n            <ul class="item-prop-list">\n                <item-symbol :item="inv.obj"></item-symbol>\n                <item-name :item="inv.obj"></item-name>\n            </ul>\n            <p\n                v-show="inv.desc"\n                class="description"\n            >{{ inv.desc }}</p>\n            <ul\n                ref="fighterPropList"\n                class="base-prop-list"\n            >\n                <li v-for="prop in inv.basePropList">\n                    <ul\n                        class="base-prop"\n                        :style="{ \n                            \'text-shadow\': prop && prop.shadow ? \'1px 1px 0 \' + prop.shadow : \'\'\n                        }"\n                    >\n                        <li>{{ prop.text }}</li>\n                        <li>{{ prop.value }}</li>\n                    </ul>\n                </li>\n            </ul>\n        </div>\n    '}),Vue.component("investigation-skill",{props:["inv"],template:'\n        <div\n            v-if="inv.show"\n            class="inventory investigation"\n        >\n            <ul class="item-prop-list">\n                <item-symbol :item="inv.obj"></item-symbol>\n                <item-name :item="inv.obj"></item-name>\n            </ul>\n            <p class="description">{{ inv.desc }}</p>\n            <ul class="base-prop-list">\n                <li v-for="prop in inv.basePropList">\n                    <ul\n                        class="base-prop"\n                        :style="{ \n                            \'text-shadow\': prop && prop.shadow ? \'1px 1px 0 \' + prop.shadow : \'\'\n                        }"\n                    >\n                        <li>{{ prop.text }}</li>\n                        <li>{{ prop.value }}</li>\n                    </ul>\n                </li>\n            </ul>\n        </div>\n    '}),Vue.component("recipe",{props:["inv"],template:'\n        <div\n            v-if="inv.show"\n            class="inventory middle"\n        >\n            <ul class="item-list">\n                <li v-for="item in inv.items">\n                    <ul class="item-prop-list">\n                        <li class="item-name">{{ item.name }}</li>\n                        <li class="item-cost">{{ item.cost }}</li>\n                        <li class="item-recipe">{{ item.recipe }}</li>\n                    </ul>\n                </li>\n            </ul>\n        </div>\n    '}),Vue.component("enemy-bar",{props:["enemy","name","rogue","colorList"],template:"\n        <div>\n            <div \n                v-if=\"enemy\"\n                class=\"enemy-bar-box\"\n            >\n                <p\n                    :style=\"{ \n                        color: enemy.cursed ? colorList.red : '',\n                        'text-shadow': enemy.shadow ? '1px 1px 0 ' + enemy.shadow : '',\n                        'text-stroke': enemy.stroke ? '1px ' + enemy.stroke : '',\n                    }\"\n                >{{ 'Lv' + enemy.lvl + ' ' + name }}</p>\n                <div class=\"enemy-bar\">\n                    <span \n                        class=\"hp\"\n                        :style=\"{ \n                            width: (enemy.hp < 0 ? 0 : enemy.hp / enemy.hpMax * 100) + '%',\n                            'background-color': (\n                                enemy.sleeping ? colorList.royalblue :\n                                enemy.paralyzed ? colorList.orange :\n                                enemy.confused ? colorList.yellow :\n                                enemy.blinded ? colorList.gray :\n                                enemy.hallucinated ? colorList.purple :\n                                enemy.canceled ? colorList.white :\n                                enemy.infected ? colorList.infection :\n                                enemy.poisoned ? colorList.poison :\n                                ''\n                            )\n                        }\"\n                    ></span>\n                </div>\n            </div>\n            <span\n                v-if=\"rogue.ce\"\n                class=\"enemy-icon\"\n                :style=\"{ \n                    color: rogue.ce.color,\n                    'text-shadow': rogue.ce.shadow ? '1px 1px 0 ' + rogue.ce.shadow : '',\n                    'text-stroke': rogue.ce.stroke ? '1px ' + rogue.ce.stroke : '',\n                }\"\n            >{{ rogue.ce.symbol }}</span>\n        </div>\n    "}),Vue.component("condition",{props:["rogue","colorList","isEnglish"],template:"\n        <div \n            :style=\"{ \n                'background-color': rogue.hallucinated ? 'rgba(128, 0, 128, 0.15)' : '',\n            }\"\n        >\n            <ul>\n                <li\n                    v-if=\"rogue.hunger >= 1600\"\n                    :style=\"{ color: colorList.lime }\"\n                >{{ isEnglish ? 'full' : '満腹'}}</li>\n                <li\n                    v-else-if=\"rogue.hunger > 0 && rogue.hunger <= 200\"\n                    :style=\"{ color: colorList.yellow }\"\n                >{{ isEnglish ? 'hungry' : '空腹'}}</li>\n                <li\n                    v-else-if=\"rogue.hunger === 0\"\n                    :style=\"{ color: colorList.red }\"\n                >{{ isEnglish ? 'starved' : '飢餓'}}</li>\n                <li\n                    v-if=\"rogue.poisoned\"\n                    :style=\"{ color: colorList.poison }\"\n                >{{ isEnglish ? 'poisoned' : '毒'}}</li>\n                <li\n                    v-if=\"rogue.confused\"\n                    :style=\"{ color: colorList.yellow }\"\n                >{{ isEnglish ? 'confused' : '混乱'}}</li>\n                <li\n                    v-if=\"rogue.paralyzed\"\n                    :style=\"{ color: colorList.orange }\"\n                >{{ isEnglish ? 'paralyzed' : '麻痺'}}</li>\n                <li\n                    v-if=\"rogue.sleeping > 0\"\n                    :style=\"{ color: colorList.royalblue }\"\n                >{{ isEnglish ? 'sleeping' : '睡眠'}}</li>\n                <li\n                    v-if=\"rogue.blinded\"\n                    :style=\"{ color: colorList.gray }\"\n                >{{ isEnglish ? 'blinded' : '盲目'}}</li>\n                <li\n                    v-if=\"rogue.infected\"\n                    :style=\"{ color: colorList.infection }\"\n                >{{ isEnglish ? 'infected' : '感染'}}</li>\n                <li\n                    v-if=\"rogue.hallucinated\"\n                    :style=\"{ color: colorList.purple }\"\n                >{{ isEnglish ? 'hallucinated' : '幻覚'}}</li>\n                <li\n                    v-if=\"rogue.canceled\"\n                    :style=\"{ color: colorList.white }\"\n                >{{ isEnglish ? 'canceled' : '封印'}}</li>\n                <li\n                    v-if=\"rogue.seeInvisible\"\n                    :style=\"{\n                        color: colorList.light,\n                        'text-shadow': '1px 1px 0 ' + colorList.light\n                    }\"\n                >{{ isEnglish ? 'see invisible' : '透視'}}</li>\n                <li\n                    v-if=\"rogue.invisibility\"\n                    :style=\"{\n                        color: colorList.light,\n                        'text-shadow': '1px 1px 0 ' + colorList.light\n                    }\"\n                >{{ isEnglish ? 'invisible' : '透明'}}</li>\n                <li\n                    v-if=\"rogue.ecco\"\n                    :style=\"{ color: colorList.air }\"\n                >{{ isEnglish ? 'ecco' : 'エコー'}}</li>\n                <li\n                    v-if=\"rogue.enchantSelfDur\"\n                    :style=\"{ color: colorList.earth }\"\n                >{{ isEnglish ? 'enchant self' : '自己強化'}}</li>\n                <li\n                    v-if=\"rogue.venomDur\"\n                    :style=\"{ color: colorList.poison }\"\n                >{{ isEnglish ? 'venom hands' : '猛毒の手'}}</li>\n                <li\n                    v-if=\"rogue.confusing\"\n                    :style=\"{ color: colorList.poison }\"\n                >{{ isEnglish ? 'confusing hands' : '混乱の手'}}</li>\n            </ul>\n        </div>\n    "}),Vue.component("stats-fixed",{props:["rogue","colorList","isEnglish"],template:"\n        <div>\n            <div class=\"stats-fixed-left-container\">\n                <div class=\"stats-fixed-bar\">\n                    <span \n                        class=\"hp\"\n                        :style=\"{ \n                            width: (rogue.hp < 0 ? 0 : rogue.hp / rogue.hpMax * 100) + '%',\n                            'background-color': (\n                                rogue.sleeping ? colorList.royalblue :\n                                rogue.paralyzed ? colorList.orange :\n                                rogue.confused ? colorList.yellow :\n                                rogue.blinded ? colorList.gray :\n                                rogue.hallucinated ? colorList.purple :\n                                rogue.canceled ? colorList.white :\n                                rogue.infected ? colorList.infection :\n                                rogue.poisoned ? colorList.poison :\n                                ''\n                            )\n                        }\"\n                    ></span>\n                </div>\n                <div class=\"stats-fixed-box\">\n                    <ul class=\"stats-fixed-list-top\">\n                        <li\n                            :style=\"{ color: rogue.lvl < rogue.lvlMax ? colorList.yellow : '' }\"\n                        >{{ (isEnglish ? 'Level ' : 'レベル ') + rogue.lvl }}</li>\n                        <li\n                            :class=\"{ \n                                buff: rogue.expBuff,\n                            }\"\n\n                            :style=\"{\n                                color: rogue.exp < rogue.expMax ? colorList.yellow : '',\n                            }\"\n                        >{{ (isEnglish ? 'Exp ' : '経験値 ') + rogue.exp }}</li>\n                        <li>{{ '$ ' + rogue.purse }}</li>\n                        <li\n                            :style=\"{\n                                color: rogue.hp <= 0 ? colorList.red : '',\n                            }\"\n                        >{{ 'HP '+ rogue.hp + '/' + rogue.hpMax }}</li>\n                    </ul>\n                    <ul class=\"stats-fixed-list-bottom\">\n                        <li \n                            class=\"rogue-boxes-list\"\n                            v-for=\"(item, key) in rogue.boxes\"\n                        >\n                            <span\n                                :style=\"{ \n                                    color: item ? item && item.color : '',\n                                    'text-shadow': item && item.shadow ? '1px 1px 0 ' + item.shadow : '',\n                                    'text-stroke': item && item.stroke ? '1px ' + item.stroke : '',\n                                }\"\n                            >{{ item ? item.symbol : key }}</span>\n                            <span \n                                class=\"item-num\"\n                                v-if=\"item\"\n                            >{{ item.quantity }}</span>\n                            <span \n                                class=\"item-charge\"\n                                v-if=\"item && item.identified && isFinite(item.charges)\"\n                            >{{ item.charges}}</span>\n                        </li>\n                    </ul>\n                </div>\n            </div>\n            <div class=\"stats-fixed-right-container\">\n                <div class=\"stats-fixed-bar\">\n                    <span class=\"mp\"\n                        :style=\"{ \n                            width: (rogue.mp < 0 ? 0 : rogue.mp / rogue.mpMax * 100) + '%'\n                        }\"\n                    ></span>\n                </div>\n                <div class=\"stats-fixed-box\">\n                    <ul class=\"stats-fixed-list-top\">\n                        <li\n                            :style=\"{\n                                color: rogue.mp <= 0 ? colorList.red : '',\n                            }\"\n                        >{{ 'MP '+ rogue.mp + '/' + rogue.mpMax }}</li>\n                        <li\n                            :class=\"{ \n                                sustain: rogue.strSus\n                            }\"\n\n                            :style=\"{\n                                color: rogue.str < rogue.strMax ? colorList.yellow : '',\n                            }\"\n                        >{{ (isEnglish ? 'Str ' : '筋 ') + rogue.str }}</li>\n                        <li\n                            :class=\"{ \n                                sustain: rogue.dexSus\n                            }\"\n\n                            :style=\"{\n                                color: rogue.dex < rogue.dexMax ? colorList.yellow : '',\n                            }\"\n                        >{{ (isEnglish ? 'Dex ' : '器 ') + rogue.dex }}</li>\n                        <li\n                            :class=\"{ \n                                sustain: rogue.conSus\n                            }\"\n\n                            :style=\"{\n                                color: rogue.con < rogue.conMax ? colorList.yellow : '',\n                            }\"\n                        >{{ (isEnglish ? 'Con ' : '耐 ') + rogue.con }}</li>\n                        <li\n                            :class=\"{ \n                                sustain: rogue.intSus\n                            }\"\n\n                            :style=\"{\n                                color: rogue.int < rogue.intMax ? colorList.yellow : '',\n                            }\"\n                        >{{ (isEnglish ? 'Int ' : '知 ') + rogue.int }}</li>\n                        <li\n                            :class=\"{ \n                                buff: rogue.spdBuffDur\n                            }\"\n\n                            :style=\"{\n                                color: rogue.spdNerfDur ? colorList.red : '',\n                            }\"\n                        >{{ (isEnglish ? 'Spd ' : '速 ') + rogue.spd + '%' }}</li>\n                    </ul>\n                    <div class=\"stats-fixed-list-bottom\">\n                        <span v-if=\"!rogue.cdl\">{{ isEnglish ? 'Limbo' : '辺獄' }}</span>\n                        <span v-else-if=\"rogue.cdl >= 1 && rogue.cdl <= 33\">{{ (isEnglish ? 'Hell B' : '地獄 地下') + rogue.cdl }}</span>\n                        <span v-else-if=\"rogue.cdl >= 34 && rogue.cdl <= 66\">{{ (isEnglish ? 'Purgatory ' : '煉獄') + (rogue.cdl - 33) }}</span>\n                        <span v-else-if=\"rogue.cdl >= 67 && rogue.cdl <= 99\">{{ (isEnglish ? 'Heaven ' : '天国') + (rogue.cdl - 66) }}</span>\n                    </div>\n                </div>\n            </div>\n        </div>\n    "}),Vue.component("game-loader",{props:["flag","ver","verData","isEnglish"],template:'\n\t\t<div>\n\t\t\t<div\n\t\t\t\tclass="title"\n\t\t\t\tv-if="flag.title || flag.failed"\n\t\t\t\tv-cloak\n\t\t\t>\n\t\t\t\t<p\n\t\t\t\t\tclass="err-msg"\n\t\t\t\t\tv-show="flag.failed"\n\t\t\t\t>\n\t\t\t\t\t{{ (isEnglish ?\n\t\t\t\t\t"Failed to load. In order to delete your save data and continue, please push \'Y\'" :\n\t\t\t\t\t"読み込みに失敗しました。セーブデータを消去してゲームを続けるには、\'Y\'を押してください。")\n\t\t\t\t\t+ "(data ver " + verData.toFixed(3) + ")" }}\n\t\t\t\t</p>\n\t\t\t\t<div class="msg-box">\n\t\t\t\t\t<h1>Death and Birth</h1>\n\t\t\t\t\t<h2>{{ isEnglish ?\n\t\t\t\t\t\t\'[Enter] to start\' :\n\t\t\t\t\t\t\'[Enter] ゲームスタート\' }}\n\t\t\t\t\t</h2>\n\t\t\t\t</div>\n\t\t\t\t<small class="ver">{{ "ver " + ver.toFixed(3) }}</small>\n\t\t\t</div>\n\t\t\t<div\n\t\t\t\tclass="retry"\n\t\t\t\tv-else-if="flag.retry"\n\t\t\t\tv-cloak\n\t\t\t>\n\t\t\t\t<div class="msg-box">\n\t\t\t\t\t<h1>G A M E  O V E R</h1>\n\t\t\t\t\t<h2>{{ isEnglish ?\n\t\t\t\t\t\t\'[Enter] to retry\' :\n\t\t\t\t\t\t\'[Enter] リトライ\' }}\n\t\t\t\t\t</h2>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n    '}),window.onload=(()=>{e(),Vue.nextTick(function(){Ct.init(),pp.title(!0),gp.init()})})})();